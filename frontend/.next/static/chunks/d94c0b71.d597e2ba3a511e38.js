(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[644],{4613:function(en){/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.8.0/LICENSE.txt
 */en.exports=function(){"use strict";var en={},es={};function define(ec,ed,ep){if(es[ec]=ep,"index"===ec){var ef="var sharedModule = {}; ("+es.shared+")(sharedModule); ("+es.worker+")(sharedModule);",em={};return es.shared(em),es.index(en,em),"undefined"!=typeof window&&en.setWorkerUrl(window.URL.createObjectURL(new Blob([ef],{type:"text/javascript"}))),en}}return define("shared",["exports"],function(en){let es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC,eI;function e(en,es,ec,ed){return new(ec||(ec=Promise))(function(ep,ef){function a(en){try{l(ed.next(en))}catch(en){ef(en)}}function o(en){try{l(ed.throw(en))}catch(en){ef(en)}}function l(en){var es;en.done?ep(en.value):((es=en.value)instanceof ec?es:new ec(function(en){en(es)})).then(a,o)}l((ed=ed.apply(en,es||[])).next())})}function r(en,es){this.x=en,this.y=es}function n(en){return en&&en.__esModule&&Object.prototype.hasOwnProperty.call(en,"default")?en.default:en}"function"==typeof SuppressedError&&SuppressedError,r.prototype={clone(){return new r(this.x,this.y)},add(en){return this.clone()._add(en)},sub(en){return this.clone()._sub(en)},multByPoint(en){return this.clone()._multByPoint(en)},divByPoint(en){return this.clone()._divByPoint(en)},mult(en){return this.clone()._mult(en)},div(en){return this.clone()._div(en)},rotate(en){return this.clone()._rotate(en)},rotateAround(en,es){return this.clone()._rotateAround(en,es)},matMult(en){return this.clone()._matMult(en)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(en){return this.x===en.x&&this.y===en.y},dist(en){return Math.sqrt(this.distSqr(en))},distSqr(en){let es=en.x-this.x,ec=en.y-this.y;return es*es+ec*ec},angle(){return Math.atan2(this.y,this.x)},angleTo(en){return Math.atan2(this.y-en.y,this.x-en.x)},angleWith(en){return this.angleWithSep(en.x,en.y)},angleWithSep(en,es){return Math.atan2(this.x*es-this.y*en,this.x*en+this.y*es)},_matMult(en){let es=en[2]*this.x+en[3]*this.y;return this.x=en[0]*this.x+en[1]*this.y,this.y=es,this},_add(en){return this.x+=en.x,this.y+=en.y,this},_sub(en){return this.x-=en.x,this.y-=en.y,this},_mult(en){return this.x*=en,this.y*=en,this},_div(en){return this.x/=en,this.y/=en,this},_multByPoint(en){return this.x*=en.x,this.y*=en.y,this},_divByPoint(en){return this.x/=en.x,this.y/=en.y,this},_unit(){return this._div(this.mag()),this},_perp(){let en=this.y;return this.y=this.x,this.x=-en,this},_rotate(en){let es=Math.cos(en),ec=Math.sin(en),ed=ec*this.x+es*this.y;return this.x=es*this.x-ec*this.y,this.y=ed,this},_rotateAround(en,es){let ec=Math.cos(en),ed=Math.sin(en),ep=es.y+ed*(this.x-es.x)+ec*(this.y-es.y);return this.x=es.x+ec*(this.x-es.x)-ed*(this.y-es.y),this.y=ep,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:r},r.convert=function(en){if(en instanceof r)return en;if(Array.isArray(en))return new r(+en[0],+en[1]);if(void 0!==en.x&&void 0!==en.y)return new r(+en.x,+en.y);throw Error("Expected [x, y] or {x, y} point format")};var eE,eA,ez,ek=n(function(){if(tT)return tw;function t(en,es,ec,ed){this.cx=3*en,this.bx=3*(ec-en)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*es,this.by=3*(ed-es)-this.cy,this.ay=1-this.cy-this.by,this.p1x=en,this.p1y=es,this.p2x=ec,this.p2y=ed}return tT=1,tw=t,t.prototype={sampleCurveX:function(en){return((this.ax*en+this.bx)*en+this.cx)*en},sampleCurveY:function(en){return((this.ay*en+this.by)*en+this.cy)*en},sampleCurveDerivativeX:function(en){return(3*this.ax*en+2*this.bx)*en+this.cx},solveCurveX:function(en,es){if(void 0===es&&(es=1e-6),en<0)return 0;if(en>1)return 1;for(var ec=en,ed=0;ed<8;ed++){var ep=this.sampleCurveX(ec)-en;if(Math.abs(ep)<es)return ec;var ef=this.sampleCurveDerivativeX(ec);if(1e-6>Math.abs(ef))break;ec-=ep/ef}var em=0,e_=1;for(ec=en,ed=0;ed<20&&!(Math.abs((ep=this.sampleCurveX(ec))-en)<es);ed++)en>ep?em=ec:e_=ec,ec=.5*(e_-em)+em;return ec},solve:function(en,es){return this.sampleCurveY(this.solveCurveX(en,es))}},tw}());function c(){return null==es&&(es="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),es}function h(){if(null==ec&&(ec=!1,c())){let en=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(en){for(let es=0;es<25;es++){let ec=4*es;en.fillStyle=`rgb(${ec},${ec+1},${ec+2})`,en.fillRect(es%5,Math.floor(es/5),1,1)}let es=en.getImageData(0,0,5,5).data;for(let en=0;en<100;en++)if(en%4!=3&&es[en]!==en){ec=!0;break}}}return ec||!1}var eD="undefined"!=typeof Float32Array?Float32Array:Array;function d(){var en=new eD(9);return eD!=Float32Array&&(en[1]=0,en[2]=0,en[3]=0,en[5]=0,en[6]=0,en[7]=0),en[0]=1,en[4]=1,en[8]=1,en}function y(en){return en[0]=1,en[1]=0,en[2]=0,en[3]=0,en[4]=0,en[5]=1,en[6]=0,en[7]=0,en[8]=0,en[9]=0,en[10]=1,en[11]=0,en[12]=0,en[13]=0,en[14]=0,en[15]=1,en}function m(){var en=new eD(3);return eD!=Float32Array&&(en[0]=0,en[1]=0,en[2]=0),en}function g(en){var es=en[0],ec=en[1],ed=en[2];return Math.sqrt(es*es+ec*ec+ed*ed)}function x(en,es,ec){var ed=new eD(3);return ed[0]=en,ed[1]=es,ed[2]=ec,ed}function v(en,es,ec){return en[0]=es[0]+ec[0],en[1]=es[1]+ec[1],en[2]=es[2]+ec[2],en}function b(en,es,ec){return en[0]=es[0]*ec,en[1]=es[1]*ec,en[2]=es[2]*ec,en}function w(en,es,ec){var ed=es[0],ep=es[1],ef=es[2],em=ec[0],e_=ec[1],eg=ec[2];return en[0]=ep*eg-ef*e_,en[1]=ef*em-ed*eg,en[2]=ed*e_-ep*em,en}function A(en,es,ec){var ed=es[0],ep=es[1],ef=es[2],em=es[3];return en[0]=ec[0]*ed+ec[4]*ep+ec[8]*ef+ec[12]*em,en[1]=ec[1]*ed+ec[5]*ep+ec[9]*ef+ec[13]*em,en[2]=ec[2]*ed+ec[6]*ep+ec[10]*ef+ec[14]*em,en[3]=ec[3]*ed+ec[7]*ep+ec[11]*ef+ec[15]*em,en}function k(){var en=new eD(4);return eD!=Float32Array&&(en[0]=0,en[1]=0,en[2]=0),en[3]=1,en}function M(en,es,ec,ed){var ep=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"zyx",ef=Math.PI/360;es*=ef,ed*=ef,ec*=ef;var em=Math.sin(es),e_=Math.cos(es),eg=Math.sin(ec),ey=Math.cos(ec),ex=Math.sin(ed),ev=Math.cos(ed);switch(ep){case"xyz":en[0]=em*ey*ev+e_*eg*ex,en[1]=e_*eg*ev-em*ey*ex,en[2]=e_*ey*ex+em*eg*ev,en[3]=e_*ey*ev-em*eg*ex;break;case"xzy":en[0]=em*ey*ev-e_*eg*ex,en[1]=e_*eg*ev-em*ey*ex,en[2]=e_*ey*ex+em*eg*ev,en[3]=e_*ey*ev+em*eg*ex;break;case"yxz":en[0]=em*ey*ev+e_*eg*ex,en[1]=e_*eg*ev-em*ey*ex,en[2]=e_*ey*ex-em*eg*ev,en[3]=e_*ey*ev+em*eg*ex;break;case"yzx":en[0]=em*ey*ev+e_*eg*ex,en[1]=e_*eg*ev+em*ey*ex,en[2]=e_*ey*ex-em*eg*ev,en[3]=e_*ey*ev-em*eg*ex;break;case"zxy":en[0]=em*ey*ev-e_*eg*ex,en[1]=e_*eg*ev+em*ey*ex,en[2]=e_*ey*ex+em*eg*ev,en[3]=e_*ey*ev-em*eg*ex;break;case"zyx":en[0]=em*ey*ev-e_*eg*ex,en[1]=e_*eg*ev+em*ey*ex,en[2]=e_*ey*ex-em*eg*ev,en[3]=e_*ey*ev+em*eg*ex;break;default:throw Error("Unknown angle order "+ep)}return en}function I(){var en=new eD(2);return eD!=Float32Array&&(en[0]=0,en[1]=0),en}function z(en,es){var ec=new eD(2);return ec[0]=en,ec[1]=es,ec}function C(en,es,ec){return es*(8192/(en.tileSize*Math.pow(2,ec-en.tileID.overscaledZ)))}function E(en,es){return(en%es+es)%es}function T(en,es,ec){return en*(1-ec)+es*ec}function B(en){if(en<=0)return 0;if(en>=1)return 1;let es=en*en,ec=es*en;return 4*(en<.5?ec:3*(en-es)+ec-.75)}function V(en,es,ec,ed){let ep=new ek(en,es,ec,ed);return en=>ep.solve(en)}m(),tP=new eD(4),eD!=Float32Array&&(tP[0]=0,tP[1]=0,tP[2]=0,tP[3]=0),m(),x(1,0,0),x(0,1,0),k(),k(),d(),I();let eR=V(.25,.1,.25,1);function D(en,es,ec){return Math.min(ec,Math.max(es,en))}function $(en,es,ec){let ed=ec-es,ep=((en-es)%ed+ed)%ed+es;return ep===es?ec:ep}function L(en,...es){for(let ec of es)for(let es in ec)en[es]=ec[es];return en}let eL=1;function R(en,es,ec){let ed={};for(let ec in en)ed[ec]=es.call(this,en[ec],ec,en);return ed}function U(en,es,ec){let ed={};for(let ec in en)es.call(this,en[ec],ec,en)&&(ed[ec]=en[ec]);return ed}function j(en){return Array.isArray(en)?en.map(j):"object"==typeof en&&en?R(en,j):en}let eB={};function q(en){eB[en]||("undefined"!=typeof console&&console.warn(en),eB[en]=!0)}function G(en,es,ec){return(ec.y-en.y)*(es.x-en.x)>(es.y-en.y)*(ec.x-en.x)}function X(en){return"undefined"!=typeof WorkerGlobalScope&&void 0!==en&&en instanceof WorkerGlobalScope}let eF=null;function Y(en){return"undefined"!=typeof ImageBitmap&&en instanceof ImageBitmap}let eO="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function K(en,es,ec,ed,ep){return e(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw Error("VideoFrame not supported");let ef=new VideoFrame(en,{timestamp:0});try{let em=null==ef?void 0:ef.format;if(!em||!em.startsWith("BGR")&&!em.startsWith("RGB"))throw Error(`Unrecognized format ${em}`);let e_=em.startsWith("BGR"),eg=new Uint8ClampedArray(ed*ep*4);if(yield ef.copyTo(eg,function(en,es,ec,ed,ep){let ef=Math.max(0,es),em=Math.max(0,ec);return{rect:{x:ef,y:em,width:Math.min(en.width,es+ed)-ef,height:Math.min(en.height,ec+ep)-em},layout:[{offset:(Math.max(0,ec)-ec)*ed*4+4*Math.max(-es,0),stride:4*ed}]}}(en,es,ec,ed,ep)),e_)for(let en=0;en<eg.length;en+=4){let es=eg[en];eg[en]=eg[en+2],eg[en+2]=es}return eg}finally{ef.close()}})}function Q(en,es,ec,ed){return en.addEventListener(es,ec,ed),{unsubscribe:()=>{en.removeEventListener(es,ec,ed)}}}function tt(en){return en*Math.PI/180}function et(en){return en/Math.PI*180}let ej={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},eV={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},eU="AbortError";function st(){return Error(eU)}let eN={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ot(en){return eN.REGISTERED_PROTOCOLS[en.substring(0,en.indexOf("://"))]}let eZ="global-dispatcher";let ut=class ut extends Error{constructor(en,es,ec,ed){super(`AJAXError: ${es} (${en}): ${ec}`),this.status=en,this.statusText=es,this.url=ec,this.body=ed}};let ct=()=>X(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,ht=function(en,es){var ec;if(/:\/\//.test(en.url)&&!/^https?:|^file:/.test(en.url)){let ec=ot(en.url);if(ec)return ec(en,es);if(X(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:en,targetMapId:eZ},es)}if(!(/^file:/.test(ec=en.url)||/^file:/.test(ct())&&!/^\w+:/.test(ec))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(en,es){return e(this,void 0,void 0,function*(){let ec,ed;let ep=new Request(en.url,{method:en.method||"GET",body:en.body,credentials:en.credentials,headers:en.headers,cache:en.cache,referrer:ct(),signal:es.signal});"json"!==en.type||ep.headers.has("Accept")||ep.headers.set("Accept","application/json");try{ec=yield fetch(ep)}catch(es){throw new ut(0,es.message,en.url,new Blob)}if(!ec.ok){let es=yield ec.blob();throw new ut(ec.status,ec.statusText,en.url,es)}ed="arrayBuffer"===en.type||"image"===en.type?ec.arrayBuffer():"json"===en.type?ec.json():ec.text();let ef=yield ed;if(es.signal.aborted)throw st();return{data:ef,cacheControl:ec.headers.get("Cache-Control"),expires:ec.headers.get("Expires")}})}(en,es);if(X(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:en,mustQueue:!0,targetMapId:eZ},es)}return new Promise((ec,ed)=>{var ep;let ef=new XMLHttpRequest;for(let es in ef.open(en.method||"GET",en.url,!0),"arrayBuffer"!==en.type&&"image"!==en.type||(ef.responseType="arraybuffer"),en.headers)ef.setRequestHeader(es,en.headers[es]);"json"===en.type&&(ef.responseType="text",(null===(ep=en.headers)||void 0===ep?void 0:ep.Accept)||ef.setRequestHeader("Accept","application/json")),ef.withCredentials="include"===en.credentials,ef.onerror=()=>{ed(Error(ef.statusText))},ef.onload=()=>{if(!es.signal.aborted){if((ef.status>=200&&ef.status<300||0===ef.status)&&null!==ef.response){let es=ef.response;if("json"===en.type)try{es=JSON.parse(ef.response)}catch(en){return void ed(en)}ec({data:es,cacheControl:ef.getResponseHeader("Cache-Control"),expires:ef.getResponseHeader("Expires")})}else{let es=new Blob([ef.response],{type:ef.getResponseHeader("Content-Type")});ed(new ut(ef.status,ef.statusText,en.url,es))}}},es.signal.addEventListener("abort",()=>{ef.abort(),ed(st())}),ef.send(en.body)})};function pt(en){if(!en||0>=en.indexOf("://")||0===en.indexOf("data:image/")||0===en.indexOf("blob:"))return!0;let es=new URL(en),ec=window.location;return es.protocol===ec.protocol&&es.host===ec.host}function ft(en,es,ec){ec[en]&&-1!==ec[en].indexOf(es)||(ec[en]=ec[en]||[],ec[en].push(es))}function dt(en,es,ec){if(ec&&ec[en]){let ed=ec[en].indexOf(es);-1!==ed&&ec[en].splice(ed,1)}}let yt=class yt{constructor(en,es={}){L(this,es),this.type=en}};let mt=class mt extends yt{constructor(en,es={}){super("error",L({error:en},es))}};let gt=class gt{on(en,es){return this._listeners=this._listeners||{},ft(en,es,this._listeners),{unsubscribe:()=>{this.off(en,es)}}}off(en,es){return dt(en,es,this._listeners),dt(en,es,this._oneTimeListeners),this}once(en,es){return es?(this._oneTimeListeners=this._oneTimeListeners||{},ft(en,es,this._oneTimeListeners),this):new Promise(es=>this.once(en,es))}fire(en,es){"string"==typeof en&&(en=new yt(en,es||{}));let ec=en.type;if(this.listens(ec)){en.target=this;let es=this._listeners&&this._listeners[ec]?this._listeners[ec].slice():[];for(let ec of es)ec.call(this,en);let ed=this._oneTimeListeners&&this._oneTimeListeners[ec]?this._oneTimeListeners[ec].slice():[];for(let es of ed)dt(ec,es,this._oneTimeListeners),es.call(this,en);let ep=this._eventedParent;ep&&(L(en,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),ep.fire(en))}else en instanceof mt&&console.error(en.error);return this}listens(en){return this._listeners&&this._listeners[en]&&this._listeners[en].length>0||this._oneTimeListeners&&this._oneTimeListeners[en]&&this._oneTimeListeners[en].length>0||this._eventedParent&&this._eventedParent.listens(en)}setEventedParent(en,es){return this._eventedParent=en,this._eventedParentData=es,this}};var eG={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let e$=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wt(en,es){if(Array.isArray(en)){if(!Array.isArray(es)||en.length!==es.length)return!1;for(let ec=0;ec<en.length;ec++)if(!wt(en[ec],es[ec]))return!1;return!0}if("object"==typeof en&&null!==en&&null!==es){if("object"!=typeof es||Object.keys(en).length!==Object.keys(es).length)return!1;for(let ec in en)if(!wt(en[ec],es[ec]))return!1;return!0}return en===es}function _t(en,es){en.push(es)}function St(en,es,ec){_t(ec,{command:"addSource",args:[en,es[en]]})}function At(en,es,ec){_t(es,{command:"removeSource",args:[en]}),ec[en]=!0}function It(en,es,ec,ed,ep,ef){for(let em in es=es||{},en=en||{})Object.prototype.hasOwnProperty.call(en,em)&&(wt(en[em],es[em])||ec.push({command:ef,args:[ed,em,es[em],ep]}));for(let em in es)Object.prototype.hasOwnProperty.call(es,em)&&!Object.prototype.hasOwnProperty.call(en,em)&&(wt(en[em],es[em])||ec.push({command:ef,args:[ed,em,es[em],ep]}))}function zt(en){return en.id}function Pt(en,es){return en[es.id]=es,en}let Ct=class Ct{constructor(en,es,ec,ed){this.message=(en?`${en}: `:"")+ec,ed&&(this.identifier=ed),null!=es&&es.__line__&&(this.line=es.__line__)}};function Et(en,...es){for(let ec of es)for(let es in ec)en[es]=ec[es];return en}let Tt=class Tt extends Error{constructor(en,es){super(es),this.message=es,this.key=en}};let Bt=class Bt{constructor(en,es=[]){for(let[ec,ed]of(this.parent=en,this.bindings={},es))this.bindings[ec]=ed}concat(en){return new Bt(this,en)}get(en){if(this.bindings[en])return this.bindings[en];if(this.parent)return this.parent.get(en);throw Error(`${en} not found in scope.`)}has(en){return!!this.bindings[en]||!!this.parent&&this.parent.has(en)}};let eq={kind:"null"},eW={kind:"number"},eH={kind:"string"},eX={kind:"boolean"},eK={kind:"color"},eY={kind:"projectionDefinition"},eJ={kind:"object"},eQ={kind:"value"},e0={kind:"collator"},e1={kind:"formatted"},e2={kind:"padding"},e3={kind:"colorArray"},e5={kind:"numberArray"},e4={kind:"resolvedImage"},e6={kind:"variableAnchorOffsetCollection"};function Ht(en,es){return{kind:"array",itemType:en,N:es}}function Kt(en){if("array"===en.kind){let es=Kt(en.itemType);return"number"==typeof en.N?`array<${es}, ${en.N}>`:"value"===en.itemType.kind?"array":`array<${es}>`}return en.kind}let e8=[eq,eW,eH,eX,eK,eY,e1,eJ,Ht(eQ),e2,e5,e3,e4,e6];function Wt(en,es){if("error"===es.kind)return null;if("array"===en.kind){if("array"===es.kind&&(0===es.N&&"value"===es.itemType.kind||!Wt(en.itemType,es.itemType))&&("number"!=typeof en.N||en.N===es.N))return null}else{if(en.kind===es.kind)return null;if("value"===en.kind){for(let en of e8)if(!Wt(en,es))return null}}return`Expected ${Kt(en)} but found ${Kt(es)} instead.`}function Qt(en,es){return es.some(es=>es.kind===en.kind)}function te(en,es){return es.some(es=>"null"===es?null===en:"array"===es?Array.isArray(en):"object"===es?en&&!Array.isArray(en)&&"object"==typeof en:es===typeof en)}function ee(en,es){return"array"===en.kind&&"array"===es.kind?en.itemType.kind===es.itemType.kind&&"number"==typeof en.N:en.kind===es.kind}let e9=4/29,e7=6/29,th=3*e7*e7,tc=e7*e7*e7,td=Math.PI/180,tf=180/Math.PI;function ce(en){return(en%=360)<0&&(en+=360),en}function he([en,es,ec,ed]){let ep,ef;let em=fe((.2225045*(en=pe(en))+.7168786*(es=pe(es))+.0606169*(ec=pe(ec)))/1);en===es&&es===ec?ep=ef=em:(ep=fe((.4360747*en+.3850649*es+.1430804*ec)/.96422),ef=fe((.0139322*en+.0971045*es+.7141733*ec)/.82521));let e_=116*em-16;return[e_<0?0:e_,500*(ep-em),200*(em-ef),ed]}function pe(en){return en<=.04045?en/12.92:Math.pow((en+.055)/1.055,2.4)}function fe(en){return en>tc?Math.pow(en,1/3):en/th+e9}function de([en,es,ec,ed]){let ep=(en+16)/116,ef=isNaN(es)?ep:ep+es/500,em=isNaN(ec)?ep:ep-ec/200;return ep=1*me(ep),[ye(3.1338561*(ef=.96422*me(ef))-1.6168667*ep-.4906146*(em=.82521*me(em))),ye(-.9787684*ef+1.9161415*ep+.033454*em),ye(.0719453*ef-.2289914*ep+1.4052427*em),ed]}function ye(en){return(en=en<=.00304?12.92*en:1.055*Math.pow(en,1/2.4)-.055)<0?0:en>1?1:en}function me(en){return en>e7?en*en*en:th*(en-e9)}let tm=Object.hasOwn||function(en,es){return Object.prototype.hasOwnProperty.call(en,es)};function xe(en,es){return tm(en,es)?en[es]:void 0}function ve(en){return parseInt(en.padEnd(2,en),16)/255}function be(en,es){return we(es?en/100:en,0,1)}function we(en,es,ec){return Math.min(Math.max(es,en),ec)}function _e(en){return!en.some(Number.isNaN)}let t_={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ke(en,es,ec){return en.map((en,ed)=>en+ec*(es[ed]-en))}let Me=class Me{constructor(en,es,ec,ed=1,ep=!0){this.r=en,this.g=es,this.b=ec,this.a=ed,ep||(this.r*=ed,this.g*=ed,this.b*=ed,ed||this.overwriteGetter("rgb",[en,es,ec,ed]))}static parse(en){if(en instanceof Me)return en;if("string"!=typeof en)return;let es=function(en){if("transparent"===(en=en.toLowerCase().trim()))return[0,0,0,0];let es=xe(t_,en);if(es){let[en,ec,ed]=es;return[en/255,ec/255,ed/255,1]}if(en.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(en)){let es=en.length<6?1:2,ec=1;return[ve(en.slice(ec,ec+=es)),ve(en.slice(ec,ec+=es)),ve(en.slice(ec,ec+=es)),ve(en.slice(ec,ec+es)||"ff")]}if(en.startsWith("rgb")){let es=en.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(es){let[en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb]=es,ew=[ep||" ",e_||" ",ex].join("");if("  "===ew||"  /"===ew||",,"===ew||",,,"===ew){let en=[ed,em,ey].join(""),es="%%%"===en?100:""===en?255:0;if(es){let en=[we(+ec/es,0,1),we(+ef/es,0,1),we(+eg/es,0,1),ev?be(+ev,eb):1];if(_e(en))return en}}return}}let ec=en.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(ec){let[en,es,ed,ep,ef,em,e_,eg,ey]=ec,ex=[ed||" ",ef||" ",e_].join("");if("  "===ex||"  /"===ex||",,"===ex||",,,"===ex){let en=[+es,we(+ep,0,100),we(+em,0,100),eg?be(+eg,ey):1];if(_e(en))return function([en,es,ec,ed]){function i(ed){let ep=(ed+en/30)%12,ef=es*Math.min(ec,1-ec);return ec-ef*Math.max(-1,Math.min(ep-3,9-ep,1))}return en=ce(en),es/=100,ec/=100,[i(0),i(8),i(4),ed]}(en)}}}(en);return es?new Me(...es,!1):void 0}get rgb(){let{r:en,g:es,b:ec,a:ed}=this,ep=ed||1/0;return this.overwriteGetter("rgb",[en/ep,es/ep,ec/ep,ed])}get hcl(){return this.overwriteGetter("hcl",function(en){let[es,ec,ed,ep]=he(en),ef=Math.sqrt(ec*ec+ed*ed);return[Math.round(1e4*ef)?ce(Math.atan2(ed,ec)*tf):NaN,ef,es,ep]}(this.rgb))}get lab(){return this.overwriteGetter("lab",he(this.rgb))}overwriteGetter(en,es){return Object.defineProperty(this,en,{value:es}),es}toString(){let[en,es,ec,ed]=this.rgb;return`rgba(${[en,es,ec].map(en=>Math.round(255*en)).join(",")},${ed})`}static interpolate(en,es,ec,ed="rgb"){switch(ed){case"rgb":{let[ed,ep,ef,em]=ke(en.rgb,es.rgb,ec);return new Me(ed,ep,ef,em,!1)}case"hcl":{let ed,ep;let[ef,em,e_,eg]=en.hcl,[ey,ex,ev,eb]=es.hcl;if(isNaN(ef)||isNaN(ey))isNaN(ef)?isNaN(ey)?ed=NaN:(ed=ey,1!==e_&&0!==e_||(ep=ex)):(ed=ef,1!==ev&&0!==ev||(ep=em));else{let en=ey-ef;ey>ef&&en>180?en-=360:ey<ef&&ef-ey>180&&(en+=360),ed=ef+ec*en}let[ew,eT,eP,eS]=function([en,es,ec,ed]){return de([ec,Math.cos(en=isNaN(en)?0:en*td)*es,Math.sin(en)*es,ed])}([ed,null!=ep?ep:em+ec*(ex-em),e_+ec*(ev-e_),eg+ec*(eb-eg)]);return new Me(ew,eT,eP,eS,!1)}case"lab":{let[ed,ep,ef,em]=de(ke(en.lab,es.lab,ec));return new Me(ed,ep,ef,em,!1)}}}};Me.black=new Me(0,0,0,1),Me.white=new Me(1,1,1,1),Me.transparent=new Me(0,0,0,0),Me.red=new Me(1,0,0,1);let Ie=class Ie{constructor(en,es,ec){this.sensitivity=en?es?"variant":"case":es?"accent":"base",this.locale=ec,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(en,es){return this.collator.compare(en,es)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}};let tg=["bottom","center","top"];let Pe=class Pe{constructor(en,es,ec,ed,ep,ef){this.text=en,this.image=es,this.scale=ec,this.fontStack=ed,this.textColor=ep,this.verticalAlign=ef}};let Ce=class Ce{constructor(en){this.sections=en}static fromString(en){return new Ce([new Pe(en,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(en=>0!==en.text.length||en.image&&0!==en.image.name.length)}static factory(en){return en instanceof Ce?en:Ce.fromString(en)}toString(){return 0===this.sections.length?"":this.sections.map(en=>en.text).join("")}};let Ee=class Ee{constructor(en){this.values=en.slice()}static parse(en){if(en instanceof Ee)return en;if("number"==typeof en)return new Ee([en,en,en,en]);if(Array.isArray(en)&&!(en.length<1||en.length>4)){for(let es of en)if("number"!=typeof es)return;switch(en.length){case 1:en=[en[0],en[0],en[0],en[0]];break;case 2:en=[en[0],en[1],en[0],en[1]];break;case 3:en=[en[0],en[1],en[2],en[1]]}return new Ee(en)}}toString(){return JSON.stringify(this.values)}static interpolate(en,es,ec){return new Ee(ke(en.values,es.values,ec))}};let Te=class Te{constructor(en){this.values=en.slice()}static parse(en){if(en instanceof Te)return en;if("number"==typeof en)return new Te([en]);if(Array.isArray(en)){for(let es of en)if("number"!=typeof es)return;return new Te(en)}}toString(){return JSON.stringify(this.values)}static interpolate(en,es,ec){return new Te(ke(en.values,es.values,ec))}};let Be=class Be{constructor(en){this.values=en.slice()}static parse(en){if(en instanceof Be)return en;if("string"==typeof en){let es=Me.parse(en);if(!es)return;return new Be([es])}if(!Array.isArray(en))return;let es=[];for(let ec of en){if("string"!=typeof ec)return;let en=Me.parse(ec);if(!en)return;es.push(en)}return new Be(es)}toString(){return JSON.stringify(this.values)}static interpolate(en,es,ec,ed="rgb"){let ep=[];if(en.values.length!=es.values.length)throw Error(`colorArray: Arrays have mismatched length (${en.values.length} vs. ${es.values.length}), cannot interpolate.`);for(let ef=0;ef<en.values.length;ef++)ep.push(Me.interpolate(en.values[ef],es.values[ef],ec,ed));return new Be(ep)}};let Ve=class Ve extends Error{constructor(en){super(en),this.name="RuntimeError"}toJSON(){return this.message}};let ty=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);let De=class De{constructor(en){this.values=en.slice()}static parse(en){if(en instanceof De)return en;if(Array.isArray(en)&&!(en.length<1)&&en.length%2==0){for(let es=0;es<en.length;es+=2){let ec=en[es],ed=en[es+1];if("string"!=typeof ec||!ty.has(ec)||!Array.isArray(ed)||2!==ed.length||"number"!=typeof ed[0]||"number"!=typeof ed[1])return}return new De(en)}}toString(){return JSON.stringify(this.values)}static interpolate(en,es,ec){let ed=en.values,ep=es.values;if(ed.length!==ep.length)throw new Ve(`Cannot interpolate values of different length. from: ${en.toString()}, to: ${es.toString()}`);let ef=[];for(let en=0;en<ed.length;en+=2){if(ed[en]!==ep[en])throw new Ve(`Cannot interpolate values containing mismatched anchors. from[${en}]: ${ed[en]}, to[${en}]: ${ep[en]}`);ef.push(ed[en]);let[es,em]=ed[en+1],[e_,eg]=ep[en+1];ef.push([es+ec*(e_-es),em+ec*(eg-em)])}return new De(ef)}};let $e=class $e{constructor(en){this.name=en.name,this.available=en.available}toString(){return this.name}static fromString(en){return en?new $e({name:en,available:!1}):null}};let Le=class Le{constructor(en,es,ec){this.from=en,this.to=es,this.transition=ec}static interpolate(en,es,ec){return new Le(en,es,ec)}static parse(en){return en instanceof Le?en:Array.isArray(en)&&3===en.length&&"string"==typeof en[0]&&"string"==typeof en[1]&&"number"==typeof en[2]?new Le(en[0],en[1],en[2]):"object"==typeof en&&"string"==typeof en.from&&"string"==typeof en.to&&"number"==typeof en.transition?new Le(en.from,en.to,en.transition):"string"==typeof en?new Le(en,en,1):void 0}};function Oe(en,es,ec,ed){return"number"==typeof en&&en>=0&&en<=255&&"number"==typeof es&&es>=0&&es<=255&&"number"==typeof ec&&ec>=0&&ec<=255?void 0===ed||"number"==typeof ed&&ed>=0&&ed<=1?null:`Invalid rgba value [${[en,es,ec,ed].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof ed?[en,es,ec,ed]:[en,es,ec]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Re(en){if(null===en||"string"==typeof en||"boolean"==typeof en||"number"==typeof en||en instanceof Le||en instanceof Me||en instanceof Ie||en instanceof Ce||en instanceof Ee||en instanceof Te||en instanceof Be||en instanceof De||en instanceof $e)return!0;if(Array.isArray(en)){for(let es of en)if(!Re(es))return!1;return!0}if("object"==typeof en){for(let es in en)if(!Re(en[es]))return!1;return!0}return!1}function Ue(en){if(null===en)return eq;if("string"==typeof en)return eH;if("boolean"==typeof en)return eX;if("number"==typeof en)return eW;if(en instanceof Me)return eK;if(en instanceof Le)return eY;if(en instanceof Ie)return e0;if(en instanceof Ce)return e1;if(en instanceof Ee)return e2;if(en instanceof Te)return e5;if(en instanceof Be)return e3;if(en instanceof De)return e6;if(en instanceof $e)return e4;if(Array.isArray(en)){let es;let ec=en.length;for(let ec of en){let en=Ue(ec);if(es){if(es===en)continue;es=eQ;break}es=en}return Ht(es||eQ,ec)}return eJ}function je(en){let es=typeof en;return null===en?"":"string"===es||"number"===es||"boolean"===es?String(en):en instanceof Me||en instanceof Le||en instanceof Ce||en instanceof Ee||en instanceof Te||en instanceof Be||en instanceof De||en instanceof $e?en.toString():JSON.stringify(en)}let Ne=class Ne{constructor(en,es){this.type=en,this.value=es}static parse(en,es){if(2!==en.length)return es.error(`'literal' expression requires exactly one argument, but found ${en.length-1} instead.`);if(!Re(en[1]))return es.error("invalid value");let ec=en[1],ed=Ue(ec),ep=es.expectedType;return"array"===ed.kind&&0===ed.N&&ep&&"array"===ep.kind&&("number"!=typeof ep.N||0===ep.N)&&(ed=ep),new Ne(ed,ec)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}};let tx={string:eH,number:eW,boolean:eX,object:eJ};let Ge=class Ge{constructor(en,es){this.type=en,this.args=es}static parse(en,es){if(en.length<2)return es.error("Expected at least one argument.");let ec,ed=1,ep=en[0];if("array"===ep){let ep,ef;if(en.length>2){let ec=en[1];if("string"!=typeof ec||!(ec in tx)||"object"===ec)return es.error('The item type argument of "array" must be one of string, number, boolean',1);ep=tx[ec],ed++}else ep=eQ;if(en.length>3){if(null!==en[2]&&("number"!=typeof en[2]||en[2]<0||en[2]!==Math.floor(en[2])))return es.error('The length argument to "array" must be a positive integer literal',2);ef=en[2],ed++}ec=Ht(ep,ef)}else{if(!tx[ep])throw Error(`Types doesn't contain name = ${ep}`);ec=tx[ep]}let ef=[];for(;ed<en.length;ed++){let ec=es.parse(en[ed],ed,eQ);if(!ec)return null;ef.push(ec)}return new Ge(ec,ef)}evaluate(en){for(let es=0;es<this.args.length;es++){let ec=this.args[es].evaluate(en);if(!Wt(this.type,Ue(ec)))return ec;if(es===this.args.length-1)throw new Ve(`Expected value to be of type ${Kt(this.type)}, but found ${Kt(Ue(ec))} instead.`)}throw Error()}eachChild(en){this.args.forEach(en)}outputDefined(){return this.args.every(en=>en.outputDefined())}};let tv={"to-boolean":eX,"to-color":eK,"to-number":eW,"to-string":eH};let Ze=class Ze{constructor(en,es){this.type=en,this.args=es}static parse(en,es){if(en.length<2)return es.error("Expected at least one argument.");let ec=en[0];if(!tv[ec])throw Error(`Can't parse ${ec} as it is not part of the known types`);if(("to-boolean"===ec||"to-string"===ec)&&2!==en.length)return es.error("Expected one argument.");let ed=tv[ec],ep=[];for(let ec=1;ec<en.length;ec++){let ed=es.parse(en[ec],ec,eQ);if(!ed)return null;ep.push(ed)}return new Ze(ed,ep)}evaluate(en){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(en);case"color":{let es,ec;for(let ed of this.args){if(es=ed.evaluate(en),ec=null,es instanceof Me)return es;if("string"==typeof es){let ec=en.parseColor(es);if(ec)return ec}else if(Array.isArray(es)&&!(ec=es.length<3||es.length>4?`Invalid rgba value ${JSON.stringify(es)}: expected an array containing either three or four numeric values.`:Oe(es[0],es[1],es[2],es[3])))return new Me(es[0]/255,es[1]/255,es[2]/255,es[3])}throw new Ve(ec||`Could not parse color from value '${"string"==typeof es?es:JSON.stringify(es)}'`)}case"padding":{let es;for(let ec of this.args){es=ec.evaluate(en);let ed=Ee.parse(es);if(ed)return ed}throw new Ve(`Could not parse padding from value '${"string"==typeof es?es:JSON.stringify(es)}'`)}case"numberArray":{let es;for(let ec of this.args){es=ec.evaluate(en);let ed=Te.parse(es);if(ed)return ed}throw new Ve(`Could not parse numberArray from value '${"string"==typeof es?es:JSON.stringify(es)}'`)}case"colorArray":{let es;for(let ec of this.args){es=ec.evaluate(en);let ed=Be.parse(es);if(ed)return ed}throw new Ve(`Could not parse colorArray from value '${"string"==typeof es?es:JSON.stringify(es)}'`)}case"variableAnchorOffsetCollection":{let es;for(let ec of this.args){es=ec.evaluate(en);let ed=De.parse(es);if(ed)return ed}throw new Ve(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof es?es:JSON.stringify(es)}'`)}case"number":{let es=null;for(let ec of this.args){if(null===(es=ec.evaluate(en)))return 0;let ed=Number(es);if(!isNaN(ed))return ed}throw new Ve(`Could not convert ${JSON.stringify(es)} to number.`)}case"formatted":return Ce.fromString(je(this.args[0].evaluate(en)));case"resolvedImage":return $e.fromString(je(this.args[0].evaluate(en)));case"projectionDefinition":return this.args[0].evaluate(en);default:return je(this.args[0].evaluate(en))}}eachChild(en){this.args.forEach(en)}outputDefined(){return this.args.every(en=>en.outputDefined())}};let tb=["Unknown","Point","LineString","Polygon"];let He=class He{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?tb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(en){let es=this._parseColorCache.get(en);return es||(es=Me.parse(en),this._parseColorCache.set(en,es)),es}};let Ke=class Ke{constructor(en,es,ec=[],ed,ep=new Bt,ef=[]){this.registry=en,this.path=ec,this.key=ec.map(en=>`[${en}]`).join(""),this.scope=ep,this.errors=ef,this.expectedType=ed,this._isConstant=es}parse(en,es,ec,ed,ep={}){return es?this.concat(es,ec,ed)._parse(en,ep):this._parse(en,ep)}_parse(en,es){function r(en,es,ec){return"assert"===ec?new Ge(es,[en]):"coerce"===ec?new Ze(es,[en]):en}if(null!==en&&"string"!=typeof en&&"boolean"!=typeof en&&"number"!=typeof en||(en=["literal",en]),Array.isArray(en)){if(0===en.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let ec=en[0];if("string"!=typeof ec)return this.error(`Expression name must be a string, but found ${typeof ec} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let ed=this.registry[ec];if(ed){let ec=ed.parse(en,this);if(!ec)return null;if(this.expectedType){let en=this.expectedType,ed=ec.type;if("string"!==en.kind&&"number"!==en.kind&&"boolean"!==en.kind&&"object"!==en.kind&&"array"!==en.kind||"value"!==ed.kind){if("projectionDefinition"===en.kind&&["string","array"].includes(ed.kind)||["color","formatted","resolvedImage"].includes(en.kind)&&["value","string"].includes(ed.kind)||["padding","numberArray"].includes(en.kind)&&["value","number","array"].includes(ed.kind)||"colorArray"===en.kind&&["value","string","array"].includes(ed.kind)||"variableAnchorOffsetCollection"===en.kind&&["value","array"].includes(ed.kind))ec=r(ec,en,es.typeAnnotation||"coerce");else if(this.checkSubtype(en,ed))return null}else ec=r(ec,en,es.typeAnnotation||"assert")}if(!(ec instanceof Ne)&&"resolvedImage"!==ec.type.kind&&this._isConstant(ec)){let en=new He;try{ec=new Ne(ec.type,ec.evaluate(en))}catch(en){return this.error(en.message),null}}return ec}return this.error(`Unknown expression "${ec}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===en?"'undefined' value invalid. Use null instead.":"object"==typeof en?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof en} instead.`)}concat(en,es,ec){let ed="number"==typeof en?this.path.concat(en):this.path,ep=ec?this.scope.concat(ec):this.scope;return new Ke(this.registry,this._isConstant,ed,es||null,ep,this.errors)}error(en,...es){let ec=`${this.key}${es.map(en=>`[${en}]`).join("")}`;this.errors.push(new Tt(ec,en))}checkSubtype(en,es){let ec=Wt(en,es);return ec&&this.error(ec),ec}};let Je=class Je{constructor(en,es){this.type=es.type,this.bindings=[].concat(en),this.result=es}evaluate(en){return this.result.evaluate(en)}eachChild(en){for(let es of this.bindings)en(es[1]);en(this.result)}static parse(en,es){if(en.length<4)return es.error(`Expected at least 3 arguments, but found ${en.length-1} instead.`);let ec=[];for(let ed=1;ed<en.length-1;ed+=2){let ep=en[ed];if("string"!=typeof ep)return es.error(`Expected string, but found ${typeof ep} instead.`,ed);if(/[^a-zA-Z0-9_]/.test(ep))return es.error("Variable names must contain only alphanumeric characters or '_'.",ed);let ef=es.parse(en[ed+1],ed+1);if(!ef)return null;ec.push([ep,ef])}let ed=es.parse(en[en.length-1],en.length-1,es.expectedType,ec);return ed?new Je(ec,ed):null}outputDefined(){return this.result.outputDefined()}};let We=class We{constructor(en,es){this.type=es.type,this.name=en,this.boundExpression=es}static parse(en,es){if(2!==en.length||"string"!=typeof en[1])return es.error("'var' expression requires exactly one string literal argument.");let ec=en[1];return es.scope.has(ec)?new We(ec,es.scope.get(ec)):es.error(`Unknown variable "${ec}". Make sure "${ec}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(en){return this.boundExpression.evaluate(en)}eachChild(){}outputDefined(){return!1}};let Qe=class Qe{constructor(en,es,ec){this.type=en,this.index=es,this.input=ec}static parse(en,es){if(3!==en.length)return es.error(`Expected 2 arguments, but found ${en.length-1} instead.`);let ec=es.parse(en[1],1,eW),ed=es.parse(en[2],2,Ht(es.expectedType||eQ));return ec&&ed?new Qe(ed.type.itemType,ec,ed):null}evaluate(en){let es=this.index.evaluate(en),ec=this.input.evaluate(en);if(es<0)throw new Ve(`Array index out of bounds: ${es} < 0.`);if(es>=ec.length)throw new Ve(`Array index out of bounds: ${es} > ${ec.length-1}.`);if(es!==Math.floor(es))throw new Ve(`Array index must be an integer, but found ${es} instead.`);return ec[es]}eachChild(en){en(this.index),en(this.input)}outputDefined(){return!1}};let tr=class tr{constructor(en,es){this.type=eX,this.needle=en,this.haystack=es}static parse(en,es){if(3!==en.length)return es.error(`Expected 2 arguments, but found ${en.length-1} instead.`);let ec=es.parse(en[1],1,eQ),ed=es.parse(en[2],2,eQ);return ec&&ed?Qt(ec.type,[eX,eH,eW,eq,eQ])?new tr(ec,ed):es.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(ec.type)} instead`):null}evaluate(en){let es=this.needle.evaluate(en),ec=this.haystack.evaluate(en);if(!ec)return!1;if(!te(es,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(Ue(es))} instead.`);if(!te(ec,["string","array"]))throw new Ve(`Expected second argument to be of type array or string, but found ${Kt(Ue(ec))} instead.`);return ec.indexOf(es)>=0}eachChild(en){en(this.needle),en(this.haystack)}outputDefined(){return!0}};let er=class er{constructor(en,es,ec){this.type=eW,this.needle=en,this.haystack=es,this.fromIndex=ec}static parse(en,es){if(en.length<=2||en.length>=5)return es.error(`Expected 2 or 3 arguments, but found ${en.length-1} instead.`);let ec=es.parse(en[1],1,eQ),ed=es.parse(en[2],2,eQ);if(!ec||!ed)return null;if(!Qt(ec.type,[eX,eH,eW,eq,eQ]))return es.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(ec.type)} instead`);if(4===en.length){let ep=es.parse(en[3],3,eW);return ep?new er(ec,ed,ep):null}return new er(ec,ed)}evaluate(en){let es;let ec=this.needle.evaluate(en),ed=this.haystack.evaluate(en);if(!te(ec,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(Ue(ec))} instead.`);if(this.fromIndex&&(es=this.fromIndex.evaluate(en)),te(ed,["string"])){let en=ed.indexOf(ec,es);return -1===en?-1:[...ed.slice(0,en)].length}if(te(ed,["array"]))return ed.indexOf(ec,es);throw new Ve(`Expected second argument to be of type array or string, but found ${Kt(Ue(ed))} instead.`)}eachChild(en){en(this.needle),en(this.haystack),this.fromIndex&&en(this.fromIndex)}outputDefined(){return!1}};let rr=class rr{constructor(en,es,ec,ed,ep,ef){this.inputType=en,this.type=es,this.input=ec,this.cases=ed,this.outputs=ep,this.otherwise=ef}static parse(en,es){let ec,ed;if(en.length<5)return es.error(`Expected at least 4 arguments, but found only ${en.length-1}.`);if(en.length%2!=1)return es.error("Expected an even number of arguments.");es.expectedType&&"value"!==es.expectedType.kind&&(ed=es.expectedType);let ep={},ef=[];for(let em=2;em<en.length-1;em+=2){let e_=en[em],eg=en[em+1];Array.isArray(e_)||(e_=[e_]);let ey=es.concat(em);if(0===e_.length)return ey.error("Expected at least one branch label.");for(let en of e_){if("number"!=typeof en&&"string"!=typeof en)return ey.error("Branch labels must be numbers or strings.");if("number"==typeof en&&Math.abs(en)>Number.MAX_SAFE_INTEGER)return ey.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof en&&Math.floor(en)!==en)return ey.error("Numeric branch labels must be integer values.");if(ec){if(ey.checkSubtype(ec,Ue(en)))return null}else ec=Ue(en);if(void 0!==ep[String(en)])return ey.error("Branch labels must be unique.");ep[String(en)]=ef.length}let ex=es.parse(eg,em,ed);if(!ex)return null;ed=ed||ex.type,ef.push(ex)}let em=es.parse(en[1],1,eQ);if(!em)return null;let e_=es.parse(en[en.length-1],en.length-1,ed);return e_?"value"!==em.type.kind&&es.concat(1).checkSubtype(ec,em.type)?null:new rr(ec,ed,em,ep,ef,e_):null}evaluate(en){let es=this.input.evaluate(en);return(Ue(es)===this.inputType&&this.outputs[this.cases[es]]||this.otherwise).evaluate(en)}eachChild(en){en(this.input),this.outputs.forEach(en),en(this.otherwise)}outputDefined(){return this.outputs.every(en=>en.outputDefined())&&this.otherwise.outputDefined()}};let nr=class nr{constructor(en,es,ec){this.type=en,this.branches=es,this.otherwise=ec}static parse(en,es){let ec;if(en.length<4)return es.error(`Expected at least 3 arguments, but found only ${en.length-1}.`);if(en.length%2!=0)return es.error("Expected an odd number of arguments.");es.expectedType&&"value"!==es.expectedType.kind&&(ec=es.expectedType);let ed=[];for(let ep=1;ep<en.length-1;ep+=2){let ef=es.parse(en[ep],ep,eX);if(!ef)return null;let em=es.parse(en[ep+1],ep+1,ec);if(!em)return null;ed.push([ef,em]),ec=ec||em.type}let ep=es.parse(en[en.length-1],en.length-1,ec);if(!ep)return null;if(!ec)throw Error("Can't infer output type");return new nr(ec,ed,ep)}evaluate(en){for(let[es,ec]of this.branches)if(es.evaluate(en))return ec.evaluate(en);return this.otherwise.evaluate(en)}eachChild(en){for(let[es,ec]of this.branches)en(es),en(ec);en(this.otherwise)}outputDefined(){return this.branches.every(([en,es])=>es.outputDefined())&&this.otherwise.outputDefined()}};let ir=class ir{constructor(en,es,ec,ed){this.type=en,this.input=es,this.beginIndex=ec,this.endIndex=ed}static parse(en,es){if(en.length<=2||en.length>=5)return es.error(`Expected 2 or 3 arguments, but found ${en.length-1} instead.`);let ec=es.parse(en[1],1,eQ),ed=es.parse(en[2],2,eW);if(!ec||!ed)return null;if(!Qt(ec.type,[Ht(eQ),eH,eQ]))return es.error(`Expected first argument to be of type array or string, but found ${Kt(ec.type)} instead`);if(4===en.length){let ep=es.parse(en[3],3,eW);return ep?new ir(ec.type,ec,ed,ep):null}return new ir(ec.type,ec,ed)}evaluate(en){let es;let ec=this.input.evaluate(en),ed=this.beginIndex.evaluate(en);if(this.endIndex&&(es=this.endIndex.evaluate(en)),te(ec,["string"]))return[...ec].slice(ed,es).join("");if(te(ec,["array"]))return ec.slice(ed,es);throw new Ve(`Expected first argument to be of type array or string, but found ${Kt(Ue(ec))} instead.`)}eachChild(en){en(this.input),en(this.beginIndex),this.endIndex&&en(this.endIndex)}outputDefined(){return!1}};function sr(en,es){let ec=en.length-1,ed,ep,ef=0,em=ec,e_=0;for(;ef<=em;)if(ed=en[e_=Math.floor((ef+em)/2)],ep=en[e_+1],ed<=es){if(e_===ec||es<ep)return e_;ef=e_+1}else{if(!(ed>es))throw new Ve("Input is not a number.");em=e_-1}return 0}let ar=class ar{constructor(en,es,ec){for(let[ed,ep]of(this.type=en,this.input=es,this.labels=[],this.outputs=[],ec))this.labels.push(ed),this.outputs.push(ep)}static parse(en,es){if(en.length-1<4)return es.error(`Expected at least 4 arguments, but found only ${en.length-1}.`);if((en.length-1)%2!=0)return es.error("Expected an even number of arguments.");let ec=es.parse(en[1],1,eW);if(!ec)return null;let ed=[],ep=null;es.expectedType&&"value"!==es.expectedType.kind&&(ep=es.expectedType);for(let ec=1;ec<en.length;ec+=2){let ef=1===ec?-1/0:en[ec],em=en[ec+1],e_=ec,eg=ec+1;if("number"!=typeof ef)return es.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',e_);if(ed.length&&ed[ed.length-1][0]>=ef)return es.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',e_);let ey=es.parse(em,eg,ep);if(!ey)return null;ep=ep||ey.type,ed.push([ef,ey])}return new ar(ep,ec,ed)}evaluate(en){let es=this.labels,ec=this.outputs;if(1===es.length)return ec[0].evaluate(en);let ed=this.input.evaluate(en);if(ed<=es[0])return ec[0].evaluate(en);let ep=es.length;return ed>=es[ep-1]?ec[ep-1].evaluate(en):ec[sr(es,ed)].evaluate(en)}eachChild(en){for(let es of(en(this.input),this.outputs))en(es)}outputDefined(){return this.outputs.every(en=>en.outputDefined())}};var tw,tT,tP,tS,tM,tC,tI=(tS=function(){if(tC)return tM;function t(en,es,ec,ed){this.cx=3*en,this.bx=3*(ec-en)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*es,this.by=3*(ed-es)-this.cy,this.ay=1-this.cy-this.by,this.p1x=en,this.p1y=es,this.p2x=ec,this.p2y=ed}return tC=1,tM=t,t.prototype={sampleCurveX:function(en){return((this.ax*en+this.bx)*en+this.cx)*en},sampleCurveY:function(en){return((this.ay*en+this.by)*en+this.cy)*en},sampleCurveDerivativeX:function(en){return(3*this.ax*en+2*this.bx)*en+this.cx},solveCurveX:function(en,es){if(void 0===es&&(es=1e-6),en<0)return 0;if(en>1)return 1;for(var ec=en,ed=0;ed<8;ed++){var ep=this.sampleCurveX(ec)-en;if(Math.abs(ep)<es)return ec;var ef=this.sampleCurveDerivativeX(ec);if(1e-6>Math.abs(ef))break;ec-=ep/ef}var em=0,e_=1;for(ec=en,ed=0;ed<20&&!(Math.abs((ep=this.sampleCurveX(ec))-en)<es);ed++)en>ep?em=ec:e_=ec,ec=.5*(e_-em)+em;return ec},solve:function(en,es){return this.sampleCurveY(this.solveCurveX(en,es))}},tM}())&&tS.__esModule&&Object.prototype.hasOwnProperty.call(tS,"default")?tS.default:tS;let pr=class pr{constructor(en,es,ec,ed,ep){for(let[ef,em]of(this.type=en,this.operator=es,this.interpolation=ec,this.input=ed,this.labels=[],this.outputs=[],ep))this.labels.push(ef),this.outputs.push(em)}static interpolationFactor(en,es,ec,ed){let ep=0;if("exponential"===en.name)ep=fr(es,en.base,ec,ed);else if("linear"===en.name)ep=fr(es,1,ec,ed);else if("cubic-bezier"===en.name){let ef=en.controlPoints;ep=new tI(ef[0],ef[1],ef[2],ef[3]).solve(fr(es,1,ec,ed))}return ep}static parse(en,es){let[ec,ed,ep,...ef]=en;if(!Array.isArray(ed)||0===ed.length)return es.error("Expected an interpolation type expression.",1);if("linear"===ed[0])ed={name:"linear"};else if("exponential"===ed[0]){let en=ed[1];if("number"!=typeof en)return es.error("Exponential interpolation requires a numeric base.",1,1);ed={name:"exponential",base:en}}else{if("cubic-bezier"!==ed[0])return es.error(`Unknown interpolation type ${String(ed[0])}`,1,0);{let en=ed.slice(1);if(4!==en.length||en.some(en=>"number"!=typeof en||en<0||en>1))return es.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ed={name:"cubic-bezier",controlPoints:en}}}if(en.length-1<4)return es.error(`Expected at least 4 arguments, but found only ${en.length-1}.`);if((en.length-1)%2!=0)return es.error("Expected an even number of arguments.");if(!(ep=es.parse(ep,2,eW)))return null;let em=[],e_=null;"interpolate-hcl"!==ec&&"interpolate-lab"!==ec||es.expectedType==e3?es.expectedType&&"value"!==es.expectedType.kind&&(e_=es.expectedType):e_=eK;for(let en=0;en<ef.length;en+=2){let ec=ef[en],ed=ef[en+1],ep=en+3,eg=en+4;if("number"!=typeof ec)return es.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ep);if(em.length&&em[em.length-1][0]>=ec)return es.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ep);let ey=es.parse(ed,eg,e_);if(!ey)return null;e_=e_||ey.type,em.push([ec,ey])}return ee(e_,eW)||ee(e_,eY)||ee(e_,eK)||ee(e_,e2)||ee(e_,e5)||ee(e_,e3)||ee(e_,e6)||ee(e_,Ht(eW))?new pr(e_,ec,ed,ep,em):es.error(`Type ${Kt(e_)} is not interpolatable.`)}evaluate(en){let es=this.labels,ec=this.outputs;if(1===es.length)return ec[0].evaluate(en);let ed=this.input.evaluate(en);if(ed<=es[0])return ec[0].evaluate(en);let ep=es.length;if(ed>=es[ep-1])return ec[ep-1].evaluate(en);let ef=sr(es,ed),em=pr.interpolationFactor(this.interpolation,ed,es[ef],es[ef+1]),e_=ec[ef].evaluate(en),eg=ec[ef+1].evaluate(en);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return e_+em*(eg-e_);case"color":return Me.interpolate(e_,eg,em);case"padding":return Ee.interpolate(e_,eg,em);case"colorArray":return Be.interpolate(e_,eg,em);case"numberArray":return Te.interpolate(e_,eg,em);case"variableAnchorOffsetCollection":return De.interpolate(e_,eg,em);case"array":return ke(e_,eg,em);case"projectionDefinition":return Le.interpolate(e_,eg,em)}case"interpolate-hcl":switch(this.type.kind){case"color":return Me.interpolate(e_,eg,em,"hcl");case"colorArray":return Be.interpolate(e_,eg,em,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Me.interpolate(e_,eg,em,"lab");case"colorArray":return Be.interpolate(e_,eg,em,"lab")}}}eachChild(en){for(let es of(en(this.input),this.outputs))en(es)}outputDefined(){return this.outputs.every(en=>en.outputDefined())}};function fr(en,es,ec,ed){let ep=ed-ec,ef=en-ec;return 0===ep?0:1===es?ef/ep:(Math.pow(es,ef)-1)/(Math.pow(es,ep)-1)}let tE={color:Me.interpolate,number:function(en,es,ec){return en+ec*(es-en)},padding:Ee.interpolate,numberArray:Te.interpolate,colorArray:Be.interpolate,variableAnchorOffsetCollection:De.interpolate,array:ke};let yr=class yr{constructor(en,es){this.type=en,this.args=es}static parse(en,es){if(en.length<2)return es.error("Expected at least one argument.");let ec=null,ed=es.expectedType;ed&&"value"!==ed.kind&&(ec=ed);let ep=[];for(let ed of en.slice(1)){let en=es.parse(ed,1+ep.length,ec,void 0,{typeAnnotation:"omit"});if(!en)return null;ec=ec||en.type,ep.push(en)}if(!ec)throw Error("No output type");let ef=ed&&ep.some(en=>Wt(ed,en.type));return new yr(ef?eQ:ec,ep)}evaluate(en){let es,ec=null,ed=0;for(let ep of this.args)if(ed++,(ec=ep.evaluate(en))&&ec instanceof $e&&!ec.available&&(es||(es=ec.name),ec=null,ed===this.args.length&&(ec=es)),null!==ec)break;return ec}eachChild(en){this.args.forEach(en)}outputDefined(){return this.args.every(en=>en.outputDefined())}};function mr(en,es){return"=="===en||"!="===en?"boolean"===es.kind||"string"===es.kind||"number"===es.kind||"null"===es.kind||"value"===es.kind:"string"===es.kind||"number"===es.kind||"value"===es.kind}function gr(en,es,ec,ed){return 0===ed.compare(es,ec)}function xr(en,es,ec){let ed="=="!==en&&"!="!==en;return class i{constructor(en,es,ec){this.type=eX,this.lhs=en,this.rhs=es,this.collator=ec,this.hasUntypedArgument="value"===en.type.kind||"value"===es.type.kind}static parse(en,es){if(3!==en.length&&4!==en.length)return es.error("Expected two or three arguments.");let ec=en[0],ep=es.parse(en[1],1,eQ);if(!ep)return null;if(!mr(ec,ep.type))return es.concat(1).error(`"${ec}" comparisons are not supported for type '${Kt(ep.type)}'.`);let ef=es.parse(en[2],2,eQ);if(!ef)return null;if(!mr(ec,ef.type))return es.concat(2).error(`"${ec}" comparisons are not supported for type '${Kt(ef.type)}'.`);if(ep.type.kind!==ef.type.kind&&"value"!==ep.type.kind&&"value"!==ef.type.kind)return es.error(`Cannot compare types '${Kt(ep.type)}' and '${Kt(ef.type)}'.`);ed&&("value"===ep.type.kind&&"value"!==ef.type.kind?ep=new Ge(ef.type,[ep]):"value"!==ep.type.kind&&"value"===ef.type.kind&&(ef=new Ge(ep.type,[ef])));let em=null;if(4===en.length){if("string"!==ep.type.kind&&"string"!==ef.type.kind&&"value"!==ep.type.kind&&"value"!==ef.type.kind)return es.error("Cannot use collator to compare non-string types.");if(!(em=es.parse(en[3],3,e0)))return null}return new i(ep,ef,em)}evaluate(ep){let ef=this.lhs.evaluate(ep),em=this.rhs.evaluate(ep);if(ed&&this.hasUntypedArgument){let es=Ue(ef),ec=Ue(em);if(es.kind!==ec.kind||"string"!==es.kind&&"number"!==es.kind)throw new Ve(`Expected arguments for "${en}" to be (string, string) or (number, number), but found (${es.kind}, ${ec.kind}) instead.`)}if(this.collator&&!ed&&this.hasUntypedArgument){let en=Ue(ef),ec=Ue(em);if("string"!==en.kind||"string"!==ec.kind)return es(ep,ef,em)}return this.collator?ec(ep,ef,em,this.collator.evaluate(ep)):es(ep,ef,em)}eachChild(en){en(this.lhs),en(this.rhs),this.collator&&en(this.collator)}outputDefined(){return!0}}}let tA=xr("==",function(en,es,ec){return es===ec},gr),tz=xr("!=",function(en,es,ec){return es!==ec},function(en,es,ec,ed){return!gr(0,es,ec,ed)}),tk=xr("<",function(en,es,ec){return es<ec},function(en,es,ec,ed){return 0>ed.compare(es,ec)}),tD=xr(">",function(en,es,ec){return es>ec},function(en,es,ec,ed){return ed.compare(es,ec)>0}),tR=xr("<=",function(en,es,ec){return es<=ec},function(en,es,ec,ed){return 0>=ed.compare(es,ec)}),tL=xr(">=",function(en,es,ec){return es>=ec},function(en,es,ec,ed){return ed.compare(es,ec)>=0});let kr=class kr{constructor(en,es,ec){this.type=e0,this.locale=ec,this.caseSensitive=en,this.diacriticSensitive=es}static parse(en,es){if(2!==en.length)return es.error("Expected one argument.");let ec=en[1];if("object"!=typeof ec||Array.isArray(ec))return es.error("Collator options argument must be an object.");let ed=es.parse(void 0!==ec["case-sensitive"]&&ec["case-sensitive"],1,eX);if(!ed)return null;let ep=es.parse(void 0!==ec["diacritic-sensitive"]&&ec["diacritic-sensitive"],1,eX);if(!ep)return null;let ef=null;return!ec.locale||(ef=es.parse(ec.locale,1,eH))?new kr(ed,ep,ef):null}evaluate(en){return new Ie(this.caseSensitive.evaluate(en),this.diacriticSensitive.evaluate(en),this.locale?this.locale.evaluate(en):null)}eachChild(en){en(this.caseSensitive),en(this.diacriticSensitive),this.locale&&en(this.locale)}outputDefined(){return!1}};let Mr=class Mr{constructor(en,es,ec,ed,ep){this.type=eH,this.number=en,this.locale=es,this.currency=ec,this.minFractionDigits=ed,this.maxFractionDigits=ep}static parse(en,es){if(3!==en.length)return es.error("Expected two arguments.");let ec=es.parse(en[1],1,eW);if(!ec)return null;let ed=en[2];if("object"!=typeof ed||Array.isArray(ed))return es.error("NumberFormat options argument must be an object.");let ep=null;if(ed.locale&&!(ep=es.parse(ed.locale,1,eH)))return null;let ef=null;if(ed.currency&&!(ef=es.parse(ed.currency,1,eH)))return null;let em=null;if(ed["min-fraction-digits"]&&!(em=es.parse(ed["min-fraction-digits"],1,eW)))return null;let e_=null;return!ed["max-fraction-digits"]||(e_=es.parse(ed["max-fraction-digits"],1,eW))?new Mr(ec,ep,ef,em,e_):null}evaluate(en){return new Intl.NumberFormat(this.locale?this.locale.evaluate(en):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(en):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(en):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(en):void 0}).format(this.number.evaluate(en))}eachChild(en){en(this.number),this.locale&&en(this.locale),this.currency&&en(this.currency),this.minFractionDigits&&en(this.minFractionDigits),this.maxFractionDigits&&en(this.maxFractionDigits)}outputDefined(){return!1}};let Ir=class Ir{constructor(en){this.type=e1,this.sections=en}static parse(en,es){if(en.length<2)return es.error("Expected at least one argument.");let ec=en[1];if(!Array.isArray(ec)&&"object"==typeof ec)return es.error("First argument must be an image or text section.");let ed=[],ep=!1;for(let ec=1;ec<=en.length-1;++ec){let ef=en[ec];if(ep&&"object"==typeof ef&&!Array.isArray(ef)){ep=!1;let en=null;if(ef["font-scale"]&&!(en=es.parse(ef["font-scale"],1,eW)))return null;let ec=null;if(ef["text-font"]&&!(ec=es.parse(ef["text-font"],1,Ht(eH))))return null;let em=null;if(ef["text-color"]&&!(em=es.parse(ef["text-color"],1,eK)))return null;let e_=null;if(ef["vertical-align"]){if("string"==typeof ef["vertical-align"]&&!tg.includes(ef["vertical-align"]))return es.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${ef["vertical-align"]}' instead.`);if(!(e_=es.parse(ef["vertical-align"],1,eH)))return null}let eg=ed[ed.length-1];eg.scale=en,eg.font=ec,eg.textColor=em,eg.verticalAlign=e_}else{let ef=es.parse(en[ec],1,eQ);if(!ef)return null;let em=ef.type.kind;if("string"!==em&&"value"!==em&&"null"!==em&&"resolvedImage"!==em)return es.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ep=!0,ed.push({content:ef,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ir(ed)}evaluate(en){return new Ce(this.sections.map(es=>{let ec=es.content.evaluate(en);return Ue(ec)===e4?new Pe("",ec,null,null,null,es.verticalAlign?es.verticalAlign.evaluate(en):null):new Pe(je(ec),null,es.scale?es.scale.evaluate(en):null,es.font?es.font.evaluate(en).join(","):null,es.textColor?es.textColor.evaluate(en):null,es.verticalAlign?es.verticalAlign.evaluate(en):null)}))}eachChild(en){for(let es of this.sections)en(es.content),es.scale&&en(es.scale),es.font&&en(es.font),es.textColor&&en(es.textColor),es.verticalAlign&&en(es.verticalAlign)}outputDefined(){return!1}};let zr=class zr{constructor(en){this.type=e4,this.input=en}static parse(en,es){if(2!==en.length)return es.error("Expected two arguments.");let ec=es.parse(en[1],1,eH);return ec?new zr(ec):es.error("No image name provided.")}evaluate(en){let es=this.input.evaluate(en),ec=$e.fromString(es);return ec&&en.availableImages&&(ec.available=en.availableImages.indexOf(es)>-1),ec}eachChild(en){en(this.input)}outputDefined(){return!1}};let Pr=class Pr{constructor(en){this.type=eW,this.input=en}static parse(en,es){if(2!==en.length)return es.error(`Expected 1 argument, but found ${en.length-1} instead.`);let ec=es.parse(en[1],1);return ec?"array"!==ec.type.kind&&"string"!==ec.type.kind&&"value"!==ec.type.kind?es.error(`Expected argument of type string or array, but found ${Kt(ec.type)} instead.`):new Pr(ec):null}evaluate(en){let es=this.input.evaluate(en);if("string"==typeof es)return[...es].length;if(Array.isArray(es))return es.length;throw new Ve(`Expected value to be of type string or array, but found ${Kt(Ue(es))} instead.`)}eachChild(en){en(this.input)}outputDefined(){return!1}};function Tr(en,es){let ec=Math.pow(2,es.z);return[360*((en[0]/8192+es.x)/ec)-180,360/Math.PI*Math.atan(Math.exp((180-360*((en[1]/8192+es.y)/ec))*Math.PI/180))-90]}function Br(en,es){en[0]=Math.min(en[0],es[0]),en[1]=Math.min(en[1],es[1]),en[2]=Math.max(en[2],es[0]),en[3]=Math.max(en[3],es[1])}function Vr(en,es){return!(en[0]<=es[0]||en[2]>=es[2]||en[1]<=es[1]||en[3]>=es[3])}function Dr(en,es,ec,ed){var ep,ef;return 0!=(ep=[ed[0]-ec[0],ed[1]-ec[1]])[0]*(ef=[es[0]-en[0],es[1]-en[1]])[1]-ep[1]*ef[0]&&!(!jr(en,es,ec,ed)||!jr(ec,ed,en,es))}function Lr(en,es,ec=!1){var ed,ep;let ef=!1;for(let em of es)for(let es=0;es<em.length-1;es++){if(function(en,es,ec){let ed=en[0]-es[0],ep=en[1]-es[1],ef=en[0]-ec[0],em=en[1]-ec[1];return ed*em-ef*ep==0&&ed*ef<=0&&ep*em<=0}(en,em[es],em[es+1]))return ec;(ed=em[es])[1]>en[1]!=(ep=em[es+1])[1]>en[1]&&en[0]<(ep[0]-ed[0])*(en[1]-ed[1])/(ep[1]-ed[1])+ed[0]&&(ef=!ef)}return ef}function Rr(en,es){for(let ec of en)if(!Lr(ec,es))return!1;for(let ec=0;ec<en.length-1;++ec)if(function(en,es,ec){for(let ed of ec)for(let ec=0;ec<ed.length-1;++ec)if(Dr(en,es,ed[ec],ed[ec+1]))return!0;return!1}(en[ec],en[ec+1],es))return!1;return!0}function jr(en,es,ec,ed){let ep=ed[0]-ec[0],ef=ed[1]-ec[1],em=(en[0]-ec[0])*ef-ep*(en[1]-ec[1]),e_=(es[0]-ec[0])*ef-ep*(es[1]-ec[1]);return em>0&&e_<0||em<0&&e_>0}function Nr(en,es,ec){let ed=[];for(let ep=0;ep<en.length;ep++){let ef=[];for(let ed=0;ed<en[ep].length;ed++){let em=function(en,es){let ec=(180+en[0])/360,ed=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+en[1]*Math.PI/360)))/360,ep=Math.pow(2,es.z);return[Math.round(ec*ep*8192),Math.round(ed*ep*8192)]}(en[ep][ed],ec);Br(es,em),ef.push(em)}ed.push(ef)}return ed}function qr(en,es,ec){let ed=[];for(let ep=0;ep<en.length;ep++){let ef=Nr(en[ep],es,ec);ed.push(ef)}return ed}function Gr(en,es,ec,ed){if(en[0]<ec[0]||en[0]>ec[2]){let es=.5*ed,ep=en[0]-ec[0]>es?-ed:ec[0]-en[0]>es?ed:0;0===ep&&(ep=en[0]-ec[2]>es?-ed:ec[2]-en[0]>es?ed:0),en[0]+=ep}Br(es,en)}function Xr(en,es,ec,ed){let ep=8192*Math.pow(2,ed.z),ef=[8192*ed.x,8192*ed.y],em=[];for(let ed of en)for(let en of ed){let ed=[en.x+ef[0],en.y+ef[1]];Gr(ed,es,ec,ep),em.push(ed)}return em}function Zr(en,es,ec,ed){let ep=8192*Math.pow(2,ed.z),ef=[8192*ed.x,8192*ed.y],em=[];for(let ec of en){let en=[];for(let ed of ec){let ec=[ed.x+ef[0],ed.y+ef[1]];Br(es,ec),en.push(ec)}em.push(en)}if(es[2]-es[0]<=ep/2)for(let en of(es[0]=es[1]=1/0,es[2]=es[3]=-1/0,em))for(let ed of en)Gr(ed,es,ec,ep);return em}let Yr=class Yr{constructor(en,es){this.type=eX,this.geojson=en,this.geometries=es}static parse(en,es){if(2!==en.length)return es.error(`'within' expression requires exactly one argument, but found ${en.length-1} instead.`);if(Re(en[1])){let es=en[1];if("FeatureCollection"===es.type){let en=[];for(let ec of es.features){let{type:es,coordinates:ed}=ec.geometry;"Polygon"===es&&en.push(ed),"MultiPolygon"===es&&en.push(...ed)}if(en.length)return new Yr(es,{type:"MultiPolygon",coordinates:en})}else if("Feature"===es.type){let en=es.geometry.type;if("Polygon"===en||"MultiPolygon"===en)return new Yr(es,es.geometry)}else if("Polygon"===es.type||"MultiPolygon"===es.type)return new Yr(es,es)}return es.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(en){if(null!=en.geometry()&&null!=en.canonicalID()){if("Point"===en.geometryType())return function(en,es){let ec=[1/0,1/0,-1/0,-1/0],ed=[1/0,1/0,-1/0,-1/0],ep=en.canonicalID();if("Polygon"===es.type){let ef=Nr(es.coordinates,ed,ep),em=Xr(en.geometry(),ec,ed,ep);if(!Vr(ec,ed))return!1;for(let en of em)if(!Lr(en,ef))return!1}if("MultiPolygon"===es.type){let ef=qr(es.coordinates,ed,ep),em=Xr(en.geometry(),ec,ed,ep);if(!Vr(ec,ed))return!1;for(let en of em)if(!function(en,es){for(let ec of es)if(Lr(en,ec))return!0;return!1}(en,ef))return!1}return!0}(en,this.geometries);if("LineString"===en.geometryType())return function(en,es){let ec=[1/0,1/0,-1/0,-1/0],ed=[1/0,1/0,-1/0,-1/0],ep=en.canonicalID();if("Polygon"===es.type){let ef=Nr(es.coordinates,ed,ep),em=Zr(en.geometry(),ec,ed,ep);if(!Vr(ec,ed))return!1;for(let en of em)if(!Rr(en,ef))return!1}if("MultiPolygon"===es.type){let ef=qr(es.coordinates,ed,ep),em=Zr(en.geometry(),ec,ed,ep);if(!Vr(ec,ed))return!1;for(let en of em)if(!function(en,es){for(let ec of es)if(Rr(en,ec))return!0;return!1}(en,ef))return!1}return!0}(en,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}};let tB=class{constructor(en=[],es=(en,es)=>en<es?-1:en>es?1:0){if(this.data=en,this.length=this.data.length,this.compare=es,this.length>0)for(let en=(this.length>>1)-1;en>=0;en--)this._down(en)}push(en){this.data.push(en),this._up(this.length++)}pop(){if(0===this.length)return;let en=this.data[0],es=this.data.pop();return--this.length>0&&(this.data[0]=es,this._down(0)),en}peek(){return this.data[0]}_up(en){let{data:es,compare:ec}=this,ed=es[en];for(;en>0;){let ep=en-1>>1,ef=es[ep];if(ec(ed,ef)>=0)break;es[en]=ef,en=ep}es[en]=ed}_down(en){let{data:es,compare:ec}=this,ed=this.length>>1,ep=es[en];for(;en<ed;){let ed=1+(en<<1),ef=ed+1;if(ef<this.length&&0>ec(es[ef],es[ed])&&(ed=ef),ec(es[ed],ep)>=0)break;es[en]=es[ed],en=ed}es[en]=ep}};function Jr(en,es,ec){let ed=en[es];en[es]=en[ec],en[ec]=ed}function Qr(en,es){let ec,ed;if(en.length<=1)return[en];let ep=[];for(let es of en){let en=function(en){let es=0;for(let ec,ed,ep=0,ef=en.length,em=ef-1;ep<ef;em=ep++)ec=en[ep],es+=((ed=en[em]).x-ec.x)*(ec.y+ed.y);return es}(es);0!==en&&(es.area=Math.abs(en),void 0===ed&&(ed=en<0),ed===en<0?(ec&&ep.push(ec),ec=[es]):ec.push(es))}if(ec&&ep.push(ec),es>1)for(let en=0;en<ep.length;en++)ep[en].length<=es||(function Kr(en,es,ec=0,ed=en.length-1,ep=function(en,es){return en<es?-1:en>es?1:0}){for(;ed>ec;){if(ed-ec>600){let ef=ed-ec+1,em=es-ec+1,e_=Math.log(ef),eg=.5*Math.exp(2*e_/3),ey=.5*Math.sqrt(e_*eg*(ef-eg)/ef)*(em-ef/2<0?-1:1);Kr(en,es,Math.max(ec,Math.floor(es-em*eg/ef+ey)),Math.min(ed,Math.floor(es+(ef-em)*eg/ef+ey)),ep)}let ef=en[es],em=ec,e_=ed;for(Jr(en,ec,es),ep(en[ed],ef)>0&&Jr(en,ec,ed);em<e_;){for(Jr(en,em,e_),em++,e_--;0>ep(en[em],ef);)em++;for(;ep(en[e_],ef)>0;)e_--}0===ep(en[ec],ef)?Jr(en,ec,e_):Jr(en,++e_,ed),e_<=es&&(ec=e_+1),es<=e_&&(ed=e_-1)}}(ep[en],es,1,ep[en].length-1,tn),ep[en]=ep[en].slice(0,es));return ep}function tn(en,es){return es.area-en.area}let tF=1/298.257223563,tO=tF*(2-tF),tj=Math.PI/180;let an=class an{constructor(en){let es=6378.137*tj*1e3,ec=Math.cos(en*tj),ed=1/(1-tO*(1-ec*ec)),ep=Math.sqrt(ed);this.kx=es*ep*ec,this.ky=es*ep*ed*(1-tO)}distance(en,es){let ec=this.wrap(en[0]-es[0])*this.kx,ed=(en[1]-es[1])*this.ky;return Math.sqrt(ec*ec+ed*ed)}pointOnLine(en,es){let ec,ed,ep,ef,em=1/0;for(let e_=0;e_<en.length-1;e_++){let eg=en[e_][0],ey=en[e_][1],ex=this.wrap(en[e_+1][0]-eg)*this.kx,ev=(en[e_+1][1]-ey)*this.ky,eb=0;0===ex&&0===ev||((eb=(this.wrap(es[0]-eg)*this.kx*ex+(es[1]-ey)*this.ky*ev)/(ex*ex+ev*ev))>1?(eg=en[e_+1][0],ey=en[e_+1][1]):eb>0&&(eg+=ex/this.kx*eb,ey+=ev/this.ky*eb)),ex=this.wrap(es[0]-eg)*this.kx,ev=(es[1]-ey)*this.ky;let ew=ex*ex+ev*ev;ew<em&&(em=ew,ec=eg,ed=ey,ep=e_,ef=eb)}return{point:[ec,ed],index:ep,t:Math.max(0,Math.min(1,ef))}}wrap(en){for(;en<-180;)en+=360;for(;en>180;)en-=360;return en}};function on(en,es){return es[0]-en[0]}function ln(en){return en[1]-en[0]+1}function un(en,es){return en[1]>=en[0]&&en[1]<es}function cn(en,es){if(en[0]>en[1])return[null,null];let ec=ln(en);if(es){if(2===ec)return[en,null];let es=Math.floor(ec/2);return[[en[0],en[0]+es],[en[0]+es,en[1]]]}if(1===ec)return[en,null];let ed=Math.floor(ec/2)-1;return[[en[0],en[0]+ed],[en[0]+ed+1,en[1]]]}function hn(en,es){if(!un(es,en.length))return[1/0,1/0,-1/0,-1/0];let ec=[1/0,1/0,-1/0,-1/0];for(let ed=es[0];ed<=es[1];++ed)Br(ec,en[ed]);return ec}function pn(en){let es=[1/0,1/0,-1/0,-1/0];for(let ec of en)for(let en of ec)Br(es,en);return es}function fn(en){return en[0]!==-1/0&&en[1]!==-1/0&&en[2]!==1/0&&en[3]!==1/0}function dn(en,es,ec){if(!fn(en)||!fn(es))return NaN;let ed=0,ep=0;return en[2]<es[0]&&(ed=es[0]-en[2]),en[0]>es[2]&&(ed=en[0]-es[2]),en[1]>es[3]&&(ep=en[1]-es[3]),en[3]<es[1]&&(ep=es[1]-en[3]),ec.distance([0,0],[ed,ep])}function yn(en,es,ec){let ed=ec.pointOnLine(es,en);return ec.distance(en,ed.point)}function mn(en,es,ec,ed,ep){let ef=Math.min(yn(en,[ec,ed],ep),yn(es,[ec,ed],ep)),em=Math.min(yn(ec,[en,es],ep),yn(ed,[en,es],ep));return Math.min(ef,em)}function wn(en,es){for(let ec of en)for(let en of ec)if(Lr(en,es,!0))return!0;return!1}function Sn(en,es,ec,ed,ep,ef){if(!ef)return;let em=dn(hn(ed,ef),ep,ec);em<es&&en.push([em,ef,[0,0]])}function An(en,es,ec,ed,ep,ef,em){if(!ef||!em)return;let e_=dn(hn(ed,ef),hn(ep,em),ec);e_<es&&en.push([e_,ef,em])}function kn(en,es,ec,ed,ep=1/0){let ef=Math.min(ed.distance(en[0],ec[0][0]),ep);if(0===ef)return ef;let em=new tB([[0,[0,en.length-1],[0,0]]],on),e_=pn(ec);for(;em.length>0;){let ep=em.pop();if(ep[0]>=ef)continue;let eg=ep[1],ey=es?50:100;if(ln(eg)<=ey){if(!un(eg,en.length))return NaN;if(es){let es=function(en,es,ec,ed){if(!un(es,en.length))return NaN;for(let ed=es[0];ed<=es[1];++ed)if(Lr(en[ed],ec,!0))return 0;let ep=1/0;for(let ef=es[0];ef<es[1];++ef){let es=en[ef],em=en[ef+1];for(let en of ec)for(let ec=0,ef=en.length,e_=ef-1;ec<ef;e_=ec++){let ef=en[e_],eg=en[ec];if(Dr(es,em,ef,eg))return 0;ep=Math.min(ep,mn(es,em,ef,eg,ed))}}return ep}(en,eg,ec,ed);if(isNaN(es)||0===es)return es;ef=Math.min(ef,es)}else for(let es=eg[0];es<=eg[1];++es){let ep=function(en,es,ec){if(Lr(en,es,!0))return 0;let ed=1/0;for(let ep of es){let es=ep[0],ef=ep[ep.length-1];if(es!==ef&&0===(ed=Math.min(ed,yn(en,[ef,es],ec))))break;let em=ec.pointOnLine(ep,en);if(0===(ed=Math.min(ed,ec.distance(en,em.point))))break}return ed}(en[es],ec,ed);if(0===(ef=Math.min(ef,ep)))return 0}}else{let ec=cn(eg,es);Sn(em,ef,ed,en,e_,ec[0]),Sn(em,ef,ed,en,e_,ec[1])}}return ef}function Mn(en,es,ec,ed,ep,ef=1/0){let em=Math.min(ef,ep.distance(en[0],ec[0]));if(0===em)return em;let e_=new tB([[0,[0,en.length-1],[0,ec.length-1]]],on);for(;e_.length>0;){let ef=e_.pop();if(ef[0]>=em)continue;let eg=ef[1],ey=ef[2],ex=es?50:100,ev=ed?50:100;if(ln(eg)<=ex&&ln(ey)<=ev){if(!un(eg,en.length)&&un(ey,ec.length))return NaN;if(es&&ed)em=Math.min(em,function(en,es,ec,ed,ep){if(!un(es,en.length)||!un(ed,ec.length))return 1/0;let ef=1/0;for(let em=es[0];em<es[1];++em){let es=en[em],e_=en[em+1];for(let en=ed[0];en<ed[1];++en){let ed=ec[en],em=ec[en+1];if(Dr(es,e_,ed,em))return 0;ef=Math.min(ef,mn(es,e_,ed,em,ep))}}return ef}(en,eg,ec,ey,ep));else if(es&&!ed){let es=en.slice(eg[0],eg[1]+1);for(let en=ey[0];en<=ey[1];++en)if(0===(em=Math.min(em,yn(ec[en],es,ep))))return em}else if(!es&&ed){let es=ec.slice(ey[0],ey[1]+1);for(let ec=eg[0];ec<=eg[1];++ec)if(0===(em=Math.min(em,yn(en[ec],es,ep))))return em}else em=Math.min(em,function(en,es,ec,ed,ep){if(!un(es,en.length)||!un(ed,ec.length))return NaN;let ef=1/0;for(let em=es[0];em<=es[1];++em)for(let es=ed[0];es<=ed[1];++es)if(0===(ef=Math.min(ef,ep.distance(en[em],ec[es]))))return ef;return ef}(en,eg,ec,ey,ep))}else{let ef=cn(eg,es),ex=cn(ey,ed);An(e_,em,ep,en,ec,ef[0],ex[0]),An(e_,em,ep,en,ec,ef[0],ex[1]),An(e_,em,ep,en,ec,ef[1],ex[0]),An(e_,em,ep,en,ec,ef[1],ex[1])}}return em}function In(en){return"MultiPolygon"===en.type?en.coordinates.map(en=>({type:"Polygon",coordinates:en})):"MultiLineString"===en.type?en.coordinates.map(en=>({type:"LineString",coordinates:en})):"MultiPoint"===en.type?en.coordinates.map(en=>({type:"Point",coordinates:en})):[en]}let zn=class zn{constructor(en,es){this.type=eW,this.geojson=en,this.geometries=es}static parse(en,es){if(2!==en.length)return es.error(`'distance' expression requires exactly one argument, but found ${en.length-1} instead.`);if(Re(en[1])){let es=en[1];if("FeatureCollection"===es.type)return new zn(es,es.features.map(en=>In(en.geometry)).flat());if("Feature"===es.type)return new zn(es,In(es.geometry));if("type"in es&&"coordinates"in es)return new zn(es,In(es))}return es.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(en){if(null!=en.geometry()&&null!=en.canonicalID()){if("Point"===en.geometryType())return function(en,es){let ec=en.geometry(),ed=ec.flat().map(es=>Tr([es.x,es.y],en.canonical));if(0===ec.length)return NaN;let ep=new an(ed[0][1]),ef=1/0;for(let en of es){switch(en.type){case"Point":ef=Math.min(ef,Mn(ed,!1,[en.coordinates],!1,ep,ef));break;case"LineString":ef=Math.min(ef,Mn(ed,!1,en.coordinates,!0,ep,ef));break;case"Polygon":ef=Math.min(ef,kn(ed,!1,en.coordinates,ep,ef))}if(0===ef)break}return ef}(en,this.geometries);if("LineString"===en.geometryType())return function(en,es){let ec=en.geometry(),ed=ec.flat().map(es=>Tr([es.x,es.y],en.canonical));if(0===ec.length)return NaN;let ep=new an(ed[0][1]),ef=1/0;for(let en of es){switch(en.type){case"Point":ef=Math.min(ef,Mn(ed,!0,[en.coordinates],!1,ep,ef));break;case"LineString":ef=Math.min(ef,Mn(ed,!0,en.coordinates,!0,ep,ef));break;case"Polygon":ef=Math.min(ef,kn(ed,!0,en.coordinates,ep,ef))}if(0===ef)break}return ef}(en,this.geometries);if("Polygon"===en.geometryType())return function(en,es){let ec=en.geometry();if(0===ec.length||0===ec[0].length)return NaN;let ed=Qr(ec,0).map(es=>es.map(es=>es.map(es=>Tr([es.x,es.y],en.canonical)))),ep=new an(ed[0][0][0][1]),ef=1/0;for(let en of es)for(let es of ed){switch(en.type){case"Point":ef=Math.min(ef,kn([en.coordinates],!1,es,ep,ef));break;case"LineString":ef=Math.min(ef,kn(en.coordinates,!0,es,ep,ef));break;case"Polygon":ef=Math.min(ef,function(en,es,ec,ed=1/0){let ep=pn(en),ef=pn(es);if(ed!==1/0&&dn(ep,ef,ec)>=ed)return ed;if(Vr(ep,ef)){if(wn(en,es))return 0}else if(wn(es,en))return 0;let em=1/0;for(let ed of en)for(let en=0,ep=ed.length,ef=ep-1;en<ep;ef=en++){let ep=ed[ef],e_=ed[en];for(let en of es)for(let es=0,ed=en.length,ef=ed-1;es<ed;ef=es++){let ed=en[ef],eg=en[es];if(Dr(ep,e_,ed,eg))return 0;em=Math.min(em,mn(ep,e_,ed,eg,ec))}}return em}(es,en.coordinates,ep,ef))}if(0===ef)return ef}return ef}(en,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}};let Pn=class Pn{constructor(en){this.type=eQ,this.key=en}static parse(en,es){if(2!==en.length)return es.error(`Expected 1 argument, but found ${en.length-1} instead.`);let ec=en[1];return null==ec?es.error("Global state property must be defined."):"string"!=typeof ec?es.error(`Global state property must be string, but found ${typeof en[1]} instead.`):new Pn(ec)}evaluate(en){var es;let ec=null===(es=en.globals)||void 0===es?void 0:es.globalState;return ec&&0!==Object.keys(ec).length?xe(ec,this.key):null}eachChild(){}outputDefined(){return!1}};let tV={"==":tA,"!=":tz,">":tD,"<":tk,">=":tL,"<=":tR,array:Ge,at:Qe,boolean:Ge,case:nr,coalesce:yr,collator:kr,format:Ir,image:zr,in:tr,"index-of":er,interpolate:pr,"interpolate-hcl":pr,"interpolate-lab":pr,length:Pr,let:Je,literal:Ne,match:rr,number:Ge,"number-format":Mr,object:Ge,slice:ir,step:ar,string:Ge,"to-boolean":Ze,"to-color":Ze,"to-number":Ze,"to-string":Ze,var:We,within:Yr,distance:zn,"global-state":Pn};let En=class En{constructor(en,es,ec,ed){this.name=en,this.type=es,this._evaluate=ec,this.args=ed}evaluate(en){return this._evaluate(en,this.args)}eachChild(en){this.args.forEach(en)}outputDefined(){return!1}static parse(en,es){let ec=en[0],ed=En.definitions[ec];if(!ed)return es.error(`Unknown expression "${ec}". If you wanted a literal array, use ["literal", [...]].`,0);let ep=Array.isArray(ed)?ed[0]:ed.type,ef=Array.isArray(ed)?[[ed[1],ed[2]]]:ed.overloads,em=ef.filter(([es])=>!Array.isArray(es)||es.length===en.length-1),e_=null;for(let[ed,ef]of em){e_=new Ke(es.registry,Dn,es.path,null,es.scope);let em=[],eg=!1;for(let es=1;es<en.length;es++){let ec=en[es],ep=Array.isArray(ed)?ed[es-1]:ed.type,ef=e_.parse(ec,1+em.length,ep);if(!ef){eg=!0;break}em.push(ef)}if(!eg){if(Array.isArray(ed)&&ed.length!==em.length)e_.error(`Expected ${ed.length} arguments, but found ${em.length} instead.`);else{for(let en=0;en<em.length;en++){let es=Array.isArray(ed)?ed[en]:ed.type,ec=em[en];e_.concat(en+1).checkSubtype(es,ec.type)}if(0===e_.errors.length)return new En(ec,ep,ef,em)}}}if(1===em.length)es.errors.push(...e_.errors);else{let ec=(em.length?em:ef).map(([en])=>Array.isArray(en)?`(${en.map(Kt).join(", ")})`:`(${Kt(en.type)}...)`).join(" | "),ed=[];for(let ec=1;ec<en.length;ec++){let ep=es.parse(en[ec],1+ed.length);if(!ep)return null;ed.push(Kt(ep.type))}es.error(`Expected arguments of type ${ec}, but found (${ed.join(", ")}) instead.`)}return null}static register(en,es){for(let ec in En.definitions=es,es)en[ec]=En}};function Tn(en,[es,ec,ed,ep]){es=es.evaluate(en),ec=ec.evaluate(en),ed=ed.evaluate(en);let ef=ep?ep.evaluate(en):1,em=Oe(es,ec,ed,ef);if(em)throw new Ve(em);return new Me(es/255,ec/255,ed/255,ef,!1)}function Vn(en,es){let ec=es[en];return void 0===ec?null:ec}function Fn(en){return{type:en}}function Dn(en){if(en instanceof We)return Dn(en.boundExpression);if(en instanceof En&&"error"===en.name||en instanceof kr||en instanceof Yr||en instanceof zn||en instanceof Pn)return!1;let es=en instanceof Ze||en instanceof Ge,ec=!0;return en.eachChild(en=>{ec=es?ec&&Dn(en):ec&&en instanceof Ne}),!!ec&&$n(en)&&On(en,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function $n(en){if(en instanceof En&&("get"===en.name&&1===en.args.length||"feature-state"===en.name||"has"===en.name&&1===en.args.length||"properties"===en.name||"geometry-type"===en.name||"id"===en.name||/^filter-/.test(en.name))||en instanceof Yr||en instanceof zn)return!1;let es=!0;return en.eachChild(en=>{es&&!$n(en)&&(es=!1)}),es}function Ln(en){if(en instanceof En&&"feature-state"===en.name)return!1;let es=!0;return en.eachChild(en=>{es&&!Ln(en)&&(es=!1)}),es}function On(en,es){if(en instanceof En&&es.indexOf(en.name)>=0)return!1;let ec=!0;return en.eachChild(en=>{ec&&!On(en,es)&&(ec=!1)}),ec}function Rn(en){return{result:"success",value:en}}function Un(en){return{result:"error",value:en}}function jn(en){return"data-driven"===en["property-type"]||"cross-faded-data-driven"===en["property-type"]}function Nn(en){return!!en.expression&&en.expression.parameters.indexOf("zoom")>-1}function qn(en){return!!en.expression&&en.expression.interpolated}function Gn(en){return en instanceof Number?"number":en instanceof String?"string":en instanceof Boolean?"boolean":Array.isArray(en)?"array":null===en?"null":typeof en}function Xn(en){return"object"==typeof en&&null!==en&&!Array.isArray(en)&&Ue(en)===eJ}function Zn(en){return en}function Hn(en,es,ec){return void 0!==en?en:void 0!==es?es:void 0!==ec?ec:void 0}function Kn(en,es,ec,ed,ep){return Hn(typeof ec===ep?ed[ec]:void 0,en.default,es.default)}function Jn(en,es,ec){if("number"!==Gn(ec))return Hn(en.default,es.default);let ed=en.stops.length;if(1===ed||ec<=en.stops[0][0])return en.stops[0][1];if(ec>=en.stops[ed-1][0])return en.stops[ed-1][1];let ep=sr(en.stops.map(en=>en[0]),ec);return en.stops[ep][1]}function Wn(en,es,ec){let ed=void 0!==en.base?en.base:1;if("number"!==Gn(ec))return Hn(en.default,es.default);let ep=en.stops.length;if(1===ep||ec<=en.stops[0][0])return en.stops[0][1];if(ec>=en.stops[ep-1][0])return en.stops[ep-1][1];let ef=sr(en.stops.map(en=>en[0]),ec),em=function(en,es,ec,ed){let ep=ed-ec,ef=en-ec;return 0===ep?0:1===es?ef/ep:(Math.pow(es,ef)-1)/(Math.pow(es,ep)-1)}(ec,ed,en.stops[ef][0],en.stops[ef+1][0]),e_=en.stops[ef][1],eg=en.stops[ef+1][1],ey=tE[es.type]||Zn;return"function"==typeof e_.evaluate?{evaluate(...es){let ec=e_.evaluate.apply(void 0,es),ed=eg.evaluate.apply(void 0,es);if(void 0!==ec&&void 0!==ed)return ey(ec,ed,em,en.colorSpace)}}:ey(e_,eg,em,en.colorSpace)}function Qn(en,es,ec){switch(es.type){case"color":ec=Me.parse(ec);break;case"formatted":ec=Ce.fromString(ec.toString());break;case"resolvedImage":ec=$e.fromString(ec.toString());break;case"padding":ec=Ee.parse(ec);break;case"colorArray":ec=Be.parse(ec);break;case"numberArray":ec=Te.parse(ec);break;default:Gn(ec)===es.type||"enum"===es.type&&es.values[ec]||(ec=void 0)}return Hn(ec,en.default,es.default)}En.register(tV,{error:[{kind:"error"},[eH],(en,[es])=>{throw new Ve(es.evaluate(en))}],typeof:[eH,[eQ],(en,[es])=>Kt(Ue(es.evaluate(en)))],"to-rgba":[Ht(eW,4),[eK],(en,[es])=>{let[ec,ed,ep,ef]=es.evaluate(en).rgb;return[255*ec,255*ed,255*ep,ef]}],rgb:[eK,[eW,eW,eW],Tn],rgba:[eK,[eW,eW,eW,eW],Tn],has:{type:eX,overloads:[[[eH],(en,[es])=>es.evaluate(en) in en.properties()],[[eH,eJ],(en,[es,ec])=>es.evaluate(en) in ec.evaluate(en)]]},get:{type:eQ,overloads:[[[eH],(en,[es])=>Vn(es.evaluate(en),en.properties())],[[eH,eJ],(en,[es,ec])=>Vn(es.evaluate(en),ec.evaluate(en))]]},"feature-state":[eQ,[eH],(en,[es])=>Vn(es.evaluate(en),en.featureState||{})],properties:[eJ,[],en=>en.properties()],"geometry-type":[eH,[],en=>en.geometryType()],id:[eQ,[],en=>en.id()],zoom:[eW,[],en=>en.globals.zoom],"heatmap-density":[eW,[],en=>en.globals.heatmapDensity||0],elevation:[eW,[],en=>en.globals.elevation||0],"line-progress":[eW,[],en=>en.globals.lineProgress||0],accumulated:[eQ,[],en=>void 0===en.globals.accumulated?null:en.globals.accumulated],"+":[eW,Fn(eW),(en,es)=>{let ec=0;for(let ed of es)ec+=ed.evaluate(en);return ec}],"*":[eW,Fn(eW),(en,es)=>{let ec=1;for(let ed of es)ec*=ed.evaluate(en);return ec}],"-":{type:eW,overloads:[[[eW,eW],(en,[es,ec])=>es.evaluate(en)-ec.evaluate(en)],[[eW],(en,[es])=>-es.evaluate(en)]]},"/":[eW,[eW,eW],(en,[es,ec])=>es.evaluate(en)/ec.evaluate(en)],"%":[eW,[eW,eW],(en,[es,ec])=>es.evaluate(en)%ec.evaluate(en)],ln2:[eW,[],()=>Math.LN2],pi:[eW,[],()=>Math.PI],e:[eW,[],()=>Math.E],"^":[eW,[eW,eW],(en,[es,ec])=>Math.pow(es.evaluate(en),ec.evaluate(en))],sqrt:[eW,[eW],(en,[es])=>Math.sqrt(es.evaluate(en))],log10:[eW,[eW],(en,[es])=>Math.log(es.evaluate(en))/Math.LN10],ln:[eW,[eW],(en,[es])=>Math.log(es.evaluate(en))],log2:[eW,[eW],(en,[es])=>Math.log(es.evaluate(en))/Math.LN2],sin:[eW,[eW],(en,[es])=>Math.sin(es.evaluate(en))],cos:[eW,[eW],(en,[es])=>Math.cos(es.evaluate(en))],tan:[eW,[eW],(en,[es])=>Math.tan(es.evaluate(en))],asin:[eW,[eW],(en,[es])=>Math.asin(es.evaluate(en))],acos:[eW,[eW],(en,[es])=>Math.acos(es.evaluate(en))],atan:[eW,[eW],(en,[es])=>Math.atan(es.evaluate(en))],min:[eW,Fn(eW),(en,es)=>Math.min(...es.map(es=>es.evaluate(en)))],max:[eW,Fn(eW),(en,es)=>Math.max(...es.map(es=>es.evaluate(en)))],abs:[eW,[eW],(en,[es])=>Math.abs(es.evaluate(en))],round:[eW,[eW],(en,[es])=>{let ec=es.evaluate(en);return ec<0?-Math.round(-ec):Math.round(ec)}],floor:[eW,[eW],(en,[es])=>Math.floor(es.evaluate(en))],ceil:[eW,[eW],(en,[es])=>Math.ceil(es.evaluate(en))],"filter-==":[eX,[eH,eQ],(en,[es,ec])=>en.properties()[es.value]===ec.value],"filter-id-==":[eX,[eQ],(en,[es])=>en.id()===es.value],"filter-type-==":[eX,[eH],(en,[es])=>en.geometryType()===es.value],"filter-<":[eX,[eH,eQ],(en,[es,ec])=>{let ed=en.properties()[es.value],ep=ec.value;return typeof ed==typeof ep&&ed<ep}],"filter-id-<":[eX,[eQ],(en,[es])=>{let ec=en.id(),ed=es.value;return typeof ec==typeof ed&&ec<ed}],"filter->":[eX,[eH,eQ],(en,[es,ec])=>{let ed=en.properties()[es.value],ep=ec.value;return typeof ed==typeof ep&&ed>ep}],"filter-id->":[eX,[eQ],(en,[es])=>{let ec=en.id(),ed=es.value;return typeof ec==typeof ed&&ec>ed}],"filter-<=":[eX,[eH,eQ],(en,[es,ec])=>{let ed=en.properties()[es.value],ep=ec.value;return typeof ed==typeof ep&&ed<=ep}],"filter-id-<=":[eX,[eQ],(en,[es])=>{let ec=en.id(),ed=es.value;return typeof ec==typeof ed&&ec<=ed}],"filter->=":[eX,[eH,eQ],(en,[es,ec])=>{let ed=en.properties()[es.value],ep=ec.value;return typeof ed==typeof ep&&ed>=ep}],"filter-id->=":[eX,[eQ],(en,[es])=>{let ec=en.id(),ed=es.value;return typeof ec==typeof ed&&ec>=ed}],"filter-has":[eX,[eQ],(en,[es])=>es.value in en.properties()],"filter-has-id":[eX,[],en=>null!==en.id()&&void 0!==en.id()],"filter-type-in":[eX,[Ht(eH)],(en,[es])=>es.value.indexOf(en.geometryType())>=0],"filter-id-in":[eX,[Ht(eQ)],(en,[es])=>es.value.indexOf(en.id())>=0],"filter-in-small":[eX,[eH,Ht(eQ)],(en,[es,ec])=>ec.value.indexOf(en.properties()[es.value])>=0],"filter-in-large":[eX,[eH,Ht(eQ)],(en,[es,ec])=>(function(en,es,ec,ed){for(;ec<=ed;){let ep=ec+ed>>1;if(es[ep]===en)return!0;es[ep]>en?ed=ep-1:ec=ep+1}return!1})(en.properties()[es.value],ec.value,0,ec.value.length-1)],all:{type:eX,overloads:[[[eX,eX],(en,[es,ec])=>es.evaluate(en)&&ec.evaluate(en)],[Fn(eX),(en,es)=>{for(let ec of es)if(!ec.evaluate(en))return!1;return!0}]]},any:{type:eX,overloads:[[[eX,eX],(en,[es,ec])=>es.evaluate(en)||ec.evaluate(en)],[Fn(eX),(en,es)=>{for(let ec of es)if(ec.evaluate(en))return!0;return!1}]]},"!":[eX,[eX],(en,[es])=>!es.evaluate(en)],"is-supported-script":[eX,[eH],(en,[es])=>{let ec=en.globals&&en.globals.isSupportedScript;return!ec||ec(es.evaluate(en))}],upcase:[eH,[eH],(en,[es])=>es.evaluate(en).toUpperCase()],downcase:[eH,[eH],(en,[es])=>es.evaluate(en).toLowerCase()],concat:[eH,Fn(eQ),(en,es)=>es.map(es=>je(es.evaluate(en))).join("")],"resolved-locale":[eH,[e0],(en,[es])=>es.evaluate(en).resolvedLocale()]});let ti=class ti{constructor(en,es,ec){this.expression=en,this._warningHistory={},this._evaluator=new He,this._defaultValue=es?function(en){if("color"===en.type&&Xn(en.default))return new Me(0,0,0,0);switch(en.type){case"color":return Me.parse(en.default)||null;case"padding":return Ee.parse(en.default)||null;case"numberArray":return Te.parse(en.default)||null;case"colorArray":return Be.parse(en.default)||null;case"variableAnchorOffsetCollection":return De.parse(en.default)||null;case"projectionDefinition":return Le.parse(en.default)||null;default:return void 0===en.default?null:en.default}}(es):null,this._enumValues=es&&"enum"===es.type?es.values:null,this._globalState=ec}evaluateWithoutErrorHandling(en,es,ec,ed,ep,ef){return this._globalState&&(en=ui(en,this._globalState)),this._evaluator.globals=en,this._evaluator.feature=es,this._evaluator.featureState=ec,this._evaluator.canonical=ed,this._evaluator.availableImages=ep||null,this._evaluator.formattedSection=ef,this.expression.evaluate(this._evaluator)}evaluate(en,es,ec,ed,ep,ef){this._globalState&&(en=ui(en,this._globalState)),this._evaluator.globals=en,this._evaluator.feature=es||null,this._evaluator.featureState=ec||null,this._evaluator.canonical=ed,this._evaluator.availableImages=ep||null,this._evaluator.formattedSection=ef||null;try{let en=this.expression.evaluate(this._evaluator);if(null==en||"number"==typeof en&&en!=en)return this._defaultValue;if(this._enumValues&&!(en in this._enumValues))throw new Ve(`Expected value to be one of ${Object.keys(this._enumValues).map(en=>JSON.stringify(en)).join(", ")}, but found ${JSON.stringify(en)} instead.`);return en}catch(en){return this._warningHistory[en.message]||(this._warningHistory[en.message]=!0,"undefined"!=typeof console&&console.warn(en.message)),this._defaultValue}}};function ei(en){return Array.isArray(en)&&en.length>0&&"string"==typeof en[0]&&en[0]in tV}function ri(en,es,ec){let ed=new Ke(tV,Dn,[],es?function(en){let es={color:eK,string:eH,number:eW,enum:eH,boolean:eX,formatted:e1,padding:e2,numberArray:e5,colorArray:e3,projectionDefinition:eY,resolvedImage:e4,variableAnchorOffsetCollection:e6};return"array"===en.type?Ht(es[en.value]||eQ,en.length):es[en.type]}(es):void 0),ep=ed.parse(en,void 0,void 0,void 0,es&&"string"===es.type?{typeAnnotation:"coerce"}:void 0);return ep?Rn(new ti(ep,es,ec)):Un(ed.errors)}let ni=class ni{constructor(en,es,ec){this.kind=en,this._styleExpression=es,this.isStateDependent="constant"!==en&&!Ln(es.expression),this.globalStateRefs=li(es.expression),this._globalState=ec}evaluateWithoutErrorHandling(en,es,ec,ed,ep,ef){return this._globalState&&(en=ui(en,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(en,es,ec,ed,ep,ef)}evaluate(en,es,ec,ed,ep,ef){return this._globalState&&(en=ui(en,this._globalState)),this._styleExpression.evaluate(en,es,ec,ed,ep,ef)}};let ii=class ii{constructor(en,es,ec,ed,ep){this.kind=en,this.zoomStops=ec,this._styleExpression=es,this.isStateDependent="camera"!==en&&!Ln(es.expression),this.globalStateRefs=li(es.expression),this.interpolationType=ed,this._globalState=ep}evaluateWithoutErrorHandling(en,es,ec,ed,ep,ef){return this._globalState&&(en=ui(en,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(en,es,ec,ed,ep,ef)}evaluate(en,es,ec,ed,ep,ef){return this._globalState&&(en=ui(en,this._globalState)),this._styleExpression.evaluate(en,es,ec,ed,ep,ef)}interpolationFactor(en,es,ec){return this.interpolationType?pr.interpolationFactor(this.interpolationType,en,es,ec):0}};function si(en,es,ec){let ed=ri(en,es,ec);if("error"===ed.result)return ed;let ep=ed.value.expression,ef=$n(ep);if(!ef&&!jn(es))return Un([new Tt("","data expressions not supported")]);let em=On(ep,["zoom"]);if(!em&&!Nn(es))return Un([new Tt("","zoom expressions not supported")]);let e_=function oi(en){let es=null;if(en instanceof Je)es=oi(en.result);else if(en instanceof yr){for(let ec of en.args)if(es=oi(ec))break}else(en instanceof ar||en instanceof pr)&&en.input instanceof En&&"zoom"===en.input.name&&(es=en);return es instanceof Tt||en.eachChild(en=>{let ec=oi(en);ec instanceof Tt?es=ec:!es&&ec?es=new Tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):es&&ec&&es!==ec&&(es=new Tt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),es}(ep);return e_||em?e_ instanceof Tt?Un([e_]):e_ instanceof pr&&!qn(es)?Un([new Tt("",'"interpolate" expressions cannot be used with this property')]):Rn(e_?new ii(ef?"camera":"composite",ed.value,e_.labels,e_ instanceof pr?e_.interpolation:void 0,ec):new ni(ef?"constant":"source",ed.value,ec)):Un([new Tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}let ai=class ai{constructor(en,es){this._parameters=en,this._specification=es,Et(this,function Yn(en,es){var ec;let ed,ep;let ef=en.stops&&"object"==typeof en.stops[0][0],em=ef||!(ef||void 0!==en.property),e_=en.type||(qn(es)?"exponential":"interval"),eg=function(en){switch(en.type){case"color":return Me.parse;case"padding":return Ee.parse;case"numberArray":return Te.parse;case"colorArray":return Be.parse;default:return null}}(es);if(eg&&((en=Et({},en)).stops&&(en.stops=en.stops.map(en=>[en[0],eg(en[1])])),en.default=eg(en.default?en.default:es.default)),en.colorSpace&&"rgb"!==(ec=en.colorSpace)&&"hcl"!==ec&&"lab"!==ec)throw Error(`Unknown color space: "${en.colorSpace}"`);let ey=function(en){switch(en){case"exponential":return Wn;case"interval":return Jn;case"categorical":return Kn;case"identity":return Qn;default:throw Error(`Unknown function type "${en}"`)}}(e_);if("categorical"===e_){for(let es of(ed=Object.create(null),en.stops))ed[es[0]]=es[1];ep=typeof en.stops[0][0]}if(ef){let ec={},ed=[];for(let es=0;es<en.stops.length;es++){let ep=en.stops[es],ef=ep[0].zoom;void 0===ec[ef]&&(ec[ef]={zoom:ef,type:en.type,property:en.property,default:en.default,stops:[]},ed.push(ef)),ec[ef].stops.push([ep[0].value,ep[1]])}let ep=[];for(let en of ed)ep.push([ec[en].zoom,Yn(ec[en],es)]);let ef={name:"linear"};return{kind:"composite",interpolationType:ef,interpolationFactor:pr.interpolationFactor.bind(void 0,ef),zoomStops:ep.map(en=>en[0]),evaluate:({zoom:ec},ed)=>Wn({stops:ep,base:en.base},es,ec).evaluate(ec,ed)}}if(em){let ec="exponential"===e_?{name:"exponential",base:void 0!==en.base?en.base:1}:null;return{kind:"camera",interpolationType:ec,interpolationFactor:pr.interpolationFactor.bind(void 0,ec),zoomStops:en.stops.map(en=>en[0]),evaluate:({zoom:ec})=>ey(en,es,ec,ed,ep)}}return{kind:"source",evaluate(ec,ef){let em=ef&&ef.properties?ef.properties[en.property]:void 0;return void 0===em?Hn(en.default,es.default):ey(en,es,em,ed,ep)}}}(this._parameters,this._specification))}static deserialize(en){return new ai(en._parameters,en._specification)}static serialize(en){return{_parameters:en._parameters,_specification:en._specification}}};function li(en,es=new Set){return en instanceof Pn&&es.add(en.key),en.eachChild(en=>{li(en,es)}),es}function ui(en,es){let{zoom:ec,heatmapDensity:ed,elevation:ep,lineProgress:ef,isSupportedScript:em,accumulated:e_}=null!=en?en:{};return{zoom:ec,heatmapDensity:ed,elevation:ep,lineProgress:ef,isSupportedScript:em,accumulated:e_,globalState:es}}function ci(en){if(!0===en||!1===en)return!0;if(!Array.isArray(en)||0===en.length)return!1;switch(en[0]){case"has":return en.length>=2&&"$id"!==en[1]&&"$type"!==en[1];case"in":return en.length>=3&&("string"!=typeof en[1]||Array.isArray(en[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==en.length||Array.isArray(en[1])||Array.isArray(en[2]);case"any":case"all":for(let es of en.slice(1))if(!ci(es)&&"boolean"!=typeof es)return!1;return!0;default:return!0}}let tU={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pi(en,es){if(null==en)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ci(en)||(en=function yi(en){if(!en)return!0;let es=en[0];return en.length<=1?"any"!==es:"=="===es?mi(en[1],en[2],"=="):"!="===es?vi(mi(en[1],en[2],"==")):"<"===es||">"===es||"<="===es||">="===es?mi(en[1],en[2],es):"any"===es?["any"].concat(en.slice(1).map(yi)):"all"===es?["all"].concat(en.slice(1).map(yi)):"none"===es?["all"].concat(en.slice(1).map(yi).map(vi)):"in"===es?gi(en[1],en.slice(2)):"!in"===es?vi(gi(en[1],en.slice(2))):"has"===es?xi(en[1]):"!has"!==es||vi(xi(en[1]))}(en));let ec=ri(en,tU,es);if("error"===ec.result)throw Error(ec.value.map(en=>`${en.key}: ${en.message}`).join(", "));return{filter:(en,es,ed)=>ec.value.evaluate(en,es,{},ed),needGeometry:function di(en){if(!Array.isArray(en))return!1;if("within"===en[0]||"distance"===en[0])return!0;for(let es=1;es<en.length;es++)if(di(en[es]))return!0;return!1}(en),getGlobalStateRefs:()=>li(ec.value.expression)}}function fi(en,es){return en<es?-1:en>es?1:0}function mi(en,es,ec){switch(en){case"$type":return[`filter-type-${ec}`,es];case"$id":return[`filter-id-${ec}`,es];default:return[`filter-${ec}`,en,es]}}function gi(en,es){if(0===es.length)return!1;switch(en){case"$type":return["filter-type-in",["literal",es]];case"$id":return["filter-id-in",["literal",es]];default:return es.length>200&&!es.some(en=>typeof en!=typeof es[0])?["filter-in-large",en,["literal",es.sort(fi)]]:["filter-in-small",en,["literal",es]]}}function xi(en){switch(en){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",en]}}function vi(en){return["!",en]}function _i(en){let es=en.value;return es?[new Ct(en.key,es,"constants have been deprecated as of v8")]:[]}function Si(en){return en instanceof Number||en instanceof String||en instanceof Boolean?en.valueOf():en}function Ai(en){if(Array.isArray(en))return en.map(Ai);if(en instanceof Object&&!(en instanceof Number||en instanceof String||en instanceof Boolean)){let es={};for(let ec in en)es[ec]=Ai(en[ec]);return es}return Si(en)}function ki(en){let es=en.key,ec=en.value,ed=en.valueSpec||{},ep=en.objectElementValidators||{},ef=en.style,em=en.styleSpec,e_=en.validateSpec,eg=[],ey=Gn(ec);if("object"!==ey)return[new Ct(es,ec,`object expected, ${ey} found`)];for(let en in ec){let ey;let ex=en.split(".")[0],ev=xe(ed,ex)||ed["*"];if(xe(ep,ex))ey=ep[ex];else if(xe(ed,ex))ey=e_;else if(ep["*"])ey=ep["*"];else{if(!ed["*"]){eg.push(new Ct(es,ec[en],`unknown property "${en}"`));continue}ey=e_}eg=eg.concat(ey({key:(es?`${es}.`:es)+en,value:ec[en],valueSpec:ev,style:ef,styleSpec:em,object:ec,objectKey:en,validateSpec:e_},ec))}for(let en in ed)ep[en]||ed[en].required&&void 0===ed[en].default&&void 0===ec[en]&&eg.push(new Ct(es,ec,`missing required property "${en}"`));return eg}function Mi(en){let es=en.value,ec=en.valueSpec,ed=en.style,ep=en.styleSpec,ef=en.key,em=en.arrayElementValidator||en.validateSpec;if("array"!==Gn(es))return[new Ct(ef,es,`array expected, ${Gn(es)} found`)];if(ec.length&&es.length!==ec.length)return[new Ct(ef,es,`array length ${ec.length} expected, length ${es.length} found`)];if(ec["min-length"]&&es.length<ec["min-length"])return[new Ct(ef,es,`array length at least ${ec["min-length"]} expected, length ${es.length} found`)];let e_={type:ec.value,values:ec.values};ep.$version<7&&(e_.function=ec.function),"object"===Gn(ec.value)&&(e_=ec.value);let eg=[];for(let ec=0;ec<es.length;ec++)eg=eg.concat(em({array:es,arrayIndex:ec,value:es[ec],valueSpec:e_,validateSpec:en.validateSpec,style:ed,styleSpec:ep,key:`${ef}[${ec}]`}));return eg}function Ii(en){let es=en.key,ec=en.value,ed=en.valueSpec,ep=Gn(ec);return"number"===ep&&ec!=ec&&(ep="NaN"),"number"!==ep?[new Ct(es,ec,`number expected, ${ep} found`)]:"minimum"in ed&&ec<ed.minimum?[new Ct(es,ec,`${ec} is less than the minimum value ${ed.minimum}`)]:"maximum"in ed&&ec>ed.maximum?[new Ct(es,ec,`${ec} is greater than the maximum value ${ed.maximum}`)]:[]}function zi(en){let es=en.valueSpec,ec=Si(en.value.type),ed,ep,ef,em={},e_="categorical"!==ec&&void 0===en.value.property,eg="array"===Gn(en.value.stops)&&"array"===Gn(en.value.stops[0])&&"object"===Gn(en.value.stops[0][0]),ey=ki({key:en.key,value:en.value,valueSpec:en.styleSpec.function,validateSpec:en.validateSpec,style:en.style,styleSpec:en.styleSpec,objectElementValidators:{stops:function(en){if("identity"===ec)return[new Ct(en.key,en.value,'identity function may not have a "stops" property')];let es=[],ed=en.value;return es=es.concat(Mi({key:en.key,value:ed,valueSpec:en.valueSpec,validateSpec:en.validateSpec,style:en.style,styleSpec:en.styleSpec,arrayElementValidator:h})),"array"===Gn(ed)&&0===ed.length&&es.push(new Ct(en.key,ed,"array must have at least one stop")),es},default:function(en){return en.validateSpec({key:en.key,value:en.value,valueSpec:es,validateSpec:en.validateSpec,style:en.style,styleSpec:en.styleSpec})}}});return"identity"===ec&&e_&&ey.push(new Ct(en.key,en.value,'missing required property "property"')),"identity"===ec||en.value.stops||ey.push(new Ct(en.key,en.value,'missing required property "stops"')),"exponential"===ec&&en.valueSpec.expression&&!qn(en.valueSpec)&&ey.push(new Ct(en.key,en.value,"exponential functions not supported")),en.styleSpec.$version>=8&&(e_||jn(en.valueSpec)?e_&&!Nn(en.valueSpec)&&ey.push(new Ct(en.key,en.value,"zoom functions not supported")):ey.push(new Ct(en.key,en.value,"property functions not supported"))),("categorical"===ec||eg)&&void 0===en.value.property&&ey.push(new Ct(en.key,en.value,'"property" property is required')),ey;function h(en){let ec=[],ed=en.value,e_=en.key;if("array"!==Gn(ed))return[new Ct(e_,ed,`array expected, ${Gn(ed)} found`)];if(2!==ed.length)return[new Ct(e_,ed,`array length 2 expected, length ${ed.length} found`)];if(eg){if("object"!==Gn(ed[0]))return[new Ct(e_,ed,`object expected, ${Gn(ed[0])} found`)];if(void 0===ed[0].zoom)return[new Ct(e_,ed,"object stop key must have zoom")];if(void 0===ed[0].value)return[new Ct(e_,ed,"object stop key must have value")];if(ef&&ef>Si(ed[0].zoom))return[new Ct(e_,ed[0].zoom,"stop zoom values must appear in ascending order")];Si(ed[0].zoom)!==ef&&(ef=Si(ed[0].zoom),ep=void 0,em={}),ec=ec.concat(ki({key:`${e_}[0]`,value:ed[0],valueSpec:{zoom:{}},validateSpec:en.validateSpec,style:en.style,styleSpec:en.styleSpec,objectElementValidators:{zoom:Ii,value:p}}))}else ec=ec.concat(p({key:`${e_}[0]`,value:ed[0],validateSpec:en.validateSpec,style:en.style,styleSpec:en.styleSpec},ed));return ei(Ai(ed[1]))?ec.concat([new Ct(`${e_}[1]`,ed[1],"expressions are not allowed in function stops.")]):ec.concat(en.validateSpec({key:`${e_}[1]`,value:ed[1],valueSpec:es,validateSpec:en.validateSpec,style:en.style,styleSpec:en.styleSpec}))}function p(en,ef){let e_=Gn(en.value),eg=Si(en.value),ey=null!==en.value?en.value:ef;if(ed){if(e_!==ed)return[new Ct(en.key,ey,`${e_} stop domain type must match previous stop domain type ${ed}`)]}else ed=e_;if("number"!==e_&&"string"!==e_&&"boolean"!==e_)return[new Ct(en.key,ey,"stop domain value must be a number, string, or boolean")];if("number"!==e_&&"categorical"!==ec){let ed=`number expected, ${e_} found`;return jn(es)&&void 0===ec&&(ed+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ct(en.key,ey,ed)]}return"categorical"!==ec||"number"!==e_||isFinite(eg)&&Math.floor(eg)===eg?"categorical"!==ec&&"number"===e_&&void 0!==ep&&eg<ep?[new Ct(en.key,ey,"stop domain values must appear in ascending order")]:(ep=eg,"categorical"===ec&&eg in em?[new Ct(en.key,ey,"stop domain values must be unique")]:(em[eg]=!0,[])):[new Ct(en.key,ey,`integer expected, found ${eg}`)]}}function Pi(en){let es=("property"===en.expressionContext?si:ri)(Ai(en.value),en.valueSpec);if("error"===es.result)return es.value.map(es=>new Ct(`${en.key}${es.key}`,en.value,es.message));let ec=es.value.expression||es.value._styleExpression.expression;if("property"===en.expressionContext&&"text-font"===en.propertyKey&&!ec.outputDefined())return[new Ct(en.key,en.value,`Invalid data expression for "${en.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===en.expressionContext&&"layout"===en.propertyType&&!Ln(ec))return[new Ct(en.key,en.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===en.expressionContext&&!Ln(ec))return[new Ct(en.key,en.value,'"feature-state" data expressions are not supported with filters.')];if(en.expressionContext&&0===en.expressionContext.indexOf("cluster")){if(!On(ec,["zoom","feature-state"]))return[new Ct(en.key,en.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===en.expressionContext&&!$n(ec))return[new Ct(en.key,en.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ci(en){let es=en.key,ec=en.value,ed=Gn(ec);return"string"!==ed?[new Ct(es,ec,`color expected, ${ed} found`)]:Me.parse(String(ec))?[]:[new Ct(es,ec,`color expected, "${ec}" found`)]}function Ei(en){let es=en.key,ec=en.value,ed=en.valueSpec,ep=[];return Array.isArray(ed.values)?-1===ed.values.indexOf(Si(ec))&&ep.push(new Ct(es,ec,`expected one of [${ed.values.join(", ")}], ${JSON.stringify(ec)} found`)):-1===Object.keys(ed.values).indexOf(Si(ec))&&ep.push(new Ct(es,ec,`expected one of [${Object.keys(ed.values).join(", ")}], ${JSON.stringify(ec)} found`)),ep}function Ti(en){return ci(Ai(en.value))?Pi(Et({},en,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function Bi(en){let es=en.value,ec=en.key;if("array"!==Gn(es))return[new Ct(ec,es,`array expected, ${Gn(es)} found`)];let ed=en.styleSpec,ep,ef=[];if(es.length<1)return[new Ct(ec,es,"filter array must have at least 1 element")];switch(ef=ef.concat(Ei({key:`${ec}[0]`,value:es[0],valueSpec:ed.filter_operator,style:en.style,styleSpec:en.styleSpec})),Si(es[0])){case"<":case"<=":case">":case">=":es.length>=2&&"$type"===Si(es[1])&&ef.push(new Ct(ec,es,`"$type" cannot be use with operator "${es[0]}"`));case"==":case"!=":3!==es.length&&ef.push(new Ct(ec,es,`filter array for operator "${es[0]}" must have 3 elements`));case"in":case"!in":es.length>=2&&"string"!==(ep=Gn(es[1]))&&ef.push(new Ct(`${ec}[1]`,es[1],`string expected, ${ep} found`));for(let em=2;em<es.length;em++)ep=Gn(es[em]),"$type"===Si(es[1])?ef=ef.concat(Ei({key:`${ec}[${em}]`,value:es[em],valueSpec:ed.geometry_type,style:en.style,styleSpec:en.styleSpec})):"string"!==ep&&"number"!==ep&&"boolean"!==ep&&ef.push(new Ct(`${ec}[${em}]`,es[em],`string, number, or boolean expected, ${ep} found`));break;case"any":case"all":case"none":for(let ed=1;ed<es.length;ed++)ef=ef.concat(Bi({key:`${ec}[${ed}]`,value:es[ed],style:en.style,styleSpec:en.styleSpec}));break;case"has":case"!has":ep=Gn(es[1]),2!==es.length?ef.push(new Ct(ec,es,`filter array for "${es[0]}" operator must have 2 elements`)):"string"!==ep&&ef.push(new Ct(`${ec}[1]`,es[1],`string expected, ${ep} found`))}return ef}(en)}function Vi(en,es){let ec;let ed=en.key,ep=en.validateSpec,ef=en.style,em=en.styleSpec,e_=en.value,eg=en.objectKey,ey=em[`${es}_${en.layerType}`];if(!ey)return[];let ex=eg.match(/^(.*)-transition$/);if("paint"===es&&ex&&ey[ex[1]]&&ey[ex[1]].transition)return ep({key:ed,value:e_,valueSpec:em.transition,style:ef,styleSpec:em});let ev=en.valueSpec||ey[eg];if(!ev)return[new Ct(ed,e_,`unknown property "${eg}"`)];if("string"===Gn(e_)&&jn(ev)&&!ev.tokens&&(ec=/^{([^}]+)}$/.exec(e_)))return[new Ct(ed,e_,`"${eg}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ec[1])} }\`.`)];let eb=[];return"symbol"===en.layerType&&("text-field"===eg&&ef&&!ef.glyphs&&eb.push(new Ct(ed,e_,'use of "text-field" requires a style "glyphs" property')),"text-font"===eg&&Xn(Ai(e_))&&"identity"===Si(e_.type)&&eb.push(new Ct(ed,e_,'"text-font" does not support identity functions'))),eb.concat(ep({key:en.key,value:e_,valueSpec:ev,style:ef,styleSpec:em,expressionContext:"property",propertyType:es,propertyKey:eg}))}function Fi(en){return Vi(en,"paint")}function Di(en){return Vi(en,"layout")}function $i(en){let es=[],ec=en.value,ed=en.key,ep=en.style,ef=en.styleSpec;if("object"!==Gn(ec))return[new Ct(ed,ec,`object expected, ${Gn(ec)} found`)];ec.type||ec.ref||es.push(new Ct(ed,ec,'either "type" or "ref" is required'));let em=Si(ec.type),e_=Si(ec.ref);if(ec.id){let ef=Si(ec.id);for(let em=0;em<en.arrayIndex;em++){let en=ep.layers[em];Si(en.id)===ef&&es.push(new Ct(ed,ec.id,`duplicate layer id "${ec.id}", previously used at line ${en.id.__line__}`))}}if("ref"in ec){let en;["type","source","source-layer","filter","layout"].forEach(en=>{en in ec&&es.push(new Ct(ed,ec[en],`"${en}" is prohibited for ref layers`))}),ep.layers.forEach(es=>{Si(es.id)===e_&&(en=es)}),en?en.ref?es.push(new Ct(ed,ec.ref,"ref cannot reference another ref layer")):em=Si(en.type):es.push(new Ct(ed,ec.ref,`ref layer "${e_}" not found`))}else if("background"!==em){if(ec.source){let en=ep.sources&&ep.sources[ec.source],ef=en&&Si(en.type);en?"vector"===ef&&"raster"===em?es.push(new Ct(ed,ec.source,`layer "${ec.id}" requires a raster source`)):"raster-dem"!==ef&&"hillshade"===em||"raster-dem"!==ef&&"color-relief"===em?es.push(new Ct(ed,ec.source,`layer "${ec.id}" requires a raster-dem source`)):"raster"===ef&&"raster"!==em?es.push(new Ct(ed,ec.source,`layer "${ec.id}" requires a vector source`)):"vector"!==ef||ec["source-layer"]?"raster-dem"===ef&&"hillshade"!==em&&"color-relief"!==em?es.push(new Ct(ed,ec.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"===em&&ec.paint&&ec.paint["line-gradient"]&&("geojson"!==ef||!en.lineMetrics)&&es.push(new Ct(ed,ec,`layer "${ec.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):es.push(new Ct(ed,ec,`layer "${ec.id}" must specify a "source-layer"`)):es.push(new Ct(ed,ec.source,`source "${ec.source}" not found`))}else es.push(new Ct(ed,ec,'missing required property "source"'))}return es=es.concat(ki({key:ed,value:ec,valueSpec:ef.layer,style:en.style,styleSpec:en.styleSpec,validateSpec:en.validateSpec,objectElementValidators:{"*":()=>[],type:()=>en.validateSpec({key:`${ed}.type`,value:ec.type,valueSpec:ef.layer.type,style:en.style,styleSpec:en.styleSpec,validateSpec:en.validateSpec,object:ec,objectKey:"type"}),filter:Ti,layout:en=>ki({layer:ec,key:en.key,value:en.value,style:en.style,styleSpec:en.styleSpec,validateSpec:en.validateSpec,objectElementValidators:{"*":en=>Di(Et({layerType:em},en))}}),paint:en=>ki({layer:ec,key:en.key,value:en.value,style:en.style,styleSpec:en.styleSpec,validateSpec:en.validateSpec,objectElementValidators:{"*":en=>Fi(Et({layerType:em},en))}})}}))}function Li(en){let es=en.value,ec=en.key,ed=Gn(es);return"string"!==ed?[new Ct(ec,es,`string expected, ${ed} found`)]:[]}let tN={promoteId:function({key:en,value:es}){if("string"===Gn(es))return Li({key:en,value:es});{let ec=[];for(let ed in es)ec.push(...Li({key:`${en}.${ed}`,value:es[ed]}));return ec}}};function Ri(en){let es;let ec=en.value,ed=en.key,ep=en.styleSpec,ef=en.style,em=en.validateSpec;if(!ec.type)return[new Ct(ed,ec,'"type" is required')];let e_=Si(ec.type);switch(e_){case"vector":case"raster":return ki({key:ed,value:ec,valueSpec:ep[`source_${e_.replace("-","_")}`],style:en.style,styleSpec:ep,objectElementValidators:tN,validateSpec:em});case"raster-dem":return function(en){var es;let ec=null!==(es=en.sourceName)&&void 0!==es?es:"",ed=en.value,ep=en.styleSpec,ef=ep.source_raster_dem,em=en.style,e_=[],eg=Gn(ed);if(void 0===ed)return e_;if("object"!==eg)return e_.push(new Ct("source_raster_dem",ed,`object expected, ${eg} found`)),e_;let ey="custom"===Si(ed.encoding),ex=["redFactor","greenFactor","blueFactor","baseShift"],ev=en.value.encoding?`"${en.value.encoding}"`:"Default";for(let es in ed)!ey&&ex.includes(es)?e_.push(new Ct(es,ed[es],`In "${ec}": "${es}" is only valid when "encoding" is set to "custom". ${ev} encoding found`)):ef[es]?e_=e_.concat(en.validateSpec({key:es,value:ed[es],valueSpec:ef[es],validateSpec:en.validateSpec,style:em,styleSpec:ep})):e_.push(new Ct(es,ed[es],`unknown property "${es}"`));return e_}({sourceName:ed,value:ec,style:en.style,styleSpec:ep,validateSpec:em});case"geojson":if(es=ki({key:ed,value:ec,valueSpec:ep.source_geojson,style:ef,styleSpec:ep,validateSpec:em,objectElementValidators:tN}),ec.cluster)for(let en in ec.clusterProperties){let[ep,ef]=ec.clusterProperties[en],em="string"==typeof ep?[ep,["accumulated"],["get",en]]:ep;es.push(...Pi({key:`${ed}.${en}.map`,value:ef,expressionContext:"cluster-map"})),es.push(...Pi({key:`${ed}.${en}.reduce`,value:em,expressionContext:"cluster-reduce"}))}return es;case"video":return ki({key:ed,value:ec,valueSpec:ep.source_video,style:ef,validateSpec:em,styleSpec:ep});case"image":return ki({key:ed,value:ec,valueSpec:ep.source_image,style:ef,validateSpec:em,styleSpec:ep});case"canvas":return[new Ct(ed,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ei({key:`${ed}.type`,value:ec.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ui(en){let es=en.value,ec=en.styleSpec,ed=ec.light,ep=en.style,ef=[],em=Gn(es);if(void 0===es)return ef;if("object"!==em)return ef.concat([new Ct("light",es,`object expected, ${em} found`)]);for(let em in es){let e_=em.match(/^(.*)-transition$/);ef=ef.concat(e_&&ed[e_[1]]&&ed[e_[1]].transition?en.validateSpec({key:em,value:es[em],valueSpec:ec.transition,validateSpec:en.validateSpec,style:ep,styleSpec:ec}):ed[em]?en.validateSpec({key:em,value:es[em],valueSpec:ed[em],validateSpec:en.validateSpec,style:ep,styleSpec:ec}):[new Ct(em,es[em],`unknown property "${em}"`)])}return ef}function ji(en){let es=en.value,ec=en.styleSpec,ed=ec.sky,ep=en.style,ef=Gn(es);if(void 0===es)return[];if("object"!==ef)return[new Ct("sky",es,`object expected, ${ef} found`)];let em=[];for(let ef in es)em=em.concat(ed[ef]?en.validateSpec({key:ef,value:es[ef],valueSpec:ed[ef],style:ep,styleSpec:ec}):[new Ct(ef,es[ef],`unknown property "${ef}"`)]);return em}function Ni(en){let es=en.value,ec=en.styleSpec,ed=ec.terrain,ep=en.style,ef=[],em=Gn(es);if(void 0===es)return ef;if("object"!==em)return ef.concat([new Ct("terrain",es,`object expected, ${em} found`)]);for(let em in es)ef=ef.concat(ed[em]?en.validateSpec({key:em,value:es[em],valueSpec:ed[em],validateSpec:en.validateSpec,style:ep,styleSpec:ec}):[new Ct(em,es[em],`unknown property "${em}"`)]);return ef}function qi(en){let es=[],ec=en.value,ed=en.key;if(Array.isArray(ec)){let ep=[],ef=[];for(let em in ec)ec[em].id&&ep.includes(ec[em].id)&&es.push(new Ct(ed,ec,`all the sprites' ids must be unique, but ${ec[em].id} is duplicated`)),ep.push(ec[em].id),ec[em].url&&ef.includes(ec[em].url)&&es.push(new Ct(ed,ec,`all the sprites' URLs must be unique, but ${ec[em].url} is duplicated`)),ef.push(ec[em].url),es=es.concat(ki({key:`${ed}[${em}]`,value:ec[em],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:en.validateSpec}));return es}return Li({key:ed,value:ec})}function Gi(en){var es;return(es=en.value)&&es.constructor===Object?[]:[new Ct(en.key,en.value,`object expected, ${Gn(en.value)} found`)]}let tZ={"*":()=>[],array:Mi,boolean:function(en){let es=en.value,ec=en.key,ed=Gn(es);return"boolean"!==ed?[new Ct(ec,es,`boolean expected, ${ed} found`)]:[]},number:Ii,color:Ci,constants:_i,enum:Ei,filter:Ti,function:zi,layer:$i,object:ki,source:Ri,light:Ui,sky:ji,terrain:Ni,projection:function(en){let es=en.value,ec=en.styleSpec,ed=ec.projection,ep=en.style,ef=Gn(es);if(void 0===es)return[];if("object"!==ef)return[new Ct("projection",es,`object expected, ${ef} found`)];let em=[];for(let ef in es)em=em.concat(ed[ef]?en.validateSpec({key:ef,value:es[ef],valueSpec:ed[ef],style:ep,styleSpec:ec}):[new Ct(ef,es[ef],`unknown property "${ef}"`)]);return em},projectionDefinition:function(en){var es;let ec=en.key,ed=en.value;ed=ed instanceof String?ed.valueOf():ed;let ep=Gn(ed);return"array"!==ep||Array.isArray(es=ed)&&3===es.length&&"string"==typeof es[0]&&"string"==typeof es[1]&&"number"==typeof es[2]||["interpolate","step","literal"].includes(ed[0])?["array","string"].includes(ep)?[]:[new Ct(ec,ed,`projection expected, invalid type "${ep}" found`)]:[new Ct(ec,ed,`projection expected, invalid array ${JSON.stringify(ed)} found`)]},string:Li,formatted:function(en){return 0===Li(en).length?[]:Pi(en)},resolvedImage:function(en){return 0===Li(en).length?[]:Pi(en)},padding:function(en){let es=en.key,ec=en.value;if("array"===Gn(ec)){if(ec.length<1||ec.length>4)return[new Ct(es,ec,`padding requires 1 to 4 values; ${ec.length} values found`)];let ed={type:"number"},ep=[];for(let ef=0;ef<ec.length;ef++)ep=ep.concat(en.validateSpec({key:`${es}[${ef}]`,value:ec[ef],validateSpec:en.validateSpec,valueSpec:ed}));return ep}return Ii({key:es,value:ec,valueSpec:{}})},numberArray:function(en){let es=en.key,ec=en.value;if("array"===Gn(ec)){let ed={type:"number"};if(ec.length<1)return[new Ct(es,ec,"array length at least 1 expected, length 0 found")];let ep=[];for(let ef=0;ef<ec.length;ef++)ep=ep.concat(en.validateSpec({key:`${es}[${ef}]`,value:ec[ef],validateSpec:en.validateSpec,valueSpec:ed}));return ep}return Ii({key:es,value:ec,valueSpec:{}})},colorArray:function(en){let es=en.key,ec=en.value;if("array"===Gn(ec)){if(ec.length<1)return[new Ct(es,ec,"array length at least 1 expected, length 0 found")];let en=[];for(let ed=0;ed<ec.length;ed++)en=en.concat(Ci({key:`${es}[${ed}]`,value:ec[ed]}));return en}return Ci({key:es,value:ec})},variableAnchorOffsetCollection:function(en){let es=en.key,ec=en.value,ed=Gn(ec),ep=en.styleSpec;if("array"!==ed||ec.length<1||ec.length%2!=0)return[new Ct(es,ec,"variableAnchorOffsetCollection requires a non-empty array of even length")];let ef=[];for(let ed=0;ed<ec.length;ed+=2)ef=(ef=ef.concat(Ei({key:`${es}[${ed}]`,value:ec[ed],valueSpec:ep.layout_symbol["text-anchor"]}))).concat(Mi({key:`${es}[${ed+1}]`,value:ec[ed+1],valueSpec:{length:2,value:"number"},validateSpec:en.validateSpec,style:en.style,styleSpec:ep}));return ef},sprite:qi,state:Gi};function Zi(en){let es=en.value,ec=en.valueSpec,ed=en.styleSpec;return en.validateSpec=Zi,ec.expression&&Xn(Si(es))?zi(en):ec.expression&&ei(Ai(es))?Pi(en):ec.type&&tZ[ec.type]?tZ[ec.type](en):ki(Et({},en,{valueSpec:ec.type?ed[ec.type]:ec}))}function Yi(en){let es=en.value,ec=en.key,ed=Li(en);return ed.length||(-1===es.indexOf("{fontstack}")&&ed.push(new Ct(ec,es,'"glyphs" url must include a "{fontstack}" token')),-1===es.indexOf("{range}")&&ed.push(new Ct(ec,es,'"glyphs" url must include a "{range}" token'))),ed}function Hi(en,es=eG){let ec=[];return ec=ec.concat(Zi({key:"",value:en,valueSpec:es.$root,styleSpec:es,style:en,validateSpec:Zi,objectElementValidators:{glyphs:Yi,"*":()=>[]}})),en.constants&&(ec=ec.concat(_i({key:"constants",value:en.constants}))),Ji(ec)}function Ki(en){return function(es){return en(Object.assign({},es,{validateSpec:Zi}))}}function Ji(en){return[].concat(en).sort((en,es)=>en.line-es.line)}function Wi(en){return function(...es){return Ji(en.apply(this,es))}}Hi.source=Wi(Ki(Ri)),Hi.sprite=Wi(Ki(qi)),Hi.glyphs=Wi(Ki(Yi)),Hi.light=Wi(Ki(Ui)),Hi.sky=Wi(Ki(ji)),Hi.terrain=Wi(Ki(Ni)),Hi.state=Wi(Ki(Gi)),Hi.layer=Wi(Ki($i)),Hi.filter=Wi(Ki(Ti)),Hi.paintProperty=Wi(Ki(Fi)),Hi.layoutProperty=Wi(Ki(Di));let tG=Hi.light,t$=Hi.sky,tq=Hi.paintProperty,tW=Hi.layoutProperty;function is(en,es){let ec=!1;if(es&&es.length)for(let ed of es)en.fire(new mt(Error(ed.message))),ec=!0;return ec}let ss=class ss{constructor(en,es,ec){let ed=this.cells=[];if(en instanceof ArrayBuffer){this.arrayBuffer=en;let ep=new Int32Array(this.arrayBuffer);en=ep[0],this.d=(es=ep[1])+2*(ec=ep[2]);for(let en=0;en<this.d*this.d;en++){let es=ep[3+en],ec=ep[3+en+1];ed.push(es===ec?null:ep.subarray(es,ec))}let ef=ep[3+ed.length+1];this.keys=ep.subarray(ep[3+ed.length],ef),this.bboxes=ep.subarray(ef),this.insert=this._insertReadonly}else{this.d=es+2*ec;for(let en=0;en<this.d*this.d;en++)ed.push([]);this.keys=[],this.bboxes=[]}this.n=es,this.extent=en,this.padding=ec,this.scale=es/en,this.uid=0;let ep=ec/es*en;this.min=-ep,this.max=en+ep}insert(en,es,ec,ed,ep){this._forEachCell(es,ec,ed,ep,this._insertCell,this.uid++,void 0,void 0),this.keys.push(en),this.bboxes.push(es),this.bboxes.push(ec),this.bboxes.push(ed),this.bboxes.push(ep)}_insertReadonly(){throw Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(en,es,ec,ed,ep,ef){this.cells[ep].push(ef)}query(en,es,ec,ed,ep){let ef=this.min,em=this.max;if(en<=ef&&es<=ef&&em<=ec&&em<=ed&&!ep)return Array.prototype.slice.call(this.keys);{let ef=[];return this._forEachCell(en,es,ec,ed,this._queryCell,ef,{},ep),ef}}_queryCell(en,es,ec,ed,ep,ef,em,e_){let eg=this.cells[ep];if(null!==eg){let ep=this.keys,ey=this.bboxes;for(let ex=0;ex<eg.length;ex++){let ev=eg[ex];if(void 0===em[ev]){let eg=4*ev;(e_?e_(ey[eg+0],ey[eg+1],ey[eg+2],ey[eg+3]):en<=ey[eg+2]&&es<=ey[eg+3]&&ec>=ey[eg+0]&&ed>=ey[eg+1])?(em[ev]=!0,ef.push(ep[ev])):em[ev]=!1}}}}_forEachCell(en,es,ec,ed,ep,ef,em,e_){let eg=this._convertToCellCoord(en),ey=this._convertToCellCoord(es),ex=this._convertToCellCoord(ec),ev=this._convertToCellCoord(ed);for(let eb=eg;eb<=ex;eb++)for(let eg=ey;eg<=ev;eg++){let ey=this.d*eg+eb;if((!e_||e_(this._convertFromCellCoord(eb),this._convertFromCellCoord(eg),this._convertFromCellCoord(eb+1),this._convertFromCellCoord(eg+1)))&&ep.call(this,en,es,ec,ed,ey,ef,em,e_))return}}_convertFromCellCoord(en){return(en-this.padding)/this.scale}_convertToCellCoord(en){return Math.max(0,Math.min(this.d-1,Math.floor(en*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let en=this.cells,es=3+this.cells.length+1+1,ec=0;for(let en=0;en<this.cells.length;en++)ec+=this.cells[en].length;let ed=new Int32Array(es+ec+this.keys.length+this.bboxes.length);ed[0]=this.extent,ed[1]=this.n,ed[2]=this.padding;let ep=es;for(let es=0;es<en.length;es++){let ec=en[es];ed[3+es]=ep,ed.set(ec,ep),ep+=ec.length}return ed[3+en.length]=ep,ed.set(this.keys,ep),ep+=this.keys.length,ed[3+en.length+1]=ep,ed.set(this.bboxes,ep),ep+=this.bboxes.length,ed.buffer}static serialize(en,es){let ec=en.toArrayBuffer();return es&&es.push(ec),{buffer:ec}}static deserialize(en){return new ss(en.buffer)}};let tH={};function os(en,es,ec={}){if(tH[en])throw Error(`${en} is already registered.`);Object.defineProperty(es,"_classRegistryKey",{value:en,writeable:!1}),tH[en]={klass:es,omit:ec.omit||[],shallow:ec.shallow||[]}}for(let en in os("Object",Object),os("Set",Set),os("TransferableGridIndex",ss),os("Color",Me),os("Error",Error),os("AJAXError",ut),os("ResolvedImage",$e),os("StylePropertyFunction",ai),os("StyleExpression",ti,{omit:["_evaluator"]}),os("ZoomDependentExpression",ii),os("ZoomConstantExpression",ni),os("CompoundExpression",En,{omit:["_evaluate"]}),tV)tV[en]._classRegistryKey||os(`Expression_${en}`,tV[en]);function ls(en){return en&&"undefined"!=typeof ArrayBuffer&&(en instanceof ArrayBuffer||en.constructor&&"ArrayBuffer"===en.constructor.name)}function us(en){return en.$name||en.constructor._classRegistryKey}function cs(en){return!function(en){if(null===en||"object"!=typeof en)return!1;let es=us(en);return!(!es||"Object"===es)}(en)&&(null==en||"boolean"==typeof en||"number"==typeof en||"string"==typeof en||en instanceof Boolean||en instanceof Number||en instanceof String||en instanceof Date||en instanceof RegExp||en instanceof Blob||en instanceof Error||ls(en)||Y(en)||ArrayBuffer.isView(en)||en instanceof ImageData)}function hs(en,es){if(cs(en))return(ls(en)||Y(en))&&es&&es.push(en),ArrayBuffer.isView(en)&&es&&es.push(en.buffer),en instanceof ImageData&&es&&es.push(en.data.buffer),en;if(Array.isArray(en)){let ec=[];for(let ed of en)ec.push(hs(ed,es));return ec}if("object"!=typeof en)throw Error("can't serialize object of type "+typeof en);let ec=us(en);if(!ec)throw Error(`can't serialize object of unregistered class ${en.constructor.name}`);if(!tH[ec])throw Error(`${ec} is not registered.`);let{klass:ed}=tH[ec],ep=ed.serialize?ed.serialize(en,es):{};if(ed.serialize){if(es&&ep===es[es.length-1])throw Error("statically serialized object won't survive transfer of $name property")}else{for(let ed in en){if(!en.hasOwnProperty(ed)||tH[ec].omit.indexOf(ed)>=0)continue;let ef=en[ed];ep[ed]=tH[ec].shallow.indexOf(ed)>=0?ef:hs(ef,es)}en instanceof Error&&(ep.message=en.message)}if(ep.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==ec&&(ep.$name=ec),ep}function ps(en){if(cs(en))return en;if(Array.isArray(en))return en.map(ps);if("object"!=typeof en)throw Error("can't deserialize object of type "+typeof en);let es=us(en)||"Object";if(!tH[es])throw Error(`can't deserialize unregistered class ${es}`);let{klass:ec}=tH[es];if(!ec)throw Error(`can't deserialize unregistered class ${es}`);if(ec.deserialize)return ec.deserialize(en);let ed=Object.create(ec.prototype);for(let ec of Object.keys(en)){if("$name"===ec)continue;let ep=en[ec];ed[ec]=tH[es].shallow.indexOf(ec)>=0?ep:ps(ep)}return ed}let fs=class fs{constructor(){this.first=!0}update(en,es){let ec=Math.floor(en);return this.first?(this.first=!1,this.lastIntegerZoom=ec,this.lastIntegerZoomTime=0,this.lastZoom=en,this.lastFloorZoom=ec,!0):(this.lastFloorZoom>ec?(this.lastIntegerZoom=ec+1,this.lastIntegerZoomTime=es):this.lastFloorZoom<ec&&(this.lastIntegerZoom=ec,this.lastIntegerZoomTime=es),en!==this.lastZoom&&(this.lastZoom=en,this.lastFloorZoom=ec,!0))}};let tX={"Latin-1 Supplement":en=>en>=128&&en<=255,"Hangul Jamo":en=>en>=4352&&en<=4607,Khmer:en=>en>=6016&&en<=6143,"General Punctuation":en=>en>=8192&&en<=8303,"Letterlike Symbols":en=>en>=8448&&en<=8527,"Number Forms":en=>en>=8528&&en<=8591,"Miscellaneous Technical":en=>en>=8960&&en<=9215,"Control Pictures":en=>en>=9216&&en<=9279,"Optical Character Recognition":en=>en>=9280&&en<=9311,"Enclosed Alphanumerics":en=>en>=9312&&en<=9471,"Geometric Shapes":en=>en>=9632&&en<=9727,"Miscellaneous Symbols":en=>en>=9728&&en<=9983,"Miscellaneous Symbols and Arrows":en=>en>=11008&&en<=11263,"Ideographic Description Characters":en=>en>=12272&&en<=12287,"CJK Symbols and Punctuation":en=>en>=12288&&en<=12351,Hiragana:en=>en>=12352&&en<=12447,Katakana:en=>en>=12448&&en<=12543,Kanbun:en=>en>=12688&&en<=12703,"CJK Strokes":en=>en>=12736&&en<=12783,"Enclosed CJK Letters and Months":en=>en>=12800&&en<=13055,"CJK Compatibility":en=>en>=13056&&en<=13311,"Yijing Hexagram Symbols":en=>en>=19904&&en<=19967,"CJK Unified Ideographs":en=>en>=19968&&en<=40959,"Hangul Syllables":en=>en>=44032&&en<=55215,"Private Use Area":en=>en>=57344&&en<=63743,"Vertical Forms":en=>en>=65040&&en<=65055,"CJK Compatibility Forms":en=>en>=65072&&en<=65103,"Small Form Variants":en=>en>=65104&&en<=65135,"Halfwidth and Fullwidth Forms":en=>en>=65280&&en<=65519};function ys(en){for(let es of en)if(ws(es.charCodeAt(0)))return!0;return!1}function gs(en){let es=en.map(en=>{try{return RegExp(`\\p{sc=${en}}`,"u").source}catch(en){return null}}).filter(en=>en);return RegExp(es.join("|"),"u")}let tK=gs(["Arab","Dupl","Mong","Ougr","Syrc"]),tY=gs(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ws(en){return!(746!==en&&747!==en&&(en<4352||!(tX["CJK Compatibility Forms"](en)&&!(en>=65097&&en<=65103)||tX["CJK Compatibility"](en)||tX["CJK Strokes"](en)||!(!tX["CJK Symbols and Punctuation"](en)||en>=12296&&en<=12305||en>=12308&&en<=12319||12336===en)||tX["Enclosed CJK Letters and Months"](en)||tX["Ideographic Description Characters"](en)||tX.Kanbun(en)||tX.Katakana(en)&&12540!==en||!(!tX["Halfwidth and Fullwidth Forms"](en)||65288===en||65289===en||65293===en||en>=65306&&en<=65310||65339===en||65341===en||65343===en||en>=65371&&en<=65503||65507===en||en>=65512&&en<=65519)||!(!tX["Small Form Variants"](en)||en>=65112&&en<=65118||en>=65123&&en<=65126)||tX["Vertical Forms"](en)||tX["Yijing Hexagram Symbols"](en)||/\p{sc=Cans}/u.test(String.fromCodePoint(en))||/\p{sc=Hang}/u.test(String.fromCodePoint(en))||tY.test(String.fromCodePoint(en)))))}function _s(en){return!(ws(en)||tX["Latin-1 Supplement"](en)&&(167===en||169===en||174===en||177===en||188===en||189===en||190===en||215===en||247===en)||tX["General Punctuation"](en)&&(8214===en||8224===en||8225===en||8240===en||8241===en||8251===en||8252===en||8258===en||8263===en||8264===en||8265===en||8273===en)||tX["Letterlike Symbols"](en)||tX["Number Forms"](en)||tX["Miscellaneous Technical"](en)&&(en>=8960&&en<=8967||en>=8972&&en<=8991||en>=8996&&en<=9e3||9003===en||en>=9085&&en<=9114||en>=9150&&en<=9165||9167===en||en>=9169&&en<=9179||en>=9186&&en<=9215)||tX["Control Pictures"](en)&&9251!==en||tX["Optical Character Recognition"](en)||tX["Enclosed Alphanumerics"](en)||tX["Geometric Shapes"](en)||tX["Miscellaneous Symbols"](en)&&!(en>=9754&&en<=9759)||tX["Miscellaneous Symbols and Arrows"](en)&&(en>=11026&&en<=11055||en>=11088&&en<=11097||en>=11192&&en<=11243)||tX["CJK Symbols and Punctuation"](en)||tX.Katakana(en)||tX["Private Use Area"](en)||tX["CJK Compatibility Forms"](en)||tX["Small Form Variants"](en)||tX["Halfwidth and Fullwidth Forms"](en)||8734===en||8756===en||8757===en||en>=9984&&en<=10087||en>=10102&&en<=10131||65532===en||65533===en)}let tJ=gs(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function As(en){return tJ.test(String.fromCodePoint(en))}let tQ=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(en){this.pluginStatus=en.pluginStatus,this.pluginURL=en.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(en){if(tQ.isParsed())throw Error("RTL text plugin already registered.");this.applyArabicShaping=en.applyArabicShaping,this.processBidirectionalText=en.processBidirectionalText,this.processStyledBidirectionalText=en.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(en,es){return e(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==en.pluginStatus)return this.setState(en),en;let ec=en.pluginURL,ed=new Promise(en=>{this.loadScriptResolve=en});es(ec);let ep=new Promise(en=>setTimeout(()=>en(),this.TIMEOUT));if(yield Promise.race([ed,ep]),this.isParsed()){let en={pluginStatus:"loaded",pluginURL:ec};return this.setState(en),en}throw this.setState({pluginStatus:"error",pluginURL:""}),Error(`RTL Text Plugin failed to import scripts from ${ec}`)})}};let zs=class zs{constructor(en,es){this.isSupportedScript=Ps,this.zoom=en,es?(this.now=es.now||0,this.fadeDuration=es.fadeDuration||0,this.zoomHistory=es.zoomHistory||new fs,this.transition=es.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fs,this.transition={})}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let en=this.zoom,es=en-Math.floor(en),ec=this.crossFadingFactor();return en>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:es+(1-es)*ec}:{fromScale:.5,toScale:1,t:1-(1-ec)*es}}};function Ps(en){return function(en,es){for(let ed of en){var ec;if(ec=ed.charCodeAt(0),!es&&As(ec)||ec>=2304&&ec<=3583||ec>=3840&&ec<=4255||tX.Khmer(ec))return!1}return!0}(en,"loaded"===tQ.getRTLTextPluginStatus())}let Cs=class Cs{constructor(en,es,ec){this.property=en,this.value=es,this.expression=function(en,es,ec){if(Xn(en))return new ai(en,es);if(ei(en)){let ed=si(en,es,ec);if("error"===ed.result)throw Error(ed.value.map(en=>`${en.key}: ${en.message}`).join(", "));return ed.value}{let ec=en;return"color"===es.type&&"string"==typeof en?ec=Me.parse(en):"padding"===es.type&&("number"==typeof en||Array.isArray(en))?ec=Ee.parse(en):"numberArray"===es.type&&("number"==typeof en||Array.isArray(en))?ec=Te.parse(en):"colorArray"===es.type&&("string"==typeof en||Array.isArray(en))?ec=Be.parse(en):"variableAnchorOffsetCollection"===es.type&&Array.isArray(en)?ec=De.parse(en):"projectionDefinition"===es.type&&"string"==typeof en&&(ec=Le.parse(en)),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>ec}}}(void 0===es?en.specification.default:es,en.specification,ec)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(en,es,ec){return this.property.possiblyEvaluate(this,en,es,ec)}};let Es=class Es{constructor(en,es){this.property=en,this.value=new Cs(en,void 0,es)}transitioned(en,es){return new Bs(this.property,this.value,es,L({},en.transition,this.transition),en.now)}untransitioned(){return new Bs(this.property,this.value,null,{},0)}};let Ts=class Ts{constructor(en,es){this._properties=en,this._values=Object.create(en.defaultTransitionablePropertyValues),this._globalState=es}getValue(en){return j(this._values[en].value.value)}setValue(en,es){Object.prototype.hasOwnProperty.call(this._values,en)||(this._values[en]=new Es(this._values[en].property,this._globalState)),this._values[en].value=new Cs(this._values[en].property,null===es?void 0:j(es),this._globalState)}getTransition(en){return j(this._values[en].transition)}setTransition(en,es){Object.prototype.hasOwnProperty.call(this._values,en)||(this._values[en]=new Es(this._values[en].property,this._globalState)),this._values[en].transition=j(es)||void 0}serialize(){let en={};for(let es of Object.keys(this._values)){let ec=this.getValue(es);void 0!==ec&&(en[es]=ec);let ed=this.getTransition(es);void 0!==ed&&(en[`${es}-transition`]=ed)}return en}transitioned(en,es){let ec=new Vs(this._properties);for(let ed of Object.keys(this._values))ec._values[ed]=this._values[ed].transitioned(en,es._values[ed]);return ec}untransitioned(){let en=new Vs(this._properties);for(let es of Object.keys(this._values))en._values[es]=this._values[es].untransitioned();return en}};let Bs=class Bs{constructor(en,es,ec,ed,ep){this.property=en,this.value=es,this.begin=ep+ed.delay||0,this.end=this.begin+ed.duration||0,en.specification.transition&&(ed.delay||ed.duration)&&(this.prior=ec)}possiblyEvaluate(en,es,ec){let ed=en.now||0,ep=this.value.possiblyEvaluate(en,es,ec),ef=this.prior;if(ef){if(ed>this.end||this.value.isDataDriven())return this.prior=null,ep;if(ed<this.begin)return ef.possiblyEvaluate(en,es,ec);{let em=(ed-this.begin)/(this.end-this.begin);return this.property.interpolate(ef.possiblyEvaluate(en,es,ec),ep,B(em))}}return ep}};let Vs=class Vs{constructor(en){this._properties=en,this._values=Object.create(en.defaultTransitioningPropertyValues)}possiblyEvaluate(en,es,ec){let ed=new $s(this._properties);for(let ep of Object.keys(this._values))ed._values[ep]=this._values[ep].possiblyEvaluate(en,es,ec);return ed}hasTransition(){for(let en of Object.keys(this._values))if(this._values[en].prior)return!0;return!1}};let Fs=class Fs{constructor(en,es){this._properties=en,this._values=Object.create(en.defaultPropertyValues),this._globalState=es}hasValue(en){return void 0!==this._values[en].value}getValue(en){return j(this._values[en].value)}setValue(en,es){this._values[en]=new Cs(this._values[en].property,null===es?void 0:j(es),this._globalState)}serialize(){let en={};for(let es of Object.keys(this._values)){let ec=this.getValue(es);void 0!==ec&&(en[es]=ec)}return en}possiblyEvaluate(en,es,ec){let ed=new $s(this._properties);for(let ep of Object.keys(this._values))ed._values[ep]=this._values[ep].possiblyEvaluate(en,es,ec);return ed}};let Ds=class Ds{constructor(en,es,ec){this.property=en,this.value=es,this.parameters=ec}isConstant(){return"constant"===this.value.kind}constantOr(en){return"constant"===this.value.kind?this.value.value:en}evaluate(en,es,ec,ed){return this.property.evaluate(this.value,this.parameters,en,es,ec,ed)}};let $s=class $s{constructor(en){this._properties=en,this._values=Object.create(en.defaultPossiblyEvaluatedValues)}get(en){return this._values[en]}};let Ls=class Ls{constructor(en){this.specification=en}possiblyEvaluate(en,es){if(en.isDataDriven())throw Error("Value should not be data driven");return en.expression.evaluate(es)}interpolate(en,es,ec){let ed=tE[this.specification.type];return ed?ed(en,es,ec):en}};let Os=class Os{constructor(en,es){this.specification=en,this.overrides=es}possiblyEvaluate(en,es,ec,ed){return new Ds(this,"constant"===en.expression.kind||"camera"===en.expression.kind?{kind:"constant",value:en.expression.evaluate(es,null,{},ec,ed)}:en.expression,es)}interpolate(en,es,ec){if("constant"!==en.value.kind||"constant"!==es.value.kind)return en;if(void 0===en.value.value||void 0===es.value.value)return new Ds(this,{kind:"constant",value:void 0},en.parameters);let ed=tE[this.specification.type];if(ed){let ep=ed(en.value.value,es.value.value,ec);return new Ds(this,{kind:"constant",value:ep},en.parameters)}return en}evaluate(en,es,ec,ed,ep,ef){return"constant"===en.kind?en.value:en.evaluate(es,ec,ed,ep,ef)}};let Rs=class Rs extends Os{possiblyEvaluate(en,es,ec,ed){if(void 0===en.value)return new Ds(this,{kind:"constant",value:void 0},es);if("constant"===en.expression.kind){let ep=en.expression.evaluate(es,null,{},ec,ed),ef="resolvedImage"===en.property.specification.type&&"string"!=typeof ep?ep.name:ep,em=this._calculate(ef,ef,ef,es);return new Ds(this,{kind:"constant",value:em},es)}if("camera"===en.expression.kind){let ec=this._calculate(en.expression.evaluate({zoom:es.zoom-1}),en.expression.evaluate({zoom:es.zoom}),en.expression.evaluate({zoom:es.zoom+1}),es);return new Ds(this,{kind:"constant",value:ec},es)}return new Ds(this,en.expression,es)}evaluate(en,es,ec,ed,ep,ef){if("source"===en.kind){let em=en.evaluate(es,ec,ed,ep,ef);return this._calculate(em,em,em,es)}return"composite"===en.kind?this._calculate(en.evaluate({zoom:Math.floor(es.zoom)-1},ec,ed),en.evaluate({zoom:Math.floor(es.zoom)},ec,ed),en.evaluate({zoom:Math.floor(es.zoom)+1},ec,ed),es):en.value}_calculate(en,es,ec,ed){return ed.zoom>ed.zoomHistory.lastIntegerZoom?{from:en,to:es}:{from:ec,to:es}}interpolate(en){return en}};let Us=class Us{constructor(en){this.specification=en}possiblyEvaluate(en,es,ec,ed){if(void 0!==en.value){if("constant"===en.expression.kind){let ep=en.expression.evaluate(es,null,{},ec,ed);return this._calculate(ep,ep,ep,es)}return this._calculate(en.expression.evaluate(new zs(Math.floor(es.zoom-1),es)),en.expression.evaluate(new zs(Math.floor(es.zoom),es)),en.expression.evaluate(new zs(Math.floor(es.zoom+1),es)),es)}}_calculate(en,es,ec,ed){return ed.zoom>ed.zoomHistory.lastIntegerZoom?{from:en,to:es}:{from:ec,to:es}}interpolate(en){return en}};let js=class js{constructor(en){this.specification=en}possiblyEvaluate(en,es,ec,ed){return!!en.expression.evaluate(es,null,{},ec,ed)}interpolate(){return!1}};let Ns=class Ns{constructor(en){for(let es in this.properties=en,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],en){let ec=en[es];ec.specification.overridable&&this.overridableProperties.push(es);let ed=this.defaultPropertyValues[es]=new Cs(ec,void 0,void 0),ep=this.defaultTransitionablePropertyValues[es]=new Es(ec,void 0);this.defaultTransitioningPropertyValues[es]=ep.untransitioned(),this.defaultPossiblyEvaluatedValues[es]=ed.possiblyEvaluate({})}}};os("DataDrivenProperty",Os),os("DataConstantProperty",Ls),os("CrossFadedDataDrivenProperty",Rs),os("CrossFadedProperty",Us),os("ColorRampProperty",js);let t0="-transition";let Gs=class Gs extends gt{constructor(en,es,ec){if(super(),this.id=en.id,this.type=en.type,this._globalState=ec,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==en.type&&(this.metadata=en.metadata,this.minzoom=en.minzoom,this.maxzoom=en.maxzoom,"background"!==en.type&&(this.source=en.source,this.sourceLayer=en["source-layer"],this.filter=en.filter,this._featureFilter=pi(en.filter,ec)),es.layout&&(this._unevaluatedLayout=new Fs(es.layout,ec)),es.paint)){for(let ed in this._transitionablePaint=new Ts(es.paint,ec),en.paint)this.setPaintProperty(ed,en.paint[ed],{validate:!1});for(let es in en.layout)this.setLayoutProperty(es,en.layout[es],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $s(es.paint)}}setFilter(en){this.filter=en,this._featureFilter=pi(en,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(en){return"visibility"===en?this.visibility:this._unevaluatedLayout.getValue(en)}getLayoutAffectingGlobalStateRefs(){let en=new Set;if(this._unevaluatedLayout)for(let es in this._unevaluatedLayout._values){let ec=this._unevaluatedLayout._values[es];for(let es of ec.getGlobalStateRefs())en.add(es)}for(let es of this._featureFilter.getGlobalStateRefs())en.add(es);return en}getPaintAffectingGlobalStateRefs(){var en;let es=new globalThis.Map;if(this._transitionablePaint)for(let ec in this._transitionablePaint._values){let ed=this._transitionablePaint._values[ec].value;for(let ep of ed.getGlobalStateRefs()){let ef=null!==(en=es.get(ep))&&void 0!==en?en:[];ef.push({name:ec,value:ed.value}),es.set(ep,ef)}}return es}setLayoutProperty(en,es,ec={}){null!=es&&this._validate(tW,`layers.${this.id}.layout.${en}`,en,es,ec)||("visibility"!==en?this._unevaluatedLayout.setValue(en,es):this.visibility=es)}getPaintProperty(en){return en.endsWith(t0)?this._transitionablePaint.getTransition(en.slice(0,-11)):this._transitionablePaint.getValue(en)}setPaintProperty(en,es,ec={}){if(null!=es&&this._validate(tq,`layers.${this.id}.paint.${en}`,en,es,ec))return!1;if(en.endsWith(t0))return this._transitionablePaint.setTransition(en.slice(0,-11),es||void 0),!1;{let ec=this._transitionablePaint._values[en],ed="cross-faded-data-driven"===ec.property.specification["property-type"],ep=ec.value.isDataDriven(),ef=ec.value;this._transitionablePaint.setValue(en,es),this._handleSpecialPaintPropertyUpdate(en);let em=this._transitionablePaint._values[en].value;return em.isDataDriven()||ep||ed||this._handleOverridablePaintPropertyUpdate(en,ef,em)}}_handleSpecialPaintPropertyUpdate(en){}_handleOverridablePaintPropertyUpdate(en,es,ec){return!1}isHidden(en){return!!(this.minzoom&&en<this.minzoom)||!!(this.maxzoom&&en>=this.maxzoom)||"none"===this.visibility}updateTransitions(en){this._transitioningPaint=this._transitionablePaint.transitioned(en,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(en,es){en.getCrossfadeParameters&&(this._crossfadeParameters=en.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(en,void 0,es)),this.paint=this._transitioningPaint.possiblyEvaluate(en,void 0,es)}serialize(){let en={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(en.layout=en.layout||{},en.layout.visibility=this.visibility),U(en,(en,es)=>!(void 0===en||"layout"===es&&!Object.keys(en).length||"paint"===es&&!Object.keys(en).length))}_validate(en,es,ec,ed,ep={}){return(!ep||!1!==ep.validate)&&is(this,en.call(Hi,{key:es,layerType:this.type,objectKey:ec,value:ed,styleSpec:eG,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let en in this.paint._values){let es=this.paint.get(en);if(es instanceof Ds&&jn(es.property.specification)&&("source"===es.value.kind||"composite"===es.value.kind)&&es.value.isStateDependent)return!0}return!1}};let t1={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};let Zs=class Zs{constructor(en,es){this._structArray=en,this._pos1=es*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}};let Ys=class Ys{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(en,es){return en._trim(),es&&(en.isTransferred=!0,es.push(en.arrayBuffer)),{length:en.length,arrayBuffer:en.arrayBuffer}}static deserialize(en){let es=Object.create(this.prototype);return es.arrayBuffer=en.arrayBuffer,es.length=en.length,es.capacity=en.arrayBuffer.byteLength/es.bytesPerElement,es._refreshViews(),es}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(en){this.reserve(en),this.length=en}reserve(en){if(en>this.capacity){this.capacity=Math.max(en,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let es=this.uint8;this._refreshViews(),es&&this.uint8.set(es)}}_refreshViews(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")}};function Hs(en,es=1){let ec=0,ed=0;return{members:en.map(en=>{let ep=t1[en.type].BYTES_PER_ELEMENT,ef=ec=Ks(ec,Math.max(es,ep)),em=en.components||1;return ed=Math.max(ed,ep),ec+=ep*em,{name:en.name,type:en.type,components:em,offset:ef}}),size:Ks(ec,Math.max(ed,es)),alignment:es}}function Ks(en,es){return Math.ceil(en/es)*es}let Js=class Js extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es){let ec=this.length;return this.resize(ec+1),this.emplace(ec,en,es)}emplace(en,es,ec){let ed=2*en;return this.int16[ed+0]=es,this.int16[ed+1]=ec,en}};Js.prototype.bytesPerElement=4,os("StructArrayLayout2i4",Js);let Ws=class Ws extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,en,es,ec)}emplace(en,es,ec,ed){let ep=3*en;return this.int16[ep+0]=es,this.int16[ep+1]=ec,this.int16[ep+2]=ed,en}};Ws.prototype.bytesPerElement=6,os("StructArrayLayout3i6",Ws);let Qs=class Qs extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed){let ep=this.length;return this.resize(ep+1),this.emplace(ep,en,es,ec,ed)}emplace(en,es,ec,ed,ep){let ef=4*en;return this.int16[ef+0]=es,this.int16[ef+1]=ec,this.int16[ef+2]=ed,this.int16[ef+3]=ep,en}};Qs.prototype.bytesPerElement=8,os("StructArrayLayout4i8",Qs);let ta=class ta extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef){let em=this.length;return this.resize(em+1),this.emplace(em,en,es,ec,ed,ep,ef)}emplace(en,es,ec,ed,ep,ef,em){let e_=6*en;return this.int16[e_+0]=es,this.int16[e_+1]=ec,this.int16[e_+2]=ed,this.int16[e_+3]=ep,this.int16[e_+4]=ef,this.int16[e_+5]=em,en}};ta.prototype.bytesPerElement=12,os("StructArrayLayout2i4i12",ta);let ea=class ea extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef){let em=this.length;return this.resize(em+1),this.emplace(em,en,es,ec,ed,ep,ef)}emplace(en,es,ec,ed,ep,ef,em){let e_=4*en,eg=8*en;return this.int16[e_+0]=es,this.int16[e_+1]=ec,this.uint8[eg+4]=ed,this.uint8[eg+5]=ep,this.uint8[eg+6]=ef,this.uint8[eg+7]=em,en}};ea.prototype.bytesPerElement=8,os("StructArrayLayout2i4ub8",ea);let ra=class ra extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en,es){let ec=this.length;return this.resize(ec+1),this.emplace(ec,en,es)}emplace(en,es,ec){let ed=2*en;return this.float32[ed+0]=es,this.float32[ed+1]=ec,en}};ra.prototype.bytesPerElement=8,os("StructArrayLayout2f8",ra);let na=class na extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef,em,e_,eg,ey){let ex=this.length;return this.resize(ex+1),this.emplace(ex,en,es,ec,ed,ep,ef,em,e_,eg,ey)}emplace(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex){let ev=10*en;return this.uint16[ev+0]=es,this.uint16[ev+1]=ec,this.uint16[ev+2]=ed,this.uint16[ev+3]=ep,this.uint16[ev+4]=ef,this.uint16[ev+5]=em,this.uint16[ev+6]=e_,this.uint16[ev+7]=eg,this.uint16[ev+8]=ey,this.uint16[ev+9]=ex,en}};na.prototype.bytesPerElement=20,os("StructArrayLayout10ui20",na);let ia=class ia extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef,em,e_){let eg=this.length;return this.resize(eg+1),this.emplace(eg,en,es,ec,ed,ep,ef,em,e_)}emplace(en,es,ec,ed,ep,ef,em,e_,eg){let ey=8*en;return this.uint16[ey+0]=es,this.uint16[ey+1]=ec,this.uint16[ey+2]=ed,this.uint16[ey+3]=ep,this.uint16[ey+4]=ef,this.uint16[ey+5]=em,this.uint16[ey+6]=e_,this.uint16[ey+7]=eg,en}};ia.prototype.bytesPerElement=16,os("StructArrayLayout8ui16",ia);let sa=class sa extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev){let eb=this.length;return this.resize(eb+1),this.emplace(eb,en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev)}emplace(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb){let ew=12*en;return this.int16[ew+0]=es,this.int16[ew+1]=ec,this.int16[ew+2]=ed,this.int16[ew+3]=ep,this.uint16[ew+4]=ef,this.uint16[ew+5]=em,this.uint16[ew+6]=e_,this.uint16[ew+7]=eg,this.int16[ew+8]=ey,this.int16[ew+9]=ex,this.int16[ew+10]=ev,this.int16[ew+11]=eb,en}};sa.prototype.bytesPerElement=24,os("StructArrayLayout4i4ui4i24",sa);let aa=class aa extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en,es,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,en,es,ec)}emplace(en,es,ec,ed){let ep=3*en;return this.float32[ep+0]=es,this.float32[ep+1]=ec,this.float32[ep+2]=ed,en}};aa.prototype.bytesPerElement=12,os("StructArrayLayout3f12",aa);let oa=class oa extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(en){let es=this.length;return this.resize(es+1),this.emplace(es,en)}emplace(en,es){return this.uint32[1*en+0]=es,en}};oa.prototype.bytesPerElement=4,os("StructArrayLayout1ul4",oa);let la=class la extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef,em,e_,eg){let ey=this.length;return this.resize(ey+1),this.emplace(ey,en,es,ec,ed,ep,ef,em,e_,eg)}emplace(en,es,ec,ed,ep,ef,em,e_,eg,ey){let ex=10*en;return this.int16[ex+0]=es,this.int16[ex+1]=ec,this.int16[ex+2]=ed,this.int16[ex+3]=ep,this.int16[ex+4]=ef,this.int16[ex+5]=em,this.uint32[5*en+3]=e_,this.uint16[ex+8]=eg,this.uint16[ex+9]=ey,en}};la.prototype.bytesPerElement=20,os("StructArrayLayout6i1ul2ui20",la);let ua=class ua extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef){let em=this.length;return this.resize(em+1),this.emplace(em,en,es,ec,ed,ep,ef)}emplace(en,es,ec,ed,ep,ef,em){let e_=6*en;return this.int16[e_+0]=es,this.int16[e_+1]=ec,this.int16[e_+2]=ed,this.int16[e_+3]=ep,this.int16[e_+4]=ef,this.int16[e_+5]=em,en}};ua.prototype.bytesPerElement=12,os("StructArrayLayout2i2i2i12",ua);let ca=class ca extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep){let ef=this.length;return this.resize(ef+1),this.emplace(ef,en,es,ec,ed,ep)}emplace(en,es,ec,ed,ep,ef){let em=4*en,e_=8*en;return this.float32[em+0]=es,this.float32[em+1]=ec,this.float32[em+2]=ed,this.int16[e_+6]=ep,this.int16[e_+7]=ef,en}};ca.prototype.bytesPerElement=16,os("StructArrayLayout2f1f2i16",ca);let ha=class ha extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef){let em=this.length;return this.resize(em+1),this.emplace(em,en,es,ec,ed,ep,ef)}emplace(en,es,ec,ed,ep,ef,em){let e_=16*en,eg=4*en,ey=8*en;return this.uint8[e_+0]=es,this.uint8[e_+1]=ec,this.float32[eg+1]=ed,this.float32[eg+2]=ep,this.int16[ey+6]=ef,this.int16[ey+7]=em,en}};ha.prototype.bytesPerElement=16,os("StructArrayLayout2ub2f2i16",ha);let pa=class pa extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,en,es,ec)}emplace(en,es,ec,ed){let ep=3*en;return this.uint16[ep+0]=es,this.uint16[ep+1]=ec,this.uint16[ep+2]=ed,en}};pa.prototype.bytesPerElement=6,os("StructArrayLayout3ui6",pa);let fa=class fa extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS){let eM=this.length;return this.resize(eM+1),this.emplace(eM,en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS)}emplace(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM){let eC=24*en,eI=12*en,eE=48*en;return this.int16[eC+0]=es,this.int16[eC+1]=ec,this.uint16[eC+2]=ed,this.uint16[eC+3]=ep,this.uint32[eI+2]=ef,this.uint32[eI+3]=em,this.uint32[eI+4]=e_,this.uint16[eC+10]=eg,this.uint16[eC+11]=ey,this.uint16[eC+12]=ex,this.float32[eI+7]=ev,this.float32[eI+8]=eb,this.uint8[eE+36]=ew,this.uint8[eE+37]=eT,this.uint8[eE+38]=eP,this.uint32[eI+10]=eS,this.int16[eC+22]=eM,en}};fa.prototype.bytesPerElement=48,os("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fa);let da=class da extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC,eI,eE,eA,ez,ek,eD,eR,eL,eB){let eF=this.length;return this.resize(eF+1),this.emplace(eF,en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC,eI,eE,eA,ez,ek,eD,eR,eL,eB)}emplace(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC,eI,eE,eA,ez,ek,eD,eR,eL,eB,eF){let eO=32*en,ej=16*en;return this.int16[eO+0]=es,this.int16[eO+1]=ec,this.int16[eO+2]=ed,this.int16[eO+3]=ep,this.int16[eO+4]=ef,this.int16[eO+5]=em,this.int16[eO+6]=e_,this.int16[eO+7]=eg,this.uint16[eO+8]=ey,this.uint16[eO+9]=ex,this.uint16[eO+10]=ev,this.uint16[eO+11]=eb,this.uint16[eO+12]=ew,this.uint16[eO+13]=eT,this.uint16[eO+14]=eP,this.uint16[eO+15]=eS,this.uint16[eO+16]=eM,this.uint16[eO+17]=eC,this.uint16[eO+18]=eI,this.uint16[eO+19]=eE,this.uint16[eO+20]=eA,this.uint16[eO+21]=ez,this.uint16[eO+22]=ek,this.uint32[ej+12]=eD,this.float32[ej+13]=eR,this.float32[ej+14]=eL,this.uint16[eO+30]=eB,this.uint16[eO+31]=eF,en}};da.prototype.bytesPerElement=64,os("StructArrayLayout8i15ui1ul2f2ui64",da);let ya=class ya extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en){let es=this.length;return this.resize(es+1),this.emplace(es,en)}emplace(en,es){return this.float32[1*en+0]=es,en}};ya.prototype.bytesPerElement=4,os("StructArrayLayout1f4",ya);let ma=class ma extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en,es,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,en,es,ec)}emplace(en,es,ec,ed){let ep=3*en;return this.uint16[6*en+0]=es,this.float32[ep+1]=ec,this.float32[ep+2]=ed,en}};ma.prototype.bytesPerElement=12,os("StructArrayLayout1ui2f12",ma);let ga=class ga extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,en,es,ec)}emplace(en,es,ec,ed){let ep=4*en;return this.uint32[2*en+0]=es,this.uint16[ep+2]=ec,this.uint16[ep+3]=ed,en}};ga.prototype.bytesPerElement=8,os("StructArrayLayout1ul2ui8",ga);let xa=class xa extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en,es){let ec=this.length;return this.resize(ec+1),this.emplace(ec,en,es)}emplace(en,es,ec){let ed=2*en;return this.uint16[ed+0]=es,this.uint16[ed+1]=ec,en}};xa.prototype.bytesPerElement=4,os("StructArrayLayout2ui4",xa);let va=class va extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(en){let es=this.length;return this.resize(es+1),this.emplace(es,en)}emplace(en,es){return this.uint16[1*en+0]=es,en}};va.prototype.bytesPerElement=2,os("StructArrayLayout1ui2",va);let ba=class ba extends Ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(en,es,ec,ed){let ep=this.length;return this.resize(ep+1),this.emplace(ep,en,es,ec,ed)}emplace(en,es,ec,ed,ep){let ef=4*en;return this.float32[ef+0]=es,this.float32[ef+1]=ec,this.float32[ef+2]=ed,this.float32[ef+3]=ep,en}};ba.prototype.bytesPerElement=16,os("StructArrayLayout4f16",ba);let wa=class wa extends Zs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}};wa.prototype.size=20;let _a=class _a extends la{get(en){return new wa(this,en)}};os("CollisionBoxArray",_a);let Sa=class Sa extends Zs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(en){this._structArray.uint8[this._pos1+37]=en}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(en){this._structArray.uint8[this._pos1+38]=en}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(en){this._structArray.uint32[this._pos4+10]=en}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}};Sa.prototype.size=48;let Aa=class Aa extends fa{get(en){return new Sa(this,en)}};os("PlacedSymbolArray",Aa);let ka=class ka extends Zs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(en){this._structArray.uint32[this._pos4+12]=en}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}};ka.prototype.size=64;let Ma=class Ma extends da{get(en){return new ka(this,en)}};os("SymbolInstanceArray",Ma);let Ia=class Ia extends ya{getoffsetX(en){return this.float32[1*en+0]}};os("GlyphOffsetArray",Ia);let za=class za extends Ws{getx(en){return this.int16[3*en+0]}gety(en){return this.int16[3*en+1]}gettileUnitDistanceFromAnchor(en){return this.int16[3*en+2]}};os("SymbolLineVertexArray",za);let Pa=class Pa extends Zs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}};Pa.prototype.size=12;let Ca=class Ca extends ma{get(en){return new Pa(this,en)}};os("TextAnchorOffsetArray",Ca);let Ea=class Ea extends Zs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}};Ea.prototype.size=8;let Ta=class Ta extends ga{get(en){return new Ea(this,en)}};os("FeatureIndexArray",Ta);let Ba=class Ba extends Js{};let Va=class Va extends Js{};let Fa=class Fa extends Js{};let Da=class Da extends ta{};let $a=class $a extends ea{};let La=class La extends ra{};let Oa=class Oa extends na{};let Ra=class Ra extends ia{};let Ua=class Ua extends sa{};let ja=class ja extends aa{};let Na=class Na extends oa{};let qa=class qa extends ua{};let Ga=class Ga extends ha{};let Xa=class Xa extends pa{};let Za=class Za extends xa{};let t2=Hs([{name:"a_pos",components:2,type:"Int16"}],4),{members:t3}=t2;let Ka=class Ka{constructor(en=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=en}prepareSegment(en,es,ec,ed){let ep=this.segments[this.segments.length-1];return en>Ka.MAX_VERTEX_ARRAY_LENGTH&&q(`Max vertices per segment is ${Ka.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${en}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ka.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!ep||ep.vertexLength+en>Ka.MAX_VERTEX_ARRAY_LENGTH||ep.sortKey!==ed?this.createNewSegment(es,ec,ed):ep}createNewSegment(en,es,ec){let ed={vertexOffset:en.length,primitiveOffset:es.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==ec&&(ed.sortKey=ec),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(ed),ed}getOrCreateLatestSegment(en,es,ec){return this.prepareSegment(0,en,es,ec)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let en of this.segments)for(let es in en.vaos)en.vaos[es].destroy()}static simpleSegment(en,es,ec,ed){return new Ka([{vertexOffset:en,primitiveOffset:es,vertexLength:ec,primitiveLength:ed,vaos:{},sortKey:0}])}};function Ja(en,es){return 256*(en=D(Math.floor(en),0,255))+D(Math.floor(es),0,255)}Ka.MAX_VERTEX_ARRAY_LENGTH=65535,os("SegmentVector",Ka);let t5=Hs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),t4=Hs([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var t6,t8,t9,t7={exports:{}},il={exports:{}},iu={exports:{}},ic=n(function(){if(t9)return t7.exports;t9=1;var en=(t6||(t6=1,il.exports=function(en,es){var ec,ed,ep,ef,em,e_;for(ed=en.length-(ec=3&en.length),ep=es,e_=0;e_<ed;)em=255&en.charCodeAt(e_)|(255&en.charCodeAt(++e_))<<8|(255&en.charCodeAt(++e_))<<16|(255&en.charCodeAt(++e_))<<24,++e_,ep=27492+(65535&(ef=5*(65535&(ep=(ep^=em=(65535&(em=(em=(65535&em)*3432918353+(((em>>>16)*3432918353&65535)<<16)&4294967295)<<15|em>>>17))*461845907+(((em>>>16)*461845907&65535)<<16)&4294967295)<<13|ep>>>19))+((5*(ep>>>16)&65535)<<16)&4294967295))+((58964+(ef>>>16)&65535)<<16);switch(em=0,ec){case 3:em^=(255&en.charCodeAt(e_+2))<<16;case 2:em^=(255&en.charCodeAt(e_+1))<<8;case 1:ep^=em=(65535&(em=(em=(65535&(em^=255&en.charCodeAt(e_)))*3432918353+(((em>>>16)*3432918353&65535)<<16)&4294967295)<<15|em>>>17))*461845907+(((em>>>16)*461845907&65535)<<16)&4294967295}return ep^=en.length,ep=2246822507*(65535&(ep^=ep>>>16))+((2246822507*(ep>>>16)&65535)<<16)&4294967295,ep=3266489909*(65535&(ep^=ep>>>13))+((3266489909*(ep>>>16)&65535)<<16)&4294967295,(ep^=ep>>>16)>>>0}),il.exports),es=(t8||(t8=1,iu.exports=function(en,es){for(var ec,ed=en.length,ep=es^ed,ef=0;ed>=4;)ec=1540483477*(65535&(ec=255&en.charCodeAt(ef)|(255&en.charCodeAt(++ef))<<8|(255&en.charCodeAt(++ef))<<16|(255&en.charCodeAt(++ef))<<24))+((1540483477*(ec>>>16)&65535)<<16),ep=1540483477*(65535&ep)+((1540483477*(ep>>>16)&65535)<<16)^(ec=1540483477*(65535&(ec^=ec>>>24))+((1540483477*(ec>>>16)&65535)<<16)),ed-=4,++ef;switch(ed){case 3:ep^=(255&en.charCodeAt(ef+2))<<16;case 2:ep^=(255&en.charCodeAt(ef+1))<<8;case 1:ep=1540483477*(65535&(ep^=255&en.charCodeAt(ef)))+((1540483477*(ep>>>16)&65535)<<16)}return ep=1540483477*(65535&(ep^=ep>>>13))+((1540483477*(ep>>>16)&65535)<<16),(ep^=ep>>>15)>>>0}),iu.exports);return t7.exports=en,t7.exports.murmur3=en,t7.exports.murmur2=es,t7.exports}());let lo=class lo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(en,es,ec,ed){this.ids.push(uo(en)),this.positions.push(es,ec,ed)}getPositions(en){if(!this.indexed)throw Error("Trying to get index, but feature positions are not indexed");let es=uo(en),ec=0,ed=this.ids.length-1;for(;ec<ed;){let en=ec+ed>>1;this.ids[en]>=es?ed=en:ec=en+1}let ep=[];for(;this.ids[ec]===es;)ep.push({index:this.positions[3*ec],start:this.positions[3*ec+1],end:this.positions[3*ec+2]}),ec++;return ep}static serialize(en,es){let ec=new Float64Array(en.ids),ed=new Uint32Array(en.positions);return function co(en,es,ec,ed){for(;ec<ed;){let ep=en[ec+ed>>1],ef=ec-1,em=ed+1;for(;;){do ef++;while(en[ef]<ep);do em--;while(en[em]>ep);if(ef>=em)break;ho(en,ef,em),ho(es,3*ef,3*em),ho(es,3*ef+1,3*em+1),ho(es,3*ef+2,3*em+2)}em-ec<ed-em?(co(en,es,ec,em),ec=em+1):(co(en,es,em+1,ed),ed=em)}}(ec,ed,0,ec.length-1),es&&es.push(ec.buffer,ed.buffer),{ids:ec,positions:ed}}static deserialize(en){let es=new lo;return es.ids=en.ids,es.positions=en.positions,es.indexed=!0,es}};function uo(en){let es=+en;return!isNaN(es)&&es<=Number.MAX_SAFE_INTEGER?es:ic(String(en))}function ho(en,es,ec){let ed=en[es];en[es]=en[ec],en[ec]=ed}os("FeaturePositionMap",lo);let po=class po{constructor(en,es){this.gl=en.gl,this.location=es}};let fo=class fo extends po{constructor(en,es){super(en,es),this.current=0}set(en){this.current!==en&&(this.current=en,this.gl.uniform1f(this.location,en))}};let yo=class yo extends po{constructor(en,es){super(en,es),this.current=[0,0,0,0]}set(en){en[0]===this.current[0]&&en[1]===this.current[1]&&en[2]===this.current[2]&&en[3]===this.current[3]||(this.current=en,this.gl.uniform4f(this.location,en[0],en[1],en[2],en[3]))}};let mo=class mo extends po{constructor(en,es){super(en,es),this.current=Me.transparent}set(en){en.r===this.current.r&&en.g===this.current.g&&en.b===this.current.b&&en.a===this.current.a||(this.current=en,this.gl.uniform4f(this.location,en.r,en.g,en.b,en.a))}};let id=new Float32Array(16);function xo(en){return[Ja(255*en.r,255*en.g),Ja(255*en.b,255*en.a)]}let vo=class vo{constructor(en,es,ec){this.value=en,this.uniformNames=es.map(en=>`u_${en}`),this.type=ec}setUniform(en,es,ec){en.set(ec.constantOr(this.value))}getBinding(en,es,ec){return"color"===this.type?new mo(en,es):new fo(en,es)}};let bo=class bo{constructor(en,es){this.uniformNames=es.map(en=>`u_${en}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(en,es){this.pixelRatioFrom=es.pixelRatio,this.pixelRatioTo=en.pixelRatio,this.patternFrom=es.tlbr,this.patternTo=en.tlbr}setConstantDashPositions(en,es){this.dashTo=[0,en.y,en.height,en.width],this.dashFrom=[0,es.y,es.height,es.width]}setUniform(en,es,ec,ed){let ep=null;"u_pattern_to"===ed?ep=this.patternTo:"u_pattern_from"===ed?ep=this.patternFrom:"u_dasharray_to"===ed?ep=this.dashTo:"u_dasharray_from"===ed?ep=this.dashFrom:"u_pixel_ratio_to"===ed?ep=this.pixelRatioTo:"u_pixel_ratio_from"===ed&&(ep=this.pixelRatioFrom),null!==ep&&en.set(ep)}getBinding(en,es,ec){return"u_pattern"===ec.substr(0,9)||"u_dasharray_"===ec.substr(0,12)?new yo(en,es):new fo(en,es)}};let wo=class wo{constructor(en,es,ec,ed){this.expression=en,this.type=ec,this.maxValue=0,this.paintVertexAttributes=es.map(en=>({name:`a_${en}`,type:"Float32",components:"color"===ec?2:1,offset:0})),this.paintVertexArray=new ed}populatePaintArray(en,es,ec){let ed=this.paintVertexArray.length,ep=this.expression.evaluate(new zs(0,ec),es,{},ec.canonical,[],ec.formattedSection);this.paintVertexArray.resize(en),this._setPaintValue(ed,en,ep)}updatePaintArray(en,es,ec,ed,ep){let ef=this.expression.evaluate(new zs(0,ep),ec,ed);this._setPaintValue(en,es,ef)}_setPaintValue(en,es,ec){if("color"===this.type){let ed=xo(ec);for(let ec=en;ec<es;ec++)this.paintVertexArray.emplace(ec,ed[0],ed[1])}else{for(let ed=en;ed<es;ed++)this.paintVertexArray.emplace(ed,ec);this.maxValue=Math.max(this.maxValue,Math.abs(ec))}}upload(en){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=en.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}};let _o=class _o{constructor(en,es,ec,ed,ep,ef){this.expression=en,this.uniformNames=es.map(en=>`u_${en}_t`),this.type=ec,this.useIntegerZoom=ed,this.zoom=ep,this.maxValue=0,this.paintVertexAttributes=es.map(en=>({name:`a_${en}`,type:"Float32",components:"color"===ec?4:2,offset:0})),this.paintVertexArray=new ef}populatePaintArray(en,es,ec){let ed=this.expression.evaluate(new zs(this.zoom,ec),es,{},ec.canonical,[],ec.formattedSection),ep=this.expression.evaluate(new zs(this.zoom+1,ec),es,{},ec.canonical,[],ec.formattedSection),ef=this.paintVertexArray.length;this.paintVertexArray.resize(en),this._setPaintValue(ef,en,ed,ep)}updatePaintArray(en,es,ec,ed,ep){let ef=this.expression.evaluate(new zs(this.zoom,ep),ec,ed),em=this.expression.evaluate(new zs(this.zoom+1,ep),ec,ed);this._setPaintValue(en,es,ef,em)}_setPaintValue(en,es,ec,ed){if("color"===this.type){let ep=xo(ec),ef=xo(ed);for(let ec=en;ec<es;ec++)this.paintVertexArray.emplace(ec,ep[0],ep[1],ef[0],ef[1])}else{for(let ep=en;ep<es;ep++)this.paintVertexArray.emplace(ep,ec,ed);this.maxValue=Math.max(this.maxValue,Math.abs(ec),Math.abs(ed))}}upload(en){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=en.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(en,es){let ec=this.useIntegerZoom?Math.floor(es.zoom):es.zoom,ed=D(this.expression.interpolationFactor(ec,this.zoom,this.zoom+1),0,1);en.set(ed)}getBinding(en,es,ec){return new fo(en,es)}};let So=class So{constructor(en,es,ec,ed,ep,ef){this.expression=en,this.type=es,this.useIntegerZoom=ec,this.zoom=ed,this.layerId=ef,this.zoomInPaintVertexArray=new ep,this.zoomOutPaintVertexArray=new ep}populatePaintArray(en,es,ec){let ed=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(en),this.zoomOutPaintVertexArray.resize(en),this._setPaintValues(ed,en,this.getPositionIds(es),ec)}updatePaintArray(en,es,ec,ed,ep){this._setPaintValues(en,es,this.getPositionIds(ec),ep)}_setPaintValues(en,es,ec,ed){let ep=this.getPositions(ed);if(!ep||!ec)return;let ef=ep[ec.min],em=ep[ec.mid],e_=ep[ec.max];if(ef&&em&&e_)for(let ec=en;ec<es;ec++)this.emplace(this.zoomInPaintVertexArray,ec,em,ef),this.emplace(this.zoomOutPaintVertexArray,ec,em,e_)}upload(en){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){let es=this.getVertexAttributes();this.zoomInPaintVertexBuffer=en.createVertexBuffer(this.zoomInPaintVertexArray,es,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=en.createVertexBuffer(this.zoomOutPaintVertexArray,es,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}};let Ao=class Ao extends So{getPositions(en){return en.imagePositions}getPositionIds(en){return en.patterns&&en.patterns[this.layerId]}getVertexAttributes(){return t5.members}emplace(en,es,ec,ed){en.emplace(es,ec.tlbr[0],ec.tlbr[1],ec.tlbr[2],ec.tlbr[3],ed.tlbr[0],ed.tlbr[1],ed.tlbr[2],ed.tlbr[3],ec.pixelRatio,ed.pixelRatio)}};let ko=class ko extends So{getPositions(en){return en.dashPositions}getPositionIds(en){return en.dashes&&en.dashes[this.layerId]}getVertexAttributes(){return t4.members}emplace(en,es,ec,ed){en.emplace(es,0,ec.y,ec.height,ec.width,0,ed.y,ed.height,ed.width)}};let Mo=class Mo{constructor(en,es,ec){this.binders={},this._buffers=[];let ed=[];for(let ef in en.paint._values){var ep;if(!ec(ef))continue;let em=en.paint.get(ef);if(!(em instanceof Ds&&jn(em.property.specification)))continue;let e_=(ep=en.type,({"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]})[ef]||[ef.replace(`${ep}-`,"").replace(/-/g,"_")]),eg=em.value,ey=em.property.specification.type,ex=em.property.useIntegerZoom,ev=em.property.specification["property-type"],eb="cross-faded"===ev||"cross-faded-data-driven"===ev;if("constant"===eg.kind)this.binders[ef]=eb?new bo(eg.value,e_):new vo(eg.value,e_,ey),ed.push(`/u_${ef}`);else if("source"===eg.kind||eb){let ec=Po(ef,ey,"source");this.binders[ef]=eb?"line-dasharray"===ef?new ko(eg,ey,ex,es,ec,en.id):new Ao(eg,ey,ex,es,ec,en.id):new wo(eg,e_,ey,ec),ed.push(`/a_${ef}`)}else{let en=Po(ef,ey,"composite");this.binders[ef]=new _o(eg,e_,ey,ex,es,en),ed.push(`/z_${ef}`)}}this.cacheKey=ed.sort().join("")}getMaxValue(en){let es=this.binders[en];return es instanceof wo||es instanceof _o?es.maxValue:0}populatePaintArrays(en,es,ec){for(let ed in this.binders){let ep=this.binders[ed];(ep instanceof wo||ep instanceof _o||ep instanceof So)&&ep.populatePaintArray(en,es,ec)}}setConstantPatternPositions(en,es){for(let ec in this.binders){let ed=this.binders[ec];ed instanceof bo&&ed.setConstantPatternPositions(en,es)}}setConstantDashPositions(en,es){for(let ec in this.binders){let ed=this.binders[ec];ed instanceof bo&&ed.setConstantDashPositions(en,es)}}updatePaintArrays(en,es,ec,ed,ep){let ef=!1;for(let em in en){let e_=es.getPositions(em);for(let es of e_){let e_=ec.feature(es.index);for(let ec in this.binders){let eg=this.binders[ec];if((eg instanceof wo||eg instanceof _o||eg instanceof So)&&!0===eg.expression.isStateDependent){let ey=ed.paint.get(ec);eg.expression=ey.value,eg.updatePaintArray(es.start,es.end,e_,en[em],ep),ef=!0}}}}return ef}defines(){let en=[];for(let es in this.binders){let ec=this.binders[es];(ec instanceof vo||ec instanceof bo)&&en.push(...ec.uniformNames.map(en=>`#define HAS_UNIFORM_${en}`))}return en}getBinderAttributes(){let en=[];for(let es in this.binders){let ec=this.binders[es];if(ec instanceof wo||ec instanceof _o)for(let es=0;es<ec.paintVertexAttributes.length;es++)en.push(ec.paintVertexAttributes[es].name);else if(ec instanceof So){let es=ec.getVertexAttributes();for(let ec of es)en.push(ec.name)}}return en}getBinderUniforms(){let en=[];for(let es in this.binders){let ec=this.binders[es];if(ec instanceof vo||ec instanceof bo||ec instanceof _o)for(let es of ec.uniformNames)en.push(es)}return en}getPaintVertexBuffers(){return this._buffers}getUniforms(en,es){let ec=[];for(let ed in this.binders){let ep=this.binders[ed];if(ep instanceof vo||ep instanceof bo||ep instanceof _o){for(let ef of ep.uniformNames)if(es[ef]){let em=ep.getBinding(en,es[ef],ef);ec.push({name:ef,property:ed,binding:em})}}}return ec}setUniforms(en,es,ec,ed){for(let{name:en,property:ep,binding:ef}of es)this.binders[ep].setUniform(ef,ed,ec.get(ep),en)}updatePaintBuffers(en){for(let es in this._buffers=[],this.binders){let ec=this.binders[es];if(en&&ec instanceof So){let es=2===en.fromScale?ec.zoomInPaintVertexBuffer:ec.zoomOutPaintVertexBuffer;es&&this._buffers.push(es)}else(ec instanceof wo||ec instanceof _o)&&ec.paintVertexBuffer&&this._buffers.push(ec.paintVertexBuffer)}}upload(en){for(let es in this.binders){let ec=this.binders[es];(ec instanceof wo||ec instanceof _o||ec instanceof So)&&ec.upload(en)}this.updatePaintBuffers()}destroy(){for(let en in this.binders){let es=this.binders[en];(es instanceof wo||es instanceof _o||es instanceof So)&&es.destroy()}}};let Io=class Io{constructor(en,es,ec=()=>!0){for(let ed of(this.programConfigurations={},en))this.programConfigurations[ed.id]=new Mo(ed,es,ec);this.needsUpload=!1,this._featureMap=new lo,this._bufferOffset=0}populatePaintArrays(en,es,ec,ed){for(let ec in this.programConfigurations)this.programConfigurations[ec].populatePaintArrays(en,es,ed);void 0!==es.id&&this._featureMap.add(es.id,ec,this._bufferOffset,en),this._bufferOffset=en,this.needsUpload=!0}updatePaintArrays(en,es,ec,ed){for(let ep of ec)this.needsUpload=this.programConfigurations[ep.id].updatePaintArrays(en,this._featureMap,es,ep,ed)||this.needsUpload}get(en){return this.programConfigurations[en]}upload(en){if(this.needsUpload){for(let es in this.programConfigurations)this.programConfigurations[es].upload(en);this.needsUpload=!1}}destroy(){for(let en in this.programConfigurations)this.programConfigurations[en].destroy()}};function Po(en,es,ec){let ed={"line-pattern":{source:Oa,composite:Oa},"fill-pattern":{source:Oa,composite:Oa},"fill-extrusion-pattern":{source:Oa,composite:Oa},"line-dasharray":{source:Ra,composite:Ra}}[en];return ed&&ed[ec]||({color:{source:ra,composite:ba},number:{source:ya,composite:ra}})[es][ec]}os("ConstantBinder",vo),os("CrossFadedConstantBinder",bo),os("SourceExpressionBinder",wo),os("CrossFadedPatternBinder",Ao),os("CrossFadedDasharrayBinder",ko),os("CompositeExpressionBinder",_o),os("ProgramConfiguration",Mo,{omit:["_buffers"]}),os("ProgramConfigurationSet",Io);let im=-16383-1;function To(en){let es=8192/en.extent,ec=en.loadGeometry();for(let en=0;en<ec.length;en++){let ed=ec[en];for(let en=0;en<ed.length;en++){let ec=ed[en],ep=Math.round(ec.x*es),ef=Math.round(ec.y*es);ec.x=D(ep,im,16383),ec.y=D(ef,im,16383),(ep<ec.x||ep>ec.x+1||ef<ec.y||ef>ec.y+1)&&q("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return ec}function Bo(en,es){return{type:en.type,id:en.id,properties:en.properties,geometry:es?To(en):[]}}let Do=class Do{constructor(en){this.zoom=en.zoom,this.overscaling=en.overscaling,this.layers=en.layers,this.layerIds=this.layers.map(en=>en.id),this.index=en.index,this.hasDependencies=!1,this.layoutVertexArray=new Va,this.indexArray=new Xa,this.segments=new Ka,this.programConfigurations=new Io(en.layers,en.zoom),this.stateDependentLayerIds=this.layers.filter(en=>en.isStateDependent()).map(en=>en.id)}populate(en,es,ec){let ed=this.layers[0],ep=[],ef=null,em=!1,e_="heatmap"===ed.type;"circle"===ed.type&&(em=!(ef=ed.layout.get("circle-sort-key")).isConstant(),e_=e_||"map"===ed.paint.get("circle-pitch-alignment"));let eg=e_?es.subdivisionGranularity.circle:1;for(let{feature:es,id:ed,index:e_,sourceLayerIndex:eg}of en){let en=this.layers[0]._featureFilter.needGeometry,ey=Bo(es,en);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom),ey,ec))continue;let ex=em?ef.evaluate(ey,{},ec):void 0,ev={id:ed,properties:es.properties,type:es.type,sourceLayerIndex:eg,index:e_,geometry:en?ey.geometry:To(es),patterns:{},sortKey:ex};ep.push(ev)}for(let ed of(em&&ep.sort((en,es)=>en.sortKey-es.sortKey),ep)){let{geometry:ep,index:ef,sourceLayerIndex:em}=ed,e_=en[ef].feature;this.addFeature(ed,ep,ef,ec,eg),es.featureIndex.insert(e_,ep,ef,em,this.index)}}update(en,es,ec){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(en,es,this.stateDependentLayers,{imagePositions:ec})}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(en){this.uploaded||(this.layoutVertexBuffer=en.createVertexBuffer(this.layoutVertexArray,t3),this.indexBuffer=en.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(en),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(en,es,ec,ed,ep=1){let ef;switch(ep){case 1:ef=[0,7];break;case 3:ef=[0,2,5,7];break;case 5:ef=[0,1,3,4,6,7];break;case 7:ef=[0,1,2,3,4,5,6,7];break;default:throw Error(`Invalid circle bucket granularity: ${ep}; valid values are 1, 3, 5, 7.`)}let em=ef.length;for(let ec of es)for(let es of ec){let ec=es.x,ed=es.y;if(ec<0||ec>=8192||ed<0||ed>=8192)continue;let ep=this.segments.prepareSegment(em*em,this.layoutVertexArray,this.indexArray,en.sortKey),e_=ep.vertexLength;for(let en=0;en<em;en++)for(let es=0;es<em;es++)!function(en,es,ec,ed,ep){en.emplaceBack(-32768+8*es+ed,-32768+8*ec+ep)}(this.layoutVertexArray,ec,ed,ef[es],ef[en]);for(let en=0;en<em-1;en++)for(let es=0;es<em-1;es++){let ec=e_+en*em+es,ed=e_+(en+1)*em+es;this.indexArray.emplaceBack(ec,ed+1,ec+1),this.indexArray.emplaceBack(ec,ed,ed+1)}ep.vertexLength+=em*em,ep.primitiveLength+=(em-1)*(em-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,en,ec,{imagePositions:{},canonical:ed})}};function $o(en,es){for(let ec=0;ec<en.length;ec++)if(Xo(es,en[ec]))return!0;for(let ec=0;ec<es.length;ec++)if(Xo(en,es[ec]))return!0;return!!Uo(en,es)}function Lo(en,es,ec){return!!Xo(en,es)||!!No(es,en,ec)}function Oo(en,es){if(1===en.length)return Go(es,en[0]);for(let ec=0;ec<es.length;ec++){let ed=es[ec];for(let es=0;es<ed.length;es++)if(Xo(en,ed[es]))return!0}for(let ec=0;ec<en.length;ec++)if(Go(es,en[ec]))return!0;for(let ec=0;ec<es.length;ec++)if(Uo(en,es[ec]))return!0;return!1}function Uo(en,es){if(0===en.length||0===es.length)return!1;for(let ep=0;ep<en.length-1;ep++){let ef=en[ep],em=en[ep+1];for(let en=0;en<es.length-1;en++){var ec,ed;if(G(ef,ec=es[en],ed=es[en+1])!==G(em,ec,ed)&&G(ef,em,ec)!==G(ef,em,ed))return!0}}return!1}function No(en,es,ec){let ed=ec*ec;if(1===es.length)return en.distSqr(es[0])<ed;for(let ec=1;ec<es.length;ec++)if(qo(en,es[ec-1],es[ec])<ed)return!0;return!1}function qo(en,es,ec){let ed=es.distSqr(ec);if(0===ed)return en.distSqr(es);let ep=((en.x-es.x)*(ec.x-es.x)+(en.y-es.y)*(ec.y-es.y))/ed;return en.distSqr(ep<0?es:ep>1?ec:ec.sub(es)._mult(ep)._add(es))}function Go(en,es){let ec,ed,ep,ef=!1;for(let em=0;em<en.length;em++){ec=en[em];for(let en=0,em=ec.length-1;en<ec.length;em=en++)ed=ec[en],ep=ec[em],ed.y>es.y!=ep.y>es.y&&es.x<(ep.x-ed.x)*(es.y-ed.y)/(ep.y-ed.y)+ed.x&&(ef=!ef)}return ef}function Xo(en,es){let ec=!1;for(let ed=0,ep=en.length-1;ed<en.length;ep=ed++){let ef=en[ed],em=en[ep];ef.y>es.y!=em.y>es.y&&es.x<(em.x-ef.x)*(es.y-ef.y)/(em.y-ef.y)+ef.x&&(ec=!ec)}return ec}function Yo(en,es,ec){let ed=es.paint.get(en).value;return"constant"===ed.kind?ed.value:ec.programConfigurations.get(es.id).getMaxValue(en)}function Ho(en){return Math.sqrt(en[0]*en[0]+en[1]*en[1])}function Ko(en,es,ec,ed,ep){if(!es[0]&&!es[1])return en;let ef=r.convert(es)._mult(ep);"viewport"===ec&&ef._rotate(-ed);let em=[];for(let es=0;es<en.length;es++)em.push(en[es].sub(ef));return em}function Jo({queryGeometry:en,size:es},ec){return Lo(en,ec,es)}function Wo({queryGeometry:en,size:es,transform:ec,unwrappedTileID:ed,getElevation:ep},ef){return Lo(en,ef,es*(ec.projectTileCoordinates(ef.x,ef.y,ed,ep).signedDistanceFromCamera/ec.cameraToCenterDistance))}function Qo({queryGeometry:en,size:es,transform:ec,unwrappedTileID:ed,getElevation:ep},ef){let em=ec.projectTileCoordinates(ef.x,ef.y,ed,ep).signedDistanceFromCamera,e_=es*(ec.cameraToCenterDistance/em);return Lo(en,rl(ef,ec,ed,ep),e_)}function tl({queryGeometry:en,size:es,transform:ec,unwrappedTileID:ed,getElevation:ep},ef){return Lo(en,rl(ef,ec,ed,ep),es)}function el({queryGeometry:en,size:es,transform:ec,unwrappedTileID:ed,getElevation:ep,pitchAlignment:ef="map",pitchScale:em="map"},e_){let eg="map"===ef?"map"===em?Jo:Wo:"map"===em?Qo:tl,ey={queryGeometry:en,size:es,transform:ec,unwrappedTileID:ed,getElevation:ep};for(let en of e_)for(let es of en)if(eg(ey,es))return!0;return!1}function rl(en,es,ec,ed){let ep=es.projectTileCoordinates(en.x,en.y,ec,ed).point;return new r((.5*ep.x+.5)*es.width,(-(.5*ep.y)+.5)*es.height)}os("CircleBucket",Do,{omit:["layers"]});var i_={get paint(){return em=em||new Ns({"circle-radius":new Os(eG.paint_circle["circle-radius"]),"circle-color":new Os(eG.paint_circle["circle-color"]),"circle-blur":new Os(eG.paint_circle["circle-blur"]),"circle-opacity":new Os(eG.paint_circle["circle-opacity"]),"circle-translate":new Ls(eG.paint_circle["circle-translate"]),"circle-translate-anchor":new Ls(eG.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ls(eG.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ls(eG.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Os(eG.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Os(eG.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Os(eG.paint_circle["circle-stroke-opacity"])})},get layout(){return ef=ef||new Ns({"circle-sort-key":new Os(eG.layout_circle["circle-sort-key"])})}};let al=class al extends Gs{constructor(en,es){super(en,i_,es)}createBucket(en){return new Do(en)}queryRadius(en){return Yo("circle-radius",this,en)+Yo("circle-stroke-width",this,en)+Ho(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:en,feature:es,featureState:ec,geometry:ed,transform:ep,pixelsToTileUnits:ef,unwrappedTileID:em,getElevation:e_}){let eg,ey;let ex=Ko(en,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-ep.bearingInRadians,ef),ev=this.paint.get("circle-radius").evaluate(es,ec)+this.paint.get("circle-stroke-width").evaluate(es,ec),eb=this.paint.get("circle-pitch-scale"),ew=this.paint.get("circle-pitch-alignment");return"map"===ew?(eg=ex,ey=ev*ef):(eg=ex.map(en=>rl(en,ep,em,e_)),ey=ev),el({queryGeometry:eg,size:ey,transform:ep,unwrappedTileID:em,getElevation:e_,pitchAlignment:ew,pitchScale:eb},ed)}};let ol=class ol extends Do{};os("HeatmapBucket",ol,{omit:["layers"]});var ig={get paint(){return e_=e_||new Ns({"heatmap-radius":new Os(eG.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Os(eG.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ls(eG.paint_heatmap["heatmap-intensity"]),"heatmap-color":new js(eG.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ls(eG.paint_heatmap["heatmap-opacity"])})}};function cl(en,{width:es,height:ec},ed,ep){if(ep){if(ep instanceof Uint8ClampedArray)ep=new Uint8Array(ep.buffer);else if(ep.length!==es*ec*ed)throw RangeError(`mismatched image size. expected: ${ep.length} but got: ${es*ec*ed}`)}else ep=new Uint8Array(es*ec*ed);return en.width=es,en.height=ec,en.data=ep,en}function hl(en,{width:es,height:ec},ed){if(es===en.width&&ec===en.height)return;let ep=cl({},{width:es,height:ec},ed);pl(en,ep,{x:0,y:0},{x:0,y:0},{width:Math.min(en.width,es),height:Math.min(en.height,ec)},ed),en.width=es,en.height=ec,en.data=ep.data}function pl(en,es,ec,ed,ep,ef){if(0===ep.width||0===ep.height)return es;if(ep.width>en.width||ep.height>en.height||ec.x>en.width-ep.width||ec.y>en.height-ep.height)throw RangeError("out of range source coordinates for image copy");if(ep.width>es.width||ep.height>es.height||ed.x>es.width-ep.width||ed.y>es.height-ep.height)throw RangeError("out of range destination coordinates for image copy");let em=en.data,e_=es.data;if(em===e_)throw Error("srcData equals dstData, so image is already copied");for(let eg=0;eg<ep.height;eg++){let ey=((ec.y+eg)*en.width+ec.x)*ef,ex=((ed.y+eg)*es.width+ed.x)*ef;for(let en=0;en<ep.width*ef;en++)e_[ex+en]=em[ey+en]}return es}let fl=class fl{constructor(en,es){cl(this,en,1,es)}resize(en){hl(this,en,1)}clone(){return new fl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(en,es,ec,ed,ep){pl(en,es,ec,ed,ep,1)}};let dl=class dl{constructor(en,es){cl(this,en,4,es)}resize(en){hl(this,en,4)}replace(en,es){es?this.data.set(en):this.data=en instanceof Uint8ClampedArray?new Uint8Array(en.buffer):en}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(en,es,ec,ed,ep){pl(en,es,ec,ed,ep,4)}setPixel(en,es,ec){let ed=4*(en*this.width+es);this.data[ed+0]=Math.round(255*ec.r/ec.a),this.data[ed+1]=Math.round(255*ec.g/ec.a),this.data[ed+2]=Math.round(255*ec.b/ec.a),this.data[ed+3]=Math.round(255*ec.a)}};function yl(en){let es={},ec=en.resolution||256,ed=en.clips?en.clips.length:1,ep=en.image||new dl({width:ec,height:ed});if(Math.log(ec)/Math.LN2%1!=0)throw Error(`width is not a power of 2 - ${ec}`);let s=(ed,ef,em)=>{es[en.evaluationKey]=em;let e_=en.expression.evaluate(es);ep.setPixel(ed/4/ec,ef/4,e_)};if(en.clips)for(let es=0,ep=0;es<ed;++es,ep+=4*ec)for(let ed=0,ef=0;ed<ec;ed++,ef+=4){let em=ed/(ec-1),{start:e_,end:eg}=en.clips[es];s(ep,ef,e_*(1-em)+eg*em)}else for(let en=0,es=0;en<ec;en++,es+=4)s(0,es,en/(ec-1));return ep}os("AlphaImage",fl),os("RGBAImage",dl);let iy="big-fb";let gl=class gl extends Gs{createBucket(en){return new ol(en)}constructor(en,es){super(en,ig,es),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(en){"heatmap-color"===en&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(iy)&&this.heatmapFbos.delete(iy)}queryRadius(en){return Yo("heatmap-radius",this,en)}queryIntersectsFeature({queryGeometry:en,feature:es,featureState:ec,geometry:ed,transform:ep,pixelsToTileUnits:ef,unwrappedTileID:em,getElevation:e_}){return el({queryGeometry:en,size:this.paint.get("heatmap-radius").evaluate(es,ec)*ef,transform:ep,unwrappedTileID:em,getElevation:e_},ed)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}};var ix={get paint(){return eg=eg||new Ns({"hillshade-illumination-direction":new Ls(eG.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ls(eG.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ls(eG.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ls(eG.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ls(eG.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ls(eG.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ls(eG.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ls(eG.paint_hillshade["hillshade-method"])})}};let bl=class bl extends Gs{constructor(en,es){super(en,ix,es),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let en=this.paint.get("hillshade-illumination-direction").values,es=this.paint.get("hillshade-illumination-altitude").values,ec=this.paint.get("hillshade-highlight-color").values,ed=this.paint.get("hillshade-shadow-color").values,ep=Math.max(en.length,es.length,ec.length,ed.length);en=en.concat(Array(ep-en.length).fill(en.at(-1))),es=es.concat(Array(ep-es.length).fill(es.at(-1))),ec=ec.concat(Array(ep-ec.length).fill(ec.at(-1))),ed=ed.concat(Array(ep-ed.length).fill(ed.at(-1)));let ef=es.map(tt);return{directionRadians:en.map(tt),altitudeRadians:ef,shadowColor:ed,highlightColor:ec}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}};var iv={get paint(){return ey=ey||new Ns({"color-relief-opacity":new Ls(eG["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new js(eG["paint_color-relief"]["color-relief-color"])})}};let Sl=class Sl{constructor(en,es,ec,ed){this.context=en,this.format=ec,this.texture=en.gl.createTexture(),this.update(es,ed)}update(en,es,ec){let{width:ed,height:ep}=en,ef=!(this.size&&this.size[0]===ed&&this.size[1]===ep||ec),{context:em}=this,{gl:e_}=em;if(this.useMipmap=!!(es&&es.useMipmap),e_.bindTexture(e_.TEXTURE_2D,this.texture),em.pixelStoreUnpackFlipY.set(!1),em.pixelStoreUnpack.set(1),em.pixelStoreUnpackPremultiplyAlpha.set(this.format===e_.RGBA&&(!es||!1!==es.premultiply)),ef)this.size=[ed,ep],en instanceof HTMLImageElement||en instanceof HTMLCanvasElement||en instanceof HTMLVideoElement||en instanceof ImageData||Y(en)?e_.texImage2D(e_.TEXTURE_2D,0,this.format,this.format,e_.UNSIGNED_BYTE,en):e_.texImage2D(e_.TEXTURE_2D,0,this.format,ed,ep,0,this.format,e_.UNSIGNED_BYTE,en.data);else{let{x:es,y:ef}=ec||{x:0,y:0};en instanceof HTMLImageElement||en instanceof HTMLCanvasElement||en instanceof HTMLVideoElement||en instanceof ImageData||Y(en)?e_.texSubImage2D(e_.TEXTURE_2D,0,es,ef,e_.RGBA,e_.UNSIGNED_BYTE,en):e_.texSubImage2D(e_.TEXTURE_2D,0,es,ef,ed,ep,e_.RGBA,e_.UNSIGNED_BYTE,en.data)}this.useMipmap&&this.isSizePowerOfTwo()&&e_.generateMipmap(e_.TEXTURE_2D),em.pixelStoreUnpackFlipY.setDefault(),em.pixelStoreUnpack.setDefault(),em.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(en,es,ec){let{context:ed}=this,{gl:ep}=ed;ep.bindTexture(ep.TEXTURE_2D,this.texture),ec!==ep.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(ec=ep.LINEAR),en!==this.filter&&(ep.texParameteri(ep.TEXTURE_2D,ep.TEXTURE_MAG_FILTER,en),ep.texParameteri(ep.TEXTURE_2D,ep.TEXTURE_MIN_FILTER,ec||en),this.filter=en),es!==this.wrap&&(ep.texParameteri(ep.TEXTURE_2D,ep.TEXTURE_WRAP_S,es),ep.texParameteri(ep.TEXTURE_2D,ep.TEXTURE_WRAP_T,es),this.wrap=es)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:en}=this.context;en.deleteTexture(this.texture),this.texture=null}};let Al=class Al{constructor(en,es,ec,ed=1,ep=1,ef=1,em=0){if(this.uid=en,es.height!==es.width)throw RangeError("DEM tiles must be square");if(ec&&!["mapbox","terrarium","custom"].includes(ec))return void q(`"${ec}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=es.height;let e_=this.dim=es.height-2;switch(this.data=new Uint32Array(es.data.buffer),ec){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=ed,this.greenFactor=ep,this.blueFactor=ef,this.baseShift=em;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let en=0;en<e_;en++)this.data[this._idx(-1,en)]=this.data[this._idx(0,en)],this.data[this._idx(e_,en)]=this.data[this._idx(e_-1,en)],this.data[this._idx(en,-1)]=this.data[this._idx(en,0)],this.data[this._idx(en,e_)]=this.data[this._idx(en,e_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(e_,-1)]=this.data[this._idx(e_-1,0)],this.data[this._idx(-1,e_)]=this.data[this._idx(0,e_-1)],this.data[this._idx(e_,e_)]=this.data[this._idx(e_-1,e_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let en=0;en<e_;en++)for(let es=0;es<e_;es++){let ec=this.get(en,es);ec>this.max&&(this.max=ec),ec<this.min&&(this.min=ec)}}get(en,es){let ec=new Uint8Array(this.data.buffer),ed=4*this._idx(en,es);return this.unpack(ec[ed],ec[ed+1],ec[ed+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(en,es){if(en<-1||en>=this.dim+1||es<-1||es>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(es+1)*this.stride+(en+1)}unpack(en,es,ec){return en*this.redFactor+es*this.greenFactor+ec*this.blueFactor-this.baseShift}pack(en){return kl(en,this.getUnpackVector())}getPixels(){return new dl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(en,es,ec){if(this.dim!==en.dim)throw Error("dem dimension mismatch");let ed=es*this.dim,ep=es*this.dim+this.dim,ef=ec*this.dim,em=ec*this.dim+this.dim;switch(es){case -1:ed=ep-1;break;case 1:ep=ed+1}switch(ec){case -1:ef=em-1;break;case 1:em=ef+1}let e_=-es*this.dim,eg=-ec*this.dim;for(let es=ef;es<em;es++)for(let ec=ed;ec<ep;ec++)this.data[this._idx(ec,es)]=en.data[this._idx(ec+e_,es+eg)]}};function kl(en,es){let ec=es[0],ed=es[1],ep=es[2],ef=es[3],em=Math.min(ec,ed,ep),e_=Math.round((en+ef)/em);return{r:Math.floor(e_*em/ec)%256,g:Math.floor(e_*em/ed)%256,b:Math.floor(e_*em/ep)%256}}os("DEMData",Al);let Ml=class Ml extends Gs{constructor(en,es){super(en,iv,es)}_createColorRamp(en){let es={elevationStops:[],colorStops:[]},ec=this._transitionablePaint._values["color-relief-color"].value.expression;if(ec instanceof ni&&ec._styleExpression.expression instanceof pr){this.colorRampExpression=ec;let en=ec._styleExpression.expression;for(let ec of(es.elevationStops=en.labels,es.colorStops=[],es.elevationStops))es.colorStops.push(en.evaluate({globals:{elevation:ec}}))}if(es.elevationStops.length<1&&(es.elevationStops=[0],es.colorStops=[Me.transparent]),es.elevationStops.length<2&&(es.elevationStops.push(es.elevationStops[0]+1),es.colorStops.push(es.colorStops[0])),es.elevationStops.length<=en)return es;let ed={elevationStops:[],colorStops:[]},ep=(es.elevationStops.length-1)/(en-1);for(let en=0;en<es.elevationStops.length-.5;en+=ep)ed.elevationStops.push(es.elevationStops[Math.round(en)]),ed.colorStops.push(es.colorStops[Math.round(en)]);return q(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),ed}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(en,es,ec){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let ed=this._createColorRamp(es),ep=new dl({width:ed.colorStops.length,height:1}),ef=new dl({width:ed.colorStops.length,height:1});for(let en=0;en<ed.elevationStops.length;en++){let es=kl(ed.elevationStops[en],ec);ef.setPixel(0,en,new Me(es.r/255,es.g/255,es.b/255,1)),ep.setPixel(0,en,ed.colorStops[en])}return this.colorRampTextures={elevationTexture:new Sl(en,ef,en.gl.RGBA),colorTexture:new Sl(en,ep,en.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}};let ib=Hs([{name:"a_pos",components:2,type:"Int16"}],4),{members:iw}=ib;function Pl(en,es,ec){let ed=ec.patternDependencies,ep=!1;for(let ec of es){let es=ec.paint.get(`${en}-pattern`);es.isConstant()||(ep=!0);let ef=es.constantOr(null);ef&&(ep=!0,ed[ef.to]=!0,ed[ef.from]=!0)}return ep}function Cl(en,es,ec,ed,ep){let{zoom:ef}=ed,em=ep.patternDependencies;for(let ed of es){let es=ed.paint.get(`${en}-pattern`).value;if("constant"!==es.kind){let en=es.evaluate({zoom:ef-1},ec,{},ep.availableImages),e_=es.evaluate({zoom:ef},ec,{},ep.availableImages),eg=es.evaluate({zoom:ef+1},ec,{},ep.availableImages);en=en&&en.name?en.name:en,e_=e_&&e_.name?e_.name:e_,eg=eg&&eg.name?eg.name:eg,em[en]=!0,em[e_]=!0,em[eg]=!0,ec.patterns[ed.id]={min:en,mid:e_,max:eg}}}return ec}function El(en,es,ec,ed,ep){let ef;if(ep===function(en,es,ec,ed){let ep=0;for(let ef=es,em=ec-ed;ef<ec;ef+=ed)ep+=(en[em]-en[ef])*(en[ef+1]+en[em+1]),em=ef;return ep}(en,es,ec,ed)>0)for(let ep=es;ep<ec;ep+=ed)ef=Ql(ep/ed|0,en[ep],en[ep+1],ef);else for(let ep=ec-ed;ep>=es;ep-=ed)ef=Ql(ep/ed|0,en[ep],en[ep+1],ef);return ef&&Zl(ef,ef.next)&&(tu(ef),ef=ef.next),ef}function Tl(en,es){if(!en)return en;es||(es=en);let ec,ed=en;do if(ec=!1,ed.steiner||!Zl(ed,ed.next)&&0!==Xl(ed.prev,ed,ed.next))ed=ed.next;else{if(tu(ed),(ed=es=ed.prev)===ed.next)break;ec=!0}while(ec||ed!==es);return es}function Ll(en,es){let ec=en.x-es.x;return 0===ec&&0==(ec=en.y-es.y)&&(ec=(en.next.y-en.y)/(en.next.x-en.x)-(es.next.y-es.y)/(es.next.x-es.x)),ec}function Ul(en,es,ec,ed,ep){return(en=1431655765&((en=858993459&((en=252645135&((en=16711935&((en=(en-ec)*ep|0)|en<<8))|en<<4))|en<<2))|en<<1))|(es=1431655765&((es=858993459&((es=252645135&((es=16711935&((es=(es-ed)*ep|0)|es<<8))|es<<4))|es<<2))|es<<1))<<1}function Nl(en,es,ec,ed,ep,ef,em,e_){return(ep-em)*(es-e_)>=(en-em)*(ef-e_)&&(en-em)*(ed-e_)>=(ec-em)*(es-e_)&&(ec-em)*(ef-e_)>=(ep-em)*(ed-e_)}function ql(en,es,ec,ed,ep,ef,em,e_){return!(en===em&&es===e_)&&Nl(en,es,ec,ed,ep,ef,em,e_)}function Xl(en,es,ec){return(es.y-en.y)*(ec.x-es.x)-(es.x-en.x)*(ec.y-es.y)}function Zl(en,es){return en.x===es.x&&en.y===es.y}function Yl(en,es,ec,ed){let ep=Kl(Xl(en,es,ec)),ef=Kl(Xl(en,es,ed)),em=Kl(Xl(ec,ed,en)),e_=Kl(Xl(ec,ed,es));return ep!==ef&&em!==e_||!(0!==ep||!Hl(en,ec,es))||!(0!==ef||!Hl(en,ed,es))||!(0!==em||!Hl(ec,en,ed))||!(0!==e_||!Hl(ec,es,ed))}function Hl(en,es,ec){return es.x<=Math.max(en.x,ec.x)&&es.x>=Math.min(en.x,ec.x)&&es.y<=Math.max(en.y,ec.y)&&es.y>=Math.min(en.y,ec.y)}function Kl(en){return en>0?1:en<0?-1:0}function Jl(en,es){return 0>Xl(en.prev,en,en.next)?Xl(en,es,en.next)>=0&&Xl(en,en.prev,es)>=0:0>Xl(en,es,en.prev)||0>Xl(en,en.next,es)}function Wl(en,es){let ec=eu(en.i,en.x,en.y),ed=eu(es.i,es.x,es.y),ep=en.next,ef=es.prev;return en.next=es,es.prev=en,ec.next=ep,ep.prev=ec,ed.next=ec,ec.prev=ed,ef.next=ed,ed.prev=ef,ed}function Ql(en,es,ec,ed){let ep=eu(en,es,ec);return ed?(ep.next=ed.next,ep.prev=ed,ed.next.prev=ep,ed.next=ep):(ep.prev=ep,ep.next=ep),ep}function tu(en){en.next.prev=en.prev,en.prev.next=en.next,en.prevZ&&(en.prevZ.nextZ=en.nextZ),en.nextZ&&(en.nextZ.prevZ=en.prevZ)}function eu(en,es,ec){return{i:en,x:es,y:ec,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}let ru=class ru{constructor(en,es){if(es>en)throw Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=en,this._minGranularity=es}getGranularityForZoomLevel(en){return Math.max(Math.floor(this._baseZoomGranularity/(1<<en)),this._minGranularity,1)}};let nu=class nu{constructor(en){this.fill=en.fill,this.line=en.line,this.tile=en.tile,this.stencil=en.stencil,this.circle=en.circle}};nu.noSubdivision=new nu({fill:new ru(0,0),line:new ru(0,0),tile:new ru(0,0),stencil:new ru(0,0),circle:1}),os("SubdivisionGranularityExpression",ru),os("SubdivisionGranularitySetting",nu);let au=class au{constructor(en,es){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=en,this._granularityCellSize=8192/en,this._canonical=es}_getKey(en,es){return(en+=32768)<<16|es+32768}_vertexToIndex(en,es){if(en<-32768||es<-32768||en>32767||es>32767)throw Error("Vertex coordinates are out of signed 16 bit integer range.");let ec=0|Math.round(en),ed=0|Math.round(es),ep=this._getKey(ec,ed);if(this._vertexDictionary.has(ep))return this._vertexDictionary.get(ep);let ef=this._vertexBuffer.length/2;return this._vertexDictionary.set(ep,ef),this._vertexBuffer.push(ec,ed),ef}_subdivideTrianglesScanline(en){if(this._granularity<2)return function(en,es){let ec=[];for(let ed=0;ed<es.length;ed+=3){let ep=es[ed],ef=es[ed+1],em=es[ed+2],e_=en[2*ep],eg=en[2*ep+1];(en[2*ef]-e_)*(en[2*em+1]-eg)-(en[2*ef+1]-eg)*(en[2*em]-e_)>0?(ec.push(ep),ec.push(em),ec.push(ef)):(ec.push(ep),ec.push(ef),ec.push(em))}return ec}(this._vertexBuffer,en);let es=[],ec=en.length;for(let ed=0;ed<ec;ed+=3){let ec=[en[ed+0],en[ed+1],en[ed+2]],ep=[this._vertexBuffer[2*en[ed+0]+0],this._vertexBuffer[2*en[ed+0]+1],this._vertexBuffer[2*en[ed+1]+0],this._vertexBuffer[2*en[ed+1]+1],this._vertexBuffer[2*en[ed+2]+0],this._vertexBuffer[2*en[ed+2]+1]],ef=1/0,em=1/0,e_=-1/0,eg=-1/0;for(let en=0;en<3;en++){let es=ep[2*en],ec=ep[2*en+1];ef=Math.min(ef,es),e_=Math.max(e_,es),em=Math.min(em,ec),eg=Math.max(eg,ec)}if(ef===e_||em===eg)continue;let ey=Math.floor(ef/this._granularityCellSize),ex=Math.ceil(e_/this._granularityCellSize),ev=Math.floor(em/this._granularityCellSize),eb=Math.ceil(eg/this._granularityCellSize);if(ey!==ex||ev!==eb)for(let en=ev;en<eb;en++){let ed=this._scanlineGenerateVertexRingForCellRow(en,ep,ec);(function(en,es,ec){if(0===es.length)throw Error("Subdivision vertex ring is empty.");let ed=0,ep=en[2*es[0]];for(let ec=1;ec<es.length;ec++){let ef=en[2*es[ec]];ef<ep&&(ep=ef,ed=ec)}let ef=es.length,em=ed,e_=(em+1)%ef;for(;;){let ed=em-1>=0?em-1:ef-1,ep=(e_+1)%ef,eg=en[2*es[ed]],ey=en[2*es[ep]],ex=en[2*es[em]],ev=en[2*es[em]+1],eb=en[2*es[e_]+1],ew=!1;if(eg<ey)ew=!0;else if(eg>ey)ew=!1;else{let ec=eb-ev,ef=-(en[2*es[e_]]-ex),em=ev<eb?1:-1;((eg-ex)*ec+(en[2*es[ed]+1]-ev)*ef)*em>((ey-ex)*ec+(en[2*es[ep]+1]-ev)*ef)*em&&(ew=!0)}if(ew){let en=es[ed],ep=es[em],eg=es[e_];en!==ep&&en!==eg&&ep!==eg&&ec.push(eg,ep,en),--em<0&&(em=ef-1)}else{let en=es[ep],ed=es[em],eg=es[e_];en!==ed&&en!==eg&&ed!==eg&&ec.push(eg,ed,en),++e_>=ef&&(e_=0)}if(ed===ep)break}})(this._vertexBuffer,ed,es)}else es.push(...ec)}return es}_scanlineGenerateVertexRingForCellRow(en,es,ec){let ed=en*this._granularityCellSize,ep=ed+this._granularityCellSize,ef=[];for(let en=0;en<3;en++){let em=es[2*en],e_=es[2*en+1],eg=es[2*(en+1)%6],ey=es[(2*(en+1)+1)%6],ex=es[2*(en+2)%6],ev=es[(2*(en+2)+1)%6],eb=eg-em,ew=ey-e_,eT=0===eb,eP=0===ew,eS=(ed-e_)/ew,eM=(ep-e_)/ew,eC=Math.min(eS,eM),eI=Math.max(eS,eM);if(!eP&&(eC>=1||eI<=0)||eP&&(e_<ed||e_>ep)){ey>=ed&&ey<=ep&&ef.push(ec[(en+1)%3]);continue}!eP&&eC>0&&ef.push(this._vertexToIndex(em+eb*eC,e_+ew*eC));let eE=em+eb*Math.max(eC,0),eA=em+eb*Math.min(eI,1);eT||this._generateIntraEdgeVertices(ef,em,e_,eg,ey,eE,eA),!eP&&eI<1&&ef.push(this._vertexToIndex(em+eb*eI,e_+ew*eI)),(eP||ey>=ed&&ey<=ep)&&ef.push(ec[(en+1)%3]),!eP&&(ey<=ed||ey>=ep)&&this._generateInterEdgeVertices(ef,em,e_,eg,ey,ex,ev,eA,ed,ep)}return ef}_generateIntraEdgeVertices(en,es,ec,ed,ep,ef,em){let e_=ed-es,eg=ep-ec,ey=0===eg,ex=ey?Math.min(es,ed):Math.min(ef,em),ev=ey?Math.max(es,ed):Math.max(ef,em),eb=Math.floor(ex/this._granularityCellSize)+1,ew=Math.ceil(ev/this._granularityCellSize)-1;if(ey?es<ed:ef<em)for(let ed=eb;ed<=ew;ed++){let ep=ed*this._granularityCellSize;en.push(this._vertexToIndex(ep,ec+eg*(ep-es)/e_))}else for(let ed=ew;ed>=eb;ed--){let ep=ed*this._granularityCellSize;en.push(this._vertexToIndex(ep,ec+eg*(ep-es)/e_))}}_generateInterEdgeVertices(en,es,ec,ed,ep,ef,em,e_,eg,ey){let ex=em-ep,ev=(eg-ep)/ex,eb=(ey-ep)/ex,ew=Math.min(ev,eb),eT=ed+(ef-ed)*ew,eP=Math.floor(Math.min(eT,e_)/this._granularityCellSize)+1,eS=Math.ceil(Math.max(eT,e_)/this._granularityCellSize)-1,eM=e_<eT,eC=0===ex;if(eC&&(em===eg||em===ey))return;if(eC||ew>=1||0>=Math.max(ev,eb)){let en=ec-em,ed=ef+(es-ef)*Math.min((eg-em)/en,(ey-em)/en);eP=Math.floor(Math.min(ed,e_)/this._granularityCellSize)+1,eS=Math.ceil(Math.max(ed,e_)/this._granularityCellSize)-1,eM=e_<ed}let eI=ep-ec>0?ey:eg;if(eM)for(let es=eP;es<=eS;es++)en.push(this._vertexToIndex(es*this._granularityCellSize,eI));else for(let es=eS;es>=eP;es--)en.push(this._vertexToIndex(es*this._granularityCellSize,eI))}_generateOutline(en){let es=[];for(let ec of en){let en=lu(ec,this._granularity,!0),ed=this._pointArrayToIndices(en),ep=[];for(let en=1;en<ed.length;en++)ep.push(ed[en-1]),ep.push(ed[en]);es.push(ep)}return es}_handlePoles(en){let es=!1,ec=!1;this._canonical&&(0===this._canonical.y&&(es=!0),this._canonical.y===(1<<this._canonical.z)-1&&(ec=!0)),(es||ec)&&this._fillPoles(en,es,ec)}_ensureNoPoleVertices(){let en=this._vertexBuffer;for(let es=0;es<en.length;es+=2){let ec=en[es+1];-32768===ec&&(en[es+1]=-32767),32767===ec&&(en[es+1]=32766)}}_generatePoleQuad(en,es,ec,ed,ep,ef){ed>ep!=(-32768===ef)?(en.push(es),en.push(ec),en.push(this._vertexToIndex(ed,ef)),en.push(ec),en.push(this._vertexToIndex(ep,ef))):(en.push(ec),en.push(es),en.push(this._vertexToIndex(ed,ef)),en.push(this._vertexToIndex(ep,ef)),en.push(ec)),en.push(this._vertexToIndex(ed,ef))}_fillPoles(en,es,ec){let ed=this._vertexBuffer,ep=en.length;for(let ef=2;ef<ep;ef+=3){let ep=en[ef-2],em=en[ef-1],e_=en[ef],eg=ed[2*ep],ey=ed[2*ep+1],ex=ed[2*em],ev=ed[2*em+1],eb=ed[2*e_],ew=ed[2*e_+1];es&&(0===ey&&0===ev&&this._generatePoleQuad(en,ep,em,eg,ex,-32768),0===ev&&0===ew&&this._generatePoleQuad(en,em,e_,ex,eb,-32768),0===ew&&0===ey&&this._generatePoleQuad(en,e_,ep,eb,eg,-32768)),ec&&(8192===ey&&8192===ev&&this._generatePoleQuad(en,ep,em,eg,ex,32767),8192===ev&&8192===ew&&this._generatePoleQuad(en,em,e_,ex,eb,32767),8192===ew&&8192===ey&&this._generatePoleQuad(en,e_,ep,eb,eg,32767))}}_initializeVertices(en){for(let es=0;es<en.length;es+=2)this._vertexToIndex(en[es],en[es+1])}subdividePolygonInternal(en,es){let ec;if(this._used)throw Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:ed,holeIndices:ep}=function(en){let es=[],ec=[];for(let ed of en)if(0!==ed.length){ed!==en[0]&&es.push(ec.length/2);for(let en=0;en<ed.length;en++)ec.push(ed[en].x),ec.push(ed[en].y)}return{flattened:ec,holeIndices:es}}(en);this._initializeVertices(ed);try{let en=function(en,es,ec=2){let ed,ep,ef;let em=es&&es.length,e_=em?es[0]*ec:en.length,eg=El(en,0,e_,ec,!0),ey=[];if(!eg||eg.next===eg.prev)return ey;if(em&&(eg=function(en,es,ec,ed){let ep=[];for(let ec=0,ef=es.length;ec<ef;ec++){let em=El(en,es[ec]*ed,ec<ef-1?es[ec+1]*ed:en.length,ed,!1);em===em.next&&(em.steiner=!0),ep.push(function(en){let es=en,ec=en;do(es.x<ec.x||es.x===ec.x&&es.y<ec.y)&&(ec=es),es=es.next;while(es!==en);return ec}(em))}ep.sort(Ll);for(let en=0;en<ep.length;en++)ec=function(en,es){let ec=function(en,es){let ec=es,ed=en.x,ep=en.y,ef,em=-1/0;if(Zl(en,ec))return ec;do{if(Zl(en,ec.next))return ec.next;if(ep<=ec.y&&ep>=ec.next.y&&ec.next.y!==ec.y){let en=ec.x+(ep-ec.y)*(ec.next.x-ec.x)/(ec.next.y-ec.y);if(en<=ed&&en>em&&(em=en,ef=ec.x<ec.next.x?ec:ec.next,en===ed))return ef}ec=ec.next}while(ec!==es);if(!ef)return null;let e_=ef,eg=ef.x,ey=ef.y,ex=1/0;ec=ef;do{if(ed>=ec.x&&ec.x>=eg&&ed!==ec.x&&Nl(ep<ey?ed:em,ep,eg,ey,ep<ey?em:ed,ep,ec.x,ec.y)){var ev,eb;let es=Math.abs(ep-ec.y)/(ed-ec.x);Jl(ec,en)&&(es<ex||es===ex&&(ec.x>ef.x||ec.x===ef.x&&(ev=ef,eb=ec,0>Xl(ev.prev,ev,eb.prev)&&0>Xl(eb.next,ev,ev.next))))&&(ef=ec,ex=es)}ec=ec.next}while(ec!==e_);return ef}(en,es);if(!ec)return es;let ed=Wl(ec,en);return Tl(ed,ed.next),Tl(ec,ec.next)}(ep[en],ec);return ec}(en,es,eg,ec)),en.length>80*ec){ed=en[0],ep=en[1];let es=ed,em=ep;for(let ef=ec;ef<e_;ef+=ec){let ec=en[ef],e_=en[ef+1];ec<ed&&(ed=ec),e_<ep&&(ep=e_),ec>es&&(es=ec),e_>em&&(em=e_)}ef=Math.max(es-ed,em-ep),ef=0!==ef?32767/ef:0}return function Bl(en,es,ec,ed,ep,ef,em){if(!en)return;!em&&ef&&function(en,es,ec,ed){let ep=en;do 0===ep.z&&(ep.z=Ul(ep.x,ep.y,es,ec,ed)),ep.prevZ=ep.prev,ep.nextZ=ep.next,ep=ep.next;while(ep!==en);ep.prevZ.nextZ=null,ep.prevZ=null,function(en){let es,ec=1;do{let ed,ep=en;en=null;let ef=null;for(es=0;ep;){es++;let em=ep,e_=0;for(let en=0;en<ec&&(e_++,em=em.nextZ);en++);let eg=ec;for(;e_>0||eg>0&&em;)0!==e_&&(0===eg||!em||ep.z<=em.z)?(ed=ep,ep=ep.nextZ,e_--):(ed=em,em=em.nextZ,eg--),ef?ef.nextZ=ed:en=ed,ed.prevZ=ef,ef=ed;ep=em}ef.nextZ=null,ec*=2}while(es>1)}(ep)}(en,ed,ep,ef);let e_=en;for(;en.prev!==en.next;){let eg=en.prev,ey=en.next;if(ef?function(en,es,ec,ed){let ep=en.prev,ef=en.next;if(Xl(ep,en,ef)>=0)return!1;let em=ep.x,e_=en.x,eg=ef.x,ey=ep.y,ex=en.y,ev=ef.y,eb=Math.min(em,e_,eg),ew=Math.min(ey,ex,ev),eT=Math.max(em,e_,eg),eP=Math.max(ey,ex,ev),eS=Ul(eb,ew,es,ec,ed),eM=Ul(eT,eP,es,ec,ed),eC=en.prevZ,eI=en.nextZ;for(;eC&&eC.z>=eS&&eI&&eI.z<=eM;){if(eC.x>=eb&&eC.x<=eT&&eC.y>=ew&&eC.y<=eP&&eC!==ep&&eC!==ef&&ql(em,ey,e_,ex,eg,ev,eC.x,eC.y)&&Xl(eC.prev,eC,eC.next)>=0||(eC=eC.prevZ,eI.x>=eb&&eI.x<=eT&&eI.y>=ew&&eI.y<=eP&&eI!==ep&&eI!==ef&&ql(em,ey,e_,ex,eg,ev,eI.x,eI.y)&&Xl(eI.prev,eI,eI.next)>=0))return!1;eI=eI.nextZ}for(;eC&&eC.z>=eS;){if(eC.x>=eb&&eC.x<=eT&&eC.y>=ew&&eC.y<=eP&&eC!==ep&&eC!==ef&&ql(em,ey,e_,ex,eg,ev,eC.x,eC.y)&&Xl(eC.prev,eC,eC.next)>=0)return!1;eC=eC.prevZ}for(;eI&&eI.z<=eM;){if(eI.x>=eb&&eI.x<=eT&&eI.y>=ew&&eI.y<=eP&&eI!==ep&&eI!==ef&&ql(em,ey,e_,ex,eg,ev,eI.x,eI.y)&&Xl(eI.prev,eI,eI.next)>=0)return!1;eI=eI.nextZ}return!0}(en,ed,ep,ef):function(en){let es=en.prev,ec=en.next;if(Xl(es,en,ec)>=0)return!1;let ed=es.x,ep=en.x,ef=ec.x,em=es.y,e_=en.y,eg=ec.y,ey=Math.min(ed,ep,ef),ex=Math.min(em,e_,eg),ev=Math.max(ed,ep,ef),eb=Math.max(em,e_,eg),ew=ec.next;for(;ew!==es;){if(ew.x>=ey&&ew.x<=ev&&ew.y>=ex&&ew.y<=eb&&ql(ed,em,ep,e_,ef,eg,ew.x,ew.y)&&Xl(ew.prev,ew,ew.next)>=0)return!1;ew=ew.next}return!0}(en))es.push(eg.i,en.i,ey.i),tu(en),en=ey.next,e_=ey.next;else if((en=ey)===e_){em?1===em?Bl(en=function(en,es){let ec=en;do{let ed=ec.prev,ep=ec.next.next;!Zl(ed,ep)&&Yl(ed,ec,ec.next,ep)&&Jl(ed,ep)&&Jl(ep,ed)&&(es.push(ed.i,ec.i,ep.i),tu(ec),tu(ec.next),ec=en=ep),ec=ec.next}while(ec!==en);return Tl(ec)}(Tl(en),es),es,ec,ed,ep,ef,2):2===em&&function(en,es,ec,ed,ep,ef){let em=en;do{let en=em.next.next;for(;en!==em.prev;){var e_,eg;if(em.i!==en.i&&(e_=em,eg=en,e_.next.i!==eg.i&&e_.prev.i!==eg.i&&!function(en,es){let ec=en;do{if(ec.i!==en.i&&ec.next.i!==en.i&&ec.i!==es.i&&ec.next.i!==es.i&&Yl(ec,ec.next,en,es))return!0;ec=ec.next}while(ec!==en);return!1}(e_,eg)&&(Jl(e_,eg)&&Jl(eg,e_)&&function(en,es){let ec=en,ed=!1,ep=(en.x+es.x)/2,ef=(en.y+es.y)/2;do ec.y>ef!=ec.next.y>ef&&ec.next.y!==ec.y&&ep<(ec.next.x-ec.x)*(ef-ec.y)/(ec.next.y-ec.y)+ec.x&&(ed=!ed),ec=ec.next;while(ec!==en);return ed}(e_,eg)&&(Xl(e_.prev,e_,eg.prev)||Xl(e_,eg.prev,eg))||Zl(e_,eg)&&Xl(e_.prev,e_,e_.next)>0&&Xl(eg.prev,eg,eg.next)>0))){let e_=Wl(em,en);return em=Tl(em,em.next),e_=Tl(e_,e_.next),Bl(em,es,ec,ed,ep,ef,0),void Bl(e_,es,ec,ed,ep,ef,0)}en=en.next}em=em.next}while(em!==en)}(en,es,ec,ed,ep,ef):Bl(Tl(en),es,ec,ed,ep,ef,1);break}}}(eg,ey,ec,ed,ep,ef,0),ey}(ed,ep),es=this._convertIndices(ed,en);ec=this._subdivideTrianglesScanline(es)}catch(en){console.error(en)}let ef=[];return es&&(ef=this._generateOutline(en)),this._ensureNoPoleVertices(),this._handlePoles(ec),{verticesFlattened:this._vertexBuffer,indicesTriangles:ec,indicesLineList:ef}}_convertIndices(en,es){let ec=[];for(let ed=0;ed<es.length;ed++)ec.push(this._vertexToIndex(en[2*es[ed]],en[2*es[ed]+1]));return ec}_pointArrayToIndices(en){let es=[];for(let ec=0;ec<en.length;ec++){let ed=en[ec];es.push(this._vertexToIndex(ed.x,ed.y))}return es}};function ou(en,es,ec,ed=!0){return new au(ec,es).subdividePolygonInternal(en,ed)}function lu(en,es,ec=!1){if(!en||en.length<1||en.length<2)return[];let ed=en[0],ep=en[en.length-1],ef=ec&&(ed.x!==ep.x||ed.y!==ep.y);if(es<2)return ef?[...en,en[0]]:[...en];let em=Math.floor(8192/es),e_=[];e_.push(new r(en[0].x,en[0].y));let eg=en.length,ey=ef?eg:eg-1;for(let es=0;es<ey;es++){let ec=en[es],ed=es<eg-1?en[es+1]:en[0],ep=ec.x,ef=ec.y,ey=ed.x,ex=ed.y,ev=ep!==ey,eb=ef!==ex;if(!ev&&!eb)continue;let ew=ey-ep,eT=ex-ef,eP=Math.abs(ew),eS=Math.abs(eT),eM=ep,eC=ef;for(;;){let en=ew>0?(Math.floor(eM/em)+1)*em:(Math.ceil(eM/em)-1)*em,es=eT>0?(Math.floor(eC/em)+1)*em:(Math.ceil(eC/em)-1)*em,ec=Math.abs(eM-en),ed=Math.abs(eC-es),ep=Math.abs(eM-ey),ef=Math.abs(eC-ex),eg=ev?ec/eP:Number.POSITIVE_INFINITY,eI=eb?ed/eS:Number.POSITIVE_INFINITY;if((ep<=ec||!ev)&&(ef<=ed||!eb))break;if(eg<eI&&ev||!eb){eM=en,eC+=eT*eg;let es=new r(eM,Math.round(eC));e_[e_.length-1].x===es.x&&e_[e_.length-1].y===es.y||e_.push(es)}else{eM+=ew*eI,eC=es;let en=new r(Math.round(eM),eC);e_[e_.length-1].x===en.x&&e_[e_.length-1].y===en.y||e_.push(en)}}let eI=new r(ey,ex);e_[e_.length-1].x===eI.x&&e_[e_.length-1].y===eI.y||e_.push(eI)}return e_}function cu(en,es,ec,ed,ep,ef,em,e_,eg){let ey=ep.length/2,ex=em&&e_&&eg;if(ey<Ka.MAX_VERTEX_ARRAY_LENGTH){let ev,eb;let ew=es.prepareSegment(ey,ec,ed),eT=ew.vertexLength;for(let en=0;en<ef.length;en+=3)ed.emplaceBack(eT+ef[en],eT+ef[en+1],eT+ef[en+2]);ew.vertexLength+=ey,ew.primitiveLength+=ef.length/3,ex&&(ev=(eb=em.prepareSegment(ey,ec,e_)).vertexLength,eb.vertexLength+=ey);for(let es=0;es<ep.length;es+=2)en(ep[es],ep[es+1]);if(ex)for(let en=0;en<eg.length;en++){let es=eg[en];for(let en=1;en<es.length;en+=2)e_.emplaceBack(ev+es[en-1],ev+es[en]);eb.primitiveLength+=es.length/2}}else(function(en,es,ec,ed,ep,ef){let em=[];for(let en=0;en<ed.length/2;en++)em.push(-1);let e_={count:0},eg=0,ey=en.getOrCreateLatestSegment(es,ec),ex=ey.vertexLength;for(let ev=2;ev<ep.length;ev+=3){let eb=ep[ev-2],ew=ep[ev-1],eT=ep[ev],eP=em[eb]<eg,eS=em[ew]<eg,eM=em[eT]<eg;ey.vertexLength+((eP?1:0)+(eS?1:0)+(eM?1:0))>Ka.MAX_VERTEX_ARRAY_LENGTH&&(ey=en.createNewSegment(es,ec),eg=e_.count,eP=!0,eS=!0,eM=!0,ex=0);let eC=hu(em,ed,ef,e_,eb,eP,ey),eI=hu(em,ed,ef,e_,ew,eS,ey),eE=hu(em,ed,ef,e_,eT,eM,ey);ec.emplaceBack(ex+eC-eg,ex+eI-eg,ex+eE-eg),ey.primitiveLength++}})(es,ec,ed,ep,ef,en),ex&&function(en,es,ec,ed,ep,ef){let em=[];for(let en=0;en<ed.length/2;en++)em.push(-1);let e_={count:0},eg=0,ey=en.getOrCreateLatestSegment(es,ec),ex=ey.vertexLength;for(let ev=0;ev<ep.length;ev++){let eb=ep[ev];for(let ew=1;ew<ep[ev].length;ew+=2){let ep=eb[ew-1],ev=eb[ew],eT=em[ep]<eg,eP=em[ev]<eg;ey.vertexLength+((eT?1:0)+(eP?1:0))>Ka.MAX_VERTEX_ARRAY_LENGTH&&(ey=en.createNewSegment(es,ec),eg=e_.count,eT=!0,eP=!0,ex=0);let eS=hu(em,ed,ef,e_,ep,eT,ey),eM=hu(em,ed,ef,e_,ev,eP,ey);ec.emplaceBack(ex+eS-eg,ex+eM-eg),ey.primitiveLength++}}}(em,ec,e_,ep,eg,en),es.forceNewSegmentOnNextPrepare(),null==em||em.forceNewSegmentOnNextPrepare()}function hu(en,es,ec,ed,ep,ef,em){if(ef){let ef=ed.count;return ec(es[2*ep],es[2*ep+1]),en[ep]=ed.count,ed.count++,em.vertexLength++,ef}return en[ep]}let pu=class pu{constructor(en){this.zoom=en.zoom,this.overscaling=en.overscaling,this.layers=en.layers,this.layerIds=this.layers.map(en=>en.id),this.index=en.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Fa,this.indexArray=new Xa,this.indexArray2=new Za,this.programConfigurations=new Io(en.layers,en.zoom),this.segments=new Ka,this.segments2=new Ka,this.stateDependentLayerIds=this.layers.filter(en=>en.isStateDependent()).map(en=>en.id)}populate(en,es,ec){this.hasDependencies=Pl("fill",this.layers,es);let ed=this.layers[0].layout.get("fill-sort-key"),ep=!ed.isConstant(),ef=[];for(let{feature:em,id:e_,index:eg,sourceLayerIndex:ey}of en){let en=this.layers[0]._featureFilter.needGeometry,ex=Bo(em,en);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom),ex,ec))continue;let ev=ep?ed.evaluate(ex,{},ec,es.availableImages):void 0,eb={id:e_,properties:em.properties,type:em.type,sourceLayerIndex:ey,index:eg,geometry:en?ex.geometry:To(em),patterns:{},sortKey:ev};ef.push(eb)}for(let ed of(ep&&ef.sort((en,es)=>en.sortKey-es.sortKey),ef)){let{geometry:ep,index:ef,sourceLayerIndex:em}=ed;if(this.hasDependencies){let en=Cl("fill",this.layers,ed,{zoom:this.zoom},es);this.patternFeatures.push(en)}else this.addFeature(ed,ep,ef,ec,{},es.subdivisionGranularity);es.featureIndex.insert(en[ef].feature,ep,ef,em,this.index)}}update(en,es,ec){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(en,es,this.stateDependentLayers,{imagePositions:ec})}addFeatures(en,es,ec){for(let ed of this.patternFeatures)this.addFeature(ed,ed.geometry,ed.index,es,ec,en.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(en){this.uploaded||(this.layoutVertexBuffer=en.createVertexBuffer(this.layoutVertexArray,iw),this.indexBuffer=en.createIndexBuffer(this.indexArray),this.indexBuffer2=en.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(en),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(en,es,ec,ed,ep,ef){for(let en of Qr(es,500)){let es=ou(en,ed,ef.fill.getGranularityForZoomLevel(ed.z)),ec=this.layoutVertexArray;cu((en,es)=>{ec.emplaceBack(en,es)},this.segments,this.layoutVertexArray,this.indexArray,es.verticesFlattened,es.indicesTriangles,this.segments2,this.indexArray2,es.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,en,ec,{imagePositions:ep,canonical:ed})}};os("FillBucket",pu,{omit:["layers","patternFeatures"]});var iT={get paint(){return ev=ev||new Ns({"fill-antialias":new Ls(eG.paint_fill["fill-antialias"]),"fill-opacity":new Os(eG.paint_fill["fill-opacity"]),"fill-color":new Os(eG.paint_fill["fill-color"]),"fill-outline-color":new Os(eG.paint_fill["fill-outline-color"]),"fill-translate":new Ls(eG.paint_fill["fill-translate"]),"fill-translate-anchor":new Ls(eG.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rs(eG.paint_fill["fill-pattern"])})},get layout(){return ex=ex||new Ns({"fill-sort-key":new Os(eG.layout_fill["fill-sort-key"])})}};let mu=class mu extends Gs{constructor(en,es){super(en,iT,es)}recalculate(en,es){super.recalculate(en,es);let ec=this.paint._values["fill-outline-color"];"constant"===ec.value.kind&&void 0===ec.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(en){return new pu(en)}queryRadius(){return Ho(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:en,geometry:es,transform:ec,pixelsToTileUnits:ed}){return Oo(Ko(en,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-ec.bearingInRadians,ed),es)}isTileClipped(){return!0}};let iP=Hs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),iS=Hs([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iM}=iP;let bu=class bu{constructor(en,es,ec,ed,ep){this.properties={},this.extent=ec,this.type=0,this.id=void 0,this._pbf=en,this._geometry=-1,this._keys=ed,this._values=ep,en.readFields(wu,this,es)}loadGeometry(){let en=this._pbf;en.pos=this._geometry;let es=en.readVarint()+en.pos,ec=[],ed,ep=1,ef=0,em=0,e_=0;for(;en.pos<es;){if(ef<=0){let es=en.readVarint();ep=7&es,ef=es>>3}if(ef--,1===ep||2===ep)em+=en.readSVarint(),e_+=en.readSVarint(),1===ep&&(ed&&ec.push(ed),ed=[]),ed&&ed.push(new r(em,e_));else{if(7!==ep)throw Error(`unknown command ${ep}`);ed&&ed.push(ed[0].clone())}}return ed&&ec.push(ed),ec}bbox(){let en=this._pbf;en.pos=this._geometry;let es=en.readVarint()+en.pos,ec=1,ed=0,ep=0,ef=0,em=1/0,e_=-1/0,eg=1/0,ey=-1/0;for(;en.pos<es;){if(ed<=0){let es=en.readVarint();ec=7&es,ed=es>>3}if(ed--,1===ec||2===ec)ep+=en.readSVarint(),ef+=en.readSVarint(),ep<em&&(em=ep),ep>e_&&(e_=ep),ef<eg&&(eg=ef),ef>ey&&(ey=ef);else if(7!==ec)throw Error(`unknown command ${ec}`)}return[em,eg,e_,ey]}toGeoJSON(en,es,ec){let ed;let ep=this.extent*Math.pow(2,ec),ef=this.extent*en,em=this.extent*es,e_=this.loadGeometry();function o(en){return[360*(en.x+ef)/ep-180,360/Math.PI*Math.atan(Math.exp((1-2*(en.y+em)/ep)*Math.PI))-90]}function l(en){return en.map(o)}if(1===this.type){let en=[];for(let es of e_)en.push(es[0]);let es=l(en);ed=1===en.length?{type:"Point",coordinates:es[0]}:{type:"MultiPoint",coordinates:es}}else if(2===this.type){let en=e_.map(l);ed=1===en.length?{type:"LineString",coordinates:en[0]}:{type:"MultiLineString",coordinates:en}}else{if(3!==this.type)throw Error("unknown feature type");{let en=function(en){let es,ec;let ed=en.length;if(ed<=1)return[en];let ep=[];for(let ef=0;ef<ed;ef++){let ed=function(en){let es=0;for(let ec,ed,ep=0,ef=en.length,em=ef-1;ep<ef;em=ep++)ec=en[ep],es+=((ed=en[em]).x-ec.x)*(ec.y+ed.y);return es}(en[ef]);0!==ed&&(void 0===ec&&(ec=ed<0),ec===ed<0?(es&&ep.push(es),es=[en[ef]]):es&&es.push(en[ef]))}return es&&ep.push(es),ep}(e_),es=[];for(let ec of en)es.push(ec.map(l));ed=1===es.length?{type:"Polygon",coordinates:es[0]}:{type:"MultiPolygon",coordinates:es}}}let eg={type:"Feature",geometry:ed,properties:this.properties};return null!=this.id&&(eg.id=this.id),eg}};function wu(en,es,ec){1===en?es.id=ec.readVarint():2===en?function(en,es){let ec=en.readVarint()+en.pos;for(;en.pos<ec;){let ec=es._keys[en.readVarint()],ed=es._values[en.readVarint()];es.properties[ec]=ed}}(ec,es):3===en?es.type=ec.readVarint():4===en&&(es._geometry=ec.pos)}bu.types=["Unknown","Point","LineString","Polygon"];let Su=class Su{constructor(en,es){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=en,this._keys=[],this._values=[],this._features=[],en.readFields(Au,this,es),this.length=this._features.length}feature(en){if(en<0||en>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[en];let es=this._pbf.readVarint()+this._pbf.pos;return new bu(this._pbf,es,this.extent,this._keys,this._values)}};function Au(en,es,ec){15===en?es.version=ec.readVarint():1===en?es.name=ec.readString():5===en?es.extent=ec.readVarint():2===en?es._features.push(ec.pos):3===en?es._keys.push(ec.readString()):4===en&&es._values.push(function(en){let es=null,ec=en.readVarint()+en.pos;for(;en.pos<ec;){let ec=en.readVarint()>>3;es=1===ec?en.readString():2===ec?en.readFloat():3===ec?en.readDouble():4===ec?en.readVarint64():5===ec?en.readVarint():6===ec?en.readSVarint():7===ec?en.readBoolean():null}if(null==es)throw Error("unknown feature value");return es}(ec))}let ku=class ku{constructor(en,es){this.layers=en.readFields(Mu,{},es)}};function Mu(en,es,ec){if(3===en){let en=new Su(ec,ec.readVarint()+ec.pos);en.length&&(es[en.name]=en)}}function zu(en,es,ec,ed,ep,ef,em,e_){en.emplaceBack(es,ec,2*Math.floor(8192*ed)+em,16384*ep,16384*ef,Math.round(e_))}let Pu=class Pu{constructor(en){this.zoom=en.zoom,this.overscaling=en.overscaling,this.layers=en.layers,this.layerIds=this.layers.map(en=>en.id),this.index=en.index,this.hasDependencies=!1,this.layoutVertexArray=new Da,this.centroidVertexArray=new Ba,this.indexArray=new Xa,this.programConfigurations=new Io(en.layers,en.zoom),this.segments=new Ka,this.stateDependentLayerIds=this.layers.filter(en=>en.isStateDependent()).map(en=>en.id)}populate(en,es,ec){for(let{feature:ed,id:ep,index:ef,sourceLayerIndex:em}of(this.features=[],this.hasDependencies=Pl("fill-extrusion",this.layers,es),en)){let en=this.layers[0]._featureFilter.needGeometry,e_=Bo(ed,en);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom),e_,ec))continue;let eg={id:ep,sourceLayerIndex:em,index:ef,geometry:en?e_.geometry:To(ed),properties:ed.properties,type:ed.type,patterns:{}};this.hasDependencies?this.features.push(Cl("fill-extrusion",this.layers,eg,{zoom:this.zoom},es)):this.addFeature(eg,eg.geometry,ef,ec,{},es.subdivisionGranularity),es.featureIndex.insert(ed,eg.geometry,ef,em,this.index,!0)}}addFeatures(en,es,ec){for(let ed of this.features){let{geometry:ep}=ed;this.addFeature(ed,ep,ed.index,es,ec,en.subdivisionGranularity)}}update(en,es,ec){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(en,es,this.stateDependentLayers,{imagePositions:ec})}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(en){this.uploaded||(this.layoutVertexBuffer=en.createVertexBuffer(this.layoutVertexArray,iM),this.centroidVertexBuffer=en.createVertexBuffer(this.centroidVertexArray,iS.members,!0),this.indexBuffer=en.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(en),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(en,es,ec,ed,ep,ef){for(let ec of Qr(es,500)){let es={x:0,y:0,sampleCount:0},ep=this.layoutVertexArray.length;this.processPolygon(es,ed,en,ec,ef);let em=this.layoutVertexArray.length-ep,e_=Math.floor(es.x/es.sampleCount),eg=Math.floor(es.y/es.sampleCount);for(let en=0;en<em;en++)this.centroidVertexArray.emplaceBack(e_,eg)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,en,ec,{imagePositions:ep,canonical:ed})}processPolygon(en,es,ec,ed,ep){if(ed.length<1||Tu(ed[0]))return;for(let es of ed)0!==es.length&&function(en,es){for(let ec=0;ec<es.length;ec++){let ed=es[ec];ec===es.length-1&&es[0].x===ed.x&&es[0].y===ed.y||(en.x+=ed.x,en.y+=ed.y,en.sampleCount++)}}(en,es);let ef={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},em=ep.fill.getGranularityForZoomLevel(es.z),e_="Polygon"===bu.types[ec.type];for(let en of ed){if(0===en.length||Tu(en))continue;let es=lu(en,em,e_);this._generateSideFaces(es,ef)}if(!e_)return;let eg=ou(ed,es,em,!1),ey=this.layoutVertexArray;cu((en,es)=>{zu(ey,en,es,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,eg.verticesFlattened,eg.indicesTriangles)}_generateSideFaces(en,es){let ec=0;for(let ed=1;ed<en.length;ed++){let ep=en[ed],ef=en[ed-1];if(ep.x===ef.x&&(ep.x<0||ep.x>8192)||ep.y===ef.y&&(ep.y<0||ep.y>8192))continue;es.segment.vertexLength+4>Ka.MAX_VERTEX_ARRAY_LENGTH&&(es.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let em=ep.sub(ef)._perp()._unit(),e_=ef.dist(ep);ec+e_>32768&&(ec=0),zu(this.layoutVertexArray,ep.x,ep.y,em.x,em.y,0,0,ec),zu(this.layoutVertexArray,ep.x,ep.y,em.x,em.y,0,1,ec),ec+=e_,zu(this.layoutVertexArray,ef.x,ef.y,em.x,em.y,0,0,ec),zu(this.layoutVertexArray,ef.x,ef.y,em.x,em.y,0,1,ec);let eg=es.segment.vertexLength;this.indexArray.emplaceBack(eg,eg+2,eg+1),this.indexArray.emplaceBack(eg+1,eg+2,eg+3),es.segment.vertexLength+=4,es.segment.primitiveLength+=2}}};function Tu(en){return en.every(en=>en.x<0)||en.every(en=>en.x>8192)||en.every(en=>en.y<0)||en.every(en=>en.y>8192)}os("FillExtrusionBucket",Pu,{omit:["layers","features"]});var iC={get paint(){return eb=eb||new Ns({"fill-extrusion-opacity":new Ls(eG["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Os(eG["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ls(eG["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ls(eG["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rs(eG["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Os(eG["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Os(eG["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ls(eG["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};let Fu=class Fu extends Gs{constructor(en,es){super(en,iC,es)}createBucket(en){return new Pu(en)}queryRadius(){return Ho(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:en,feature:es,featureState:ec,geometry:ed,transform:ep,pixelsToTileUnits:ef,pixelPosMatrix:em}){let e_=Ko(en,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-ep.bearingInRadians,ef),eg=this.paint.get("fill-extrusion-height").evaluate(es,ec),ey=this.paint.get("fill-extrusion-base").evaluate(es,ec),ex=function(en,es){let ec=[];for(let ed of en){let en=[ed.x,ed.y,0,1];A(en,en,es),ec.push(new r(en[0]/en[3],en[1]/en[3]))}return ec}(e_,em),ev=function(en,es,ec,ed){let ep=[],ef=[],em=ed[8]*es,e_=ed[9]*es,eg=ed[10]*es,ey=ed[11]*es,ex=ed[8]*ec,ev=ed[9]*ec,eb=ed[10]*ec,ew=ed[11]*ec;for(let es of en){let en=[],ec=[];for(let ep of es){let es=ep.x,ef=ep.y,eT=ed[0]*es+ed[4]*ef+ed[12],eP=ed[1]*es+ed[5]*ef+ed[13],eS=ed[2]*es+ed[6]*ef+ed[14],eM=ed[3]*es+ed[7]*ef+ed[15],eC=eS+eg,eI=eM+ey,eE=eT+ex,eA=eP+ev,ez=eS+eb,ek=eM+ew,eD=new r((eT+em)/eI,(eP+e_)/eI);eD.z=eC/eI,en.push(eD);let eR=new r(eE/ek,eA/ek);eR.z=ez/ek,ec.push(eR)}ep.push(en),ef.push(ec)}return[ep,ef]}(ed,ey,eg,em);return function(en,es,ec){let ed=1/0;Oo(ec,es)&&(ed=$u(ec,es[0]));for(let ep=0;ep<es.length;ep++){let ef=es[ep],em=en[ep];for(let en=0;en<ef.length-1;en++){let es=ef[en],ep=[es,ef[en+1],em[en+1],em[en],es];$o(ec,ep)&&(ed=Math.min(ed,$u(ec,ep)))}}return ed!==1/0&&ed}(ev[0],ev[1],ex)}};function Du(en,es){return en.x*es.x+en.y*es.y}function $u(en,es){if(1===en.length){let ec,ed=0,ep=es[ed++];for(;!ec||ep.equals(ec);)if(!(ec=es[ed++]))return 1/0;for(;ed<es.length;ed++){let ef=es[ed],em=en[0],e_=ec.sub(ep),eg=ef.sub(ep),ey=em.sub(ep),ex=Du(e_,e_),ev=Du(e_,eg),eb=Du(eg,eg),ew=Du(ey,e_),eT=Du(ey,eg),eP=ex*eb-ev*ev,eS=(eb*ew-ev*eT)/eP,eM=(ex*eT-ev*ew)/eP,eC=ep.z*(1-eS-eM)+ec.z*eS+ef.z*eM;if(isFinite(eC))return eC}return 1/0}{let en=1/0;for(let ec of es)en=Math.min(en,ec.z);return en}}let iI=Hs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:iE}=iI,iA=Hs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:iz}=iA,ik=Math.cos(Math.PI/180*37.5);let qu=class qu{constructor(en){this.zoom=en.zoom,this.overscaling=en.overscaling,this.layers=en.layers,this.layerIds=this.layers.map(en=>en.id),this.index=en.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(en=>{this.gradients[en.id]={}}),this.layoutVertexArray=new $a,this.layoutVertexArray2=new La,this.indexArray=new Xa,this.programConfigurations=new Io(en.layers,en.zoom),this.segments=new Ka,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(en=>en.isStateDependent()).map(en=>en.id)}populate(en,es,ec){this.hasDependencies=Pl("line",this.layers,es)||this.hasLineDasharray(this.layers);let ed=this.layers[0].layout.get("line-sort-key"),ep=!ed.isConstant(),ef=[];for(let{feature:es,id:em,index:e_,sourceLayerIndex:eg}of en){let en=this.layers[0]._featureFilter.needGeometry,ey=Bo(es,en);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom),ey,ec))continue;let ex=ep?ed.evaluate(ey,{},ec):void 0,ev={id:em,properties:es.properties,type:es.type,sourceLayerIndex:eg,index:e_,geometry:en?ey.geometry:To(es),patterns:{},dashes:{},sortKey:ex};ef.push(ev)}for(let ed of(ep&&ef.sort((en,es)=>en.sortKey-es.sortKey),ef)){let{geometry:ep,index:ef,sourceLayerIndex:em}=ed;this.hasDependencies?(Pl("line",this.layers,es)?Cl("line",this.layers,ed,{zoom:this.zoom},es):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,ed,this.zoom,es),this.patternFeatures.push(ed)):this.addFeature(ed,ep,ef,ec,{},{},es.subdivisionGranularity),es.featureIndex.insert(en[ef].feature,ep,ef,em,this.index)}}update(en,es,ec,ed){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(en,es,this.stateDependentLayers,{imagePositions:ec,dashPositions:ed})}addFeatures(en,es,ec,ed){for(let ep of this.patternFeatures)this.addFeature(ep,ep.geometry,ep.index,es,ec,ed,en.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(en){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=en.createVertexBuffer(this.layoutVertexArray2,iz)),this.layoutVertexBuffer=en.createVertexBuffer(this.layoutVertexArray,iE),this.indexBuffer=en.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(en),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(en){if(en.properties&&Object.prototype.hasOwnProperty.call(en.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(en.properties,"mapbox_clip_end"))return{start:+en.properties.mapbox_clip_start,end:+en.properties.mapbox_clip_end}}addFeature(en,es,ec,ed,ep,ef,em){let e_=this.layers[0].layout,eg=e_.get("line-join").evaluate(en,{}),ey=e_.get("line-cap"),ex=e_.get("line-miter-limit"),ev=e_.get("line-round-limit");for(let ec of(this.lineClips=this.lineFeatureClips(en),es))this.addLine(ec,en,eg,ey,ex,ev,ed,em);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,en,ec,{imagePositions:ep,dashPositions:ef,canonical:ed})}addLine(en,es,ec,ed,ep,ef,em,e_){let eg,ey,ex,ev,eb;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,en=lu(en,em?e_.line.getGranularityForZoomLevel(em.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let es=0;es<en.length-1;es++)this.totalDistance+=en[es].dist(en[es+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let ew="Polygon"===bu.types[es.type],eT=en.length;for(;eT>=2&&en[eT-1].equals(en[eT-2]);)eT--;let eP=0;for(;eP<eT-1&&en[eP].equals(en[eP+1]);)eP++;if(eT<(ew?3:2))return;"bevel"===ec&&(ep=1.05);let eS=this.overscaling<=16?122880/(512*this.overscaling):0,eM=this.segments.prepareSegment(10*eT,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,ew&&(eg=en[eT-2],eb=en[eP].sub(eg)._unit()._perp());for(let es=eP;es<eT;es++){if((ex=es===eT-1?ew?en[eP+1]:void 0:en[es+1])&&en[es].equals(ex))continue;eb&&(ev=eb),eg&&(ey=eg),eg=en[es],eb=ex?ex.sub(eg)._unit()._perp():ev;let em=(ev=ev||eb).add(eb);0===em.x&&0===em.y||em._unit();let e_=ev.x*eb.x+ev.y*eb.y,eC=em.x*eb.x+em.y*eb.y,eI=0!==eC?1/eC:1/0,eE=2*Math.sqrt(2-2*eC),eA=eC<ik&&ey&&ex,ez=ev.x*eb.y-ev.y*eb.x>0;if(eA&&es>eP){let en=eg.dist(ey);if(en>2*eS){let es=eg.sub(eg.sub(ey)._mult(eS/en)._round());this.updateDistance(ey,es),this.addCurrentVertex(es,ev,0,0,eM),ey=es}}let ek=ey&&ex,eD=ek?ec:ew?"butt":ed;if(ek&&"round"===eD&&(eI<ef?eD="miter":eI<=2&&(eD="fakeround")),"miter"===eD&&eI>ep&&(eD="bevel"),"bevel"===eD&&(eI>2&&(eD="flipbevel"),eI<ep&&(eD="miter")),ey&&this.updateDistance(ey,eg),"miter"===eD)em._mult(eI),this.addCurrentVertex(eg,em,0,0,eM);else if("flipbevel"===eD){if(eI>100)em=eb.mult(-1);else{let en=eI*ev.add(eb).mag()/ev.sub(eb).mag();em._perp()._mult(en*(ez?-1:1))}this.addCurrentVertex(eg,em,0,0,eM),this.addCurrentVertex(eg,em.mult(-1),0,0,eM)}else if("bevel"===eD||"fakeround"===eD){let en=-Math.sqrt(eI*eI-1),es=ez?en:0,ec=ez?0:en;if(ey&&this.addCurrentVertex(eg,ev,es,ec,eM),"fakeround"===eD){let en=Math.round(180*eE/Math.PI/20);for(let es=1;es<en;es++){let ec=es/en;if(.5!==ec){let en=ec-.5;ec+=ec*en*(ec-1)*((1.0904+e_*(e_*(3.55645-1.43519*e_)-3.2452))*en*en+(.848013+e_*(.215638*e_-1.06021)))}let ed=eb.sub(ev)._mult(ec)._add(ev)._unit()._mult(ez?-1:1);this.addHalfVertex(eg,ed.x,ed.y,!1,ez,0,eM)}}ex&&this.addCurrentVertex(eg,eb,-es,-ec,eM)}else if("butt"===eD)this.addCurrentVertex(eg,em,0,0,eM);else if("square"===eD){let en=ey?1:-1;this.addCurrentVertex(eg,em,en,en,eM)}else"round"===eD&&(ey&&(this.addCurrentVertex(eg,ev,0,0,eM),this.addCurrentVertex(eg,ev,1,1,eM,!0)),ex&&(this.addCurrentVertex(eg,eb,-1,-1,eM,!0),this.addCurrentVertex(eg,eb,0,0,eM)));if(eA&&es<eT-1){let en=eg.dist(ex);if(en>2*eS){let es=eg.add(ex.sub(eg)._mult(eS/en)._round());this.updateDistance(eg,es),this.addCurrentVertex(es,eb,0,0,eM),eg=es}}}}addCurrentVertex(en,es,ec,ed,ep,ef=!1){let em=es.y*ed-es.x,e_=-es.y-es.x*ed;this.addHalfVertex(en,es.x+es.y*ec,es.y-es.x*ec,ef,!1,ec,ep),this.addHalfVertex(en,em,e_,ef,!0,-ed,ep),this.distance>16384&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(en,es,ec,ed,ep,ef))}addHalfVertex({x:en,y:es},ec,ed,ep,ef,em,e_){let eg=.5*(this.lineClips?32767*this.scaledDistance:this.scaledDistance);this.layoutVertexArray.emplaceBack((en<<1)+(ep?1:0),(es<<1)+(ef?1:0),Math.round(63*ec)+128,Math.round(63*ed)+128,1+(0===em?0:em<0?-1:1)|(63&eg)<<2,eg>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let ey=e_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,ey,this.e2),e_.primitiveLength++),ef?this.e2=ey:this.e1=ey}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(en,es){this.distance+=en.dist(es),this.updateScaledDistance()}hasLineDasharray(en){for(let es of en){let en=es.paint.get("line-dasharray");if(en&&!en.isConstant())return!0}return!1}addLineDashDependencies(en,es,ec,ed){for(let ep of en){let en=ep.paint.get("line-dasharray");if(!en||"constant"===en.value.kind)continue;let ef="round"===ep.layout.get("line-cap"),em={dasharray:en.value.evaluate({zoom:ec-1},es,{}),round:ef},e_={dasharray:en.value.evaluate({zoom:ec},es,{}),round:ef},eg={dasharray:en.value.evaluate({zoom:ec+1},es,{}),round:ef},ey=`${em.dasharray.join(",")},${em.round}`,ex=`${e_.dasharray.join(",")},${e_.round}`,ev=`${eg.dasharray.join(",")},${eg.round}`;ed.dashDependencies[ey]=em,ed.dashDependencies[ex]=e_,ed.dashDependencies[ev]=eg,es.dashes[ep.id]={min:ey,mid:ex,max:ev}}}};os("LineBucket",qu,{omit:["layers","patternFeatures"]});var iD={get paint(){return eT=eT||new Ns({"line-opacity":new Os(eG.paint_line["line-opacity"]),"line-color":new Os(eG.paint_line["line-color"]),"line-translate":new Ls(eG.paint_line["line-translate"]),"line-translate-anchor":new Ls(eG.paint_line["line-translate-anchor"]),"line-width":new Os(eG.paint_line["line-width"]),"line-gap-width":new Os(eG.paint_line["line-gap-width"]),"line-offset":new Os(eG.paint_line["line-offset"]),"line-blur":new Os(eG.paint_line["line-blur"]),"line-dasharray":new Rs(eG.paint_line["line-dasharray"]),"line-pattern":new Rs(eG.paint_line["line-pattern"]),"line-gradient":new js(eG.paint_line["line-gradient"])})},get layout(){return ew=ew||new Ns({"line-cap":new Ls(eG.layout_line["line-cap"]),"line-join":new Os(eG.layout_line["line-join"]),"line-miter-limit":new Ls(eG.layout_line["line-miter-limit"]),"line-round-limit":new Ls(eG.layout_line["line-round-limit"]),"line-sort-key":new Os(eG.layout_line["line-sort-key"])})}};let Yu=class Yu extends Os{possiblyEvaluate(en,es){return es=new zs(Math.floor(es.zoom),{now:es.now,fadeDuration:es.fadeDuration,zoomHistory:es.zoomHistory,transition:es.transition}),super.possiblyEvaluate(en,es)}evaluate(en,es,ec,ed){return es=L({},es,{zoom:Math.floor(es.zoom)}),super.evaluate(en,es,ec,ed)}};let Ku=class Ku extends Gs{constructor(en,es){super(en,iD,es),this.gradientVersion=0,eP||((eP=new Yu(iD.paint.properties["line-width"].specification)).useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(en){if("line-gradient"===en){let en=this.gradientExpression();this.stepInterpolant=void 0!==en._styleExpression&&en._styleExpression.expression instanceof ar,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(en,es){super.recalculate(en,es),this.paint._values["line-floorwidth"]=eP.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,en)}createBucket(en){return new qu(en)}queryRadius(en){var es,ec;let ed=(es=Yo("line-width",this,en),(ec=Yo("line-gap-width",this,en))>0?ec+2*es:es),ep=Yo("line-offset",this,en);return ed/2+Math.abs(ep)+Ho(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:en,feature:es,featureState:ec,geometry:ed,transform:ep,pixelsToTileUnits:ef}){var em,e_;let eg=Ko(en,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-ep.bearingInRadians,ef),ey=ef/2*(em=this.paint.get("line-width").evaluate(es,ec),(e_=this.paint.get("line-gap-width").evaluate(es,ec))>0?e_+2*em:em),ex=this.paint.get("line-offset").evaluate(es,ec);return ex&&(ed=function(en,es){let ec=[];for(let ed=0;ed<en.length;ed++){let ep=en[ed],ef=[];for(let en=0;en<ep.length;en++){let ec=ep[en-1],ed=ep[en],em=ep[en+1],e_=0===en?new r(0,0):ed.sub(ec)._unit()._perp(),eg=en===ep.length-1?new r(0,0):em.sub(ed)._unit()._perp(),ey=e_._add(eg)._unit(),ex=ey.x*eg.x+ey.y*eg.y;0!==ex&&ey._mult(1/ex),ef.push(ey._mult(es)._add(ed))}ec.push(ef)}return ec}(ed,ex*ef)),function(en,es,ec){for(let ed=0;ed<es.length;ed++){let ep=es[ed];if(en.length>=3){for(let es=0;es<ep.length;es++)if(Xo(en,ep[es]))return!0}if(function(en,es,ec){if(en.length>1){if(Uo(en,es))return!0;for(let ed=0;ed<es.length;ed++)if(No(es[ed],en,ec))return!0}for(let ed=0;ed<en.length;ed++)if(No(en[ed],es,ec))return!0;return!1}(en,ep,ec))return!0}return!1}(eg,ed,ey)}isTileClipped(){return!0}};let iR=Hs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iL=Hs([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let iB=Hs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Hs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let iF=Hs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iO=Hs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Hs([{name:"triangle",components:3,type:"Uint16"}]),Hs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Hs([{type:"Float32",name:"offsetX"}]),Hs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Hs([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let ij={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","\xa2":"","\xa3":"","\xa5":"","\xa6":"","\xac":"","\xaf":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},iV="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let uc=class uc{constructor(en=new Uint8Array(16)){this.buf=ArrayBuffer.isView(en)?en:new Uint8Array(en),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(en,es,ec=this.length){for(;this.pos<ec;){let ec=this.readVarint(),ed=ec>>3,ep=this.pos;this.type=7&ec,en(ed,es,this),this.pos===ep&&this.skip(ec)}return es}readMessage(en,es){return this.readFields(en,es,this.readVarint()+this.pos)}readFixed32(){let en=this.dataView.getUint32(this.pos,!0);return this.pos+=4,en}readSFixed32(){let en=this.dataView.getInt32(this.pos,!0);return this.pos+=4,en}readFixed64(){let en=this.dataView.getUint32(this.pos,!0)+4294967296*this.dataView.getUint32(this.pos+4,!0);return this.pos+=8,en}readSFixed64(){let en=this.dataView.getUint32(this.pos,!0)+4294967296*this.dataView.getInt32(this.pos+4,!0);return this.pos+=8,en}readFloat(){let en=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,en}readDouble(){let en=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,en}readVarint(en){let es,ec;let ed=this.buf;return es=127&(ec=ed[this.pos++]),ec<128?es:(es|=(127&(ec=ed[this.pos++]))<<7,ec<128?es:(es|=(127&(ec=ed[this.pos++]))<<14,ec<128?es:(es|=(127&(ec=ed[this.pos++]))<<21,ec<128?es:function(en,es,ec){let ed,ep;let ef=ec.buf;if(ed=(112&(ep=ef[ec.pos++]))>>4,ep<128||(ed|=(127&(ep=ef[ec.pos++]))<<3,ep<128)||(ed|=(127&(ep=ef[ec.pos++]))<<10,ep<128)||(ed|=(127&(ep=ef[ec.pos++]))<<17,ep<128)||(ed|=(127&(ep=ef[ec.pos++]))<<24,ep<128)||(ed|=(1&(ep=ef[ec.pos++]))<<31,ep<128)){var em,e_;return em=en,e_=ed,es?4294967296*e_+(em>>>0):4294967296*(e_>>>0)+(em>>>0)}throw Error("Expected varint not more than 10 bytes")}(es|=(15&(ec=ed[this.pos]))<<28,en,this))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let en=this.readVarint();return en%2==1?-((en+1)/2):en/2}readBoolean(){return!!this.readVarint()}readString(){let en=this.readVarint()+this.pos,es=this.pos;return this.pos=en,en-es>=12&&iV?iV.decode(this.buf.subarray(es,en)):function(en,es,ec){let ed="",ep=es;for(;ep<ec;){let es=en[ep],ef,em,e_,eg=null,ey=es>239?4:es>223?3:es>191?2:1;if(ep+ey>ec)break;1===ey?es<128&&(eg=es):2===ey?128==(192&(ef=en[ep+1]))&&(eg=(31&es)<<6|63&ef)<=127&&(eg=null):3===ey?(ef=en[ep+1],em=en[ep+2],128==(192&ef)&&128==(192&em)&&((eg=(15&es)<<12|(63&ef)<<6|63&em)<=2047||eg>=55296&&eg<=57343)&&(eg=null)):4===ey&&(ef=en[ep+1],em=en[ep+2],e_=en[ep+3],128==(192&ef)&&128==(192&em)&&128==(192&e_)&&((eg=(15&es)<<18|(63&ef)<<12|(63&em)<<6|63&e_)<=65535||eg>=1114112)&&(eg=null)),null===eg?(eg=65533,ey=1):eg>65535&&(eg-=65536,ed+=String.fromCharCode(eg>>>10&1023|55296),eg=56320|1023&eg),ed+=String.fromCharCode(eg),ep+=ey}return ed}(this.buf,es,en)}readBytes(){let en=this.readVarint()+this.pos,es=this.buf.subarray(this.pos,en);return this.pos=en,es}readPackedVarint(en=[],es){let ec=this.readPackedEnd();for(;this.pos<ec;)en.push(this.readVarint(es));return en}readPackedSVarint(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readSVarint());return en}readPackedBoolean(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readBoolean());return en}readPackedFloat(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readFloat());return en}readPackedDouble(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readDouble());return en}readPackedFixed32(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readFixed32());return en}readPackedSFixed32(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readSFixed32());return en}readPackedFixed64(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readFixed64());return en}readPackedSFixed64(en=[]){let es=this.readPackedEnd();for(;this.pos<es;)en.push(this.readSFixed64());return en}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(en){let es=7&en;if(0===es)for(;this.buf[this.pos++]>127;);else if(2===es)this.pos=this.readVarint()+this.pos;else if(5===es)this.pos+=4;else{if(1!==es)throw Error(`Unimplemented type: ${es}`);this.pos+=8}}writeTag(en,es){this.writeVarint(en<<3|es)}realloc(en){let es=this.length||16;for(;es<this.pos+en;)es*=2;if(es!==this.length){let en=new Uint8Array(es);en.set(this.buf),this.buf=en,this.dataView=new DataView(en.buffer),this.length=es}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(en){this.realloc(4),this.dataView.setInt32(this.pos,en,!0),this.pos+=4}writeSFixed32(en){this.realloc(4),this.dataView.setInt32(this.pos,en,!0),this.pos+=4}writeFixed64(en){this.realloc(8),this.dataView.setInt32(this.pos,-1&en,!0),this.dataView.setInt32(this.pos+4,Math.floor(23283064365386963e-26*en),!0),this.pos+=8}writeSFixed64(en){this.realloc(8),this.dataView.setInt32(this.pos,-1&en,!0),this.dataView.setInt32(this.pos+4,Math.floor(23283064365386963e-26*en),!0),this.pos+=8}writeVarint(en){(en=+en||0)>268435455||en<0?function(en,es){var ec;let ed,ep;if(en>=0?(ed=en%4294967296|0,ep=en/4294967296|0):(ed=~(-en%4294967296),ep=~(-en/4294967296),4294967295^ed?ed=ed+1|0:(ed=0,ep=ep+1|0)),en>=18446744073709552e3||en<-18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");es.realloc(10),ec=ed,es.buf[es.pos++]=127&ec|128,ec>>>=7,es.buf[es.pos++]=127&ec|128,ec>>>=7,es.buf[es.pos++]=127&ec|128,ec>>>=7,es.buf[es.pos++]=127&ec|128,es.buf[es.pos]=127&(ec>>>=7),function(en,es){let ec=(7&en)<<4;es.buf[es.pos++]|=ec|((en>>>=3)?128:0),en&&(es.buf[es.pos++]=127&en|((en>>>=7)?128:0),en&&(es.buf[es.pos++]=127&en|((en>>>=7)?128:0),en&&(es.buf[es.pos++]=127&en|((en>>>=7)?128:0),en&&(es.buf[es.pos++]=127&en|((en>>>=7)?128:0),en&&(es.buf[es.pos++]=127&en)))))}(ep,es)}(en,this):(this.realloc(4),this.buf[this.pos++]=127&en|(en>127?128:0),en<=127||(this.buf[this.pos++]=127&(en>>>=7)|(en>127?128:0),en<=127||(this.buf[this.pos++]=127&(en>>>=7)|(en>127?128:0),en<=127||(this.buf[this.pos++]=en>>>7&127))))}writeSVarint(en){this.writeVarint(en<0?-(2*en)-1:2*en)}writeBoolean(en){this.writeVarint(+en)}writeString(en){en=String(en),this.realloc(4*en.length),this.pos++;let es=this.pos;this.pos=function(en,es,ec){for(let ed,ep,ef=0;ef<es.length;ef++){if((ed=es.charCodeAt(ef))>55295&&ed<57344){if(!ep){ed>56319||ef+1===es.length?(en[ec++]=239,en[ec++]=191,en[ec++]=189):ep=ed;continue}if(ed<56320){en[ec++]=239,en[ec++]=191,en[ec++]=189,ep=ed;continue}ed=ep-55296<<10|ed-56320|65536,ep=null}else ep&&(en[ec++]=239,en[ec++]=191,en[ec++]=189,ep=null);ed<128?en[ec++]=ed:(ed<2048?en[ec++]=ed>>6|192:(ed<65536?en[ec++]=ed>>12|224:(en[ec++]=ed>>18|240,en[ec++]=ed>>12&63|128),en[ec++]=ed>>6&63|128),en[ec++]=63&ed|128)}return ec}(this.buf,en,this.pos);let ec=this.pos-es;ec>=128&&hc(es,ec,this),this.pos=es-1,this.writeVarint(ec),this.pos+=ec}writeFloat(en){this.realloc(4),this.dataView.setFloat32(this.pos,en,!0),this.pos+=4}writeDouble(en){this.realloc(8),this.dataView.setFloat64(this.pos,en,!0),this.pos+=8}writeBytes(en){let es=en.length;this.writeVarint(es),this.realloc(es);for(let ec=0;ec<es;ec++)this.buf[this.pos++]=en[ec]}writeRawMessage(en,es){this.pos++;let ec=this.pos;en(es,this);let ed=this.pos-ec;ed>=128&&hc(ec,ed,this),this.pos=ec-1,this.writeVarint(ed),this.pos+=ed}writeMessage(en,es,ec){this.writeTag(en,2),this.writeRawMessage(es,ec)}writePackedVarint(en,es){es.length&&this.writeMessage(en,pc,es)}writePackedSVarint(en,es){es.length&&this.writeMessage(en,fc,es)}writePackedBoolean(en,es){es.length&&this.writeMessage(en,mc,es)}writePackedFloat(en,es){es.length&&this.writeMessage(en,dc,es)}writePackedDouble(en,es){es.length&&this.writeMessage(en,yc,es)}writePackedFixed32(en,es){es.length&&this.writeMessage(en,gc,es)}writePackedSFixed32(en,es){es.length&&this.writeMessage(en,xc,es)}writePackedFixed64(en,es){es.length&&this.writeMessage(en,vc,es)}writePackedSFixed64(en,es){es.length&&this.writeMessage(en,bc,es)}writeBytesField(en,es){this.writeTag(en,2),this.writeBytes(es)}writeFixed32Field(en,es){this.writeTag(en,5),this.writeFixed32(es)}writeSFixed32Field(en,es){this.writeTag(en,5),this.writeSFixed32(es)}writeFixed64Field(en,es){this.writeTag(en,1),this.writeFixed64(es)}writeSFixed64Field(en,es){this.writeTag(en,1),this.writeSFixed64(es)}writeVarintField(en,es){this.writeTag(en,0),this.writeVarint(es)}writeSVarintField(en,es){this.writeTag(en,0),this.writeSVarint(es)}writeStringField(en,es){this.writeTag(en,2),this.writeString(es)}writeFloatField(en,es){this.writeTag(en,5),this.writeFloat(es)}writeDoubleField(en,es){this.writeTag(en,1),this.writeDouble(es)}writeBooleanField(en,es){this.writeVarintField(en,+es)}};function hc(en,es,ec){let ed=es<=16383?1:es<=2097151?2:es<=268435455?3:Math.floor(Math.log(es)/(7*Math.LN2));ec.realloc(ed);for(let es=ec.pos-1;es>=en;es--)ec.buf[es+ed]=ec.buf[es]}function pc(en,es){for(let ec=0;ec<en.length;ec++)es.writeVarint(en[ec])}function fc(en,es){for(let ec=0;ec<en.length;ec++)es.writeSVarint(en[ec])}function dc(en,es){for(let ec=0;ec<en.length;ec++)es.writeFloat(en[ec])}function yc(en,es){for(let ec=0;ec<en.length;ec++)es.writeDouble(en[ec])}function mc(en,es){for(let ec=0;ec<en.length;ec++)es.writeBoolean(en[ec])}function gc(en,es){for(let ec=0;ec<en.length;ec++)es.writeFixed32(en[ec])}function xc(en,es){for(let ec=0;ec<en.length;ec++)es.writeSFixed32(en[ec])}function vc(en,es){for(let ec=0;ec<en.length;ec++)es.writeFixed64(en[ec])}function bc(en,es){for(let ec=0;ec<en.length;ec++)es.writeSFixed64(en[ec])}function wc(en,es,ec){1===en&&ec.readMessage(_c,es)}function _c(en,es,ec){if(3===en){let{id:en,bitmap:ed,width:ep,height:ef,left:em,top:e_,advance:eg}=ec.readMessage(Sc,{});es.push({id:en,bitmap:new fl({width:ep+6,height:ef+6},ed),metrics:{width:ep,height:ef,left:em,top:e_,advance:eg}})}}function Sc(en,es,ec){1===en?es.id=ec.readVarint():2===en?es.bitmap=ec.readBytes():3===en?es.width=ec.readVarint():4===en?es.height=ec.readVarint():5===en?es.left=ec.readSVarint():6===en?es.top=ec.readSVarint():7===en&&(es.advance=ec.readVarint())}function Ac(en){let es=0,ec=0;for(let ed of en)es+=ed.w*ed.h,ec=Math.max(ec,ed.w);en.sort((en,es)=>es.h-en.h);let ed=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(es/.95)),ec),h:1/0}],ep=0,ef=0;for(let es of en)for(let en=ed.length-1;en>=0;en--){let ec=ed[en];if(!(es.w>ec.w||es.h>ec.h)){if(es.x=ec.x,es.y=ec.y,ef=Math.max(ef,es.y+es.h),ep=Math.max(ep,es.x+es.w),es.w===ec.w&&es.h===ec.h){let es=ed.pop();es&&en<ed.length&&(ed[en]=es)}else es.h===ec.h?(ec.x+=es.w,ec.w-=es.w):(es.w===ec.w||ed.push({x:ec.x+es.w,y:ec.y,w:ec.w-es.w,h:es.h}),ec.y+=es.h,ec.h-=es.h);break}}return{w:ep,h:ef,fill:es/(ep*ef)||0}}let kc=class kc{constructor(en,{pixelRatio:es,version:ec,stretchX:ed,stretchY:ep,content:ef,textFitWidth:em,textFitHeight:e_}){this.paddedRect=en,this.pixelRatio=es,this.stretchX=ed,this.stretchY=ep,this.content=ef,this.version=ec,this.textFitWidth=em,this.textFitHeight=e_}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}};let Mc=class Mc{constructor(en,es){let ec={},ed={};this.haveRenderCallbacks=[];let ep=[];this.addImages(en,ec,ep),this.addImages(es,ed,ep);let{w:ef,h:em}=Ac(ep),e_=new dl({width:ef||1,height:em||1});for(let es in en){let ed=en[es],ep=ec[es].paddedRect;dl.copy(ed.data,e_,{x:0,y:0},{x:ep.x+1,y:ep.y+1},ed.data)}for(let en in es){let ec=es[en],ep=ed[en].paddedRect,ef=ep.x+1,em=ep.y+1,eg=ec.data.width,ey=ec.data.height;dl.copy(ec.data,e_,{x:0,y:0},{x:ef,y:em},ec.data),dl.copy(ec.data,e_,{x:0,y:ey-1},{x:ef,y:em-1},{width:eg,height:1}),dl.copy(ec.data,e_,{x:0,y:0},{x:ef,y:em+ey},{width:eg,height:1}),dl.copy(ec.data,e_,{x:eg-1,y:0},{x:ef-1,y:em},{width:1,height:ey}),dl.copy(ec.data,e_,{x:0,y:0},{x:ef+eg,y:em},{width:1,height:ey})}this.image=e_,this.iconPositions=ec,this.patternPositions=ed}addImages(en,es,ec){for(let ed in en){let ep=en[ed],ef={x:0,y:0,w:ep.data.width+2,h:ep.data.height+2};ec.push(ef),es[ed]=new kc(ef,ep),ep.hasRenderCallback&&this.haveRenderCallbacks.push(ed)}}patchUpdatedImages(en,es){for(let ec in en.dispatchRenderCallbacks(this.haveRenderCallbacks),en.updatedImages)this.patchUpdatedImage(this.iconPositions[ec],en.getImage(ec),es),this.patchUpdatedImage(this.patternPositions[ec],en.getImage(ec),es)}patchUpdatedImage(en,es,ec){if(!en||!es||en.version===es.version)return;en.version=es.version;let[ed,ep]=en.tl;ec.update(es.data,void 0,{x:ed,y:ep})}};os("ImagePosition",kc),os("ImageAtlas",Mc),en.ao=void 0,(eE=en.ao||(en.ao={}))[eE.none=0]="none",eE[eE.horizontal=1]="horizontal",eE[eE.vertical=2]="vertical",eE[eE.horizontalOnly=3]="horizontalOnly";let zc=class zc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(en,es,ec){let ed=new zc;return ed.scale=en||1,ed.fontStack=es,ed.verticalAlign=ec||"bottom",ed}static forImage(en,es){let ec=new zc;return ec.imageName=en,ec.verticalAlign=es||"bottom",ec}};let Pc=class Pc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(en,es){let ec=new Pc;for(let ed=0;ed<en.sections.length;ed++){let ep=en.sections[ed];ep.image?ec.addImageSection(ep):ec.addTextSection(ep,es)}return ec}length(){return this.text.length}getSection(en){return this.sections[this.sectionIndex[en]]}getSectionIndex(en){return this.sectionIndex[en]}getCharCode(en){return this.text.charCodeAt(en)}verticalizePunctuation(){this.text=function(en){let es="";for(let ec=0;ec<en.length;ec++){let ed=en.charCodeAt(ec+1)||null,ep=en.charCodeAt(ec-1)||null;es+=ed&&_s(ed)&&!ij[en[ec+1]]||ep&&_s(ep)&&!ij[en[ec-1]]||!ij[en[ec]]?en[ec]:ij[en[ec]]}return es}(this.text)}trim(){let en=0;for(let es=0;es<this.text.length&&iU[this.text.charCodeAt(es)];es++)en++;let es=this.text.length;for(let ec=this.text.length-1;ec>=0&&ec>=en&&iU[this.text.charCodeAt(ec)];ec--)es--;this.text=this.text.substring(en,es),this.sectionIndex=this.sectionIndex.slice(en,es)}substring(en,es){let ec=new Pc;return ec.text=this.text.substring(en,es),ec.sectionIndex=this.sectionIndex.slice(en,es),ec.sections=this.sections,ec}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((en,es)=>Math.max(en,this.sections[es].scale),0)}getMaxImageSize(en){let es=0,ec=0;for(let ed=0;ed<this.length();ed++){let ep=this.getSection(ed);if(ep.imageName){let ed=en[ep.imageName];if(!ed)continue;let ef=ed.displaySize;es=Math.max(es,ef[0]),ec=Math.max(ec,ef[1])}}return{maxImageWidth:es,maxImageHeight:ec}}addTextSection(en,es){this.text+=en.text,this.sections.push(zc.forText(en.scale,en.fontStack||es,en.verticalAlign));let ec=this.sections.length-1;for(let es=0;es<en.text.length;++es)this.sectionIndex.push(ec)}addImageSection(en){let es=en.image?en.image.name:"";if(0===es.length)return void q("Can't add FormattedSection with an empty image.");let ec=this.getNextImageSectionCharCode();ec?(this.text+=String.fromCharCode(ec),this.sections.push(zc.forImage(es,en.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):q("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}};function Cc(es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP){let eS;let eM=Pc.fromFeature(es,ef);eb===en.ao.vertical&&eM.verticalizePunctuation();let{processBidirectionalText:eC,processStyledBidirectionalText:eI}=tQ;if(eC&&1===eM.sections.length){eS=[];let en=eC(eM.toString(),Oc(eM,ex,em,ec,ep,eT));for(let es of en){let en=new Pc;en.text=es,en.sections=eM.sections;for(let ec=0;ec<es.length;ec++)en.sectionIndex.push(0);eS.push(en)}}else if(eI){eS=[];let en=eI(eM.text,eM.sectionIndex,Oc(eM,ex,em,ec,ep,eT));for(let es of en){let en=new Pc;en.text=es[0],en.sectionIndex=es[1],en.sections=eM.sections,eS.push(en)}}else eS=function(en,es){let ec=[],ed=en.text,ep=0;for(let ed of es)ec.push(en.substring(ep,ed)),ep=ed;return ep<ed.length&&ec.push(en.substring(ep,ed.length)),ec}(eM,Oc(eM,ex,em,ec,ep,eT));let eE=[],eA={positionedLines:eE,text:eM.toString(),top:ev[1],bottom:ev[1],left:ev[0],right:ev[0],writingMode:eb,iconsInText:!1,verticalizable:!1};return function(es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb){let ew=0,eT=0,eP=0,eS=0,eM="right"===eg?1:"left"===eg?0:.5,eC=24/eb,eI=0;for(let e_ of ef){e_.trim();let ef=e_.getMaxScale(),eg={positionedGlyphs:[],lineOffset:0};es.positionedLines[eI]=eg;let eb=eg.positionedGlyphs,eE=0;if(!e_.length()){eT+=em,++eI;continue}let eA=function(en,es,ec){let ed=24*es.getMaxScale(),{maxImageWidth:ep,maxImageHeight:ef}=es.getMaxImageSize(en);return{verticalLineContentWidth:Math.max(ed,ep*ec),horizontalLineContentHeight:Math.max(ed,ef*ec)}}(ep,e_,eC);for(let em=0;em<e_.length();em++){let eg;let eP=e_.getSection(em),eS=e_.getSectionIndex(em),eM=e_.getCharCode(em),eI=!(ey===en.ao.horizontal||!ev&&!ws(eM)||ev&&(iU[eM]||/\p{sc=Arab}/u.test(String.fromCodePoint(eM))));if(eP.imageName){if(es.iconsInText=!0,eP.scale=eP.scale*eC,!(eg=function(en,es,ec,ed,ep){let ef;let em=ep[en.imageName];if(!em)return null;let e_=em.paddedRect,eg=em.displaySize,ey={width:eg[0],height:eg[1],left:1,top:-3,advance:es?eg[1]:eg[0]};if(es)ef=ed.verticalLineContentWidth-eg[1]*en.scale;else{let es=jc(en.verticalAlign);ef=(ed.horizontalLineContentHeight-eg[1]*en.scale)*es}return{rect:e_,metrics:ey,baselineOffset:ef,imageOffset:(es?eg[0]:eg[1])*en.scale-24*ec}}(eP,eI,ef,eA,ep)))continue;eE=Math.max(eE,eg.imageOffset)}else if(!(eg=function(en,es,ec,ed,ep,ef){let em;let e_=ef[en.fontStack],eg=function(en,es,ec,ed){if(en&&en.rect)return en;let ep=es[ec.fontStack],ef=ep&&ep[ed];return ef?{rect:null,metrics:ef.metrics}:null}(e_&&e_[es],ep,en,es);if(null===eg)return null;if(ec)em=ed.verticalLineContentWidth-24*en.scale;else{let es=jc(en.verticalAlign);em=(ed.horizontalLineContentHeight-24*en.scale)*es}return{rect:eg.rect,metrics:eg.metrics,baselineOffset:em}}(eP,eM,eI,eA,ec,ed)))continue;let{rect:ez,metrics:ek,baselineOffset:eD}=eg;eb.push({glyph:eM,imageName:eP.imageName,x:ew,y:eT+eD+-17,vertical:eI,scale:eP.scale,fontStack:eP.fontStack,sectionIndex:eS,metrics:ek,rect:ez}),eI?(es.verticalizable=!0,ew+=(eP.imageName?ek.advance:24)*eP.scale+ex):ew+=ek.advance*eP.scale+ex}0!==eb.length&&(eP=Math.max(ew-ex,eP),function(en,es,ec,ed){if(0===ed)return;let ep=en[ec],ef=(en[ec].x+ep.metrics.advance*ep.scale)*ed;for(let es=0;es<=ec;es++)en[es].x-=ef}(eb,0,eb.length-1,eM)),ew=0,eg.lineOffset=Math.max(eE,(ef-1)*24);let ez=em*ef+eE;eT+=ez,eS=Math.max(ez,eS),++eI}let{horizontalAlign:eE,verticalAlign:eA}=Rc(e_);(function(en,es,ec,ed,ep,ef,em,e_,eg){let ey=(es-ec)*ep,ex=0;for(let es of(ex=ef!==em?-e_*ed- -17:-ed*eg*em+.5*em,en))for(let en of es.positionedGlyphs)en.x+=ey,en.y+=ex})(es.positionedLines,eM,eE,eA,eP,eS,em,eT,ef.length),es.top+=-eA*eT,es.bottom=es.top+eT,es.left+=-eE*eP,es.right=es.left+eP}(eA,ec,ed,ep,eS,e_,eg,ey,eb,ex,ew,eP),!function(en){for(let es of en)if(0!==es.positionedGlyphs.length)return!1;return!0}(eE)&&eA}let iU={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},iN={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},iZ={40:!0};function Vc(en,es,ec,ed,ep,ef){if(es.imageName){let en=ed[es.imageName];return en?en.displaySize[0]*es.scale*24/ef+ep:0}{let ed=ec[es.fontStack],ef=ed&&ed[en];return ef?ef.metrics.advance*es.scale+ep:0}}function Fc(en,es,ec,ed){let ep=Math.pow(en-es,2);return ed?en<es?ep/2:2*ep:ep+Math.abs(ec)*ec}function $c(en,es,ec,ed,ep,ef){let em=null,e_=Fc(es,ec,ep,ef);for(let en of ed){let ed=Fc(es-en.x,ec,ep,ef)+en.badness;ed<=e_&&(em=en,e_=ed)}return{index:en,x:es,priorBreak:em,badness:e_}}function Oc(en,es,ec,ed,ep,ef){if(!en)return[];let em=[],e_=function(en,es,ec,ed,ep,ef){let em=0;for(let ec=0;ec<en.length();ec++){let e_=en.getSection(ec);em+=Vc(en.getCharCode(ec),e_,ed,ep,es,ef)}return em/Math.max(1,Math.ceil(em/ec))}(en,es,ec,ed,ep,ef),eg=en.text.indexOf("")>=0,ey=0;for(let ec=0;ec<en.length();ec++){let ex=en.getSection(ec),ev=en.getCharCode(ec);if(iU[ev]||(ey+=Vc(ev,ex,ed,ep,es,ef)),ec<en.length()-1){let es=!(ev<11904)&&(!!tX["CJK Compatibility Forms"](ev)||!!tX["CJK Compatibility"](ev)||!!tX["CJK Strokes"](ev)||!!tX["CJK Symbols and Punctuation"](ev)||!!tX["Enclosed CJK Letters and Months"](ev)||!!tX["Halfwidth and Fullwidth Forms"](ev)||!!tX["Ideographic Description Characters"](ev)||!!tX["Vertical Forms"](ev)||tY.test(String.fromCodePoint(ev)));(iN[ev]||es||ex.imageName||ec!==en.length()-2&&iZ[en.getCharCode(ec+1)])&&em.push($c(ec+1,ey,e_,em,function(en,es,ec){let ed=0;return 10===en&&(ed-=1e4),ec&&(ed+=150),40!==en&&65288!==en||(ed+=50),41!==es&&65289!==es||(ed+=50),ed}(ev,en.getCharCode(ec+1),es&&eg),!1))}}return function Lc(en){return en?Lc(en.priorBreak).concat(en.index):[]}($c(en.length(),ey,e_,em,0,!0))}function Rc(en){let es=.5,ec=.5;switch(en){case"right":case"top-right":case"bottom-right":es=1;break;case"left":case"top-left":case"bottom-left":es=0}switch(en){case"bottom":case"bottom-right":case"bottom-left":ec=1;break;case"top":case"top-right":case"top-left":ec=0}return{horizontalAlign:es,verticalAlign:ec}}function jc(en){switch(en){case"top":return 0;case"center":return .5;default:return 1}}function Yc(en){var es,ec;let ed=en.left,ep=en.top,ef=en.right-ed,em=en.bottom-ep,e_=null!==(es=en.image.textFitWidth)&&void 0!==es?es:"stretchOrShrink",eg=null!==(ec=en.image.textFitHeight)&&void 0!==ec?ec:"stretchOrShrink",ey=(en.image.content[2]-en.image.content[0])/(en.image.content[3]-en.image.content[1]);if("proportional"===eg){if("stretchOnly"===e_&&ef/em<ey||"proportional"===e_){let en=Math.ceil(em*ey);ed*=en/ef,ef=en}}else if("proportional"===e_&&"stretchOnly"===eg&&0!==ey&&ef/em>ey){let en=Math.ceil(ef/ey);ep*=en/em,em=en}return{x1:ed,y1:ep,x2:ed+ef,y2:ep+em}}function Hc(en,es,ec,ed,ep,ef){let em,e_,eg,ey,ex;let ev=en.image;if(ev.content){let en=ev.content,es=ev.pixelRatio||1;em=[en[0]/es,en[1]/es,ev.displaySize[0]-en[2]/es,ev.displaySize[1]-en[3]/es]}let eb=es.left*ef,ew=es.right*ef;"width"===ec||"both"===ec?(ex=ep[0]+eb-ed[3],eg=ep[0]+ew+ed[1]):eg=(ex=ep[0]+(eb+ew-ev.displaySize[0])/2)+ev.displaySize[0];let eT=es.top*ef,eP=es.bottom*ef;return"height"===ec||"both"===ec?(e_=ep[1]+eT-ed[0],ey=ep[1]+eP+ed[2]):ey=(e_=ep[1]+(eT+eP-ev.displaySize[1])/2)+ev.displaySize[1],{image:ev,top:e_,right:eg,bottom:ey,left:ex,collisionPadding:em}}function Wc(en,es){let{expression:ec}=es;if("constant"===ec.kind)return{kind:"constant",layoutSize:ec.evaluate(new zs(en+1))};if("source"===ec.kind)return{kind:"source"};{let{zoomStops:es,interpolationType:ed}=ec,ep=0;for(;ep<es.length&&es[ep]<=en;)ep++;let ef=ep=Math.max(0,ep-1);for(;ef<es.length&&es[ef]<en+1;)ef++;ef=Math.min(es.length-1,ef);let em=es[ep],e_=es[ef];return"composite"===ec.kind?{kind:"composite",minZoom:em,maxZoom:e_,interpolationType:ed}:{kind:"camera",minZoom:em,maxZoom:e_,minSize:ec.evaluate(new zs(em)),maxSize:ec.evaluate(new zs(e_)),interpolationType:ed}}}function Qc(en,es,ec){let ed="never",ep=en.get(es);return ep?ed=ep:en.get(ec)&&(ed="always"),ed}let iG=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eh(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb){let ew=e_?Math.min(32640,Math.round(e_[0])):0,eT=e_?Math.min(32640,Math.round(e_[1])):0;en.emplaceBack(es,ec,Math.round(32*ed),Math.round(32*ep),ef,em,(ew<<1)+(eg?1:0),eT,16*ey,16*ex,256*ev,256*eb)}function rh(en,es,ec){en.emplaceBack(es.x,es.y,ec),en.emplaceBack(es.x,es.y,ec),en.emplaceBack(es.x,es.y,ec),en.emplaceBack(es.x,es.y,ec)}let ih=class ih{constructor(en){this.layoutVertexArray=new Ua,this.indexArray=new Xa,this.programConfigurations=en,this.segments=new Ka,this.dynamicLayoutVertexArray=new ja,this.opacityVertexArray=new Na,this.hasVisibleVertices=!1,this.placedSymbolArray=new Aa}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(en,es,ec,ed){this.isEmpty()||(ec&&(this.layoutVertexBuffer=en.createVertexBuffer(this.layoutVertexArray,iR.members),this.indexBuffer=en.createIndexBuffer(this.indexArray,es),this.dynamicLayoutVertexBuffer=en.createVertexBuffer(this.dynamicLayoutVertexArray,iL.members,!0),this.opacityVertexBuffer=en.createVertexBuffer(this.opacityVertexArray,iG,!0),this.opacityVertexBuffer.itemSize=1),(ec||ed)&&this.programConfigurations.upload(en))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}};os("SymbolBuffers",ih);let sh=class sh{constructor(en,es,ec){this.layoutVertexArray=new en,this.layoutAttributes=es,this.indexArray=new ec,this.segments=new Ka,this.collisionVertexArray=new Ga}upload(en){this.layoutVertexBuffer=en.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=en.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=en.createVertexBuffer(this.collisionVertexArray,iB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}};os("CollisionBuffers",sh);let ah=class ah{constructor(es){this.collisionBoxArray=es.collisionBoxArray,this.zoom=es.zoom,this.overscaling=es.overscaling,this.layers=es.layers,this.layerIds=this.layers.map(en=>en.id),this.index=es.index,this.pixelRatio=es.pixelRatio,this.sourceLayerIndex=es.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let ec=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wc(this.zoom,ec["text-size"]),this.iconSizeData=Wc(this.zoom,ec["icon-size"]);let ed=this.layers[0].layout,ep=ed.get("symbol-sort-key"),ef=ed.get("symbol-z-order");this.canOverlap="never"!==Qc(ed,"text-overlap","text-allow-overlap")||"never"!==Qc(ed,"icon-overlap","icon-allow-overlap")||ed.get("text-ignore-placement")||ed.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==ef&&!ep.isConstant(),this.sortFeaturesByY=("viewport-y"===ef||"auto"===ef&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===ed.get("symbol-placement")&&(this.writingModes=ed.get("text-writing-mode").map(es=>en.ao[es])),this.stateDependentLayerIds=this.layers.filter(en=>en.isStateDependent()).map(en=>en.id),this.sourceID=es.sourceID}createArrays(){this.text=new ih(new Io(this.layers,this.zoom,en=>/^text/.test(en))),this.icon=new ih(new Io(this.layers,this.zoom,en=>/^icon/.test(en))),this.glyphOffsetArray=new Ia,this.lineVertexArray=new za,this.symbolInstances=new Ma,this.textAnchorOffsets=new Ca}calculateGlyphDependencies(en,es,ec,ed,ep){for(let ef=0;ef<en.length;ef++)if(es[en.charCodeAt(ef)]=!0,(ec||ed)&&ep){let ec=ij[en.charAt(ef)];ec&&(es[ec.charCodeAt(0)]=!0)}}populate(es,ec,ed){let ep=this.layers[0],ef=ep.layout,em=ef.get("text-font"),e_=ef.get("text-field"),eg=ef.get("icon-image"),ey=("constant"!==e_.value.kind||e_.value.value instanceof Ce&&!e_.value.value.isEmpty()||e_.value.value.toString().length>0)&&("constant"!==em.value.kind||em.value.value.length>0),ex="constant"!==eg.value.kind||!!eg.value.value||Object.keys(eg.parameters).length>0,ev=ef.get("symbol-sort-key");if(this.features=[],!ey&&!ex)return;let eb=ec.iconDependencies,ew=ec.glyphDependencies,eT=ec.availableImages,eP=new zs(this.zoom);for(let{feature:ec,id:e_,index:eg,sourceLayerIndex:eS}of es){let es,eM;let eC=ep._featureFilter.needGeometry,eI=Bo(ec,eC);if(!ep._featureFilter.filter(eP,eI,ed))continue;if(eC||(eI.geometry=To(ec)),ey){let en=ep.getValueAndResolveTokens("text-field",eI,ed,eT),ec=Ce.factory(en),ef=this.hasRTLText=this.hasRTLText||function(en){for(let es of en.sections)if(function(en){for(let es of en)if(As(es.charCodeAt(0)))return!0;return!1}(es.text))return!0;return!1}(ec);(!ef||"unavailable"===tQ.getRTLTextPluginStatus()||ef&&tQ.isParsed())&&(es=function(en,es,ec){return en.sections.forEach(en=>{en.text=function(en,es,ec){let ed=es.layout.get("text-transform").evaluate(ec,{});return"uppercase"===ed?en=en.toLocaleUpperCase():"lowercase"===ed&&(en=en.toLocaleLowerCase()),tQ.applyArabicShaping&&(en=tQ.applyArabicShaping(en)),en}(en.text,es,ec)}),en}(ec,ep,eI))}if(ex){let en=ep.getValueAndResolveTokens("icon-image",eI,ed,eT);eM=en instanceof $e?en:$e.fromString(en)}if(!es&&!eM)continue;let eE=this.sortFeaturesByKey?ev.evaluate(eI,{},ed):void 0;if(this.features.push({id:e_,text:es,icon:eM,index:eg,sourceLayerIndex:eS,geometry:eI.geometry,properties:ec.properties,type:bu.types[ec.type],sortKey:eE}),eM&&(eb[eM.name]=!0),es){let ec=em.evaluate(eI,{},ed).join(","),ep="viewport"!==ef.get("text-rotation-alignment")&&"point"!==ef.get("symbol-placement");for(let ed of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(en.ao.vertical)>=0,es.sections))if(ed.image)eb[ed.image.name]=!0;else{let en=ys(es.toString()),ef=ed.fontStack||ec,em=ew[ef]=ew[ef]||{};this.calculateGlyphDependencies(ed.text,em,ep,this.allowVerticalPlacement,en)}}}"line"===ef.get("symbol-placement")&&(this.features=function(en){let es={},ec={},ed=[],ep=0;function s(es){ed.push(en[es]),ep++}function a(en,es,ep){let ef=ec[en];return delete ec[en],ec[es]=ef,ed[ef].geometry[0].pop(),ed[ef].geometry[0]=ed[ef].geometry[0].concat(ep[0]),ef}function o(en,ec,ep){let ef=es[ec];return delete es[ec],es[en]=ef,ed[ef].geometry[0].shift(),ed[ef].geometry[0]=ep[0].concat(ed[ef].geometry[0]),ef}function l(en,es,ec){let ed=ec?es[0][es[0].length-1]:es[0][0];return`${en}:${ed.x}:${ed.y}`}for(let ef=0;ef<en.length;ef++){let em=en[ef],e_=em.geometry,eg=em.text?em.text.toString():null;if(!eg){s(ef);continue}let ey=l(eg,e_),ex=l(eg,e_,!0);if(ey in ec&&ex in es&&ec[ey]!==es[ex]){let en=o(ey,ex,e_),ep=a(ey,ex,ed[en].geometry);delete es[ey],delete ec[ex],ec[l(eg,ed[ep].geometry,!0)]=ep,ed[en].geometry=null}else ey in ec?a(ey,ex,e_):ex in es?o(ey,ex,e_):(s(ef),es[ey]=ep-1,ec[ex]=ep-1)}return ed.filter(en=>en.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((en,es)=>en.sortKey-es.sortKey)}update(en,es,ec){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(en,es,this.layers,{imagePositions:ec}),this.icon.programConfigurations.updatePaintArrays(en,es,this.layers,{imagePositions:ec}))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(en){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(en),this.iconCollisionBox.upload(en)),this.text.upload(en,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(en,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(en,es){let ec=this.lineVertexArray.length;if(void 0!==en.segment){let ec=en.dist(es[en.segment+1]),ed=en.dist(es[en.segment]),ep={};for(let ed=en.segment+1;ed<es.length;ed++)ep[ed]={x:es[ed].x,y:es[ed].y,tileUnitDistanceFromAnchor:ec},ed<es.length-1&&(ec+=es[ed+1].dist(es[ed]));for(let ec=en.segment||0;ec>=0;ec--)ep[ec]={x:es[ec].x,y:es[ec].y,tileUnitDistanceFromAnchor:ed},ec>0&&(ed+=es[ec-1].dist(es[ec]));for(let en=0;en<es.length;en++){let es=ep[en];this.lineVertexArray.emplaceBack(es.x,es.y,es.tileUnitDistanceFromAnchor)}}return{lineStartIndex:ec,lineLength:this.lineVertexArray.length-ec}}addSymbols(es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb){let ew=es.indexArray,eT=es.layoutVertexArray,eP=es.segments.prepareSegment(4*ec.length,eT,ew,this.canOverlap?em.sortKey:void 0),eS=this.glyphOffsetArray.length,eM=eP.vertexLength,eC=this.allowVerticalPlacement&&e_===en.ao.vertical?Math.PI/2:0,eI=em.text&&em.text.sections;for(let en=0;en<ec.length;en++){let{tl:ep,tr:ef,bl:e_,br:ey,tex:ex,pixelOffsetTL:ev,pixelOffsetBR:eS,minFontScaleX:eM,minFontScaleY:eE,glyphOffset:eA,isSDF:ez,sectionIndex:ek}=ec[en],eD=eP.vertexLength,eR=eA[1];eh(eT,eg.x,eg.y,ep.x,eR+ep.y,ex.x,ex.y,ed,ez,ev.x,ev.y,eM,eE),eh(eT,eg.x,eg.y,ef.x,eR+ef.y,ex.x+ex.w,ex.y,ed,ez,eS.x,ev.y,eM,eE),eh(eT,eg.x,eg.y,e_.x,eR+e_.y,ex.x,ex.y+ex.h,ed,ez,ev.x,eS.y,eM,eE),eh(eT,eg.x,eg.y,ey.x,eR+ey.y,ex.x+ex.w,ex.y+ex.h,ed,ez,eS.x,eS.y,eM,eE),rh(es.dynamicLayoutVertexArray,eg,eC),ew.emplaceBack(eD,eD+2,eD+1),ew.emplaceBack(eD+1,eD+2,eD+3),eP.vertexLength+=4,eP.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(eA[0]),en!==ec.length-1&&ek===ec[en+1].sectionIndex||es.programConfigurations.populatePaintArrays(eT.length,em,em.index,{imagePositions:{},canonical:eb,formattedSection:eI&&eI[ek]})}es.placedSymbolArray.emplaceBack(eg.x,eg.y,eS,this.glyphOffsetArray.length-eS,eM,ey,ex,eg.segment,ed?ed[0]:0,ed?ed[1]:0,ep[0],ep[1],e_,0,!1,0,ev)}_addCollisionDebugVertex(en,es,ec,ed,ep,ef){return es.emplaceBack(0,0),en.emplaceBack(ec.x,ec.y,ed,ep,Math.round(ef.x),Math.round(ef.y))}addCollisionDebugVertices(en,es,ec,ed,ep,ef,em){let e_=ep.segments.prepareSegment(4,ep.layoutVertexArray,ep.indexArray),eg=e_.vertexLength,ey=ep.layoutVertexArray,ex=ep.collisionVertexArray,ev=em.anchorX,eb=em.anchorY;this._addCollisionDebugVertex(ey,ex,ef,ev,eb,new r(en,es)),this._addCollisionDebugVertex(ey,ex,ef,ev,eb,new r(ec,es)),this._addCollisionDebugVertex(ey,ex,ef,ev,eb,new r(ec,ed)),this._addCollisionDebugVertex(ey,ex,ef,ev,eb,new r(en,ed)),e_.vertexLength+=4;let ew=ep.indexArray;ew.emplaceBack(eg,eg+1),ew.emplaceBack(eg+1,eg+2),ew.emplaceBack(eg+2,eg+3),ew.emplaceBack(eg+3,eg),e_.primitiveLength+=4}addDebugCollisionBoxes(en,es,ec,ed){for(let ep=en;ep<es;ep++){let en=this.collisionBoxArray.get(ep);this.addCollisionDebugVertices(en.x1,en.y1,en.x2,en.y2,ed?this.textCollisionBox:this.iconCollisionBox,en.anchorPoint,ec)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sh(qa,iF.members,Za),this.iconCollisionBox=new sh(qa,iF.members,Za);for(let en=0;en<this.symbolInstances.length;en++){let es=this.symbolInstances.get(en);this.addDebugCollisionBoxes(es.textBoxStartIndex,es.textBoxEndIndex,es,!0),this.addDebugCollisionBoxes(es.verticalTextBoxStartIndex,es.verticalTextBoxEndIndex,es,!0),this.addDebugCollisionBoxes(es.iconBoxStartIndex,es.iconBoxEndIndex,es,!1),this.addDebugCollisionBoxes(es.verticalIconBoxStartIndex,es.verticalIconBoxEndIndex,es,!1)}}_deserializeCollisionBoxesForSymbol(en,es,ec,ed,ep,ef,em,e_,eg){let ey={};for(let ed=es;ed<ec;ed++){let es=en.get(ed);ey.textBox={x1:es.x1,y1:es.y1,x2:es.x2,y2:es.y2,anchorPointX:es.anchorPointX,anchorPointY:es.anchorPointY},ey.textFeatureIndex=es.featureIndex;break}for(let es=ed;es<ep;es++){let ec=en.get(es);ey.verticalTextBox={x1:ec.x1,y1:ec.y1,x2:ec.x2,y2:ec.y2,anchorPointX:ec.anchorPointX,anchorPointY:ec.anchorPointY},ey.verticalTextFeatureIndex=ec.featureIndex;break}for(let es=ef;es<em;es++){let ec=en.get(es);ey.iconBox={x1:ec.x1,y1:ec.y1,x2:ec.x2,y2:ec.y2,anchorPointX:ec.anchorPointX,anchorPointY:ec.anchorPointY},ey.iconFeatureIndex=ec.featureIndex;break}for(let es=e_;es<eg;es++){let ec=en.get(es);ey.verticalIconBox={x1:ec.x1,y1:ec.y1,x2:ec.x2,y2:ec.y2,anchorPointX:ec.anchorPointX,anchorPointY:ec.anchorPointY},ey.verticalIconFeatureIndex=ec.featureIndex;break}return ey}deserializeCollisionBoxes(en){this.collisionArrays=[];for(let es=0;es<this.symbolInstances.length;es++){let ec=this.symbolInstances.get(es);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(en,ec.textBoxStartIndex,ec.textBoxEndIndex,ec.verticalTextBoxStartIndex,ec.verticalTextBoxEndIndex,ec.iconBoxStartIndex,ec.iconBoxEndIndex,ec.verticalIconBoxStartIndex,ec.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(en,es){let ec=en.placedSymbolArray.get(es),ed=ec.vertexStartIndex+4*ec.numGlyphs;for(let es=ec.vertexStartIndex;es<ed;es+=4)en.indexArray.emplaceBack(es,es+2,es+1),en.indexArray.emplaceBack(es+1,es+2,es+3)}getSortedSymbolIndexes(en){if(this.sortedAngle===en&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let es=Math.sin(en),ec=Math.cos(en),ed=[],ep=[],ef=[];for(let en=0;en<this.symbolInstances.length;++en){ef.push(en);let em=this.symbolInstances.get(en);ed.push(0|Math.round(es*em.anchorX+ec*em.anchorY)),ep.push(em.featureIndex)}return ef.sort((en,es)=>ed[en]-ed[es]||ep[es]-ep[en]),ef}addToSortKeyRanges(en,es){let ec=this.sortKeyRanges[this.sortKeyRanges.length-1];ec&&ec.sortKey===es?ec.symbolInstanceEnd=en+1:this.sortKeyRanges.push({sortKey:es,symbolInstanceStart:en,symbolInstanceEnd:en+1})}sortFeatures(en){if(this.sortFeaturesByY&&this.sortedAngle!==en&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let es of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(en),this.sortedAngle=en,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let en=this.symbolInstances.get(es);this.featureSortOrder.push(en.featureIndex),[en.rightJustifiedTextSymbolIndex,en.centerJustifiedTextSymbolIndex,en.leftJustifiedTextSymbolIndex].forEach((en,es,ec)=>{en>=0&&ec.indexOf(en)===es&&this.addIndicesForPlacedSymbol(this.text,en)}),en.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,en.verticalPlacedTextSymbolIndex),en.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,en.placedIconSymbolIndex),en.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,en.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}};os("SymbolBucket",ah,{omit:["layers","collisionBoxArray","features","compareText"]}),ah.MAX_GLYPHS=65535,ah.addDynamicAttributes=rh;var i$={get paint(){return eM=eM||new Ns({"icon-opacity":new Os(eG.paint_symbol["icon-opacity"]),"icon-color":new Os(eG.paint_symbol["icon-color"]),"icon-halo-color":new Os(eG.paint_symbol["icon-halo-color"]),"icon-halo-width":new Os(eG.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Os(eG.paint_symbol["icon-halo-blur"]),"icon-translate":new Ls(eG.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ls(eG.paint_symbol["icon-translate-anchor"]),"text-opacity":new Os(eG.paint_symbol["text-opacity"]),"text-color":new Os(eG.paint_symbol["text-color"],{runtimeType:eK,getOverride:en=>en.textColor,hasOverride:en=>!!en.textColor}),"text-halo-color":new Os(eG.paint_symbol["text-halo-color"]),"text-halo-width":new Os(eG.paint_symbol["text-halo-width"]),"text-halo-blur":new Os(eG.paint_symbol["text-halo-blur"]),"text-translate":new Ls(eG.paint_symbol["text-translate"]),"text-translate-anchor":new Ls(eG.paint_symbol["text-translate-anchor"])})},get layout(){return eS=eS||new Ns({"symbol-placement":new Ls(eG.layout_symbol["symbol-placement"]),"symbol-spacing":new Ls(eG.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ls(eG.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Os(eG.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ls(eG.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ls(eG.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ls(eG.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ls(eG.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ls(eG.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ls(eG.layout_symbol["icon-rotation-alignment"]),"icon-size":new Os(eG.layout_symbol["icon-size"]),"icon-text-fit":new Ls(eG.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ls(eG.layout_symbol["icon-text-fit-padding"]),"icon-image":new Os(eG.layout_symbol["icon-image"]),"icon-rotate":new Os(eG.layout_symbol["icon-rotate"]),"icon-padding":new Os(eG.layout_symbol["icon-padding"]),"icon-keep-upright":new Ls(eG.layout_symbol["icon-keep-upright"]),"icon-offset":new Os(eG.layout_symbol["icon-offset"]),"icon-anchor":new Os(eG.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ls(eG.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ls(eG.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ls(eG.layout_symbol["text-rotation-alignment"]),"text-field":new Os(eG.layout_symbol["text-field"]),"text-font":new Os(eG.layout_symbol["text-font"]),"text-size":new Os(eG.layout_symbol["text-size"]),"text-max-width":new Os(eG.layout_symbol["text-max-width"]),"text-line-height":new Ls(eG.layout_symbol["text-line-height"]),"text-letter-spacing":new Os(eG.layout_symbol["text-letter-spacing"]),"text-justify":new Os(eG.layout_symbol["text-justify"]),"text-radial-offset":new Os(eG.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ls(eG.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Os(eG.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Os(eG.layout_symbol["text-anchor"]),"text-max-angle":new Ls(eG.layout_symbol["text-max-angle"]),"text-writing-mode":new Ls(eG.layout_symbol["text-writing-mode"]),"text-rotate":new Os(eG.layout_symbol["text-rotate"]),"text-padding":new Ls(eG.layout_symbol["text-padding"]),"text-keep-upright":new Ls(eG.layout_symbol["text-keep-upright"]),"text-transform":new Os(eG.layout_symbol["text-transform"]),"text-offset":new Os(eG.layout_symbol["text-offset"]),"text-allow-overlap":new Ls(eG.layout_symbol["text-allow-overlap"]),"text-overlap":new Ls(eG.layout_symbol["text-overlap"]),"text-ignore-placement":new Ls(eG.layout_symbol["text-ignore-placement"]),"text-optional":new Ls(eG.layout_symbol["text-optional"])})}};let ch=class ch{constructor(en){if(void 0===en.property.overrides)throw Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=en.property.overrides?en.property.overrides.runtimeType:eq,this.defaultValue=en}evaluate(en){if(en.formattedSection){let es=this.defaultValue.property.overrides;if(es&&es.hasOverride(en.formattedSection))return es.getOverride(en.formattedSection)}return en.feature&&en.featureState?this.defaultValue.evaluate(en.feature,en.featureState):this.defaultValue.property.specification.default}eachChild(en){this.defaultValue.isConstant()||en(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}};os("FormatSectionOverride",ch,{omit:["defaultValue"]});let hh=class hh extends Gs{constructor(en,es){super(en,i$,es)}recalculate(en,es){if(super.recalculate(en,es),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){let en=this.layout.get("text-writing-mode");if(en){let es=[];for(let ec of en)0>es.indexOf(ec)&&es.push(ec);this.layout._values["text-writing-mode"]=es}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(en,es,ec,ed){var ep;let ef=this.layout.get(en).evaluate(es,{},ec,ed),em=this._unevaluatedLayout._values[en];return em.isDataDriven()||ei(em.value)||!ef?ef:(ep=es.properties,ef.replace(/{([^{}]+)}/g,(en,es)=>ep&&es in ep?String(ep[es]):""))}createBucket(en){return new ah(en)}queryRadius(){return 0}queryIntersectsFeature(){throw Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let en of i$.paint.overridableProperties){if(!hh.hasPaintOverride(this.layout,en))continue;let es=this.paint.get(en),ec=new ch(es),ed=new ti(ec,es.property.specification),ep=null;ep="constant"===es.value.kind||"source"===es.value.kind?new ni("source",ed):new ii("composite",ed,es.value.zoomStops),this.paint._values[en]=new Ds(es.property,ep,es.parameters)}}_handleOverridablePaintPropertyUpdate(en,es,ec){return!(!this.layout||es.isDataDriven()||ec.isDataDriven())&&hh.hasPaintOverride(this.layout,en)}static hasPaintOverride(en,es){let ec=en.get("text-field"),ed=i$.paint.properties[es],ep=!1,s=en=>{for(let es of en)if(ed.overrides&&ed.overrides.hasOverride(es))return void(ep=!0)};if("constant"===ec.value.kind&&ec.value.value instanceof Ce)s(ec.value.value.sections);else if("source"===ec.value.kind||"composite"===ec.value.kind){let t=en=>{ep||(en instanceof Ne&&Ue(en.value)===e1?s(en.value.sections):en instanceof Ir?s(en.sections):en.eachChild(t))},en=ec.value;en._styleExpression&&t(en._styleExpression.expression)}return ep}};var iq={get paint(){return eC=eC||new Ns({"background-color":new Ls(eG.paint_background["background-color"]),"background-pattern":new Us(eG.paint_background["background-pattern"]),"background-opacity":new Ls(eG.paint_background["background-opacity"])})}};let dh=class dh extends Gs{constructor(en,es){super(en,iq,es)}};var iW={get paint(){return eI=eI||new Ns({"raster-opacity":new Ls(eG.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ls(eG.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ls(eG.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ls(eG.paint_raster["raster-brightness-max"]),"raster-saturation":new Ls(eG.paint_raster["raster-saturation"]),"raster-contrast":new Ls(eG.paint_raster["raster-contrast"]),"raster-resampling":new Ls(eG.paint_raster["raster-resampling"]),"raster-fade-duration":new Ls(eG.paint_raster["raster-fade-duration"])})}};let gh=class gh extends Gs{constructor(en,es){super(en,iW,es)}};let xh=class xh extends Gs{constructor(en,es){super(en,{},es),this.onAdd=en=>{this.implementation.onAdd&&this.implementation.onAdd(en,en.painter.context.gl)},this.onRemove=en=>{this.implementation.onRemove&&this.implementation.onRemove(en,en.painter.context.gl)},this.implementation=en}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw Error("Custom layers cannot be serialized")}};let vh=class vh{constructor(en){this._methodToThrottle=en,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}};let iH={once:!0};let _h=class _h{constructor(en,es){if(isNaN(en)||isNaN(es))throw Error(`Invalid LngLat object: (${en}, ${es})`);if(this.lng=+en,this.lat=+es,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _h($(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(en){let es=Math.PI/180,ec=this.lat*es,ed=en.lat*es,ep=Math.sin(ec)*Math.sin(ed)+Math.cos(ec)*Math.cos(ed)*Math.cos((en.lng-this.lng)*es);return 6371008.8*Math.acos(Math.min(ep,1))}static convert(en){if(en instanceof _h)return en;if(Array.isArray(en)&&(2===en.length||3===en.length))return new _h(Number(en[0]),Number(en[1]));if(!Array.isArray(en)&&"object"==typeof en&&null!==en)return new _h(Number("lng"in en?en.lng:en.lon),Number(en.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};let iX=2*Math.PI*6371008.8;function Ah(en){return iX*Math.cos(en*Math.PI/180)}function kh(en){return(180+en)/360}function Mh(en){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+en*Math.PI/360)))/360}function zh(en){return 360/Math.PI*Math.atan(Math.exp((180-360*en)*Math.PI/180))-90}function Ph(en,es){return en*Ah(zh(es))}let Ch=class Ch{constructor(en,es,ec=0){this.x=+en,this.y=+es,this.z=+ec}static fromLngLat(en,es=0){let ec=_h.convert(en);return new Ch(kh(ec.lng),Mh(ec.lat),es/Ah(ec.lat))}toLngLat(){return new _h(360*this.x-180,zh(this.y))}toAltitude(){return Ph(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/iX*(1/Math.cos(zh(this.y)*Math.PI/180))}};function Eh(en,es,ec){var ed=2*Math.PI*6378137/256/Math.pow(2,ec);return[en*ed-2*Math.PI*6378137/2,es*ed-2*Math.PI*6378137/2]}let Th=class Th{constructor(en,es,ec){if(en<0||en>25||ec<0||ec>=Math.pow(2,en)||es<0||es>=Math.pow(2,en))throw Error(`x=${es}, y=${ec}, z=${en} outside of bounds. 0<=x<${Math.pow(2,en)}, 0<=y<${Math.pow(2,en)} 0<=z<=25 `);this.z=en,this.x=es,this.y=ec,this.key=Fh(0,en,en,es,ec)}equals(en){return this.z===en.z&&this.x===en.x&&this.y===en.y}url(en,es,ec){var ed,ep,ef,em,e_;let eg=(ep=this.y,ef=this.z,em=Eh(256*(ed=this.x),256*(ep=Math.pow(2,ef)-ep-1),ef),e_=Eh(256*(ed+1),256*(ep+1),ef),em[0]+","+em[1]+","+e_[0]+","+e_[1]),ey=function(en,es,ec){let ed,ep="";for(let ef=en;ef>0;ef--)ep+=(es&(ed=1<<ef-1)?1:0)+(ec&ed?2:0);return ep}(this.z,this.x,this.y);return en[(this.x+this.y)%en.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===ec?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,es>1?"@2x":"").replace(/{quadkey}/g,ey).replace(/{bbox-epsg-3857}/g,eg)}isChildOf(en){let es=this.z-en.z;return es>0&&en.x===this.x>>es&&en.y===this.y>>es}getTilePoint(en){let es=Math.pow(2,this.z);return new r((en.x*es-this.x)*8192,(en.y*es-this.y)*8192)}toString(){return`${this.z}/${this.x}/${this.y}`}};let Bh=class Bh{constructor(en,es){this.wrap=en,this.canonical=es,this.key=Fh(en,es.z,es.z,es.x,es.y)}};let Vh=class Vh{constructor(en,es,ec,ed,ep){if(this.terrainRttPosMatrix32f=null,en<ec)throw Error(`overscaledZ should be >= z; overscaledZ = ${en}; z = ${ec}`);this.overscaledZ=en,this.wrap=es,this.canonical=new Th(ec,+ed,+ep),this.key=Fh(es,en,ec,ed,ep)}clone(){return new Vh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(en){return this.overscaledZ===en.overscaledZ&&this.wrap===en.wrap&&this.canonical.equals(en.canonical)}scaledTo(en){if(en>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${en}; overscaledZ = ${this.overscaledZ}`);let es=this.canonical.z-en;return en>this.canonical.z?new Vh(en,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vh(en,this.wrap,en,this.canonical.x>>es,this.canonical.y>>es)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(en,es){if(en>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${en}; overscaledZ = ${this.overscaledZ}`);let ec=this.canonical.z-en;return en>this.canonical.z?Fh(this.wrap*+es,en,this.canonical.z,this.canonical.x,this.canonical.y):Fh(this.wrap*+es,en,en,this.canonical.x>>ec,this.canonical.y>>ec)}isChildOf(en){if(en.wrap!==this.wrap||this.overscaledZ-en.overscaledZ<=0)return!1;if(0===en.overscaledZ)return this.overscaledZ>0;let es=this.canonical.z-en.canonical.z;return!(es<0)&&en.canonical.x===this.canonical.x>>es&&en.canonical.y===this.canonical.y>>es}children(en){if(this.overscaledZ>=en)return[new Vh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let es=this.canonical.z+1,ec=2*this.canonical.x,ed=2*this.canonical.y;return[new Vh(es,this.wrap,es,ec,ed),new Vh(es,this.wrap,es,ec+1,ed),new Vh(es,this.wrap,es,ec,ed+1),new Vh(es,this.wrap,es,ec+1,ed+1)]}isLessThan(en){return this.wrap<en.wrap||!(this.wrap>en.wrap)&&(this.overscaledZ<en.overscaledZ||!(this.overscaledZ>en.overscaledZ)&&(this.canonical.x<en.canonical.x||!(this.canonical.x>en.canonical.x)&&this.canonical.y<en.canonical.y))}wrapped(){return new Vh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(en){return new Vh(this.overscaledZ,en,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Bh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(en){return this.canonical.getTilePoint(new Ch(en.x-this.wrap,en.y))}};function Fh(en,es,ec,ed,ep){(en*=2)<0&&(en=-1*en-1);let ef=1<<ec;return(ef*ef*en+ef*ep+ed).toString(36)+ec.toString(36)+es.toString(36)}function Dh(en,es){return es?en.properties[es]:en.id}os("CanonicalTileID",Th),os("OverscaledTileID",Vh,{omit:["terrainRttPosMatrix32f"]});let $h=class $h{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(en){return this.minX=Math.min(this.minX,en.x),this.minY=Math.min(this.minY,en.y),this.maxX=Math.max(this.maxX,en.x),this.maxY=Math.max(this.maxY,en.y),this}expandBy(en){return this.minX-=en,this.minY-=en,this.maxX+=en,this.maxY+=en,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(en){return this.expandBy(-en)}map(en){let es=new $h;return es.extend(en(new r(this.minX,this.minY))),es.extend(en(new r(this.maxX,this.minY))),es.extend(en(new r(this.minX,this.maxY))),es.extend(en(new r(this.maxX,this.maxY))),es}static fromPoints(en){let es=new $h;for(let ec of en)es.extend(ec);return es}contains(en){return en.x>=this.minX&&en.x<=this.maxX&&en.y>=this.minY&&en.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(en){return!this.empty()&&!en.empty()&&en.minX>=this.minX&&en.maxX<=this.maxX&&en.minY>=this.minY&&en.maxY<=this.maxY}intersects(en){return!this.empty()&&!en.empty()&&en.minX<=this.maxX&&en.maxX>=this.minX&&en.minY<=this.maxY&&en.maxY>=this.minY}};let Lh=class Lh{constructor(en){this._stringToNumber={},this._numberToString=[];for(let es=0;es<en.length;es++){let ec=en[es];this._stringToNumber[ec]=es,this._numberToString[es]=ec}}encode(en){return this._stringToNumber[en]}decode(en){if(en>=this._numberToString.length)throw Error(`Out of bounds. Index requested n=${en} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[en]}};let Oh=class Oh{constructor(en,es,ec,ed,ep){this.type="Feature",this._vectorTileFeature=en,en._z=es,en._x=ec,en._y=ed,this.properties=en.properties,this.id=ep}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(en){this._geometry=en}toJSON(){let en={geometry:this.geometry};for(let es in this)"_geometry"!==es&&"_vectorTileFeature"!==es&&(en[es]=this[es]);return en}};let Rh=class Rh{constructor(en,es){this.tileID=en,this.x=en.canonical.x,this.y=en.canonical.y,this.z=en.canonical.z,this.grid=new ss(8192,16,0),this.grid3D=new ss(8192,16,0),this.featureIndexArray=new Ta,this.promoteId=es}insert(en,es,ec,ed,ep,ef){let em=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(ec,ed,ep);let e_=ef?this.grid3D:this.grid;for(let en=0;en<es.length;en++){let ec=es[en],ed=[1/0,1/0,-1/0,-1/0];for(let en=0;en<ec.length;en++){let es=ec[en];ed[0]=Math.min(ed[0],es.x),ed[1]=Math.min(ed[1],es.y),ed[2]=Math.max(ed[2],es.x),ed[3]=Math.max(ed[3],es.y)}ed[0]<8192&&ed[1]<8192&&ed[2]>=0&&ed[3]>=0&&e_.insert(em,ed[0],ed[1],ed[2],ed[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ku(new uc(this.rawTileData)).layers,this.sourceLayerCoder=new Lh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(en,es,ec,ed){let ep;this.loadVTLayers();let ef=en.params,em=8192/en.tileSize/en.scale,e_=pi(ef.filter,ef.globalState),eg=en.queryGeometry,ey=en.queryPadding*em,ex=$h.fromPoints(eg),ev=this.grid.query(ex.minX-ey,ex.minY-ey,ex.maxX+ey,ex.maxY+ey),eb=$h.fromPoints(en.cameraQueryGeometry).expandBy(ey),ew=this.grid3D.query(eb.minX,eb.minY,eb.maxX,eb.maxY,(es,ec,ed,ep)=>(function(en,es,ec,ed,ep){for(let ef of en)if(es<=ef.x&&ec<=ef.y&&ed>=ef.x&&ep>=ef.y)return!0;let ef=[new r(es,ec),new r(es,ep),new r(ed,ep),new r(ed,ec)];if(en.length>2){for(let es of ef)if(Xo(en,es))return!0}for(let es=0;es<en.length-1;es++)if(function(en,es,ec){let ed=ec[0],ep=ec[2];if(en.x<ed.x&&es.x<ed.x||en.x>ep.x&&es.x>ep.x||en.y<ed.y&&es.y<ed.y||en.y>ep.y&&es.y>ep.y)return!1;let ef=G(en,es,ec[0]);return ef!==G(en,es,ec[1])||ef!==G(en,es,ec[2])||ef!==G(en,es,ec[3])}(en[es],en[es+1],ef))return!0;return!1})(en.cameraQueryGeometry,es-ey,ec-ey,ed+ey,ep+ey));for(let en of ew)ev.push(en);ev.sort(jh);let eT={};for(let ey=0;ey<ev.length;ey++){let ex=ev[ey];if(ex===ep)continue;ep=ex;let eb=this.featureIndexArray.get(ex),ew=null;this.loadMatchingFeature(eT,eb.bucketIndex,eb.sourceLayerIndex,eb.featureIndex,e_,ef.layers,ef.availableImages,es,ec,ed,(es,ec,ed)=>(ew||(ew=To(es)),ec.queryIntersectsFeature({queryGeometry:eg,feature:es,featureState:ed,geometry:ew,zoom:this.z,transform:en.transform,pixelsToTileUnits:em,pixelPosMatrix:en.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:en.getElevation})))}return eT}loadMatchingFeature(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex){let ev=this.bucketLayerIDs[es];if(ef&&!ev.some(en=>ef.has(en)))return;let eb=this.sourceLayerCoder.decode(ec),ew=this.vtLayers[eb].feature(ed);if(ep.needGeometry){let en=Bo(ew,!0);if(!ep.filter(new zs(this.tileID.overscaledZ),en,this.tileID.canonical))return}else if(!ep.filter(new zs(this.tileID.overscaledZ),ew))return;let eT=this.getId(ew,eb);for(let es=0;es<ev.length;es++){let ec=ev[es];if(ef&&!ef.has(ec))continue;let ep=e_[ec];if(!ep)continue;let eb={};eT&&ey&&(eb=ey.getState(ep.sourceLayer||"_geojsonTileLayer",eT));let eP=L({},eg[ec]);eP.paint=Uh(eP.paint,ep.paint,ew,eb,em),eP.layout=Uh(eP.layout,ep.layout,ew,eb,em);let eS=!ex||ex(ew,ep,eb);if(!eS)continue;let eM=new Oh(ew,this.z,this.x,this.y,eT);eM.layer=eP;let eC=en[ec];void 0===eC&&(eC=en[ec]=[]),eC.push({featureIndex:ed,feature:eM,intersectionZ:eS})}}lookupSymbolFeatures(en,es,ec,ed,ep,ef,em,e_){let eg={};this.loadVTLayers();let ey=pi(ep.filterSpec,ep.globalState);for(let ep of en)this.loadMatchingFeature(eg,ec,ed,ep,ey,ef,em,e_,es);return eg}hasLayer(en){for(let es of this.bucketLayerIDs)for(let ec of es)if(en===ec)return!0;return!1}getId(en,es){var ec;let ed=en.id;return this.promoteId&&("boolean"==typeof(ed=en.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[es]])&&(ed=Number(ed)),void 0===ed&&(null===(ec=en.properties)||void 0===ec?void 0:ec.cluster)&&this.promoteId&&(ed=Number(en.properties.cluster_id))),ed}};function Uh(en,es,ec,ed,ep){return R(en,(en,ef)=>{let em=es instanceof $s?es.get(ef):null;return em&&em.evaluate?em.evaluate(ec,ed,ep):em})}function jh(en,es){return es-en}function Nh(en,es,ec,ed,ep){let ef=[];for(let em=0;em<en.length;em++){let e_;let eg=en[em];for(let en=0;en<eg.length-1;en++){let em=eg[en],ey=eg[en+1];em.x<es&&ey.x<es||(em.x<es?em=new r(es,em.y+(es-em.x)/(ey.x-em.x)*(ey.y-em.y))._round():ey.x<es&&(ey=new r(es,em.y+(es-em.x)/(ey.x-em.x)*(ey.y-em.y))._round()),em.y<ec&&ey.y<ec||(em.y<ec?em=new r(em.x+(ec-em.y)/(ey.y-em.y)*(ey.x-em.x),ec)._round():ey.y<ec&&(ey=new r(em.x+(ec-em.y)/(ey.y-em.y)*(ey.x-em.x),ec)._round()),em.x>=ed&&ey.x>=ed||(em.x>=ed?em=new r(ed,em.y+(ed-em.x)/(ey.x-em.x)*(ey.y-em.y))._round():ey.x>=ed&&(ey=new r(ed,em.y+(ed-em.x)/(ey.x-em.x)*(ey.y-em.y))._round()),em.y>=ep&&ey.y>=ep||(em.y>=ep?em=new r(em.x+(ep-em.y)/(ey.y-em.y)*(ey.x-em.x),ep)._round():ey.y>=ep&&(ey=new r(em.x+(ep-em.y)/(ey.y-em.y)*(ey.x-em.x),ep)._round()),e_&&em.equals(e_[e_.length-1])||(e_=[em],ef.push(e_)),e_.push(ey)))))}}return ef}os("FeatureIndex",Rh,{omit:["rawTileData","sourceLayerCoder"]});let qh=class qh extends r{constructor(en,es,ec,ed){super(en,es),this.angle=ec,void 0!==ed&&(this.segment=ed)}clone(){return new qh(this.x,this.y,this.angle,this.segment)}};function Gh(en,es,ec,ed,ep){if(void 0===es.segment||0===ec)return!0;let ef=es,em=es.segment+1,e_=0;for(;e_>-ec/2;){if(--em<0)return!1;e_-=en[em].dist(ef),ef=en[em]}e_+=en[em].dist(en[em+1]),em++;let eg=[],ey=0;for(;e_<ec/2;){let es=en[em],ec=en[em+1];if(!ec)return!1;let ef=en[em-1].angleTo(es)-es.angleTo(ec);for(ef=Math.abs((ef+3*Math.PI)%(2*Math.PI)-Math.PI),eg.push({distance:e_,angleDelta:ef}),ey+=ef;e_-eg[0].distance>ed;)ey-=eg.shift().angleDelta;if(ey>ep)return!1;em++,e_+=es.dist(ec)}return!0}function Xh(en){let es=0;for(let ec=0;ec<en.length-1;ec++)es+=en[ec].dist(en[ec+1]);return es}function Yh(en,es){return Math.max(en?en.right-en.left:0,es?es.right-es.left:0)}function Wh(en,es,ec,ed){let ep=[],ef=en.image,em=ef.pixelRatio,e_=ef.paddedRect.w-2,eg=ef.paddedRect.h-2,ey={x1:en.left,y1:en.top,x2:en.right,y2:en.bottom},ex=ef.stretchX||[[0,e_]],ev=ef.stretchY||[[0,eg]],f=(en,es)=>en+es[1]-es[0],eb=ex.reduce(f,0),ew=ev.reduce(f,0),eT=e_-eb,eP=eg-ew,eS=0,eM=eb,eC=0,eI=ew,eE=0,eA=eT,ez=0,ek=eP;if(ef.content&&ed){let es=ef.content,ec=es[2]-es[0],ed=es[3]-es[1];(ef.textFitWidth||ef.textFitHeight)&&(ey=Yc(en)),eS=Qh(ex,0,es[0]),eC=Qh(ev,0,es[1]),eM=Qh(ex,es[0],es[2]),eI=Qh(ev,es[1],es[3]),eE=es[0]-eS,ez=es[1]-eC,eA=ec-eM,ek=ed-eI}let eD=ey.x1,eR=ey.y1,eL=ey.x2-eD,eB=ey.y2-eR,C=(en,ed,ep,e_)=>{var eg,ey,ex,ev,eT,eP,eF,eO;let ej=(en.stretch-eS)/eM*eL+eD,eV=(ey=en.fixed-eE,ey-eA*en.stretch/eb),eU=(ed.stretch-eC)/eI*eB+eR,eN=(ev=ed.fixed-ez,ev-ek*ed.stretch/ew),eZ=(ep.stretch-eS)/eM*eL+eD,eG=(eP=ep.fixed-eE,eP-eA*ep.stretch/eb),e$=(e_.stretch-eC)/eI*eB+eR,eq=(eO=e_.fixed-ez,eO-ek*e_.stretch/ew),eW=new r(ej,eU),eH=new r(eZ,eU),eX=new r(eZ,e$),eK=new r(ej,e$),eY=new r(eV/em,eN/em),eJ=new r(eG/em,eq/em),eQ=es*Math.PI/180;if(eQ){let en=Math.sin(eQ),es=Math.cos(eQ),ec=[es,-en,en,es];eW._matMult(ec),eH._matMult(ec),eK._matMult(ec),eX._matMult(ec)}let e0=en.stretch+en.fixed,e1=ed.stretch+ed.fixed;return{tl:eW,tr:eH,bl:eK,br:eX,tex:{x:ef.paddedRect.x+1+e0,y:ef.paddedRect.y+1+e1,w:ep.stretch+ep.fixed-e0,h:e_.stretch+e_.fixed-e1},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:eY,pixelOffsetBR:eJ,minFontScaleX:eA/em/eL,minFontScaleY:ek/em/eB,isSDF:ec}};if(ed&&(ef.stretchX||ef.stretchY)){let en=tp(ex,eT,eb),es=tp(ev,eP,ew);for(let ec=0;ec<en.length-1;ec++){let ed=en[ec],ef=en[ec+1];for(let en=0;en<es.length-1;en++)ep.push(C(ed,es[en],ef,es[en+1]))}}else ep.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:e_+1},{fixed:0,stretch:eg+1}));return ep}function Qh(en,es,ec){let ed=0;for(let ep of en)ed+=Math.max(es,Math.min(ec,ep[1]))-Math.max(es,Math.min(ec,ep[0]));return ed}function tp(en,es,ec){let ed=[{fixed:-1,stretch:0}];for(let[es,ec]of en){let en=ed[ed.length-1];ed.push({fixed:es-en.stretch,stretch:en.stretch}),ed.push({fixed:es-en.stretch,stretch:en.stretch+(ec-es)})}return ed.push({fixed:es+1,stretch:ec}),ed}os("Anchor",qh);let np=class np{constructor(en,es,ec,ed,ep,ef,em,e_,eg,ey){var ex;if(this.boxStartIndex=en.length,eg){let en=ef.top,es=ef.bottom,ec=ef.collisionPadding;ec&&(en-=ec[1],es+=ec[3]);let ed=es-en;ed>0&&(ed=Math.max(10,ed),this.circleDiameter=ed)}else{let eg=(null===(ex=ef.image)||void 0===ex?void 0:ex.content)&&(ef.image.textFitWidth||ef.image.textFitHeight)?Yc(ef):{x1:ef.left,y1:ef.top,x2:ef.right,y2:ef.bottom};eg.y1=eg.y1*em-e_[0],eg.y2=eg.y2*em+e_[2],eg.x1=eg.x1*em-e_[3],eg.x2=eg.x2*em+e_[1];let ev=ef.collisionPadding;if(ev&&(eg.x1-=ev[0]*em,eg.y1-=ev[1]*em,eg.x2+=ev[2]*em,eg.y2+=ev[3]*em),ey){let en=new r(eg.x1,eg.y1),es=new r(eg.x2,eg.y1),ec=new r(eg.x1,eg.y2),ed=new r(eg.x2,eg.y2),ep=ey*Math.PI/180;en._rotate(ep),es._rotate(ep),ec._rotate(ep),ed._rotate(ep),eg.x1=Math.min(en.x,es.x,ec.x,ed.x),eg.x2=Math.max(en.x,es.x,ec.x,ed.x),eg.y1=Math.min(en.y,es.y,ec.y,ed.y),eg.y2=Math.max(en.y,es.y,ec.y,ed.y)}en.emplaceBack(es.x,es.y,eg.x1,eg.y1,eg.x2,eg.y2,ec,ed,ep)}this.boxEndIndex=en.length}};let ip=class ip{constructor(en=[],es=(en,es)=>en<es?-1:en>es?1:0){if(this.data=en,this.length=this.data.length,this.compare=es,this.length>0)for(let en=(this.length>>1)-1;en>=0;en--)this._down(en)}push(en){this.data.push(en),this._up(this.length++)}pop(){if(0===this.length)return;let en=this.data[0],es=this.data.pop();return--this.length>0&&(this.data[0]=es,this._down(0)),en}peek(){return this.data[0]}_up(en){let{data:es,compare:ec}=this,ed=es[en];for(;en>0;){let ep=en-1>>1,ef=es[ep];if(ec(ed,ef)>=0)break;es[en]=ef,en=ep}es[en]=ed}_down(en){let{data:es,compare:ec}=this,ed=this.length>>1,ep=es[en];for(;en<ed;){let ed=1+(en<<1),ef=ed+1;if(ef<this.length&&0>ec(es[ef],es[ed])&&(ed=ef),ec(es[ed],ep)>=0)break;es[en]=es[ed],en=ed}es[en]=ep}};function ap(en,es){return es.max-en.max}function op(en,es,ec,ed){this.p=new r(en,es),this.h=ec,this.d=function(en,es){let ec=!1,ed=1/0;for(let ep=0;ep<es.length;ep++){let ef=es[ep];for(let es=0,ep=ef.length,em=ep-1;es<ep;em=es++){let ep=ef[es],e_=ef[em];ep.y>en.y!=e_.y>en.y&&en.x<(e_.x-ep.x)*(en.y-ep.y)/(e_.y-ep.y)+ep.x&&(ec=!ec),ed=Math.min(ed,qo(en,ep,e_))}}return(ec?1:-1)*Math.sqrt(ed)}(this.p,ed),this.max=this.d+this.h*Math.SQRT2}en.aE=void 0,(eA=en.aE||(en.aE={}))[eA.center=1]="center",eA[eA.left=2]="left",eA[eA.right=3]="right",eA[eA.top=4]="top",eA[eA.bottom=5]="bottom",eA[eA["top-left"]=6]="top-left",eA[eA["top-right"]=7]="top-right",eA[eA["bottom-left"]=8]="bottom-left",eA[eA["bottom-right"]=9]="bottom-right";let iK=Number.POSITIVE_INFINITY;function cp(en,es){return es[1]!==iK?function(en,es,ec){let ed=0,ep=0;switch(es=Math.abs(es),ec=Math.abs(ec),en){case"top-right":case"top-left":case"top":ep=ec-7;break;case"bottom-right":case"bottom-left":case"bottom":ep=7-ec}switch(en){case"top-right":case"bottom-right":case"right":ed=-es;break;case"top-left":case"bottom-left":case"left":ed=es}return[ed,ep]}(en,es[0],es[1]):function(en,es){let ec=0,ed=0;es<0&&(es=0);let ep=es/Math.SQRT2;switch(en){case"top-right":case"top-left":ed=ep-7;break;case"bottom-right":case"bottom-left":ed=7-ep;break;case"bottom":ed=7-es;break;case"top":ed=es-7}switch(en){case"top-right":case"bottom-right":ec=-ep;break;case"top-left":case"bottom-left":ec=ep;break;case"left":ec=es;break;case"right":ec=-es}return[ec,ed]}(en,es[0])}function hp(en,es,ec){var ed;let ep=en.layout,ef=null===(ed=ep.get("text-variable-anchor-offset"))||void 0===ed?void 0:ed.evaluate(es,{},ec);if(ef){let en=ef.values,es=[];for(let ec=0;ec<en.length;ec+=2){let ed=es[ec]=en[ec],ep=en[ec+1].map(en=>24*en);ed.startsWith("top")?ep[1]-=7:ed.startsWith("bottom")&&(ep[1]+=7),es[ec+1]=ep}return new De(es)}let em=ep.get("text-variable-anchor");if(em){let ed;ed=void 0!==en._unevaluatedLayout.getValue("text-radial-offset")?[24*ep.get("text-radial-offset").evaluate(es,{},ec),iK]:ep.get("text-offset").evaluate(es,{},ec).map(en=>24*en);let ef=[];for(let en of em)ef.push(en,cp(en,ed));return new De(ef)}return null}function pp(en){switch(en){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dp(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT){let eP=function(en,es,ec,ed,ep,ef,em,e_){let eg=ed.layout.get("text-rotate").evaluate(ef,{})*Math.PI/180,ey=[];for(let en of es.positionedLines)for(let ed of en.positionedGlyphs){if(!ed.rect)continue;let ef=ed.rect||{},ex=4,ev=!0,eb=1,ew=0,eT=(ep||e_)&&ed.vertical,eP=ed.metrics.advance*ed.scale/2;if(e_&&es.verticalizable&&(ew=en.lineOffset/2-(ed.imageName?-(24-ed.metrics.width*ed.scale)/2:(ed.scale-1)*24)),ed.imageName){let en=em[ed.imageName];ev=en.sdf,ex=1/(eb=en.pixelRatio)}let eS=ep?[ed.x+eP,ed.y]:[0,0],eM=ep?[0,0]:[ed.x+eP+ec[0],ed.y+ec[1]-ew],eC=[0,0];eT&&(eC=eM,eM=[0,0]);let eI=ed.metrics.isDoubleResolution?2:1,eE=(ed.metrics.left-ex)*ed.scale-eP+eM[0],eA=(-ed.metrics.top-ex)*ed.scale+eM[1],ez=eE+ef.w/eI*ed.scale/eb,ek=eA+ef.h/eI*ed.scale/eb,eD=new r(eE,eA),eR=new r(ez,eA),eL=new r(eE,ek),eB=new r(ez,ek);if(eT){let en=new r(-eP,eP- -17),es=-Math.PI/2,ec=12-eP,ep=new r(22-ec,-(ed.imageName?ec:0)),ef=new r(...eC);eD._rotateAround(es,en)._add(ep)._add(ef),eR._rotateAround(es,en)._add(ep)._add(ef),eL._rotateAround(es,en)._add(ep)._add(ef),eB._rotateAround(es,en)._add(ep)._add(ef)}if(eg){let en=Math.sin(eg),es=Math.cos(eg),ec=[es,-en,en,es];eD._matMult(ec),eR._matMult(ec),eL._matMult(ec),eB._matMult(ec)}let eF=new r(0,0),eO=new r(0,0);ey.push({tl:eD,tr:eR,bl:eL,br:eB,tex:ef,writingMode:es.writingMode,glyphOffset:eS,sectionIndex:ed.sectionIndex,isSDF:ev,pixelOffsetTL:eF,pixelOffsetBR:eO,minFontScaleX:0,minFontScaleY:0})}return ey}(0,ec,e_,ep,ef,em,ed,en.allowVerticalPlacement),eS=en.textSizeData,eM=null;for(let ec of("source"===eS.kind?(eM=[128*ep.layout.get("text-size").evaluate(em,{})])[0]>32640&&q(`${en.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===eS.kind&&((eM=[128*ew.compositeTextSizes[0].evaluate(em,{},eT),128*ew.compositeTextSizes[1].evaluate(em,{},eT)])[0]>32640||eM[1]>32640)&&q(`${en.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),en.addSymbols(en.text,eP,eM,e_,ef,em,ey,es,eg.lineStartIndex,eg.lineLength,eb,eT),ex))ev[ec]=en.text.placedSymbolArray.length-1;return 4*eP.length}function yp(en){for(let es in en)return en[es];return null}let iY=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];let xp=class xp{static from(en){if(!(en instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[es,ec]=new Uint8Array(en,0,2);if(219!==es)throw Error("Data does not appear to be in a KDBush format.");let ed=ec>>4;if(1!==ed)throw Error(`Got v${ed} data when expected v1.`);let ep=iY[15&ec];if(!ep)throw Error("Unrecognized array type.");let[ef]=new Uint16Array(en,2,1),[em]=new Uint32Array(en,4,1);return new xp(em,ef,ep,en)}constructor(en,es=64,ec=Float64Array,ed){if(isNaN(en)||en<0)throw Error(`Unpexpected numItems value: ${en}.`);this.numItems=+en,this.nodeSize=Math.min(Math.max(+es,2),65535),this.ArrayType=ec,this.IndexArrayType=en<65536?Uint16Array:Uint32Array;let ep=iY.indexOf(this.ArrayType),ef=2*en*this.ArrayType.BYTES_PER_ELEMENT,em=en*this.IndexArrayType.BYTES_PER_ELEMENT,e_=(8-em%8)%8;if(ep<0)throw Error(`Unexpected typed array class: ${ec}.`);ed&&ed instanceof ArrayBuffer?(this.data=ed,this.ids=new this.IndexArrayType(this.data,8,en),this.coords=new this.ArrayType(this.data,8+em+e_,2*en),this._pos=2*en,this._finished=!0):(this.data=new ArrayBuffer(8+ef+em+e_),this.ids=new this.IndexArrayType(this.data,8,en),this.coords=new this.ArrayType(this.data,8+em+e_,2*en),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+ep]),new Uint16Array(this.data,2,1)[0]=es,new Uint32Array(this.data,4,1)[0]=en)}add(en,es){let ec=this._pos>>1;return this.ids[ec]=ec,this.coords[this._pos++]=en,this.coords[this._pos++]=es,ec}finish(){let en=this._pos>>1;if(en!==this.numItems)throw Error(`Added ${en} items when expected ${this.numItems}.`);return function vp(en,es,ec,ed,ep,ef){if(ep-ed<=ec)return;let em=ed+ep>>1;(function bp(en,es,ec,ed,ep,ef){for(;ep>ed;){if(ep-ed>600){let em=ep-ed+1,e_=ec-ed+1,eg=Math.log(em),ey=.5*Math.exp(2*eg/3),ex=.5*Math.sqrt(eg*ey*(em-ey)/em)*(e_-em/2<0?-1:1);bp(en,es,ec,Math.max(ed,Math.floor(ec-e_*ey/em+ex)),Math.min(ep,Math.floor(ec+(em-e_)*ey/em+ex)),ef)}let em=es[2*ec+ef],e_=ed,eg=ep;for(wp(en,es,ed,ec),es[2*ep+ef]>em&&wp(en,es,ed,ep);e_<eg;){for(wp(en,es,e_,eg),e_++,eg--;es[2*e_+ef]<em;)e_++;for(;es[2*eg+ef]>em;)eg--}es[2*ed+ef]===em?wp(en,es,ed,eg):wp(en,es,++eg,ep),eg<=ec&&(ed=eg+1),ec<=eg&&(ep=eg-1)}})(en,es,em,ed,ep,ef),vp(en,es,ec,ed,em-1,1-ef),vp(en,es,ec,em+1,ep,1-ef)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(en,es,ec,ed){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:ep,coords:ef,nodeSize:em}=this,e_=[0,ep.length-1,0],eg=[];for(;e_.length;){let ey=e_.pop()||0,ex=e_.pop()||0,ev=e_.pop()||0;if(ex-ev<=em){for(let em=ev;em<=ex;em++){let e_=ef[2*em],ey=ef[2*em+1];e_>=en&&e_<=ec&&ey>=es&&ey<=ed&&eg.push(ep[em])}continue}let eb=ev+ex>>1,ew=ef[2*eb],eT=ef[2*eb+1];ew>=en&&ew<=ec&&eT>=es&&eT<=ed&&eg.push(ep[eb]),(0===ey?en<=ew:es<=eT)&&(e_.push(ev),e_.push(eb-1),e_.push(1-ey)),(0===ey?ec>=ew:ed>=eT)&&(e_.push(eb+1),e_.push(ex),e_.push(1-ey))}return eg}within(en,es,ec){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:ed,coords:ep,nodeSize:ef}=this,em=[0,ed.length-1,0],e_=[],eg=ec*ec;for(;em.length;){let ey=em.pop()||0,ex=em.pop()||0,ev=em.pop()||0;if(ex-ev<=ef){for(let ec=ev;ec<=ex;ec++)Sp(ep[2*ec],ep[2*ec+1],en,es)<=eg&&e_.push(ed[ec]);continue}let eb=ev+ex>>1,ew=ep[2*eb],eT=ep[2*eb+1];Sp(ew,eT,en,es)<=eg&&e_.push(ed[eb]),(0===ey?en-ec<=ew:es-ec<=eT)&&(em.push(ev),em.push(eb-1),em.push(1-ey)),(0===ey?en+ec>=ew:es+ec>=eT)&&(em.push(eb+1),em.push(ex),em.push(1-ey))}return e_}};function wp(en,es,ec,ed){_p(en,ec,ed),_p(es,2*ec,2*ed),_p(es,2*ec+1,2*ed+1)}function _p(en,es,ec){let ed=en[es];en[es]=en[ec],en[ec]=ed}function Sp(en,es,ec,ed){let ep=en-ec,ef=es-ed;return ep*ep+ef*ef}en.cx=void 0,(ez=en.cx||(en.cx={})).create="create",ez.load="load",ez.fullLoad="fullLoad";let iJ=null,iQ=[],i0=1e3/60,i1="loadTime",i2="fullLoadTime";en.$=8192,en.A=eD,en.B=function([en,es,ec]){return es+=90,{x:en*Math.cos(es*=Math.PI/180)*Math.sin(ec*=Math.PI/180),y:en*Math.sin(es)*Math.sin(ec),z:en*Math.cos(ec)}},en.C=tE,en.D=Ls,en.E=gt,en.F=zs,en.G=t$,en.H=function(en){if(null==eF){let es=en.navigator?en.navigator.userAgent:null;eF=!!en.safari||!(!es||!(/\b(iPad|iPhone|iPod)\b/.test(es)||es.match("Safari")&&!es.match("Chrome")))}return eF},en.I=kc,en.J=class{constructor(en,es){this.target=en,this.mapId=es,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new vh(()=>this.process()),this.subscription=Q(this.target,"message",en=>this.receive(en),!1),this.globalScope=X(self)?en:window}registerMessageHandler(en,es){this.messageHandlers[en]=es}sendAsync(en,es){return new Promise((ec,ed)=>{let ep=Math.round(1e18*Math.random()).toString(36).substring(0,10),ef=es?Q(es.signal,"abort",()=>{null==ef||ef.unsubscribe(),delete this.resolveRejects[ep];let es={id:ep,type:"<cancel>",origin:location.origin,targetMapId:en.targetMapId,sourceMapId:this.mapId};this.target.postMessage(es)},iH):null;this.resolveRejects[ep]={resolve:en=>{null==ef||ef.unsubscribe(),ec(en)},reject:en=>{null==ef||ef.unsubscribe(),ed(en)}};let em=[],e_=Object.assign(Object.assign({},en),{id:ep,sourceMapId:this.mapId,origin:location.origin,data:hs(en.data,em)});this.target.postMessage(e_,{transfer:em})})}receive(en){let es=en.data,ec=es.id;if(!("file://"!==es.origin&&"file://"!==location.origin&&"resource://android"!==es.origin&&"resource://android"!==location.origin&&es.origin!==location.origin||es.targetMapId&&this.mapId!==es.targetMapId)){if("<cancel>"===es.type){delete this.tasks[ec];let en=this.abortControllers[ec];return delete this.abortControllers[ec],void(en&&en.abort())}if(X(self)||es.mustQueue)return this.tasks[ec]=es,this.taskQueue.push(ec),void this.invoker.trigger();this.processTask(ec,es)}}process(){if(0===this.taskQueue.length)return;let en=this.taskQueue.shift(),es=this.tasks[en];delete this.tasks[en],this.taskQueue.length>0&&this.invoker.trigger(),es&&this.processTask(en,es)}processTask(en,es){return e(this,void 0,void 0,function*(){if("<response>"===es.type){let ec=this.resolveRejects[en];if(delete this.resolveRejects[en],!ec)return;return void(es.error?ec.reject(ps(es.error)):ec.resolve(ps(es.data)))}if(!this.messageHandlers[es.type])return void this.completeTask(en,Error(`Could not find a registered handler for ${es.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let ec=ps(es.data),ed=new AbortController;this.abortControllers[en]=ed;try{let ep=yield this.messageHandlers[es.type](es.sourceMapId,ec,ed);this.completeTask(en,null,ep)}catch(es){this.completeTask(en,es)}})}completeTask(en,es,ec){let ed=[];delete this.abortControllers[en];let ep={id:en,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:es?hs(es):null,data:hs(ec,ed)};this.target.postMessage(ep,{transfer:ed})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},en.K=eZ,en.L=function(){var en=new eD(16);return eD!=Float32Array&&(en[1]=0,en[2]=0,en[3]=0,en[4]=0,en[6]=0,en[7]=0,en[8]=0,en[9]=0,en[11]=0,en[12]=0,en[13]=0,en[14]=0),en[0]=1,en[5]=1,en[10]=1,en[15]=1,en},en.M=function(en,es,ec){var ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP=ec[0],eS=ec[1],eM=ec[2];return es===en?(en[12]=es[0]*eP+es[4]*eS+es[8]*eM+es[12],en[13]=es[1]*eP+es[5]*eS+es[9]*eM+es[13],en[14]=es[2]*eP+es[6]*eS+es[10]*eM+es[14],en[15]=es[3]*eP+es[7]*eS+es[11]*eM+es[15]):(ep=es[1],ef=es[2],em=es[3],e_=es[4],eg=es[5],ey=es[6],ex=es[7],ev=es[8],eb=es[9],ew=es[10],eT=es[11],en[0]=ed=es[0],en[1]=ep,en[2]=ef,en[3]=em,en[4]=e_,en[5]=eg,en[6]=ey,en[7]=ex,en[8]=ev,en[9]=eb,en[10]=ew,en[11]=eT,en[12]=ed*eP+e_*eS+ev*eM+es[12],en[13]=ep*eP+eg*eS+eb*eM+es[13],en[14]=ef*eP+ey*eS+ew*eM+es[14],en[15]=em*eP+ex*eS+eT*eM+es[15]),en},en.N=function(en,es,ec){var ed=ec[0],ep=ec[1],ef=ec[2];return en[0]=es[0]*ed,en[1]=es[1]*ed,en[2]=es[2]*ed,en[3]=es[3]*ed,en[4]=es[4]*ep,en[5]=es[5]*ep,en[6]=es[6]*ep,en[7]=es[7]*ep,en[8]=es[8]*ef,en[9]=es[9]*ef,en[10]=es[10]*ef,en[11]=es[11]*ef,en[12]=es[12],en[13]=es[13],en[14]=es[14],en[15]=es[15],en},en.O=function(en,es,ec){var ed=es[0],ep=es[1],ef=es[2],em=es[3],e_=es[4],eg=es[5],ey=es[6],ex=es[7],ev=es[8],eb=es[9],ew=es[10],eT=es[11],eP=es[12],eS=es[13],eM=es[14],eC=es[15],eI=ec[0],eE=ec[1],eA=ec[2],ez=ec[3];return en[0]=eI*ed+eE*e_+eA*ev+ez*eP,en[1]=eI*ep+eE*eg+eA*eb+ez*eS,en[2]=eI*ef+eE*ey+eA*ew+ez*eM,en[3]=eI*em+eE*ex+eA*eT+ez*eC,en[4]=(eI=ec[4])*ed+(eE=ec[5])*e_+(eA=ec[6])*ev+(ez=ec[7])*eP,en[5]=eI*ep+eE*eg+eA*eb+ez*eS,en[6]=eI*ef+eE*ey+eA*ew+ez*eM,en[7]=eI*em+eE*ex+eA*eT+ez*eC,en[8]=(eI=ec[8])*ed+(eE=ec[9])*e_+(eA=ec[10])*ev+(ez=ec[11])*eP,en[9]=eI*ep+eE*eg+eA*eb+ez*eS,en[10]=eI*ef+eE*ey+eA*ew+ez*eM,en[11]=eI*em+eE*ex+eA*eT+ez*eC,en[12]=(eI=ec[12])*ed+(eE=ec[13])*e_+(eA=ec[14])*ev+(ez=ec[15])*eP,en[13]=eI*ep+eE*eg+eA*eb+ez*eS,en[14]=eI*ef+eE*ey+eA*ew+ez*eM,en[15]=eI*em+eE*ex+eA*eT+ez*eC,en},en.P=r,en.Q=function(en,es){let ec={};for(let ed=0;ed<es.length;ed++){let ep=es[ed];ep in en&&(ec[ep]=en[ep])}return ec},en.R=dl,en.S=_h,en.T=Sl,en.U=Mh,en.V=kh,en.W=c,en.X=h,en.Y=K,en.Z=Vh,en._=e,en.a=eN,en.a$=g,en.a0=function(en,es){var ec,ed,ep,ef,em;if(!en)return null!=es?es:{};if(!es)return en;let e_=Object.assign({},en);if(es.removeAll&&(e_={removeAll:!0}),es.remove){let ed=new Set(es.remove);e_.add&&(e_.add=e_.add.filter(en=>!ed.has(en.id))),e_.update&&(e_.update=e_.update.filter(en=>!ed.has(en.id)));let ep=new Set((null!==(ec=en.add)&&void 0!==ec?ec:[]).map(en=>en.id));es.remove=es.remove.filter(en=>!ep.has(en))}if(es.remove){let en=new Set(e_.remove?e_.remove.concat(es.remove):es.remove);e_.remove=Array.from(en.values())}if(es.add){let en=e_.add?e_.add.concat(es.add):es.add,ec=new Map(en.map(en=>[en.id,en]));e_.add=Array.from(ec.values())}if(es.update){let en=new Map(null===(ed=e_.update)||void 0===ed?void 0:ed.map(en=>[en.id,en]));for(let ec of es.update){let es=null!==(ep=en.get(ec.id))&&void 0!==ep?ep:{id:ec.id};ec.newGeometry&&(es.newGeometry=ec.newGeometry),ec.addOrUpdateProperties&&(es.addOrUpdateProperties=(null!==(ef=es.addOrUpdateProperties)&&void 0!==ef?ef:[]).concat(ec.addOrUpdateProperties)),ec.removeProperties&&(es.removeProperties=(null!==(em=es.removeProperties)&&void 0!==em?em:[]).concat(ec.removeProperties)),ec.removeAllProperties&&(es.removeAllProperties=!0),en.set(ec.id,es)}e_.update=Array.from(en.values())}return e_.remove&&e_.add&&(e_.remove=e_.remove.filter(en=>-1===e_.add.findIndex(es=>es.id===en))),e_},en.a1=Ch,en.a2=$h,en.a3=25,en.a4=Th,en.a5=en=>{let es=window.document.createElement("video");return es.muted=!0,new Promise(ec=>{for(let ed of(es.onloadstart=()=>{ec(es)},en)){let en=window.document.createElement("source");pt(ed)||(es.crossOrigin="Anonymous"),en.src=ed,es.appendChild(en)}})},en.a6=Ct,en.a7=function(){return eL++},en.a8=_a,en.a9=ah,en.aA=function(en){let es=1/0,ec=1/0,ed=-1/0,ep=-1/0;for(let ef of en)es=Math.min(es,ef.x),ec=Math.min(ec,ef.y),ed=Math.max(ed,ef.x),ep=Math.max(ep,ef.y);return[es,ec,ed,ep]},en.aB=24,en.aC=C,en.aD=function(en,es,ec,ed,ep=!1){if(!ec[0]&&!ec[1])return[0,0];let ef=ep?"map"===ed?-en.bearingInRadians:0:"viewport"===ed?en.bearingInRadians:0;if(ef){let en=Math.sin(ef),es=Math.cos(ef);ec=[ec[0]*es-ec[1]*en,ec[0]*en+ec[1]*es]}return[ep?ec[0]:C(es,ec[0],en.zoom),ep?ec[1]:C(es,ec[1],en.zoom)]},en.aF=Qc,en.aG=pp,en.aH=Rc,en.aI=xp,en.aJ=Hs,en.aK=nu,en.aL=Ba,en.aM=Ka,en.aN=Xa,en.aO=$,en.aP=et,en.aQ=Ph,en.aR=b,en.aS=v,en.aT=function(en){var es=new eD(3);return es[0]=en[0],es[1]=en[1],es[2]=en[2],es},en.aU=function(en,es,ec){return en[0]=es[0]-ec[0],en[1]=es[1]-ec[1],en[2]=es[2]-ec[2],en},en.aV=function(en,es){var ec=es[0],ed=es[1],ep=es[2],ef=ec*ec+ed*ed+ep*ep;return ef>0&&(ef=1/Math.sqrt(ef)),en[0]=es[0]*ef,en[1]=es[1]*ef,en[2]=es[2]*ef,en},en.aW=w,en.aX=function(en,es){return en[0]*es[0]+en[1]*es[1]+en[2]*es[2]},en.aY=function(en,es,ec){return en[0]=es[0]*ec[0],en[1]=es[1]*ec[1],en[2]=es[2]*ec[2],en[3]=es[3]*ec[3],en},en.aZ=g,en.a_=function(en,es,ec){let ed=es[0]*ec[0]+es[1]*ec[1]+es[2]*ec[2];return 0===ed?null:(-(en[0]*ec[0]+en[1]*ec[1]+en[2]*ec[2])-ec[3])/ed},en.aa=pi,en.ab=Bo,en.ac=Oh,en.ad=function(en){let es={};if(en.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(en,ec,ed,ep)=>{let ef=ed||ep;return es[ec]=!ef||ef.toLowerCase(),""}),es["max-age"]){let en=parseInt(es["max-age"],10);isNaN(en)?delete es["max-age"]:es["max-age"]=en}return es},en.ae=tt,en.af=function(en){return Math.pow(2,en)},en.ag=y,en.ah=D,en.ai=85.051129,en.aj=function(en,es){return en/Ah(es)},en.ak=function(en){return Math.log(en)/Math.LN2},en.al=function(en){var es=en[0],ec=en[1];return es*es+ec*ec},en.am=function(en,es){let ec=[];for(let ed in en)ed in es||ec.push(ed);return ec},en.an=function(en,es){let ec=0,ed=0;if("constant"===en.kind)ed=en.layoutSize;else if("source"!==en.kind){let{interpolationType:ep,minZoom:ef,maxZoom:em}=en,e_=ep?D(pr.interpolationFactor(ep,es,ef,em),0,1):0;"camera"===en.kind?ed=tE.number(en.minSize,en.maxSize,e_):ec=e_}return{uSizeT:ec,uSize:ed}},en.ap=function(en,{uSize:es,uSizeT:ec},{lowerSize:ed,upperSize:ep}){return"source"===en.kind?ed/128:"composite"===en.kind?tE.number(ed/128,ep/128,ec):es},en.aq=function(en,es){var ec=es[0],ed=es[1],ep=es[2],ef=es[3],em=es[4],e_=es[5],eg=es[6],ey=es[7],ex=es[8],ev=es[9],eb=es[10],ew=es[11],eT=es[12],eP=es[13],eS=es[14],eM=es[15],eC=ec*e_-ed*em,eI=ec*eg-ep*em,eE=ec*ey-ef*em,eA=ed*eg-ep*e_,ez=ed*ey-ef*e_,ek=ep*ey-ef*eg,eD=ex*eP-ev*eT,eR=ex*eS-eb*eT,eL=ex*eM-ew*eT,eB=ev*eS-eb*eP,eF=ev*eM-ew*eP,eO=eb*eM-ew*eS,ej=eC*eO-eI*eF+eE*eB+eA*eL-ez*eR+ek*eD;return ej?(en[0]=(e_*eO-eg*eF+ey*eB)*(ej=1/ej),en[1]=(ep*eF-ed*eO-ef*eB)*ej,en[2]=(eP*ek-eS*ez+eM*eA)*ej,en[3]=(eb*ez-ev*ek-ew*eA)*ej,en[4]=(eg*eL-em*eO-ey*eR)*ej,en[5]=(ec*eO-ep*eL+ef*eR)*ej,en[6]=(eS*eE-eT*ek-eM*eI)*ej,en[7]=(ex*ek-eb*eE+ew*eI)*ej,en[8]=(em*eF-e_*eL+ey*eD)*ej,en[9]=(ed*eL-ec*eF-ef*eD)*ej,en[10]=(eT*ez-eP*eE+eM*eC)*ej,en[11]=(ev*eE-ex*ez-ew*eC)*ej,en[12]=(e_*eR-em*eB-eg*eD)*ej,en[13]=(ec*eB-ed*eR+ep*eD)*ej,en[14]=(eP*eI-eT*eA-eS*eC)*ej,en[15]=(ex*eA-ev*eI+eb*eC)*ej,en):null},en.ar=I,en.as=function(en){var es=en[0],ec=en[1];return Math.sqrt(es*es+ec*ec)},en.at=function(en){return en[0]=0,en[1]=0,en},en.au=function(en,es,ec){return en[0]=es[0]*ec,en[1]=es[1]*ec,en},en.av=rh,en.aw=A,en.ax=function(en,es,ec,ed){let ep=es.y-en.y,ef=es.x-en.x,em=ed.y-ec.y,e_=ed.x-ec.x,eg=em*ef-e_*ep;if(0===eg)return null;let ey=(e_*(en.y-ec.y)-em*(en.x-ec.x))/eg;return new r(en.x+ey*ef,en.y+ey*ep)},en.ay=Nh,en.az=$o,en.b=Y,en.b$=class extends ca{},en.b0=function(en,es,ec){return en[0]=es[0]*ec,en[1]=es[1]*ec,en[2]=es[2]*ec,en[3]=es[3]*ec,en},en.b1=function(en,es){return en[0]*es[0]+en[1]*es[1]+en[2]*es[2]+en[3]},en.b2=Bh,en.b3=Fh,en.b4=function(en,es,ec,ed,ep){var ef=1/Math.tan(es/2);if(en[0]=ef/ec,en[1]=0,en[2]=0,en[3]=0,en[4]=0,en[5]=ef,en[6]=0,en[7]=0,en[8]=0,en[9]=0,en[11]=-1,en[12]=0,en[13]=0,en[15]=0,null!=ep&&ep!==1/0){var em=1/(ed-ep);en[10]=(ep+ed)*em,en[14]=2*ep*ed*em}else en[10]=-1,en[14]=-2*ed;return en},en.b5=function(en){var es=new eD(16);return es[0]=en[0],es[1]=en[1],es[2]=en[2],es[3]=en[3],es[4]=en[4],es[5]=en[5],es[6]=en[6],es[7]=en[7],es[8]=en[8],es[9]=en[9],es[10]=en[10],es[11]=en[11],es[12]=en[12],es[13]=en[13],es[14]=en[14],es[15]=en[15],es},en.b6=function(en,es,ec){var ed=Math.sin(ec),ep=Math.cos(ec),ef=es[0],em=es[1],e_=es[2],eg=es[3],ey=es[4],ex=es[5],ev=es[6],eb=es[7];return es!==en&&(en[8]=es[8],en[9]=es[9],en[10]=es[10],en[11]=es[11],en[12]=es[12],en[13]=es[13],en[14]=es[14],en[15]=es[15]),en[0]=ef*ep+ey*ed,en[1]=em*ep+ex*ed,en[2]=e_*ep+ev*ed,en[3]=eg*ep+eb*ed,en[4]=ey*ep-ef*ed,en[5]=ex*ep-em*ed,en[6]=ev*ep-e_*ed,en[7]=eb*ep-eg*ed,en},en.b7=function(en,es,ec){var ed=Math.sin(ec),ep=Math.cos(ec),ef=es[4],em=es[5],e_=es[6],eg=es[7],ey=es[8],ex=es[9],ev=es[10],eb=es[11];return es!==en&&(en[0]=es[0],en[1]=es[1],en[2]=es[2],en[3]=es[3],en[12]=es[12],en[13]=es[13],en[14]=es[14],en[15]=es[15]),en[4]=ef*ep+ey*ed,en[5]=em*ep+ex*ed,en[6]=e_*ep+ev*ed,en[7]=eg*ep+eb*ed,en[8]=ey*ep-ef*ed,en[9]=ex*ep-em*ed,en[10]=ev*ep-e_*ed,en[11]=eb*ep-eg*ed,en},en.b8=function(){let en=new Float32Array(16);return y(en),en},en.b9=function(){let en=new Float64Array(16);return y(en),en},en.bA=function(en,es){let ec=E(en,360),ed=E(es,360),ep=ed-ec,ef=ed>ec?ep-360:ep+360;return Math.abs(ep)<Math.abs(ef)?ep:ef},en.bB=function(en){return en[0]=0,en[1]=0,en[2]=0,en},en.bC=function(en,es,ec,ed){let ep=Math.sqrt(en*en+es*es),ef=Math.sqrt(ec*ec+ed*ed);en/=ep,es/=ep,ec/=ef,ed/=ef;let em=Math.acos(en*ec+es*ed);return-es*ec+en*ed>0?em:-em},en.bD=function(en,es){let ec=E(en,2*Math.PI),ed=E(es,2*Math.PI);return Math.min(Math.abs(ec-ed),Math.abs(ec-ed+2*Math.PI),Math.abs(ec-ed-2*Math.PI))},en.bE=function(){let en={},es=eG.$version;for(let ec in eG.$root){let ed=eG.$root[ec];if(ed.required){let ep=null;null!=(ep="version"===ec?es:"array"===ed.type?[]:{})&&(en[ec]=ep)}}return en},en.bF=fs,en.bG=ct,en.bH=function t(en,es){if(Array.isArray(en)){if(!Array.isArray(es)||en.length!==es.length)return!1;for(let ec=0;ec<en.length;ec++)if(!t(en[ec],es[ec]))return!1;return!0}if("object"==typeof en&&null!==en&&null!==es){if("object"!=typeof es||Object.keys(en).length!==Object.keys(es).length)return!1;for(let ec in en)if(!t(en[ec],es[ec]))return!1;return!0}return en===es},en.bI=function(en){en=en.slice();let es=Object.create(null);for(let ec=0;ec<en.length;ec++)es[en[ec].id]=en[ec];for(let ec=0;ec<en.length;ec++)"ref"in en[ec]&&(en[ec]=function(en,es){let ec={};for(let es in en)"ref"!==es&&(ec[es]=en[es]);return e$.forEach(en=>{en in es&&(ec[en]=es[en])}),ec}(en[ec],es[en[ec].ref]));return en},en.bJ=function(en,es){if("custom"===en.type)return new xh(en,es);switch(en.type){case"background":return new dh(en,es);case"circle":return new al(en,es);case"color-relief":return new Ml(en,es);case"fill":return new mu(en,es);case"fill-extrusion":return new Fu(en,es);case"heatmap":return new gl(en,es);case"hillshade":return new bl(en,es);case"line":return new Ku(en,es);case"raster":return new gh(en,es);case"symbol":return new hh(en,es)}},en.bK=j,en.bL=function(en,es){if(!en)return[{command:"setStyle",args:[es]}];let ec=[];try{if(!wt(en.version,es.version))return[{command:"setStyle",args:[es]}];wt(en.center,es.center)||ec.push({command:"setCenter",args:[es.center]}),wt(en.state,es.state)||ec.push({command:"setGlobalState",args:[es.state]}),wt(en.centerAltitude,es.centerAltitude)||ec.push({command:"setCenterAltitude",args:[es.centerAltitude]}),wt(en.zoom,es.zoom)||ec.push({command:"setZoom",args:[es.zoom]}),wt(en.bearing,es.bearing)||ec.push({command:"setBearing",args:[es.bearing]}),wt(en.pitch,es.pitch)||ec.push({command:"setPitch",args:[es.pitch]}),wt(en.roll,es.roll)||ec.push({command:"setRoll",args:[es.roll]}),wt(en.sprite,es.sprite)||ec.push({command:"setSprite",args:[es.sprite]}),wt(en.glyphs,es.glyphs)||ec.push({command:"setGlyphs",args:[es.glyphs]}),wt(en.transition,es.transition)||ec.push({command:"setTransition",args:[es.transition]}),wt(en.light,es.light)||ec.push({command:"setLight",args:[es.light]}),wt(en.terrain,es.terrain)||ec.push({command:"setTerrain",args:[es.terrain]}),wt(en.sky,es.sky)||ec.push({command:"setSky",args:[es.sky]}),wt(en.projection,es.projection)||ec.push({command:"setProjection",args:[es.projection]});let ed={},ep=[];!function(en,es,ec,ed){let ep;for(ep in es=es||{},en=en||{})Object.prototype.hasOwnProperty.call(en,ep)&&(Object.prototype.hasOwnProperty.call(es,ep)||At(ep,ec,ed));for(ep in es){var ef,em;Object.prototype.hasOwnProperty.call(es,ep)&&(Object.prototype.hasOwnProperty.call(en,ep)?wt(en[ep],es[ep])||("geojson"===en[ep].type&&"geojson"===es[ep].type&&function(en,es,ec){let ed;for(ed in en[ec])if(Object.prototype.hasOwnProperty.call(en[ec],ed)&&"data"!==ed&&!wt(en[ec][ed],es[ec][ed]))return!1;for(ed in es[ec])if(Object.prototype.hasOwnProperty.call(es[ec],ed)&&"data"!==ed&&!wt(en[ec][ed],es[ec][ed]))return!1;return!0}(en,es,ep)?_t(ec,{command:"setGeoJSONSourceData",args:[ep,es[ep].data]}):(ef=ep,em=es,At(ef,ec,ed),St(ef,em,ec))):St(ep,es,ec))}}(en.sources,es.sources,ep,ed);let ef=[];en.layers&&en.layers.forEach(en=>{"source"in en&&ed[en.source]?ec.push({command:"removeLayer",args:[en.id]}):ef.push(en)}),ec=ec.concat(ep),function(en,es,ec){let ed,ep,ef,em,e_;es=es||[];let eg=(en=en||[]).map(zt),ey=es.map(zt),ex=en.reduce(Pt,{}),ev=es.reduce(Pt,{}),eb=eg.slice(),ew=Object.create(null);for(let en=0,es=0;en<eg.length;en++)ed=eg[en],Object.prototype.hasOwnProperty.call(ev,ed)?es++:(_t(ec,{command:"removeLayer",args:[ed]}),eb.splice(eb.indexOf(ed,es),1));for(let en=0,es=0;en<ey.length;en++)ed=ey[ey.length-1-en],eb[eb.length-1-en]!==ed&&(Object.prototype.hasOwnProperty.call(ex,ed)?(_t(ec,{command:"removeLayer",args:[ed]}),eb.splice(eb.lastIndexOf(ed,eb.length-es),1)):es++,em=eb[eb.length-en],_t(ec,{command:"addLayer",args:[ev[ed],em]}),eb.splice(eb.length-en,0,ed),ew[ed]=!0);for(let en=0;en<ey.length;en++)if(ep=ex[ed=ey[en]],ef=ev[ed],!ew[ed]&&!wt(ep,ef)){if(wt(ep.source,ef.source)&&wt(ep["source-layer"],ef["source-layer"])&&wt(ep.type,ef.type)){for(e_ in It(ep.layout,ef.layout,ec,ed,null,"setLayoutProperty"),It(ep.paint,ef.paint,ec,ed,null,"setPaintProperty"),wt(ep.filter,ef.filter)||_t(ec,{command:"setFilter",args:[ed,ef.filter]}),wt(ep.minzoom,ef.minzoom)&&wt(ep.maxzoom,ef.maxzoom)||_t(ec,{command:"setLayerZoomRange",args:[ed,ef.minzoom,ef.maxzoom]}),ep)Object.prototype.hasOwnProperty.call(ep,e_)&&"layout"!==e_&&"paint"!==e_&&"filter"!==e_&&"metadata"!==e_&&"minzoom"!==e_&&"maxzoom"!==e_&&(0===e_.indexOf("paint.")?It(ep[e_],ef[e_],ec,ed,e_.slice(6),"setPaintProperty"):wt(ep[e_],ef[e_])||_t(ec,{command:"setLayerProperty",args:[ed,e_,ef[e_]]}));for(e_ in ef)Object.prototype.hasOwnProperty.call(ef,e_)&&!Object.prototype.hasOwnProperty.call(ep,e_)&&"layout"!==e_&&"paint"!==e_&&"filter"!==e_&&"metadata"!==e_&&"minzoom"!==e_&&"maxzoom"!==e_&&(0===e_.indexOf("paint.")?It(ep[e_],ef[e_],ec,ed,e_.slice(6),"setPaintProperty"):wt(ep[e_],ef[e_])||_t(ec,{command:"setLayerProperty",args:[ed,e_,ef[e_]]}))}else _t(ec,{command:"removeLayer",args:[ed]}),em=eb[eb.lastIndexOf(ed)+1],_t(ec,{command:"addLayer",args:[ef,em]})}}(ef,es.layers,ec)}catch(en){console.warn("Unable to compute style diff:",en),ec=[{command:"setStyle",args:[es]}]}return ec},en.bM=function(en){let es=[],ec=en.id;return void 0===ec&&es.push({message:`layers.${ec}: missing required property "id"`}),void 0===en.render&&es.push({message:`layers.${ec}: missing required method "render"`}),en.renderingMode&&"2d"!==en.renderingMode&&"3d"!==en.renderingMode&&es.push({message:`layers.${ec}: property "renderingMode" must be either "2d" or "3d"`}),es},en.bN=R,en.bO=U,en.bP=class extends po{constructor(en,es){super(en,es),this.current=0}set(en){this.current!==en&&(this.current=en,this.gl.uniform1i(this.location,en))}},en.bQ=mo,en.bR=class extends po{constructor(en,es){super(en,es),this.current=id}set(en){if(en[12]!==this.current[12]||en[0]!==this.current[0])return this.current=en,void this.gl.uniformMatrix4fv(this.location,!1,en);for(let es=1;es<16;es++)if(en[es]!==this.current[es]){this.current=en,this.gl.uniformMatrix4fv(this.location,!1,en);break}}},en.bS=yo,en.bT=class extends po{constructor(en,es){super(en,es),this.current=[0,0,0]}set(en){en[0]===this.current[0]&&en[1]===this.current[1]&&en[2]===this.current[2]||(this.current=en,this.gl.uniform3f(this.location,en[0],en[1],en[2]))}},en.bU=class extends po{constructor(en,es){super(en,es),this.current=[0,0]}set(en){en[0]===this.current[0]&&en[1]===this.current[1]||(this.current=en,this.gl.uniform2f(this.location,en[0],en[1]))}},en.bV=d,en.bW=function(en,es){var ec=Math.sin(es),ed=Math.cos(es);return en[0]=ed,en[1]=ec,en[2]=0,en[3]=-ec,en[4]=ed,en[5]=0,en[6]=0,en[7]=0,en[8]=1,en},en.bX=function(en,es,ec){var ed=es[0],ep=es[1],ef=es[2];return en[0]=ed*ec[0]+ep*ec[3]+ef*ec[6],en[1]=ed*ec[1]+ep*ec[4]+ef*ec[7],en[2]=ed*ec[2]+ep*ec[5]+ef*ec[8],en},en.bY=function(en,es,ec,ed,ep,ef,em){var e_=1/(es-ec),eg=1/(ed-ep),ey=1/(ef-em);return en[0]=-2*e_,en[1]=0,en[2]=0,en[3]=0,en[4]=0,en[5]=-2*eg,en[6]=0,en[7]=0,en[8]=0,en[9]=0,en[10]=2*ey,en[11]=0,en[12]=(es+ec)*e_,en[13]=(ep+ed)*eg,en[14]=(em+ef)*ey,en[15]=1,en},en.bZ=class extends po{constructor(en,es){super(en,es),this.current=[]}set(en){if(en!=this.current){this.current=en;let es=new Float32Array(4*en.length);for(let ec=0;ec<en.length;ec++)es[4*ec]=en[ec].r,es[4*ec+1]=en[ec].g,es[4*ec+2]=en[ec].b,es[4*ec+3]=en[ec].a;this.gl.uniform4fv(this.location,es)}}},en.b_=class extends po{constructor(en,es){super(en,es),this.current=[]}set(en){if(en!=this.current){this.current=en;let es=new Float32Array(en);this.gl.uniform1fv(this.location,es)}}},en.ba=function(){return new Float64Array(16)},en.bb=function(en,es,ec){let ed=new Float64Array(4);return M(ed,en,es-90,ec),ed},en.bc=function(en,es,ec,ed){var ep,ef,em,e_,eg,ey=es[0],ex=es[1],ev=es[2],eb=es[3],ew=ec[0],eT=ec[1],eP=ec[2],eS=ec[3];return(ef=ey*ew+ex*eT+ev*eP+eb*eS)<0&&(ef=-ef,ew=-ew,eT=-eT,eP=-eP,eS=-eS),1-ef>1e-6?(em=Math.sin(ep=Math.acos(ef)),e_=Math.sin((1-ed)*ep)/em,eg=Math.sin(ed*ep)/em):(e_=1-ed,eg=ed),en[0]=e_*ey+eg*ew,en[1]=e_*ex+eg*eT,en[2]=e_*ev+eg*eP,en[3]=e_*eb+eg*eS,en},en.bd=function(en){var es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS;let eM,eC;let eI=new Float64Array(9);eg=(es=en[0])*(ef=es+es),ey=(ec=en[1])*ef,ev=(ed=en[2])*ef,eb=ed*(em=ec+ec),eT=(ep=en[3])*ef,eP=ep*em,eS=ep*(e_=ed+ed),eI[0]=1-(ex=ec*em)-(ew=ed*e_),eI[3]=ey-eS,eI[6]=ev+eP,eI[1]=ey+eS,eI[4]=1-eg-ew,eI[7]=eb-eT,eI[2]=ev-eP,eI[5]=eb+eT,eI[8]=1-eg-ex;let eE=et(-Math.asin(D(eI[2],-1,1)));return .001>Math.hypot(eI[5],eI[8])?(eM=0,eC=-et(Math.atan2(eI[3],eI[4]))):(eM=et(0===eI[5]&&0===eI[8]?0:Math.atan2(eI[5],eI[8])),eC=et(0===eI[1]&&0===eI[0]?0:Math.atan2(eI[1],eI[0]))),{roll:eM,pitch:eE+90,bearing:eC}},en.be=function(en,es){return en.roll==es.roll&&en.pitch==es.pitch&&en.bearing==es.bearing},en.bf=Me,en.bg=fo,en.bh=-32768,en.bi=32767,en.bj=ru,en.bk=T,en.bl=B,en.bm=Le,en.bn=function(en,es,ec,ed,ep){return T(ed,ep,D((en-es)/(ec-es),0,1))},en.bo=E,en.bp=function(){return new Float64Array(3)},en.bq=function(en,es,ec,ed){return en[0]=es[0]+ec[0]*ed,en[1]=es[1]+ec[1]*ed,en[2]=es[2]+ec[2]*ed,en},en.br=M,en.bs=function(en,es,ec){var ed=ec[0],ep=ec[1],ef=ec[2],em=ec[3],e_=es[0],eg=es[1],ey=es[2],ex=ep*ey-ef*eg,ev=ef*e_-ed*ey,eb=ed*eg-ep*e_;return en[0]=e_+em*(ex+=ex)+ep*(eb+=eb)-ef*(ev+=ev),en[1]=eg+em*ev+ef*ex-ed*eb,en[2]=ey+em*eb+ed*ev-ep*ex,en},en.bt=function(en,es,ec){var ed,ep,ef,em,e_,eg,ey;let ex=(ed=[en[0],en[1],en[2],es[0],es[1],es[2],ec[0],ec[1],ec[2]])[0]*((ey=ed[8])*(ef=ed[4])-(em=ed[5])*(eg=ed[7]))+ed[1]*(-ey*(ep=ed[3])+em*(e_=ed[6]))+ed[2]*(eg*ep-ef*e_);if(0===ex)return null;let ev=w([],[es[0],es[1],es[2]],[ec[0],ec[1],ec[2]]),eb=w([],[ec[0],ec[1],ec[2]],[en[0],en[1],en[2]]),ew=w([],[en[0],en[1],en[2]],[es[0],es[1],es[2]]),eT=b([],ev,-en[3]);return v(eT,eT,b([],eb,-es[3])),v(eT,eT,b([],ew,-ec[3])),b(eT,eT,1/ex),eT},en.bu=6371008.8,en.bv=function(){return new Float64Array(4)},en.bw=function(en,es,ec,ed){var ep=[],ef=[];return ep[0]=es[0]-ec[0],ep[1]=es[1]-ec[1],ep[2]=es[2]-ec[2],ef[0]=ep[0]*Math.cos(ed)-ep[1]*Math.sin(ed),ef[1]=ep[0]*Math.sin(ed)+ep[1]*Math.cos(ed),ef[2]=ep[2],en[0]=ef[0]+ec[0],en[1]=ef[1]+ec[1],en[2]=ef[2]+ec[2],en},en.bx=function(en,es,ec,ed){var ep=[],ef=[];return ep[0]=es[0]-ec[0],ep[1]=es[1]-ec[1],ep[2]=es[2]-ec[2],ef[0]=ep[0],ef[1]=ep[1]*Math.cos(ed)-ep[2]*Math.sin(ed),ef[2]=ep[1]*Math.sin(ed)+ep[2]*Math.cos(ed),en[0]=ef[0]+ec[0],en[1]=ef[1]+ec[1],en[2]=ef[2]+ec[2],en},en.by=function(en,es,ec,ed){var ep=[],ef=[];return ep[0]=es[0]-ec[0],ep[1]=es[1]-ec[1],ep[2]=es[2]-ec[2],ef[0]=ep[2]*Math.sin(ed)+ep[0]*Math.cos(ed),ef[1]=ep[1],ef[2]=ep[2]*Math.cos(ed)-ep[0]*Math.sin(ed),en[0]=ef[0]+ec[0],en[1]=ef[1]+ec[1],en[2]=ef[2]+ec[2],en},en.bz=function(en,es,ec){var ed=Math.sin(ec),ep=Math.cos(ec),ef=es[0],em=es[1],e_=es[2],eg=es[3],ey=es[8],ex=es[9],ev=es[10],eb=es[11];return es!==en&&(en[4]=es[4],en[5]=es[5],en[6]=es[6],en[7]=es[7],en[12]=es[12],en[13]=es[13],en[14]=es[14],en[15]=es[15]),en[0]=ef*ep-ey*ed,en[1]=em*ep-ex*ed,en[2]=e_*ep-ev*ed,en[3]=eg*ep-eb*ed,en[8]=ef*ed+ey*ep,en[9]=em*ed+ex*ep,en[10]=e_*ed+ev*ep,en[11]=eg*ed+eb*ep,en},en.c=st,en.c0=iO,en.c1=class extends pa{},en.c2=iy,en.c3=function(en){return en<=1?1:Math.pow(2,Math.ceil(Math.log(en)/Math.LN2))},en.c4=yl,en.c5=function(en,es,ec){var ed=es[0],ep=es[1],ef=es[2],em=ec[3]*ed+ec[7]*ep+ec[11]*ef+ec[15];return en[0]=(ec[0]*ed+ec[4]*ep+ec[8]*ef+ec[12])/(em=em||1),en[1]=(ec[1]*ed+ec[5]*ep+ec[9]*ef+ec[13])/em,en[2]=(ec[2]*ed+ec[6]*ep+ec[10]*ef+ec[14])/em,en},en.c6=class extends Qs{},en.c7=class extends va{},en.c8=function(en,es){return en[0]===es[0]&&en[1]===es[1]&&en[2]===es[2]&&en[3]===es[3]&&en[4]===es[4]&&en[5]===es[5]&&en[6]===es[6]&&en[7]===es[7]&&en[8]===es[8]&&en[9]===es[9]&&en[10]===es[10]&&en[11]===es[11]&&en[12]===es[12]&&en[13]===es[13]&&en[14]===es[14]&&en[15]===es[15]},en.c9=function(en,es){var ec=en[0],ed=en[1],ep=en[2],ef=en[3],em=en[4],e_=en[5],eg=en[6],ey=en[7],ex=en[8],ev=en[9],eb=en[10],ew=en[11],eT=en[12],eP=en[13],eS=en[14],eM=en[15],eC=es[0],eI=es[1],eE=es[2],eA=es[3],ez=es[4],ek=es[5],eD=es[6],eR=es[7],eL=es[8],eB=es[9],eF=es[10],eO=es[11],ej=es[12],eV=es[13],eU=es[14],eN=es[15];return Math.abs(ec-eC)<=1e-6*Math.max(1,Math.abs(ec),Math.abs(eC))&&Math.abs(ed-eI)<=1e-6*Math.max(1,Math.abs(ed),Math.abs(eI))&&Math.abs(ep-eE)<=1e-6*Math.max(1,Math.abs(ep),Math.abs(eE))&&Math.abs(ef-eA)<=1e-6*Math.max(1,Math.abs(ef),Math.abs(eA))&&Math.abs(em-ez)<=1e-6*Math.max(1,Math.abs(em),Math.abs(ez))&&Math.abs(e_-ek)<=1e-6*Math.max(1,Math.abs(e_),Math.abs(ek))&&Math.abs(eg-eD)<=1e-6*Math.max(1,Math.abs(eg),Math.abs(eD))&&Math.abs(ey-eR)<=1e-6*Math.max(1,Math.abs(ey),Math.abs(eR))&&Math.abs(ex-eL)<=1e-6*Math.max(1,Math.abs(ex),Math.abs(eL))&&Math.abs(ev-eB)<=1e-6*Math.max(1,Math.abs(ev),Math.abs(eB))&&Math.abs(eb-eF)<=1e-6*Math.max(1,Math.abs(eb),Math.abs(eF))&&Math.abs(ew-eO)<=1e-6*Math.max(1,Math.abs(ew),Math.abs(eO))&&Math.abs(eT-ej)<=1e-6*Math.max(1,Math.abs(eT),Math.abs(ej))&&Math.abs(eP-eV)<=1e-6*Math.max(1,Math.abs(eP),Math.abs(eV))&&Math.abs(eS-eU)<=1e-6*Math.max(1,Math.abs(eS),Math.abs(eU))&&Math.abs(eM-eN)<=1e-6*Math.max(1,Math.abs(eM),Math.abs(eN))},en.cA=function(en,es){eN.REGISTERED_PROTOCOLS[en]=es},en.cB=function(en){delete eN.REGISTERED_PROTOCOLS[en]},en.cC=function(en,es){let ec={};for(let ed=0;ed<en.length;ed++){let ep=es&&es[en[ed].id]||function(en){let es="";for(let ec of e$)es+=`/${function bi(en){let es=typeof en;if("number"===es||"boolean"===es||"string"===es||null==en)return JSON.stringify(en);if(Array.isArray(en)){let es="[";for(let ec of en)es+=`${bi(ec)},`;return`${es}]`}let ec=Object.keys(en).sort(),ed="{";for(let es=0;es<ec.length;es++)ed+=`${JSON.stringify(ec[es])}:${bi(en[ec[es]])},`;return`${ed}}`}(en[ec])}`;return es}(en[ed]);es&&(es[en[ed].id]=ep);let ef=ec[ep];ef||(ef=ec[ep]=[]),ef.push(en[ed])}let ed=[];for(let en in ec)ed.push(ec[en]);return ed},en.cD=os,en.cE=Lh,en.cF=Rh,en.cG=Mc,en.cH=function(es){es.bucket.createArrays(),es.bucket.tilePixelRatio=8192/(512*es.bucket.overscaling),es.bucket.compareText={},es.bucket.iconsNeedLinear=!1;let ec=es.bucket.layers[0],ed=ec.layout,ep=ec._unevaluatedLayout._values,ef={layoutIconSize:ep["icon-size"].possiblyEvaluate(new zs(es.bucket.zoom+1),es.canonical),layoutTextSize:ep["text-size"].possiblyEvaluate(new zs(es.bucket.zoom+1),es.canonical),textMaxSize:ep["text-size"].possiblyEvaluate(new zs(18))};if("composite"===es.bucket.textSizeData.kind){let{minZoom:en,maxZoom:ec}=es.bucket.textSizeData;ef.compositeTextSizes=[ep["text-size"].possiblyEvaluate(new zs(en),es.canonical),ep["text-size"].possiblyEvaluate(new zs(ec),es.canonical)]}if("composite"===es.bucket.iconSizeData.kind){let{minZoom:en,maxZoom:ec}=es.bucket.iconSizeData;ef.compositeIconSizes=[ep["icon-size"].possiblyEvaluate(new zs(en),es.canonical),ep["icon-size"].possiblyEvaluate(new zs(ec),es.canonical)]}let em=24*ed.get("text-line-height"),e_="viewport"!==ed.get("text-rotation-alignment")&&"point"!==ed.get("symbol-placement"),eg=ed.get("text-keep-upright"),ey=ed.get("text-size");for(let ep of es.bucket.features){let ex=ed.get("text-font").evaluate(ep,{},es.canonical).join(","),ev=ey.evaluate(ep,{},es.canonical),eb=ef.layoutTextSize.evaluate(ep,{},es.canonical),ew=ef.layoutIconSize.evaluate(ep,{},es.canonical),eT={horizontal:{},vertical:void 0},eP=ep.text,eS,eM=[0,0];if(eP){let ef=eP.toString(),ey=24*ed.get("text-letter-spacing").evaluate(ep,{},es.canonical),ew=!function(en){for(let ec of en){var es;if(es=ec.charCodeAt(0),tK.test(String.fromCodePoint(es)))return!1}return!0}(ef)?0:ey,eS=ed.get("text-anchor").evaluate(ep,{},es.canonical),eC=hp(ec,ep,es.canonical);if(!eC){let en=ed.get("text-radial-offset").evaluate(ep,{},es.canonical);eM=en?cp(eS,[24*en,iK]):ed.get("text-offset").evaluate(ep,{},es.canonical).map(en=>24*en)}let eI=e_?"center":ed.get("text-justify").evaluate(ep,{},es.canonical),eE="point"===ed.get("symbol-placement")?24*ed.get("text-max-width").evaluate(ep,{},es.canonical):1/0,w=()=>{es.bucket.allowVerticalPlacement&&ys(ef)&&(eT.vertical=Cc(eP,es.glyphMap,es.glyphPositions,es.imagePositions,ex,eE,em,eS,"left",ew,eM,en.ao.vertical,!0,eb,ev))};if(!e_&&eC){let ec=new Set;if("auto"===eI)for(let en=0;en<eC.values.length;en+=2)ec.add(pp(eC.values[en]));else ec.add(eI);let ed=!1;for(let ep of ec)if(!eT.horizontal[ep]){if(ed)eT.horizontal[ep]=eT.horizontal[0];else{let ec=Cc(eP,es.glyphMap,es.glyphPositions,es.imagePositions,ex,eE,em,"center",ep,ew,eM,en.ao.horizontal,!1,eb,ev);ec&&(eT.horizontal[ep]=ec,ed=1===ec.positionedLines.length)}}w()}else{"auto"===eI&&(eI=pp(eS));let ec=Cc(eP,es.glyphMap,es.glyphPositions,es.imagePositions,ex,eE,em,eS,eI,ew,eM,en.ao.horizontal,!1,eb,ev);ec&&(eT.horizontal[eI]=ec),w(),ys(ef)&&e_&&eg&&(eT.vertical=Cc(eP,es.glyphMap,es.glyphPositions,es.imagePositions,ex,eE,em,eS,eI,ew,eM,en.ao.vertical,!1,eb,ev))}}let eC=!1;if(ep.icon&&ep.icon.name){let en=es.imageMap[ep.icon.name];en&&(eS=function(en,es,ec){let{horizontalAlign:ed,verticalAlign:ep}=Rc(ec),ef=es[0]-en.displaySize[0]*ed,em=es[1]-en.displaySize[1]*ep;return{image:en,top:em,bottom:em+en.displaySize[1],left:ef,right:ef+en.displaySize[0]}}(es.imagePositions[ep.icon.name],ed.get("icon-offset").evaluate(ep,{},es.canonical),ed.get("icon-anchor").evaluate(ep,{},es.canonical)),eC=!!en.sdf,void 0===es.bucket.sdfIcons?es.bucket.sdfIcons=eC:es.bucket.sdfIcons!==eC&&q("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(en.pixelRatio!==es.bucket.pixelRatio||0!==ed.get("icon-rotate").constantOr(1))&&(es.bucket.iconsNeedLinear=!0))}let eI=yp(eT.horizontal)||eT.vertical;es.bucket.iconsInText=!!eI&&eI.iconsInText,(eI||eS)&&function(es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb){let ew,eT=em.textMaxSize.evaluate(ec,{});void 0===eT&&(eT=e_);let eP=es.layers[0].layout,eS=eP.get("icon-offset").evaluate(ec,{},ev),eM=yp(ed.horizontal),eC=e_/24,eI=es.tilePixelRatio*eC,eE=es.tilePixelRatio*eT/24,eA=es.tilePixelRatio*eg,ez=es.tilePixelRatio*eP.get("symbol-spacing"),ek=eP.get("text-padding")*es.tilePixelRatio,eD=function(en,es,ec,ed=1){let ep=en.get("icon-padding").evaluate(es,{},ec),ef=ep&&ep.values;return[ef[0]*ed,ef[1]*ed,ef[2]*ed,ef[3]*ed]}(eP,ec,ev,es.tilePixelRatio),eR=eP.get("text-max-angle")/180*Math.PI,eL="viewport"!==eP.get("text-rotation-alignment")&&"point"!==eP.get("symbol-placement"),eB="map"===eP.get("icon-rotation-alignment")&&"point"!==eP.get("symbol-placement"),eF=eP.get("symbol-placement"),eO=ez/2,ej=eP.get("icon-text-fit");ep&&"none"!==ej&&(es.allowVerticalPlacement&&ed.vertical&&(ew=Hc(ep,ed.vertical,ej,eP.get("icon-text-fit-padding"),eS,eC)),eM&&(ep=Hc(ep,eM,ej,eP.get("icon-text-fit-padding"),eS,eC)));let eV=ev?eb.line.getGranularityForZoomLevel(ev.z):1,B=(eg,eb)=>{eb.x<0||eb.x>=8192||eb.y<0||eb.y>=8192||function(es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC,eI,eE,eA,ez,ek,eD,eR){let eL=es.addToLineVertexArray(ec,ed),eB,eF,eO,ej,eV=0,eU=0,eN=0,eZ=0,eG=-1,e$=-1,eq={},eW=ic("");if(es.allowVerticalPlacement&&ep.vertical){let en=eg.layout.get("text-rotate").evaluate(eA,{},eD)+90;eO=new np(ey,ec,ex,ev,eb,ep.vertical,ew,eT,eP,en),e_&&(ej=new np(ey,ec,ex,ev,eb,e_,eM,eC,eP,en))}if(ef){let ed=eg.layout.get("icon-rotate").evaluate(eA,{}),ep="none"!==eg.layout.get("icon-text-fit"),em=Wh(ef,ed,ek,ep),ew=e_?Wh(e_,ed,ek,ep):void 0;eF=new np(ey,ec,ex,ev,eb,ef,eM,eC,!1,ed),eV=4*em.length;let eT=es.iconSizeData,eP=null;"source"===eT.kind?(eP=[128*eg.layout.get("icon-size").evaluate(eA,{})])[0]>32640&&q(`${es.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===eT.kind&&((eP=[128*ez.compositeIconSizes[0].evaluate(eA,{},eD),128*ez.compositeIconSizes[1].evaluate(eA,{},eD)])[0]>32640||eP[1]>32640)&&q(`${es.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),es.addSymbols(es.icon,em,eP,eE,eI,eA,en.ao.none,ec,eL.lineStartIndex,eL.lineLength,-1,eD),eG=es.icon.placedSymbolArray.length-1,ew&&(eU=4*ew.length,es.addSymbols(es.icon,ew,eP,eE,eI,eA,en.ao.vertical,ec,eL.lineStartIndex,eL.lineLength,-1,eD),e$=es.icon.placedSymbolArray.length-1)}let eH=Object.keys(ep.horizontal);for(let ed of eH){let ef=ep.horizontal[ed];if(!eB){eW=ic(ef.text);let en=eg.layout.get("text-rotate").evaluate(eA,{},eD);eB=new np(ey,ec,ex,ev,eb,ef,ew,eT,eP,en)}let e_=1===ef.positionedLines.length;if(eN+=dp(es,ec,ef,em,eg,eP,eA,eS,eL,ep.vertical?en.ao.horizontal:en.ao.horizontalOnly,e_?eH:[ed],eq,eG,ez,eD),e_)break}ep.vertical&&(eZ+=dp(es,ec,ep.vertical,em,eg,eP,eA,eS,eL,en.ao.vertical,["vertical"],eq,e$,ez,eD));let eX=eB?eB.boxStartIndex:es.collisionBoxArray.length,eK=eB?eB.boxEndIndex:es.collisionBoxArray.length,eY=eO?eO.boxStartIndex:es.collisionBoxArray.length,eJ=eO?eO.boxEndIndex:es.collisionBoxArray.length,eQ=eF?eF.boxStartIndex:es.collisionBoxArray.length,e0=eF?eF.boxEndIndex:es.collisionBoxArray.length,e1=ej?ej.boxStartIndex:es.collisionBoxArray.length,e2=ej?ej.boxEndIndex:es.collisionBoxArray.length,e3=-1,K=(en,es)=>en&&en.circleDiameter?Math.max(en.circleDiameter,es):es;e3=K(eB,e3),e3=K(eO,e3),e3=K(eF,e3),e3=K(ej,e3);let e5=e3>-1?1:0;e5&&(e3*=eR/24),es.glyphOffsetArray.length>=ah.MAX_GLYPHS&&q("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==eA.sortKey&&es.addToSortKeyRanges(es.symbolInstances.length,eA.sortKey);let e4=hp(eg,eA,eD),[e6,e8]=function(es,ec){let ed=es.length,ep=null==ec?void 0:ec.values;if((null==ep?void 0:ep.length)>0)for(let ec=0;ec<ep.length;ec+=2){let ed=ep[ec+1];es.emplaceBack(en.aE[ep[ec]],ed[0],ed[1])}return[ed,es.length]}(es.textAnchorOffsets,e4);es.symbolInstances.emplaceBack(ec.x,ec.y,eq.right>=0?eq.right:-1,eq.center>=0?eq.center:-1,eq.left>=0?eq.left:-1,eq.vertical||-1,eG,e$,eW,eX,eK,eY,eJ,eQ,e0,e1,e2,ex,eN,eZ,eV,eU,e5,0,ew,e3,e6,e8)}(es,eb,eg,ed,ep,ef,ew,es.layers[0],es.collisionBoxArray,ec.index,ec.sourceLayerIndex,es.index,eI,[ek,ek,ek,ek],eL,ey,eA,eD,eB,eS,ec,em,ex,ev,e_)};if("line"===eF)for(let en of Nh(ec.geometry,0,0,8192,8192)){let ec=lu(en,eV),ef=function(en,es,ec,ed,ep,ef,em,e_,eg){let ey=ed?.6*ef*em:0,ex=Yh(ed,ep),ev=ex*em,eb=0===en[0].x||en[0].x===eg||0===en[0].y||en[0].y===eg;return es-ev<es/4&&(es=ev+es/4),function Jh(en,es,ec,ed,ep,ef,em,e_,eg){let ey=ef/2,ex=Xh(en),ev=0,eb=es-ec,ew=[];for(let es=0;es<en.length-1;es++){let em=en[es],e_=en[es+1],eT=em.dist(e_),eP=e_.angleTo(em);for(;eb+ec<ev+eT;){eb+=ec;let eS=(eb-ev)/eT,eM=tE.number(em.x,e_.x,eS),eC=tE.number(em.y,e_.y,eS);if(eM>=0&&eM<eg&&eC>=0&&eC<eg&&eb-ey>=0&&eb+ey<=ex){let ec=new qh(eM,eC,eP,es);ec._round(),ed&&!Gh(en,ec,ef,ed,ep)||ew.push(ec)}}ev+=eT}return e_||ew.length||em||(ew=Jh(en,ev/2,ec,ed,ep,ef,em,!0,eg)),ew}(en,eb?es/2*e_%es:(ex/2+2*ef)*em*e_%es,es,ey,ec,ev,eb,!1,eg)}(ec,ez,eR,ed.vertical||eM,ep,24,eE,es.overscaling,8192);for(let en of ef)eM&&function(en,es,ec,ed){let ep=en.compareText;if(es in ep){let en=ep[es];for(let es=en.length-1;es>=0;es--)if(ed.dist(en[es])<ec)return!0}else ep[es]=[];return ep[es].push(ed),!1}(es,eM.text,eO,en)||B(ec,en)}else if("line-center"===eF){for(let en of ec.geometry)if(en.length>1){let es=lu(en,eV),ec=function(en,es,ec,ed,ep,ef){let em=ec?.6*24*ef:0,e_=Yh(ec,ed)*ef,eg=0,ey=Xh(en)/2;for(let ec=0;ec<en.length-1;ec++){let ed=en[ec],ep=en[ec+1],ef=ed.dist(ep);if(eg+ef>ey){let ex=(ey-eg)/ef,ev=tE.number(ed.x,ep.x,ex),eb=tE.number(ed.y,ep.y,ex),ew=new qh(ev,eb,ep.angleTo(ed),ec);return ew._round(),!em||Gh(en,ew,e_,em,es)?ew:void 0}eg+=ef}}(es,eR,ed.vertical||eM,ep,0,eE);ec&&B(es,ec)}}else if("Polygon"===ec.type)for(let en of Qr(ec.geometry,0)){let es=function(en,es=1,ec=!1){let ed=$h.fromPoints(en[0]),ep=Math.min(ed.width(),ed.height()),ef=ep/2,em=new ip([],ap),{minX:e_,minY:eg,maxX:ey,maxY:ex}=ed;if(0===ep)return new r(e_,eg);for(let es=e_;es<ey;es+=ep)for(let ec=eg;ec<ex;ec+=ep)em.push(new op(es+ef,ec+ef,ef,en));let ev=function(en){let es=0,ec=0,ed=0,ep=en[0];for(let en=0,ef=ep.length,em=ef-1;en<ef;em=en++){let ef=ep[en],e_=ep[em],eg=ef.x*e_.y-e_.x*ef.y;ec+=(ef.x+e_.x)*eg,ed+=(ef.y+e_.y)*eg,es+=3*eg}return new op(ec/es,ed/es,0,en)}(en),eb=em.length;for(;em.length;){let ed=em.pop();(ed.d>ev.d||!ev.d)&&(ev=ed,ec&&console.log("found best %d after %d probes",Math.round(1e4*ed.d)/1e4,eb)),ed.max-ev.d<=es||(ef=ed.h/2,em.push(new op(ed.p.x-ef,ed.p.y-ef,ef,en)),em.push(new op(ed.p.x+ef,ed.p.y-ef,ef,en)),em.push(new op(ed.p.x-ef,ed.p.y+ef,ef,en)),em.push(new op(ed.p.x+ef,ed.p.y+ef,ef,en)),eb+=4)}return ec&&(console.log(`num probes: ${eb}`),console.log(`best distance: ${ev.d}`)),ev.p}(en,16);B(lu(en[0],eV,!0),new qh(es.x,es.y,0))}else if("LineString"===ec.type)for(let en of ec.geometry){let es=lu(en,eV);B(es,new qh(es[0].x,es[0].y,0))}else if("Point"===ec.type)for(let en of ec.geometry)for(let es of en)B([es],new qh(es.x,es.y,0))}(es.bucket,ep,eT,eS,es.imageMap,ef,eb,ew,eM,eC,es.canonical,es.subdivisionGranularity)}es.showCollisionBoxes&&es.bucket.generateCollisionDebugBuffers()},en.cI=pu,en.cJ=Pu,en.cK=qu,en.cL=ku,en.cM=uc,en.cN=class{constructor(en){this._marks={start:[en.url,"start"].join("#"),end:[en.url,"end"].join("#"),measure:en.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let en=performance.getEntriesByName(this._marks.measure);return 0===en.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),en=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),en}},en.cO=function(en,es,ec,ef,em){return e(this,void 0,void 0,function*(){if(h())try{return yield K(en,es,ec,ef,em)}catch(en){}return function(en,es,ec,ef,em){let e_=en.width,eg=en.height;ed&&ep||(ep=(ed=new OffscreenCanvas(e_,eg)).getContext("2d",{willReadFrequently:!0})),ed.width=e_,ed.height=eg,ep.drawImage(en,0,0,e_,eg);let ey=ep.getImageData(es,ec,ef,em);return ep.clearRect(0,0,e_,eg),ey.data}(en,es,ec,ef,em)})},en.cP=Al,en.cQ=n,en.cR=Su,en.cS=bu,en.cT=ri,en.cU=function(en,es){let ec=new Map;if(null==en);else if("Feature"===en.type)ec.set(Dh(en,es),en);else for(let ed of en.features)ec.set(Dh(ed,es),ed);return ec},en.cV=function(en,es){if(null==en)return!0;if("Feature"===en.type)return null!=Dh(en,es);if("FeatureCollection"===en.type){let ec=new Set;for(let ed of en.features){let en=Dh(ed,es);if(null==en||ec.has(en))return!1;ec.add(en)}return!0}return!1},en.cW=function(en,es,ec){var ed,ep,ef,em;if(es.removeAll&&en.clear(),es.remove)for(let ec of es.remove)en.delete(ec);if(es.add)for(let ed of es.add){let es=Dh(ed,ec);null!=es&&en.set(es,ed)}if(es.update)for(let ec of es.update){let es=en.get(ec.id);if(null==es)continue;let e_=!ec.removeAllProperties&&((null===(ed=ec.removeProperties)||void 0===ed?void 0:ed.length)>0||(null===(ep=ec.addOrUpdateProperties)||void 0===ep?void 0:ep.length)>0);if((ec.newGeometry||ec.removeAllProperties||e_)&&(es=Object.assign({},es),en.set(ec.id,es),e_&&(es.properties=Object.assign({},es.properties))),ec.newGeometry&&(es.geometry=ec.newGeometry),ec.removeAllProperties)es.properties={};else if((null===(ef=ec.removeProperties)||void 0===ef?void 0:ef.length)>0)for(let en of ec.removeProperties)Object.prototype.hasOwnProperty.call(es.properties,en)&&delete es.properties[en];if((null===(em=ec.addOrUpdateProperties)||void 0===em?void 0:em.length)>0)for(let{key:en,value:ed}of ec.addOrUpdateProperties)es.properties[en]=ed}},en.cX=tQ,en.ca=function(en,es){return en[0]=es[0],en[1]=es[1],en[2]=es[2],en[3]=es[3],en[4]=es[4],en[5]=es[5],en[6]=es[6],en[7]=es[7],en[8]=es[8],en[9]=es[9],en[10]=es[10],en[11]=es[11],en[12]=es[12],en[13]=es[13],en[14]=es[14],en[15]=es[15],en},en.cb=en=>"symbol"===en.type,en.cc=en=>"circle"===en.type,en.cd=en=>"heatmap"===en.type,en.ce=en=>"line"===en.type,en.cf=en=>"fill"===en.type,en.cg=en=>"fill-extrusion"===en.type,en.ch=en=>"hillshade"===en.type,en.ci=en=>"color-relief"===en.type,en.cj=en=>"raster"===en.type,en.ck=en=>"background"===en.type,en.cl=en=>"custom"===en.type,en.cm=V,en.cn=function(en,es,ec){let ed=z(es.x-ec.x,es.y-ec.y),ep=z(en.x-ec.x,en.y-ec.y);return et(Math.atan2(ed[0]*ep[1]-ed[1]*ep[0],ed[0]*ep[0]+ed[1]*ep[1]))},en.co=eR,en.cp=function(en,es){return eV[es]&&(en instanceof MouseEvent||en instanceof WheelEvent)},en.cq=function(en,es){return ej[es]&&"touches"in en},en.cr=function(en){return ej[en]||eV[en]},en.cs=function(en,es,ec){var ed=es[0],ep=es[1];return en[0]=ec[0]*ed+ec[4]*ep+ec[12],en[1]=ec[1]*ed+ec[5]*ep+ec[13],en},en.ct=function(en,es){let{x:ec,y:ed}=Ch.fromLngLat(es);return!(en<0||en>25||ed<0||ed>=1||ec<0||ec>=1)},en.cu=function(en,es){return en[0]=es[0],en[1]=0,en[2]=0,en[3]=0,en[4]=0,en[5]=es[1],en[6]=0,en[7]=0,en[8]=0,en[9]=0,en[10]=es[2],en[11]=0,en[12]=0,en[13]=0,en[14]=0,en[15]=1,en},en.cv=class extends Ws{},en.cw={mark(en){performance.mark(en)},frame(en){null!=iJ&&iQ.push(en-iJ),iJ=en},clearMetrics(){for(let es in iJ=null,iQ=[],performance.clearMeasures(i1),performance.clearMeasures(i2),en.cx)performance.clearMarks(en.cx[es])},getPerformanceMetrics(){performance.measure(i1,en.cx.create,en.cx.load),performance.measure(i2,en.cx.create,en.cx.fullLoad);let es=performance.getEntriesByName(i1)[0].duration,ec=performance.getEntriesByName(i2)[0].duration,ed=iQ.length,ep=1/(iQ.reduce((en,es)=>en+es,0)/ed/1e3),ef=iQ.filter(en=>en>i0).reduce((en,es)=>en+(es-i0)/i0,0);return{loadTime:es,fullLoadTime:ec,fps:ep,percentDroppedFrames:ef/(ed+ef)*100,totalFrames:ed}}},en.cy=function(en){return en.message===eU},en.cz=ut,en.d=pt,en.e=L,en.f=en=>e(void 0,void 0,void 0,function*(){if(0===en.byteLength)return createImageBitmap(new ImageData(1,1));let es=new Blob([new Uint8Array(en)],{type:"image/png"});try{return createImageBitmap(es)}catch(en){throw Error(`Could not load image because of ${en.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),en.g=ot,en.h=en=>new Promise((es,ec)=>{let ed=new Image;ed.onload=()=>{es(ed),URL.revokeObjectURL(ed.src),ed.onload=null,window.requestAnimationFrame(()=>{ed.src=eO})},ed.onerror=()=>ec(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let ep=new Blob([new Uint8Array(en)],{type:"image/png"});ed.src=en.byteLength?URL.createObjectURL(ep):eO}),en.i=X,en.j=(en,es)=>ht(L(en,{type:"json"}),es),en.k=mt,en.l=yt,en.m=ht,en.n=(en,es)=>ht(L(en,{type:"arrayBuffer"}),es),en.o=function(en){return new uc(en).readFields(wc,[])},en.p=Ac,en.q=fl,en.r=Ns,en.s=Q,en.t=Ts,en.u=tX,en.v=eG,en.w=q,en.x=tG,en.y=is,en.z=Hi}),define("worker",["./shared"],function(en){let t=class t{constructor(en,es){this.keyCache={},en&&this.replace(en,es)}replace(en,es){this._layerConfigs={},this._layers={},this.update(en,[],es)}update(es,ec,ed){for(let ec of es){this._layerConfigs[ec.id]=ec;let es=this._layers[ec.id]=en.bJ(ec,ed);es._featureFilter=en.aa(es.filter,ed),this.keyCache[ec.id]&&delete this.keyCache[ec.id]}for(let en of ec)delete this.keyCache[en],delete this._layerConfigs[en],delete this._layers[en];this.familiesBySource={};let ep=en.cC(Object.values(this._layerConfigs),this.keyCache);for(let en of ep){let es=en.map(en=>this._layers[en.id]),ec=es[0];if("none"===ec.visibility)continue;let ed=ec.source||"",ep=this.familiesBySource[ed];ep||(ep=this.familiesBySource[ed]={});let ef=ec.sourceLayer||"_geojsonTileLayer",em=ep[ef];em||(em=ep[ef]=[]),em.push(es)}}};let i=class i{constructor(es){let ec={},ed=[];for(let en in es){let ep=es[en],ef=ec[en]={};for(let en in ep){let es=ep[+en];if(!es||0===es.bitmap.width||0===es.bitmap.height)continue;let ec={x:0,y:0,w:es.bitmap.width+2,h:es.bitmap.height+2};ed.push(ec),ef[en]={rect:ec,metrics:es.metrics}}}let{w:ep,h:ef}=en.p(ed),em=new en.q({width:ep||1,height:ef||1});for(let ed in es){let ep=es[ed];for(let es in ep){let ef=ep[+es];if(!ef||0===ef.bitmap.width||0===ef.bitmap.height)continue;let e_=ec[ed][es].rect;en.q.copy(ef.bitmap,em,{x:0,y:0},{x:e_.x+1,y:e_.y+1},ef.bitmap)}}this.image=em,this.positions=ec}};en.cD("GlyphAtlas",i);let o=class o{constructor(es){this.tileID=new en.Z(es.tileID.overscaledZ,es.tileID.wrap,es.tileID.canonical.z,es.tileID.canonical.x,es.tileID.canonical.y),this.uid=es.uid,this.zoom=es.zoom,this.pixelRatio=es.pixelRatio,this.tileSize=es.tileSize,this.source=es.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=es.showCollisionBoxes,this.collectResourceTiming=!!es.collectResourceTiming,this.returnDependencies=!!es.returnDependencies,this.promoteId=es.promoteId,this.inFlightDependencies=[]}parse(es,ec,ed,ep,ef){return en._(this,void 0,void 0,function*(){this.status="parsing",this.data=es,this.collisionBoxArray=new en.a8;let em=new en.cE(Object.keys(es.layers).sort()),e_=new en.cF(this.tileID,this.promoteId);e_.bucketLayerIDs=[];let eg={},ey={featureIndex:e_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ed,subdivisionGranularity:ef},ex=ec.familiesBySource[this.source];for(let ec in ex){let ep=es.layers[ec];if(!ep)continue;1===ep.version&&en.w(`Vector tile source "${this.source}" layer "${ec}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ef=em.encode(ec),ev=[];for(let en=0;en<ep.length;en++){let es=ep.feature(en),ed=e_.getId(es,ec);ev.push({feature:es,id:ed,index:en,sourceLayerIndex:ef})}for(let es of ex[ec]){let ec=es[0];ec.source!==this.source&&en.w(`layer.source = ${ec.source} does not equal this.source = ${this.source}`),ec.minzoom&&this.zoom<Math.floor(ec.minzoom)||ec.maxzoom&&this.zoom>=ec.maxzoom||"none"!==ec.visibility&&(s(es,this.zoom,ed),(eg[ec.id]=ec.createBucket({index:e_.bucketLayerIDs.length,layers:es,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ef,sourceID:this.source})).populate(ev,ey,this.tileID.canonical),e_.bucketLayerIDs.push(es.map(en=>en.id)))}}let ev=en.bN(ey.glyphDependencies,en=>Object.keys(en).map(Number));this.inFlightDependencies.forEach(en=>null==en?void 0:en.abort()),this.inFlightDependencies=[];let eb=Promise.resolve({});if(Object.keys(ev).length){let en=new AbortController;this.inFlightDependencies.push(en),eb=ep.sendAsync({type:"GG",data:{stacks:ev,source:this.source,tileID:this.tileID,type:"glyphs"}},en)}let ew=Object.keys(ey.iconDependencies),eT=Promise.resolve({});if(ew.length){let en=new AbortController;this.inFlightDependencies.push(en),eT=ep.sendAsync({type:"GI",data:{icons:ew,source:this.source,tileID:this.tileID,type:"icons"}},en)}let eP=Object.keys(ey.patternDependencies),eS=Promise.resolve({});if(eP.length){let en=new AbortController;this.inFlightDependencies.push(en),eS=ep.sendAsync({type:"GI",data:{icons:eP,source:this.source,tileID:this.tileID,type:"patterns"}},en)}let eM=ey.dashDependencies,eC=Promise.resolve({});if(Object.keys(eM).length){let en=new AbortController;this.inFlightDependencies.push(en),eC=ep.sendAsync({type:"GDA",data:{dashes:eM}},en)}let[eI,eE,eA,ez]=yield Promise.all([eb,eT,eS,eC]),ek=new i(eI),eD=new en.cG(eE,eA);for(let es in eg){let ec=eg[es];ec instanceof en.a9?(s(ec.layers,this.zoom,ed),en.cH({bucket:ec,glyphMap:eI,glyphPositions:ek.positions,imageMap:eE,imagePositions:eD.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ey.subdivisionGranularity})):ec.hasDependencies&&(ec instanceof en.cI||ec instanceof en.cJ||ec instanceof en.cK)&&(s(ec.layers,this.zoom,ed),ec.addFeatures(ey,this.tileID.canonical,eD.patternPositions,ez))}return this.status="done",{buckets:Object.values(eg).filter(en=>!en.isEmpty()),featureIndex:e_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ek.image,imageAtlas:eD,dashPositions:ez,glyphMap:this.returnDependencies?eI:null,iconMap:this.returnDependencies?eE:null,glyphPositions:this.returnDependencies?ek.positions:null}})}};function s(es,ec,ed){let ep=new en.F(ec);for(let en of es)en.recalculate(ep,ed)}let n=class n{constructor(en,es,ec){this.actor=en,this.layerIndex=es,this.availableImages=ec,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(es,ec){return en._(this,void 0,void 0,function*(){let ed=yield en.n(es.request,ec);try{return{vectorTile:new en.cL(new en.cM(ed.data)),rawData:ed.data,cacheControl:ed.cacheControl,expires:ed.expires}}catch(ep){let en=new Uint8Array(ed.data),ec=`Unable to parse the tile at ${es.request.url}, `;throw Error(ec+=31===en[0]&&139===en[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ep.message}`)}})}loadTile(es){return en._(this,void 0,void 0,function*(){let ec=es.uid,ed=!!(es&&es.request&&es.request.collectResourceTiming)&&new en.cN(es.request),ep=new o(es);this.loading[ec]=ep;let ef=new AbortController;ep.abort=ef;try{let em=yield this.loadVectorTile(es,ef);if(delete this.loading[ec],!em)return null;let e_=em.rawData,eg={};em.expires&&(eg.expires=em.expires),em.cacheControl&&(eg.cacheControl=em.cacheControl);let ey={};if(ed){let en=ed.finish();en&&(ey.resourceTiming=JSON.parse(JSON.stringify(en)))}ep.vectorTile=em.vectorTile;let ex=ep.parse(em.vectorTile,this.layerIndex,this.availableImages,this.actor,es.subdivisionGranularity);this.loaded[ec]=ep,this.fetching[ec]={rawTileData:e_,cacheControl:eg,resourceTiming:ey};try{let es=yield ex;return en.e({rawTileData:e_.slice(0)},es,eg,ey)}finally{delete this.fetching[ec]}}catch(en){throw delete this.loading[ec],ep.status="done",this.loaded[ec]=ep,en}})}reloadTile(es){return en._(this,void 0,void 0,function*(){let ec=es.uid;if(!this.loaded||!this.loaded[ec])throw Error("Should not be trying to reload a tile that was never loaded or has been removed");let ed=this.loaded[ec];if(ed.showCollisionBoxes=es.showCollisionBoxes,"parsing"===ed.status){let ep;let ef=yield ed.parse(ed.vectorTile,this.layerIndex,this.availableImages,this.actor,es.subdivisionGranularity);if(this.fetching[ec]){let{rawTileData:es,cacheControl:ed,resourceTiming:em}=this.fetching[ec];delete this.fetching[ec],ep=en.e({rawTileData:es.slice(0)},ef,ed,em)}else ep=ef;return ep}if("done"===ed.status&&ed.vectorTile)return ed.parse(ed.vectorTile,this.layerIndex,this.availableImages,this.actor,es.subdivisionGranularity)})}abortTile(es){return en._(this,void 0,void 0,function*(){let en=this.loading,ec=es.uid;en&&en[ec]&&en[ec].abort&&(en[ec].abort.abort(),delete en[ec])})}removeTile(es){return en._(this,void 0,void 0,function*(){this.loaded&&this.loaded[es.uid]&&delete this.loaded[es.uid]})}};let r=class r{constructor(){this.loaded={}}loadTile(es){return en._(this,void 0,void 0,function*(){let{uid:ec,encoding:ed,rawImageData:ep,redFactor:ef,greenFactor:em,blueFactor:e_,baseShift:eg}=es,ey=ep.width+2,ex=ep.height+2,ev=en.b(ep)?new en.R({width:ey,height:ex},(yield en.cO(ep,-1,-1,ey,ex))):ep,eb=new en.cP(ec,ev,ed,ef,em,e_,eg);return this.loaded=this.loaded||{},this.loaded[ec]=eb,eb})}removeTile(en){let es=this.loaded,ec=en.uid;es&&es[ec]&&delete es[ec]}};var es,ec,ed,ep=function(){if(ed)return ec;function e(en,es){if(0!==en.length){t(en[0],es);for(var ec=1;ec<en.length;ec++)t(en[ec],!es)}}function t(en,es){for(var ec=0,ed=0,ep=0,ef=en.length,em=ef-1;ep<ef;em=ep++){var e_=(en[ep][0]-en[em][0])*(en[em][1]+en[ep][1]),eg=ec+e_;ed+=Math.abs(ec)>=Math.abs(e_)?ec-eg+e_:e_-eg+ec,ec=eg}ec+ed>=0!=!!es&&en.reverse()}return ed=1,ec=function t(en,es){var ec,ed=en&&en.type;if("FeatureCollection"===ed)for(ec=0;ec<en.features.length;ec++)t(en.features[ec],es);else if("GeometryCollection"===ed)for(ec=0;ec<en.geometries.length;ec++)t(en.geometries[ec],es);else if("Feature"===ed)t(en.geometry,es);else if("Polygon"===ed)e(en.coordinates,es);else if("MultiPolygon"===ed)for(ec=0;ec<en.coordinates.length;ec++)e(en.coordinates[ec],es);return en}}(),ef=en.cQ(ep);let u=class u extends en.cS{constructor(es,ec){super(new en.cM,0,ec,[],[]),this.feature=es,this.type=es.type,this.properties=es.tags?es.tags:{},"id"in es&&("string"==typeof es.id?this.id=parseInt(es.id,10):"number"!=typeof es.id||isNaN(es.id)||(this.id=es.id))}loadGeometry(){let es=[],ec=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(let ed of ec){let ec=[];for(let es of ed)ec.push(new en.P(es[0],es[1]));es.push(ec)}return es}};let d=class d extends en.cR{constructor(es,ec){super(new en.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=ec?ec.version:1,this.extent=ec?ec.extent:4096,this.length=es.length,this.features=es}feature(en){return new u(this.features[en],this.extent)}};function f(en,es){es.writeVarintField(15,en.version||1),es.writeStringField(1,en.name||""),es.writeVarintField(5,en.extent||4096);let ec={keys:[],values:[],keycache:{},valuecache:{}};for(let ed=0;ed<en.length;ed++)ec.feature=en.feature(ed),es.writeMessage(2,g,ec);let ed=ec.keys;for(let en of ed)es.writeStringField(3,en);let ep=ec.values;for(let en of ep)es.writeMessage(4,w,en)}function g(en,es){if(!en.feature)return;let ec=en.feature;void 0!==ec.id&&es.writeVarintField(1,ec.id),es.writeMessage(2,p,en),es.writeVarintField(3,ec.type),es.writeMessage(4,v,ec)}function p(en,es){for(let ec in en.feature?.properties){let ed=en.feature.properties[ec],ep=en.keycache[ec];if(null===ed)continue;void 0===ep&&(en.keys.push(ec),ep=en.keys.length-1,en.keycache[ec]=ep),es.writeVarint(ep),"string"!=typeof ed&&"boolean"!=typeof ed&&"number"!=typeof ed&&(ed=JSON.stringify(ed));let ef=typeof ed+":"+ed,em=en.valuecache[ef];void 0===em&&(en.values.push(ed),em=en.values.length-1,en.valuecache[ef]=em),es.writeVarint(em)}}function v(en,es){let ec=en.loadGeometry(),ed=en.type,ep=0,ef=0;for(let em of ec){let ec=1;1===ed&&(ec=em.length),es.writeVarint((ec<<3)+1);let e_=3===ed?em.length-1:em.length;for(let en=0;en<e_;en++){1===en&&1!==ed&&es.writeVarint((e_-1<<3)+2);let ec=em[en].x-ep,eg=em[en].y-ef;es.writeVarint(ec<<1^ec>>31),es.writeVarint(eg<<1^eg>>31),ep+=ec,ef+=eg}3===en.type&&es.writeVarint(15)}}function w(en,es){let ec=typeof en;"string"===ec?es.writeStringField(1,en):"boolean"===ec?es.writeBooleanField(7,en):"number"===ec&&(en%1!=0?es.writeDoubleField(3,en):en<0?es.writeSVarintField(6,en):es.writeVarintField(5,en))}let em={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:en=>en},e_=Math.fround||(es=new Float32Array(1),en=>(es[0]=+en,es[0]));let _=class _{constructor(en){this.options=Object.assign(Object.create(em),en),this.trees=Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(en){let{log:es,minZoom:ec,maxZoom:ed}=this.options;es&&console.time("total time");let ep=`prepare ${en.length} points`;es&&console.time(ep),this.points=en;let ef=[];for(let es=0;es<en.length;es++){let ec=en[es];if(!ec.geometry)continue;let[ed,ep]=ec.geometry.coordinates,em=e_(k(ed)),eg=e_(P(ep));ef.push(em,eg,1/0,es,-1,1),this.options.reduce&&ef.push(0)}let em=this.trees[ed+1]=this._createTree(ef);es&&console.timeEnd(ep);for(let en=ed;en>=ec;en--){let ec=+Date.now();em=this.trees[en]=this._createTree(this._cluster(em,en)),es&&console.log("z%d: %d clusters in %dms",en,em.numItems,+Date.now()-ec)}return es&&console.timeEnd("total time"),this}getClusters(en,es){let ec=((en[0]+180)%360+360)%360-180,ed=Math.max(-90,Math.min(90,en[1])),ep=180===en[2]?180:((en[2]+180)%360+360)%360-180,ef=Math.max(-90,Math.min(90,en[3]));if(en[2]-en[0]>=360)ec=-180,ep=180;else if(ec>ep){let en=this.getClusters([ec,ed,180,ef],es),em=this.getClusters([-180,ed,ep,ef],es);return en.concat(em)}let em=this.trees[this._limitZoom(es)],e_=em.range(k(ec),P(ef),k(ep),P(ed)),eg=em.data,ey=[];for(let en of e_){let es=this.stride*en;ey.push(eg[es+5]>1?M(eg,es,this.clusterProps):this.points[eg[es+3]])}return ey}getChildren(en){let es=this._getOriginId(en),ec=this._getOriginZoom(en),ed="No cluster with the specified id.",ep=this.trees[ec];if(!ep)throw Error(ed);let ef=ep.data;if(es*this.stride>=ef.length)throw Error(ed);let em=this.options.radius/(this.options.extent*Math.pow(2,ec-1)),e_=ep.within(ef[es*this.stride],ef[es*this.stride+1],em),eg=[];for(let es of e_){let ec=es*this.stride;ef[ec+4]===en&&eg.push(ef[ec+5]>1?M(ef,ec,this.clusterProps):this.points[ef[ec+3]])}if(0===eg.length)throw Error(ed);return eg}getLeaves(en,es,ec){let ed=[];return this._appendLeaves(ed,en,es=es||10,ec=ec||0,0),ed}getTile(en,es,ec){let ed=this.trees[this._limitZoom(en)],ep=Math.pow(2,en),{extent:ef,radius:em}=this.options,e_=em/ef,eg=(ec-e_)/ep,ey=(ec+1+e_)/ep,ex={features:[]};return this._addTileFeatures(ed.range((es-e_)/ep,eg,(es+1+e_)/ep,ey),ed.data,es,ec,ep,ex),0===es&&this._addTileFeatures(ed.range(1-e_/ep,eg,1,ey),ed.data,ep,ec,ep,ex),es===ep-1&&this._addTileFeatures(ed.range(0,eg,e_/ep,ey),ed.data,-1,ec,ep,ex),ex.features.length?ex:null}getClusterExpansionZoom(en){let es=this._getOriginZoom(en)-1;for(;es<=this.options.maxZoom;){let ec=this.getChildren(en);if(es++,1!==ec.length)break;en=ec[0].properties.cluster_id}return es}_appendLeaves(en,es,ec,ed,ep){let ef=this.getChildren(es);for(let es of ef){let ef=es.properties;if(ef&&ef.cluster?ep+ef.point_count<=ed?ep+=ef.point_count:ep=this._appendLeaves(en,ef.cluster_id,ec,ed,ep):ep<ed?ep++:en.push(es),en.length===ec)break}return ep}_createTree(es){let ec=new en.aI(es.length/this.stride|0,this.options.nodeSize,Float32Array);for(let en=0;en<es.length;en+=this.stride)ec.add(es[en],es[en+1]);return ec.finish(),ec.data=es,ec}_addTileFeatures(en,es,ec,ed,ep,ef){for(let em of en){let en,e_,eg,ey;let ex=em*this.stride,ev=es[ex+5]>1;if(ev)en=I(es,ex,this.clusterProps),e_=es[ex],eg=es[ex+1];else{let ec=this.points[es[ex+3]];en=ec.properties;let[ed,ep]=ec.geometry.coordinates;e_=k(ed),eg=P(ep)}let eb={type:1,geometry:[[Math.round(this.options.extent*(e_*ep-ec)),Math.round(this.options.extent*(eg*ep-ed))]],tags:en};void 0!==(ey=ev||this.options.generateId?es[ex+3]:this.points[es[ex+3]].id)&&(eb.id=ey),ef.features.push(eb)}}_limitZoom(en){return Math.max(this.options.minZoom,Math.min(Math.floor(+en),this.options.maxZoom+1))}_cluster(en,es){let{radius:ec,extent:ed,reduce:ep,minPoints:ef}=this.options,em=ec/(ed*Math.pow(2,es)),e_=en.data,eg=[],ey=this.stride;for(let ec=0;ec<e_.length;ec+=ey){if(e_[ec+2]<=es)continue;e_[ec+2]=es;let ed=e_[ec],ex=e_[ec+1],ev=en.within(e_[ec],e_[ec+1],em),eb=e_[ec+5],ew=eb;for(let en of ev){let ec=en*ey;e_[ec+2]>es&&(ew+=e_[ec+5])}if(ew>eb&&ew>=ef){let en,ef=ed*eb,em=ex*eb,eT=-1,eP=(ec/ey<<5)+(es+1)+this.points.length;for(let ed of ev){let eg=ed*ey;if(e_[eg+2]<=es)continue;e_[eg+2]=es;let ex=e_[eg+5];ef+=e_[eg]*ex,em+=e_[eg+1]*ex,e_[eg+4]=eP,ep&&(en||(en=this._map(e_,ec,!0),eT=this.clusterProps.length,this.clusterProps.push(en)),ep(en,this._map(e_,eg)))}e_[ec+4]=eP,eg.push(ef/ew,em/ew,1/0,eP,-1,ew),ep&&eg.push(eT)}else{for(let en=0;en<ey;en++)eg.push(e_[ec+en]);if(ew>1)for(let en of ev){let ec=en*ey;if(!(e_[ec+2]<=es)){e_[ec+2]=es;for(let en=0;en<ey;en++)eg.push(e_[ec+en])}}}}return eg}_getOriginId(en){return en-this.points.length>>5}_getOriginZoom(en){return(en-this.points.length)%32}_map(en,es,ec){if(en[es+5]>1){let ed=this.clusterProps[en[es+6]];return ec?Object.assign({},ed):ed}let ed=this.points[en[es+3]].properties,ep=this.options.map(ed);return ec&&ep===ed?Object.assign({},ep):ep}};function M(en,es,ec){return{type:"Feature",id:en[es+3],properties:I(en,es,ec),geometry:{type:"Point",coordinates:[360*(en[es]-.5),360*Math.atan(Math.exp((180-360*en[es+1])*Math.PI/180))/Math.PI-90]}}}function I(en,es,ec){let ed=en[es+5],ep=ed>=1e4?`${Math.round(ed/1e3)}k`:ed>=1e3?Math.round(ed/100)/10+"k":ed,ef=en[es+6],em=-1===ef?{}:Object.assign({},ec[ef]);return Object.assign(em,{cluster:!0,cluster_id:en[es+3],point_count:ed,point_count_abbreviated:ep})}function k(en){return en/360+.5}function P(en){let es=Math.sin(en*Math.PI/180),ec=.5-.25*Math.log((1+es)/(1-es))/Math.PI;return ec<0?0:ec>1?1:ec}function L(en,es,ec,ed){let ep={id:null==en?null:en,type:es,geometry:ec,tags:ed,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===es||"MultiPoint"===es||"LineString"===es)O(ep,ec);else if("Polygon"===es)O(ep,ec[0]);else if("MultiLineString"===es)for(let en of ec)O(ep,en);else if("MultiPolygon"===es)for(let en of ec)O(ep,en[0]);return ep}function O(en,es){for(let ec=0;ec<es.length;ec+=3)en.minX=Math.min(en.minX,es[ec]),en.minY=Math.min(en.minY,es[ec+1]),en.maxX=Math.max(en.maxX,es[ec]),en.maxY=Math.max(en.maxY,es[ec+1])}function F(en,es,ec,ed){if(!es.geometry)return;let ep=es.geometry.coordinates;if(ep&&0===ep.length)return;let ef=es.geometry.type,em=Math.pow(ec.tolerance/((1<<ec.maxZoom)*ec.extent),2),e_=[],eg=es.id;if(ec.promoteId?eg=es.properties[ec.promoteId]:ec.generateId&&(eg=ed||0),"Point"===ef)z(ep,e_);else if("MultiPoint"===ef)for(let en of ep)z(en,e_);else if("LineString"===ef)A(ep,e_,em,!1);else if("MultiLineString"===ef){if(ec.lineMetrics){for(let ec of ep)A(ec,e_=[],em,!1),en.push(L(eg,"LineString",e_,es.properties));return}G(ep,e_,em,!1)}else if("Polygon"===ef)G(ep,e_,em,!0);else{if("MultiPolygon"!==ef){if("GeometryCollection"===ef){for(let ep of es.geometry.geometries)F(en,{id:eg,geometry:ep,properties:es.properties},ec,ed);return}throw Error("Input data is not a valid GeoJSON object.")}for(let en of ep){let es=[];G(en,es,em,!0),e_.push(es)}}en.push(L(eg,ef,e_,es.properties))}function z(en,es){var ec;es.push(en[0]/360+.5,Z(en[1]),0)}function A(en,es,ec,ed){let ep,ef,em=0;for(let ec=0;ec<en.length;ec++){var e_;let eg=en[ec][0]/360+.5,ey=Z(en[ec][1]);es.push(eg,ey,0),ec>0&&(em+=ed?(ep*ey-eg*ef)/2:Math.sqrt(Math.pow(eg-ep,2)+Math.pow(ey-ef,2))),ep=eg,ef=ey}let eg=es.length-3;es[2]=1,function T(en,es,ec,ed){let ep=ed,ef=es+(ec-es>>1),em,e_=ec-es,eg=en[es],ey=en[es+1],ex=en[ec],ev=en[ec+1];for(let ed=es+3;ed<ec;ed+=3){let es=function(en,es,ec,ed,ep,ef){let em=ep-ec,e_=ef-ed;if(0!==em||0!==e_){let eg=((en-ec)*em+(es-ed)*e_)/(em*em+e_*e_);eg>1?(ec=ep,ed=ef):eg>0&&(ec+=em*eg,ed+=e_*eg)}return(em=en-ec)*em+(e_=es-ed)*e_}(en[ed],en[ed+1],eg,ey,ex,ev);if(es>ep)em=ed,ep=es;else if(es===ep){let en=Math.abs(ed-ef);en<e_&&(em=ed,e_=en)}}ep>ed&&(em-es>3&&T(en,es,em,ed),en[em+2]=ep,ec-em>3&&T(en,em,ec,ed))}(es,0,eg,ec),es[eg+2]=1,es.size=Math.abs(em),es.start=0,es.end=es.size}function G(en,es,ec,ed){for(let ep=0;ep<en.length;ep++){let ef=[];A(en[ep],ef,ec,ed),es.push(ef)}}function Z(en){let es=Math.sin(en*Math.PI/180),ec=.5-.25*Math.log((1+es)/(1-es))/Math.PI;return ec<0?0:ec>1?1:ec}function j(en,es,ec,ed,ep,ef,em,e_){if(ed/=es,ef>=(ec/=es)&&em<ed)return en;if(em<ec||ef>=ed)return null;let eg=[];for(let es of en){let en=es.geometry,ef=es.type,em=0===ep?es.minX:es.minY,ey=0===ep?es.maxX:es.maxY;if(em>=ec&&ey<ed){eg.push(es);continue}if(ey<ec||em>=ed)continue;let ex=[];if("Point"===ef||"MultiPoint"===ef)(function(en,es,ec,ed,ep){for(let ef=0;ef<en.length;ef+=3){let em=en[ef+ep];em>=ec&&em<=ed&&Y(es,en[ef],en[ef+1],en[ef+2])}})(en,ex,ec,ed,ep);else if("LineString"===ef)R(en,ex,ec,ed,ep,!1,e_.lineMetrics);else if("MultiLineString"===ef)J(en,ex,ec,ed,ep,!1);else if("Polygon"===ef)J(en,ex,ec,ed,ep,!0);else if("MultiPolygon"===ef)for(let es of en){let en=[];J(es,en,ec,ed,ep,!0),en.length&&ex.push(en)}if(ex.length){if(e_.lineMetrics&&"LineString"===ef){for(let en of ex)eg.push(L(es.id,ef,en,es.tags));continue}"LineString"!==ef&&"MultiLineString"!==ef||(1===ex.length?(ef="LineString",ex=ex[0]):ef="MultiLineString"),"Point"!==ef&&"MultiPoint"!==ef||(ef=3===ex.length?"Point":"MultiPoint"),eg.push(L(es.id,ef,ex,es.tags))}}return eg.length?eg:null}function R(en,es,ec,ed,ep,ef,em){let e_=W(en),eg=0===ep?q:X,ey,ex,ev=en.start;for(let eb=0;eb<en.length-3;eb+=3){let ew=en[eb],eT=en[eb+1],eP=en[eb+2],eS=en[eb+3],eM=en[eb+4],eC=0===ep?ew:eT,eI=0===ep?eS:eM,eE=!1;em&&(ey=Math.sqrt(Math.pow(ew-eS,2)+Math.pow(eT-eM,2))),eC<ec?eI>ec&&(ex=eg(e_,ew,eT,eS,eM,ec),em&&(e_.start=ev+ey*ex)):eC>ed?eI<ed&&(ex=eg(e_,ew,eT,eS,eM,ed),em&&(e_.start=ev+ey*ex)):Y(e_,ew,eT,eP),eI<ec&&eC>=ec&&(ex=eg(e_,ew,eT,eS,eM,ec),eE=!0),eI>ed&&eC<=ed&&(ex=eg(e_,ew,eT,eS,eM,ed),eE=!0),!ef&&eE&&(em&&(e_.end=ev+ey*ex),es.push(e_),e_=W(en)),em&&(ev+=ey)}let eb=en.length-3,ew=en[eb],eT=en[eb+1],eP=0===ep?ew:eT;eP>=ec&&eP<=ed&&Y(e_,ew,eT,en[eb+2]),eb=e_.length-3,ef&&eb>=3&&(e_[eb]!==e_[0]||e_[eb+1]!==e_[1])&&Y(e_,e_[0],e_[1],e_[2]),e_.length&&es.push(e_)}function W(en){let es=[];return es.size=en.size,es.start=en.start,es.end=en.end,es}function J(en,es,ec,ed,ep,ef){for(let em of en)R(em,es,ec,ed,ep,ef,!1)}function Y(en,es,ec,ed){en.push(es,ec,ed)}function q(en,es,ec,ed,ep,ef){let em=(ef-es)/(ed-es);return Y(en,ef,ec+(ep-ec)*em,1),em}function X(en,es,ec,ed,ep,ef){let em=(ef-ec)/(ep-ec);return Y(en,es+(ed-es)*em,ef,1),em}function H(en,es){let ec=[];for(let ed=0;ed<en.length;ed++){let ep;let ef=en[ed],em=ef.type;if("Point"===em||"MultiPoint"===em||"LineString"===em)ep=V(ef.geometry,es);else if("MultiLineString"===em||"Polygon"===em)for(let en of(ep=[],ef.geometry))ep.push(V(en,es));else if("MultiPolygon"===em)for(let en of(ep=[],ef.geometry)){let ec=[];for(let ed of en)ec.push(V(ed,es));ep.push(ec)}ec.push(L(ef.id,em,ep,ef.tags))}return ec}function V(en,es){let ec=[];ec.size=en.size,void 0!==en.start&&(ec.start=en.start,ec.end=en.end);for(let ed=0;ed<en.length;ed+=3)ec.push(en[ed]+es,en[ed+1],en[ed+2]);return ec}function B(en,es){if(en.transformed)return en;let ec=1<<en.z,ed=en.x,ep=en.y;for(let ef of en.features){let en=ef.geometry,em=ef.type;if(ef.geometry=[],1===em)for(let em=0;em<en.length;em+=2)ef.geometry.push($(en[em],en[em+1],es,ec,ed,ep));else for(let em=0;em<en.length;em++){let e_=[];for(let ef=0;ef<en[em].length;ef+=2)e_.push($(en[em][ef],en[em][ef+1],es,ec,ed,ep));ef.geometry.push(e_)}}return en.transformed=!0,en}function $(en,es,ec,ed,ep,ef){return[Math.round(ec*(en*ed-ep)),Math.round(ec*(es*ed-ef))]}function Q(en,es,ec,ed,ep,ef){let em=ed*ed;if(ed>0&&es.size<(ep?em:ed))return void(ec.numPoints+=es.length/3);let e_=[];for(let en=0;en<es.length;en+=3)(0===ed||es[en+2]>em)&&(ec.numSimplified++,e_.push(es[en],es[en+1])),ec.numPoints++;ep&&function(en,es){let ec=0;for(let es=0,ed=en.length,ep=ed-2;es<ed;ep=es,es+=2)ec+=(en[es]-en[ep])*(en[es+1]+en[ep+1]);if(ec>0===es)for(let es=0,ec=en.length;es<ec/2;es+=2){let ed=en[es],ep=en[es+1];en[es]=en[ec-2-es],en[es+1]=en[ec-1-es],en[ec-2-es]=ed,en[ec-1-es]=ep}}(e_,ef),en.push(e_)}let eg={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};let te=class te{constructor(en,es){let ec=(es=this.options=function(en,es){for(let ec in es)en[ec]=es[ec];return en}(Object.create(eg),es)).debug;if(ec&&console.time("preprocess data"),es.maxZoom<0||es.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(es.promoteId&&es.generateId)throw Error("promoteId and generateId cannot be used together.");let ed=function(en,es){let ec=[];if("FeatureCollection"===en.type)for(let ed=0;ed<en.features.length;ed++)F(ec,en.features[ed],es,ed);else F(ec,"Feature"===en.type?en:{geometry:en},es);return ec}(en,es);this.tiles={},this.tileCoords=[],ec&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",es.indexMaxZoom,es.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ed=function(en,es){let ec=es.buffer/es.extent,ed=en,ep=j(en,1,-1-ec,ec,0,-1,2,es),ef=j(en,1,1-ec,2+ec,0,-1,2,es);return(ep||ef)&&(ed=j(en,1,-ec,1+ec,0,-1,2,es)||[],ep&&(ed=H(ep,1).concat(ed)),ef&&(ed=ed.concat(H(ef,-1)))),ed}(ed,es)).length&&this.splitTile(ed,0,0,0),ec&&(ed.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(en,es,ec,ed,ep,ef,em){let e_=[en,es,ec,ed],eg=this.options,ey=eg.debug;for(;e_.length;){ed=e_.pop(),ec=e_.pop(),es=e_.pop(),en=e_.pop();let ex=1<<es,ev=ie(es,ec,ed),eb=this.tiles[ev];if(!eb&&(ey>1&&console.time("creation"),eb=this.tiles[ev]=function(en,es,ec,ed,ep){let ef=es===ep.maxZoom?0:ep.tolerance/((1<<es)*ep.extent),em={features:[],numPoints:0,numSimplified:0,numFeatures:en.length,source:null,x:ec,y:ed,z:es,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let es of en)(function(en,es,ec,ed){let ep=es.geometry,ef=es.type,em=[];if(en.minX=Math.min(en.minX,es.minX),en.minY=Math.min(en.minY,es.minY),en.maxX=Math.max(en.maxX,es.maxX),en.maxY=Math.max(en.maxY,es.maxY),"Point"===ef||"MultiPoint"===ef)for(let es=0;es<ep.length;es+=3)em.push(ep[es],ep[es+1]),en.numPoints++,en.numSimplified++;else if("LineString"===ef)Q(em,ep,en,ec,!1,!1);else if("MultiLineString"===ef||"Polygon"===ef)for(let es=0;es<ep.length;es++)Q(em,ep[es],en,ec,"Polygon"===ef,0===es);else if("MultiPolygon"===ef)for(let es=0;es<ep.length;es++){let ed=ep[es];for(let es=0;es<ed.length;es++)Q(em,ed[es],en,ec,!0,0===es)}if(em.length){let ec=es.tags||null;if("LineString"===ef&&ed.lineMetrics){for(let en in ec={},es.tags)ec[en]=es.tags[en];ec.mapbox_clip_start=ep.start/ep.size,ec.mapbox_clip_end=ep.end/ep.size}let e_={geometry:em,type:"Polygon"===ef||"MultiPolygon"===ef?3:"LineString"===ef||"MultiLineString"===ef?2:1,tags:ec};null!==es.id&&(e_.id=es.id),en.features.push(e_)}})(em,es,ef,ep);return em}(en,es,ec,ed,eg),this.tileCoords.push({z:es,x:ec,y:ed}),ey)){ey>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",es,ec,ed,eb.numFeatures,eb.numPoints,eb.numSimplified),console.timeEnd("creation"));let en=`z${es}`;this.stats[en]=(this.stats[en]||0)+1,this.total++}if(eb.source=en,null==ep){if(es===eg.indexMaxZoom||eb.numPoints<=eg.indexMaxPoints)continue}else{if(es===eg.maxZoom||es===ep)continue;if(null!=ep){let en=ep-es;if(ec!==ef>>en||ed!==em>>en)continue}}if(eb.source=null,0===en.length)continue;ey>1&&console.time("clipping");let ew=.5*eg.buffer/eg.extent,eT=.5-ew,eP=.5+ew,eS=1+ew,eM=null,eC=null,eI=null,eE=null,eA=j(en,ex,ec-ew,ec+eP,0,eb.minX,eb.maxX,eg),ez=j(en,ex,ec+eT,ec+eS,0,eb.minX,eb.maxX,eg);en=null,eA&&(eM=j(eA,ex,ed-ew,ed+eP,1,eb.minY,eb.maxY,eg),eC=j(eA,ex,ed+eT,ed+eS,1,eb.minY,eb.maxY,eg),eA=null),ez&&(eI=j(ez,ex,ed-ew,ed+eP,1,eb.minY,eb.maxY,eg),eE=j(ez,ex,ed+eT,ed+eS,1,eb.minY,eb.maxY,eg),ez=null),ey>1&&console.timeEnd("clipping"),e_.push(eM||[],es+1,2*ec,2*ed),e_.push(eC||[],es+1,2*ec,2*ed+1),e_.push(eI||[],es+1,2*ec+1,2*ed),e_.push(eE||[],es+1,2*ec+1,2*ed+1)}}getTile(en,es,ec){en=+en,es=+es,ec=+ec;let ed=this.options,{extent:ep,debug:ef}=ed;if(en<0||en>24)return null;let em=1<<en,e_=ie(en,es=es+em&em-1,ec);if(this.tiles[e_])return B(this.tiles[e_],ep);ef>1&&console.log("drilling down to z%d-%d-%d",en,es,ec);let eg,ey=en,ex=es,ev=ec;for(;!eg&&ey>0;)ey--,ex>>=1,ev>>=1,eg=this.tiles[ie(ey,ex,ev)];return eg&&eg.source?(ef>1&&(console.log("found parent tile z%d-%d-%d",ey,ex,ev),console.time("drilling down")),this.splitTile(eg.source,ey,ex,ev,en,es,ec),ef>1&&console.timeEnd("drilling down"),this.tiles[e_]?B(this.tiles[e_],ep):null):null}};function ie(en,es,ec){return 32*((1<<en)*ec+es)+en}let oe=class oe extends n{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(es,ec){return en._(this,void 0,void 0,function*(){let ec=es.tileID.canonical;if(!this._geoJSONIndex)throw Error("Unable to parse the data into a cluster or geojson");let ed=this._geoJSONIndex.getTile(ec.z,ec.x,ec.y);if(!ed)return null;let ep=new d(ed.features,{version:2,extent:en.$}),ef=function(es){let ec=new en.cM;return function(en,es){for(let ec in en.layers)es.writeMessage(3,f,en.layers[ec])}(es,ec),ec.finish()}(ep);return 0===ef.byteOffset&&ef.byteLength===ef.buffer.byteLength||(ef=new Uint8Array(ef)),{vectorTile:ep,rawData:ef.buffer}})}loadData(es){return en._(this,void 0,void 0,function*(){var ec,ed;null===(ec=this._pendingRequest)||void 0===ec||ec.abort();let ep=!!(es&&es.request&&es.request.collectResourceTiming)&&new en.cN(es.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(es,this._pendingRequest);let ec=yield this._pendingData;this._geoJSONIndex=es.cluster?new _(function({superclusterOptions:es,clusterProperties:ec}){if(!ec||!es)return es;let ed={},ep={},ef={accumulated:null,zoom:0},em={properties:null},e_=Object.keys(ec);for(let es of e_){let[ef,em]=ec[es],e_=en.cT(em),eg=en.cT("string"==typeof ef?[ef,["accumulated"],["get",es]]:ef);ed[es]=e_.value,ep[es]=eg.value}return es.map=en=>{em.properties=en;let es={};for(let en of e_)es[en]=ed[en].evaluate(ef,em);return es},es.reduce=(en,es)=>{for(let ec of(em.properties=es,e_))ef.accumulated=en[ec],en[ec]=ep[ec].evaluate(ef,em)},es}(es)).load(ec.features):(ed=es.geojsonVtOptions,new te(ec,ed)),this.loaded={};let ef={data:ec};if(ep){let en=ep.finish();en&&(ef.resourceTiming={},ef.resourceTiming[es.source]=JSON.parse(JSON.stringify(en)))}return ef}catch(es){if(delete this._pendingRequest,en.cy(es))return{abandoned:!0};throw es}})}getData(){return en._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(en){let es=this.loaded;return es&&es[en.uid]?super.reloadTile(en):this.loadTile(en)}loadAndProcessGeoJSON(es,ec){return en._(this,void 0,void 0,function*(){let ed=yield this.loadGeoJSON(es,ec);if(delete this._pendingRequest,"object"!=typeof ed)throw Error(`Input data given to '${es.source}' is not a valid GeoJSON object.`);if(ef(ed,!0),es.filter){let ec=en.cT(es.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ec.result)throw Error(ec.value.map(en=>`${en.key}: ${en.message}`).join(", "));let ep=ed.features.filter(en=>ec.value.evaluate({zoom:0},en));ed={type:"FeatureCollection",features:ep}}return ed})}loadGeoJSON(es,ec){return en._(this,void 0,void 0,function*(){let{promoteId:ed}=es;if(es.request){let ep=yield en.j(es.request,ec);return this._dataUpdateable=en.cV(ep.data,ed)?en.cU(ep.data,ed):void 0,ep.data}if("string"==typeof es.data)try{let ec=JSON.parse(es.data);return this._dataUpdateable=en.cV(ec,ed)?en.cU(ec,ed):void 0,ec}catch(en){throw Error(`Input data given to '${es.source}' is not a valid GeoJSON object.`)}if(!es.dataDiff)throw Error(`Input data given to '${es.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw Error(`Cannot update existing geojson data in ${es.source}`);return en.cW(this._dataUpdateable,es.dataDiff,ed),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(es){return en._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(en){return this._geoJSONIndex.getClusterExpansionZoom(en.clusterId)}getClusterChildren(en){return this._geoJSONIndex.getChildren(en.clusterId)}getClusterLeaves(en){return this._geoJSONIndex.getLeaves(en.clusterId,en.limit,en.offset)}};let se=class se{constructor(es){this.self=es,this.actor=new en.J(es),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(en,es)=>{if(this.externalWorkerSourceTypes[en])throw Error(`Worker source with name "${en}" already registered.`);this.externalWorkerSourceTypes[en]=es},this.self.addProtocol=en.cA,this.self.removeProtocol=en.cB,this.self.registerRTLTextPlugin=es=>{en.cX.setMethods(es)},this.actor.registerMessageHandler("LDT",(en,es)=>this._getDEMWorkerSource(en,es.source).loadTile(es)),this.actor.registerMessageHandler("RDT",(es,ec)=>en._(this,void 0,void 0,function*(){this._getDEMWorkerSource(es,ec.source).removeTile(ec)})),this.actor.registerMessageHandler("GCEZ",(es,ec)=>en._(this,void 0,void 0,function*(){return this._getWorkerSource(es,ec.type,ec.source).getClusterExpansionZoom(ec)})),this.actor.registerMessageHandler("GCC",(es,ec)=>en._(this,void 0,void 0,function*(){return this._getWorkerSource(es,ec.type,ec.source).getClusterChildren(ec)})),this.actor.registerMessageHandler("GCL",(es,ec)=>en._(this,void 0,void 0,function*(){return this._getWorkerSource(es,ec.type,ec.source).getClusterLeaves(ec)})),this.actor.registerMessageHandler("LD",(en,es)=>this._getWorkerSource(en,es.type,es.source).loadData(es)),this.actor.registerMessageHandler("GD",(en,es)=>this._getWorkerSource(en,es.type,es.source).getData()),this.actor.registerMessageHandler("LT",(en,es)=>this._getWorkerSource(en,es.type,es.source).loadTile(es)),this.actor.registerMessageHandler("RT",(en,es)=>this._getWorkerSource(en,es.type,es.source).reloadTile(es)),this.actor.registerMessageHandler("AT",(en,es)=>this._getWorkerSource(en,es.type,es.source).abortTile(es)),this.actor.registerMessageHandler("RMT",(en,es)=>this._getWorkerSource(en,es.type,es.source).removeTile(es)),this.actor.registerMessageHandler("RS",(es,ec)=>en._(this,void 0,void 0,function*(){if(!this.workerSources[es]||!this.workerSources[es][ec.type]||!this.workerSources[es][ec.type][ec.source])return;let en=this.workerSources[es][ec.type][ec.source];delete this.workerSources[es][ec.type][ec.source],void 0!==en.removeSource&&en.removeSource(ec)})),this.actor.registerMessageHandler("RM",es=>en._(this,void 0,void 0,function*(){delete this.layerIndexes[es],delete this.availableImages[es],delete this.workerSources[es],delete this.demWorkerSources[es],this.globalStates.delete(es)})),this.actor.registerMessageHandler("SR",(es,ec)=>en._(this,void 0,void 0,function*(){this.referrer=ec})),this.actor.registerMessageHandler("SRPS",(en,es)=>this._syncRTLPluginState(en,es)),this.actor.registerMessageHandler("IS",(es,ec)=>en._(this,void 0,void 0,function*(){this.self.importScripts(ec)})),this.actor.registerMessageHandler("SI",(en,es)=>this._setImages(en,es)),this.actor.registerMessageHandler("UL",(es,ec)=>en._(this,void 0,void 0,function*(){this._getLayerIndex(es).update(ec.layers,ec.removedIds,this._getGlobalState(es))})),this.actor.registerMessageHandler("UGS",(es,ec)=>en._(this,void 0,void 0,function*(){let en=this._getGlobalState(es);for(let es in ec)en[es]=ec[es]})),this.actor.registerMessageHandler("SL",(es,ec)=>en._(this,void 0,void 0,function*(){this._getLayerIndex(es).replace(ec,this._getGlobalState(es))}))}_getGlobalState(en){let es=this.globalStates.get(en);return es||(es={},this.globalStates.set(en,es)),es}_setImages(es,ec){return en._(this,void 0,void 0,function*(){for(let en in this.availableImages[es]=ec,this.workerSources[es]){let ed=this.workerSources[es][en];for(let en in ed)ed[en].availableImages=ec}})}_syncRTLPluginState(es,ec){return en._(this,void 0,void 0,function*(){return yield en.cX.syncState(ec,this.self.importScripts)})}_getAvailableImages(en){let es=this.availableImages[en];return es||(es=[]),es}_getLayerIndex(en){let es=this.layerIndexes[en];return es||(es=this.layerIndexes[en]=new t),es}_getWorkerSource(en,es,ec){if(this.workerSources[en]||(this.workerSources[en]={}),this.workerSources[en][es]||(this.workerSources[en][es]={}),!this.workerSources[en][es][ec]){let ed={sendAsync:(es,ec)=>(es.targetMapId=en,this.actor.sendAsync(es,ec))};switch(es){case"vector":this.workerSources[en][es][ec]=new n(ed,this._getLayerIndex(en),this._getAvailableImages(en));break;case"geojson":this.workerSources[en][es][ec]=new oe(ed,this._getLayerIndex(en),this._getAvailableImages(en));break;default:this.workerSources[en][es][ec]=new this.externalWorkerSourceTypes[es](ed,this._getLayerIndex(en),this._getAvailableImages(en))}}return this.workerSources[en][es][ec]}_getDEMWorkerSource(en,es){return this.demWorkerSources[en]||(this.demWorkerSources[en]={}),this.demWorkerSources[en][es]||(this.demWorkerSources[en][es]=new r),this.demWorkerSources[en][es]}};return en.i(self)&&(self.worker=new se(self)),se}),define("index",["exports","./shared"],function(en,es){let ec,ed,ep,ef,em,e_,eg;var ey,ex="5.8.0";function o(){var en=new es.A(4);return es.A!=Float32Array&&(en[1]=0,en[2]=0),en[0]=1,en[3]=1,en}let ev={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(en,ec,ed){let ep=requestAnimationFrame(en=>{ef(),ec(en)}),{unsubscribe:ef}=es.s(en.signal,"abort",()=>{ef(),cancelAnimationFrame(ep),ed(es.c())},!1)},frameAsync(en){return new Promise((es,ec)=>{this.frame(en,es,ec)})},getImageData(en,es=0){return this.getImageCanvasContext(en).getImageData(-es,-es,en.width+2*es,en.height+2*es)},getImageCanvasContext(en){let es=window.document.createElement("canvas"),ec=es.getContext("2d",{willReadFrequently:!0});if(!ec)throw Error("failed to create canvas 2d context");return es.width=en.width,es.height=en.height,ec.drawImage(en,0,0,en.width,en.height),ec},resolveURL:en=>(ec||(ec=document.createElement("a")),ec.href=en,ec.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==ed&&(ed=matchMedia("(prefers-reduced-motion: reduce)")),ed.matches)}};let n=class n{static testProp(en){if(!n.docStyle)return en[0];for(let es=0;es<en.length;es++)if(en[es]in n.docStyle)return en[es];return en[0]}static create(en,es,ec){let ed=window.document.createElement(en);return void 0!==es&&(ed.className=es),ec&&ec.appendChild(ed),ed}static createNS(en,es){return window.document.createElementNS(en,es)}static disableDrag(){n.docStyle&&n.selectProp&&(n.userSelect=n.docStyle[n.selectProp],n.docStyle[n.selectProp]="none")}static enableDrag(){n.docStyle&&n.selectProp&&(n.docStyle[n.selectProp]=n.userSelect)}static setTransform(en,es){en.style[n.transformProp]=es}static addEventListener(en,es,ec,ed={}){en.addEventListener(es,ec,"passive"in ed?ed:ed.capture)}static removeEventListener(en,es,ec,ed={}){en.removeEventListener(es,ec,"passive"in ed?ed:ed.capture)}static suppressClickInternal(en){en.preventDefault(),en.stopPropagation(),window.removeEventListener("click",n.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",n.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",n.suppressClickInternal,!0)},0)}static getScale(en){let es=en.getBoundingClientRect();return{x:es.width/en.offsetWidth||1,y:es.height/en.offsetHeight||1,boundingClientRect:es}}static getPoint(en,ec,ed){let ep=ec.boundingClientRect;return new es.P((ed.clientX-ep.left)/ec.x-en.clientLeft,(ed.clientY-ep.top)/ec.y-en.clientTop)}static mousePos(en,es){let ec=n.getScale(en);return n.getPoint(en,ec,es)}static touchPos(en,es){let ec=[],ed=n.getScale(en);for(let ep=0;ep<es.length;ep++)ec.push(n.getPoint(en,ed,es[ep]));return ec}static mouseButton(en){return en.button}static remove(en){en.parentNode&&en.parentNode.removeChild(en)}static sanitize(en){let es=(new DOMParser).parseFromString(en,"text/html").body||document.createElement("body"),ec=es.querySelectorAll("script");for(let en of ec)en.remove();return n.clean(es),es.innerHTML}static isPossiblyDangerous(en,es){let ec=es.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(en)||!ec.includes("javascript:")&&!ec.includes("data:"))||!!en.startsWith("on")||void 0}static clean(en){let es=en.children;for(let en of es)n.removeAttributes(en),n.clean(en)}static removeAttributes(en){for(let{name:es,value:ec}of en.attributes)n.isPossiblyDangerous(es,ec)&&en.removeAttribute(es)}};n.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,n.selectProp=n.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),n.transformProp=n.testProp(["transform","WebkitTransform"]);let eb={supported:!1,testSupport:function(en){!eP&&eT&&(eS?_(en):ew=en)}},ew,eT,eP=!1,eS=!1;function _(en){let es=en.createTexture();en.bindTexture(en.TEXTURE_2D,es);try{if(en.texImage2D(en.TEXTURE_2D,0,en.RGBA,en.RGBA,en.UNSIGNED_BYTE,eT),en.isContextLost())return;eb.supported=!0}catch(en){}en.deleteTexture(es),eP=!0}"undefined"!=typeof document&&((eT=document.createElement("img")).onload=()=>{ew&&_(ew),ew=null,eS=!0},eT.onerror=()=>{eP=!0,ew=null},eT.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(en){let ec,ed,ep,ef;en.resetRequestQueue=()=>{ec=[],ed=0,ep=0,ef={}},en.addThrottleControl=en=>{let es=ep++;return ef[es]=en,es},en.removeThrottleControl=en=>{delete ef[en],n()},en.getImage=(en,ed,ep=!0)=>new Promise((ef,em)=>{eb.supported&&(en.headers||(en.headers={}),en.headers.accept="image/webp,*/*"),es.e(en,{type:"image"}),ec.push({abortController:ed,requestParameters:en,supportImageRefresh:ep,state:"queued",onError:en=>{em(en)},onSuccess:en=>{ef(en)}}),n()});let s=en=>es._(this,void 0,void 0,function*(){var ec;en.state="running";let{requestParameters:ep,supportImageRefresh:ef,onError:em,onSuccess:e_,abortController:eg}=en,ey=!1===ef&&!es.i(self)&&!es.g(ep.url)&&(!ep.headers||Object.keys(ep.headers).reduce((en,es)=>en&&"accept"===es,!0));ed++;let ex=ey?c(ep,eg):es.m(ep,eg);try{let ed=yield ex;delete en.abortController,en.state="completed",ed.data instanceof HTMLImageElement||es.b(ed.data)?e_(ed):ed.data&&e_({data:yield(ec=ed.data,"function"==typeof createImageBitmap?es.f(ec):es.h(ec)),cacheControl:ed.cacheControl,expires:ed.expires})}catch(es){delete en.abortController,em(es)}finally{ed--,n()}}),n=()=>{let en=(()=>{for(let en of Object.keys(ef))if(ef[en]())return!0;return!1})()?es.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:es.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let es=ed;es<en&&ec.length>0;es++){let en=ec.shift();en.abortController.signal.aborted?es--:s(en)}},c=(en,ec)=>new Promise((ed,ep)=>{let ef=new Image,em=en.url,e_=en.credentials;e_&&"include"===e_?ef.crossOrigin="use-credentials":(e_&&"same-origin"===e_||!es.d(em))&&(ef.crossOrigin="anonymous"),ec.signal.addEventListener("abort",()=>{ef.src="",ep(es.c())}),ef.fetchPriority="high",ef.onload=()=>{ef.onerror=ef.onload=null,ed({data:ef})},ef.onerror=()=>{ef.onerror=ef.onload=null,ec.signal.aborted||ep(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ef.src=em})}(ey||(ey={})),ey.resetRequestQueue();let m=class m{constructor(en){this._transformRequestFn=null!=en?en:null}transformRequest(en,es){return this._transformRequestFn&&this._transformRequestFn(en,es)||{url:en}}setTransformRequest(en){this._transformRequestFn=en}};function f(en){let es=[];if("string"==typeof en)es.push({id:"default",url:en});else if(en&&en.length>0){let ec=[];for(let{id:ed,url:ep}of en){let en=`${ed}${ep}`;-1===ec.indexOf(en)&&(ec.push(en),es.push({id:ed,url:ep}))}}return es}function g(en,es,ec){try{let ed=new URL(en);return ed.pathname+=`${es}${ec}`,ed.toString()}catch(es){throw Error(`Invalid sprite URL "${en}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}let b=class b extends es.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new es.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(en){if(this.loaded!==en&&(this.loaded=en,en)){for(let{ids:en,promiseResolve:es}of this.requestors)es(this._getImagesForIds(en));this.requestors=[]}}getImage(en){let ec=this.images[en];if(ec&&!ec.data&&ec.spriteData){let en=ec.spriteData;ec.data=new es.R({width:en.width,height:en.height},en.context.getImageData(en.x,en.y,en.width,en.height).data),ec.spriteData=null}return ec}addImage(en,es){if(this.images[en])throw Error(`Image id ${en} already exist, use updateImage instead`);this._validate(en,es)&&(this.images[en]=es)}_validate(en,ec){let ed=!0,ep=ec.data||ec.spriteData;return this._validateStretch(ec.stretchX,ep&&ep.width)||(this.fire(new es.k(Error(`Image "${en}" has invalid "stretchX" value`))),ed=!1),this._validateStretch(ec.stretchY,ep&&ep.height)||(this.fire(new es.k(Error(`Image "${en}" has invalid "stretchY" value`))),ed=!1),this._validateContent(ec.content,ec)||(this.fire(new es.k(Error(`Image "${en}" has invalid "content" value`))),ed=!1),ed}_validateStretch(en,es){if(!en)return!0;let ec=0;for(let ed of en){if(ed[0]<ec||ed[1]<ed[0]||es<ed[1])return!1;ec=ed[1]}return!0}_validateContent(en,es){if(!en)return!0;if(4!==en.length)return!1;let ec=es.spriteData,ed=ec&&ec.width||es.data.width,ep=ec&&ec.height||es.data.height;return!(en[0]<0||ed<en[0]||en[1]<0||ep<en[1]||en[2]<0||ed<en[2]||en[3]<0||ep<en[3]||en[2]<en[0]||en[3]<en[1])}updateImage(en,es,ec=!0){let ed=this.getImage(en);if(ec&&(ed.data.width!==es.data.width||ed.data.height!==es.data.height))throw Error(`size mismatch between old image (${ed.data.width}x${ed.data.height}) and new image (${es.data.width}x${es.data.height}).`);es.version=ed.version+1,this.images[en]=es,this.updatedImages[en]=!0}removeImage(en){let es=this.images[en];delete this.images[en],delete this.patterns[en],es.userImage&&es.userImage.onRemove&&es.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(en){return new Promise((es,ec)=>{let ed=!0;if(!this.isLoaded())for(let es of en)this.images[es]||(ed=!1);this.isLoaded()||ed?es(this._getImagesForIds(en)):this.requestors.push({ids:en,promiseResolve:es})})}_getImagesForIds(en){let ec={};for(let ed of en){let en=this.getImage(ed);en||(this.fire(new es.l("styleimagemissing",{id:ed})),en=this.getImage(ed)),en?ec[ed]={data:en.data.clone(),pixelRatio:en.pixelRatio,sdf:en.sdf,version:en.version,stretchX:en.stretchX,stretchY:en.stretchY,content:en.content,textFitWidth:en.textFitWidth,textFitHeight:en.textFitHeight,hasRenderCallback:!!(en.userImage&&en.userImage.render)}:es.w(`Image "${ed}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return ec}getPixelSize(){let{width:en,height:es}=this.atlasImage;return{width:en,height:es}}getPattern(en){let ec=this.patterns[en],ed=this.getImage(en);if(!ed)return null;if(ec&&ec.position.version===ed.version)return ec.position;if(ec)ec.position.version=ed.version;else{let ec={w:ed.data.width+2,h:ed.data.height+2,x:0,y:0},ep=new es.I(ec,ed);this.patterns[en]={bin:ec,position:ep}}return this._updatePatternAtlas(),this.patterns[en].position}bind(en){let ec=en.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new es.T(en,this.atlasImage,ec.RGBA),this.atlasTexture.bind(ec.LINEAR,ec.CLAMP_TO_EDGE)}_updatePatternAtlas(){let en=[];for(let es in this.patterns)en.push(this.patterns[es].bin);let{w:ec,h:ed}=es.p(en),ep=this.atlasImage;for(let en in ep.resize({width:ec||1,height:ed||1}),this.patterns){let{bin:ec}=this.patterns[en],ed=ec.x+1,ef=ec.y+1,em=this.getImage(en).data,e_=em.width,eg=em.height;es.R.copy(em,ep,{x:0,y:0},{x:ed,y:ef},{width:e_,height:eg}),es.R.copy(em,ep,{x:0,y:eg-1},{x:ed,y:ef-1},{width:e_,height:1}),es.R.copy(em,ep,{x:0,y:0},{x:ed,y:ef+eg},{width:e_,height:1}),es.R.copy(em,ep,{x:e_-1,y:0},{x:ed-1,y:ef},{width:1,height:eg}),es.R.copy(em,ep,{x:0,y:0},{x:ed+e_,y:ef},{width:1,height:eg})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(en){for(let ec of en){if(this.callbackDispatchedThisFrame[ec])continue;this.callbackDispatchedThisFrame[ec]=!0;let en=this.getImage(ec);en||es.w(`Image with ID: "${ec}" was not found`),function(en){let{userImage:es}=en;return!!(es&&es.render&&es.render())&&(en.data.replace(new Uint8Array(es.data.buffer)),!0)}(en)&&this.updateImage(ec,en)}}};function y(en,es,ec,ed,ep,ef,em,e_,eg){for(let ey=es;ey<es+ed;ey++)w(en,ec*ef+ey,ef,ep,em,e_,eg);for(let ey=ec;ey<ec+ep;ey++)w(en,ey*ef+es,1,ed,em,e_,eg)}function w(en,es,ec,ed,ep,ef,em){ef[0]=0,em[0]=-1e20,em[1]=1e20,ep[0]=en[es];for(let e_=1,eg=0,ey=0;e_<ed;e_++){ep[e_]=en[es+e_*ec];let ed=e_*e_;do{let en=ef[eg];ey=(ep[e_]-ep[en]+ed-en*en)/(e_-en)/2}while(ey<=em[eg]&&--eg>-1);ef[++eg]=e_,em[eg]=ey,em[eg+1]=1e20}for(let e_=0,eg=0;e_<ed;e_++){for(;em[eg+1]<e_;)eg++;let ed=ef[eg],ey=e_-ed;en[es+e_*ec]=ep[ed]+ey*ey}}let T=class T{constructor(en,es,ec){this.requestManager=en,this.localIdeographFontFamily=es,this.entries={},this.lang=ec}setURL(en){this.url=en}getGlyphs(en){return es._(this,void 0,void 0,function*(){let es=[];for(let ec in en)for(let ed of en[ec])es.push(this._getAndCacheGlyphsPromise(ec,ed));let ec=yield Promise.all(es),ed={};for(let{stack:en,id:es,glyph:ep}of ec)ed[en]||(ed[en]={}),ed[en][es]=ep&&{id:ep.id,bitmap:ep.bitmap.clone(),metrics:ep.metrics};return ed})}_getAndCacheGlyphsPromise(en,ec){return es._(this,void 0,void 0,function*(){let es=this.entries[en];es||(es=this.entries[en]={glyphs:{},requests:{},ranges:{}});let ed=es.glyphs[ec];if(void 0!==ed)return{stack:en,id:ec,glyph:ed};if(ed=this._tinySDF(es,en,ec))return es.glyphs[ec]=ed,{stack:en,id:ec,glyph:ed};let ep=Math.floor(ec/256);if(256*ep>65535)throw Error("glyphs > 65535 not supported");if(es.ranges[ep])return{stack:en,id:ec,glyph:ed};if(!this.url)throw Error("glyphsUrl is not set");if(!es.requests[ep]){let ec=T.loadGlyphRange(en,ep,this.url,this.requestManager);es.requests[ep]=ec}let ef=yield es.requests[ep];for(let en in ef)this._doesCharSupportLocalGlyph(+en)||(es.glyphs[+en]=ef[+en]);return es.ranges[ep]=!0,{stack:en,id:ec,glyph:ef[ec]||null}})}_doesCharSupportLocalGlyph(en){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(en))||es.u["CJK Unified Ideographs"](en)||es.u["Hangul Syllables"](en)||es.u.Hiragana(en)||es.u.Katakana(en)||es.u["CJK Symbols and Punctuation"](en)||es.u["Halfwidth and Fullwidth Forms"](en))}_tinySDF(en,ec,ed){let ep=this.localIdeographFontFamily;if(!ep||!this._doesCharSupportLocalGlyph(ed))return;let ef=en.tinySDF;if(!ef){let es="400";/bold/i.test(ec)?es="900":/medium/i.test(ec)?es="500":/light/i.test(ec)&&(es="200"),ef=en.tinySDF=new T.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:ep,fontWeight:es})}let em=ef.draw(String.fromCharCode(ed));return{id:ed,bitmap:new es.q({width:em.width||60,height:em.height||60},em.data),metrics:{width:em.glyphWidth/2||24,height:em.glyphHeight/2||24,left:em.glyphLeft/2+.5||0,top:em.glyphTop/2-27.5||-8,advance:em.glyphAdvance/2||24,isDoubleResolution:!0}}}};T.loadGlyphRange=function(en,ec,ed,ep){return es._(this,void 0,void 0,function*(){let ef=256*ec,em=ef+255,e_=ep.transformRequest(ed.replace("{fontstack}",en).replace("{range}",`${ef}-${em}`),"Glyphs"),eg=yield es.n(e_,new AbortController);if(!eg||!eg.data)throw Error(`Could not load glyph range. range: ${ec}, ${ef}-${em}`);let ey={};for(let en of es.o(eg.data))ey[en.id]=en;return ey})},T.TinySDF=class{constructor({fontSize:en=24,buffer:es=3,radius:ec=8,cutoff:ed=.25,fontFamily:ep="sans-serif",fontWeight:ef="normal",fontStyle:em="normal",lang:e_=null}={}){this.buffer=es,this.cutoff=ed,this.radius=ec,this.lang=e_;let eg=this.size=en+4*es,ey=this._createCanvas(eg),ex=this.ctx=ey.getContext("2d",{willReadFrequently:!0});ex.font=`${em} ${ef} ${en}px ${ep}`,ex.textBaseline="alphabetic",ex.textAlign="left",ex.fillStyle="black",this.gridOuter=new Float64Array(eg*eg),this.gridInner=new Float64Array(eg*eg),this.f=new Float64Array(eg),this.z=new Float64Array(eg+1),this.v=new Uint16Array(eg)}_createCanvas(en){let es=document.createElement("canvas");return es.width=es.height=en,es}draw(en){let{width:es,actualBoundingBoxAscent:ec,actualBoundingBoxDescent:ed,actualBoundingBoxLeft:ep,actualBoundingBoxRight:ef}=this.ctx.measureText(en),em=Math.ceil(ec),e_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(ef-ep))),eg=Math.min(this.size-this.buffer,em+Math.ceil(ed)),ey=e_+2*this.buffer,ex=eg+2*this.buffer,ev=Math.max(ey*ex,0),eb=new Uint8ClampedArray(ev),ew={data:eb,width:ey,height:ex,glyphWidth:e_,glyphHeight:eg,glyphTop:em,glyphLeft:0,glyphAdvance:es};if(0===e_||0===eg)return ew;let{ctx:eT,buffer:eP,gridInner:eS,gridOuter:eM}=this;this.lang&&(eT.lang=this.lang),eT.clearRect(eP,eP,e_,eg),eT.fillText(en,eP,eP+em);let eC=eT.getImageData(eP,eP,e_,eg);eM.fill(1e20,0,ev),eS.fill(0,0,ev);for(let en=0;en<eg;en++)for(let es=0;es<e_;es++){let ec=eC.data[4*(en*e_+es)+3]/255;if(0===ec)continue;let ed=(en+eP)*ey+es+eP;if(1===ec)eM[ed]=0,eS[ed]=1e20;else{let en=.5-ec;eM[ed]=en>0?en*en:0,eS[ed]=en<0?en*en:0}}y(eM,0,0,ey,ex,ey,this.f,this.v,this.z),y(eS,eP,eP,e_,eg,ey,this.f,this.v,this.z);for(let en=0;en<ev;en++){let es=Math.sqrt(eM[en])-Math.sqrt(eS[en]);eb[en]=Math.round(255-255*(es/this.radius+this.cutoff))}return ew}};let P=class P{constructor(){this.specification=es.v.light.position}possiblyEvaluate(en,ec){return es.B(en.expression.evaluate(ec))}interpolate(en,ec,ed){return{x:es.C.number(en.x,ec.x,ed),y:es.C.number(en.y,ec.y,ed),z:es.C.number(en.z,ec.z,ed)}}};let I=class I extends es.E{constructor(en){super(),ep=ep||new es.r({anchor:new es.D(es.v.light.anchor),position:new P,color:new es.D(es.v.light.color),intensity:new es.D(es.v.light.intensity)}),this._transitionable=new es.t(ep,void 0),this.setLight(en),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(en,ec={}){if(!this._validate(es.x,en,ec))for(let es in en){let ec=en[es];es.endsWith("-transition")?this._transitionable.setTransition(es.slice(0,-11),ec):this._transitionable.setValue(es,ec)}}updateTransitions(en){this._transitioning=this._transitionable.transitioned(en,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(en){this.properties=this._transitioning.possiblyEvaluate(en)}_validate(en,ec,ed){return(!ed||!1!==ed.validate)&&es.y(this,en.call(es.z,{value:ec,style:{glyphs:!0,sprite:!0},styleSpec:es.v}))}};let eM=new es.r({"sky-color":new es.D(es.v.sky["sky-color"]),"horizon-color":new es.D(es.v.sky["horizon-color"]),"fog-color":new es.D(es.v.sky["fog-color"]),"fog-ground-blend":new es.D(es.v.sky["fog-ground-blend"]),"horizon-fog-blend":new es.D(es.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new es.D(es.v.sky["sky-horizon-blend"]),"atmosphere-blend":new es.D(es.v.sky["atmosphere-blend"])});let S=class S extends es.E{constructor(en){super(),this._transitionable=new es.t(eM,void 0),this.setSky(en),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new es.F(0))}setSky(en,ec={}){if(!this._validate(es.G,en,ec))for(let es in en||(en={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0}),en){let ec=en[es];es.endsWith("-transition")?this._transitionable.setTransition(es.slice(0,-11),ec):this._transitionable.setValue(es,ec)}}getSky(){return this._transitionable.serialize()}updateTransitions(en){this._transitioning=this._transitionable.transitioned(en,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(en){this.properties=this._transitioning.possiblyEvaluate(en)}_validate(en,ec,ed={}){return!1!==(null==ed?void 0:ed.validate)&&es.y(this,en.call(es.z,es.e({value:ec,style:{glyphs:!0,sprite:!0},styleSpec:es.v})))}calculateFogBlendOpacity(en){return en<60?0:en<70?(en-60)/10:1}};let E=class E{constructor(en,es){this.width=en,this.height=es,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(en,es){let ec=en.join(",")+String(es);return this.dashEntry[ec]||(this.dashEntry[ec]=this.addDash(en,es)),this.dashEntry[ec]}getDashRanges(en,es,ec){let ed=[],ep=en.length%2==1?-en[en.length-1]*ec:0,ef=en[0]*ec,em=!0;ed.push({left:ep,right:ef,isDash:em,zeroLength:0===en[0]});let e_=en[0];for(let es=1;es<en.length;es++){em=!em;let eg=en[es];ep=e_*ec,e_+=eg,ef=e_*ec,ed.push({left:ep,right:ef,isDash:em,zeroLength:0===eg})}return ed}addRoundDash(en,es,ec){let ed=es/2;for(let es=-ec;es<=ec;es++){let ep=this.width*(this.nextRow+ec+es),ef=0,em=en[0];for(let e_=0;e_<this.width;e_++){let eg;e_/em.right>1&&(em=en[++ef]);let ey=Math.abs(e_-em.left),ex=Math.abs(e_-em.right),ev=Math.min(ey,ex),eb=es/ec*(ed+1);if(em.isDash){let en=ed-Math.abs(eb);eg=Math.sqrt(ev*ev+en*en)}else eg=ed-Math.sqrt(ev*ev+eb*eb);this.data[ep+e_]=Math.max(0,Math.min(255,eg+128))}}}addRegularDash(en){for(let es=en.length-1;es>=0;--es){let ec=en[es],ed=en[es+1];ec.zeroLength?en.splice(es,1):ed&&ed.isDash===ec.isDash&&(ed.left=ec.left,en.splice(es,1))}let es=en[0],ec=en[en.length-1];es.isDash===ec.isDash&&(es.left=ec.left-this.width,ec.right=es.right+this.width);let ed=this.width*this.nextRow,ep=0,ef=en[0];for(let es=0;es<this.width;es++){es/ef.right>1&&(ef=en[++ep]);let ec=Math.abs(es-ef.left),em=Math.abs(es-ef.right),e_=Math.min(ec,em);this.data[ed+es]=Math.max(0,Math.min(255,(ef.isDash?e_:-e_)+128))}}addDash(en,ec){let ed=ec?7:0,ep=2*ed+1;if(this.nextRow+ep>this.height)return es.w("LineAtlas out of space"),null;let ef=0;for(let es=0;es<en.length;es++)ef+=en[es];if(0!==ef){let es=this.width/ef,ep=this.getDashRanges(en,this.width,es);ec?this.addRoundDash(ep,es,ed):this.addRegularDash(ep)}let em={y:this.nextRow+ed,height:2*ed,width:ef};return this.nextRow+=ep,this.dirty=!0,em}bind(en){let es=en.gl;this.texture?(es.bindTexture(es.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,es.texSubImage2D(es.TEXTURE_2D,0,0,0,this.width,this.height,es.ALPHA,es.UNSIGNED_BYTE,this.data))):(this.texture=es.createTexture(),es.bindTexture(es.TEXTURE_2D,this.texture),es.texParameteri(es.TEXTURE_2D,es.TEXTURE_WRAP_S,es.REPEAT),es.texParameteri(es.TEXTURE_2D,es.TEXTURE_WRAP_T,es.REPEAT),es.texParameteri(es.TEXTURE_2D,es.TEXTURE_MIN_FILTER,es.LINEAR),es.texParameteri(es.TEXTURE_2D,es.TEXTURE_MAG_FILTER,es.LINEAR),es.texImage2D(es.TEXTURE_2D,0,es.ALPHA,this.width,this.height,0,es.ALPHA,es.UNSIGNED_BYTE,this.data))}};let eC="maplibre_preloaded_worker_pool";let z=class z{constructor(){this.active={}}acquire(en){if(!this.workers)for(this.workers=[];this.workers.length<z.workerCount;)this.workers.push(new Worker(es.a.WORKER_URL));return this.active[en]=!0,this.workers.slice()}release(en){delete this.active[en],0===this.numActive()&&(this.workers.forEach(en=>{en.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[eC]}numActive(){return Object.keys(this.active).length}};let eI=Math.floor(ev.hardwareConcurrency/2);function k(){return ef||(ef=new z),ef}z.workerCount=es.H(globalThis)?Math.max(Math.min(eI,3),1):1;let F=class F{constructor(en,ec){this.workerPool=en,this.actors=[],this.currentActor=0,this.id=ec;let ed=this.workerPool.acquire(ec);for(let en=0;en<ed.length;en++){let ep=new es.J(ed[en],ec);ep.name=`Worker ${en}`,this.actors.push(ep)}if(!this.actors.length)throw Error("No actors found")}broadcast(en,es){let ec=[];for(let ed of this.actors)ec.push(ed.sendAsync({type:en,data:es}));return Promise.all(ec)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(en=!0){this.actors.forEach(en=>{en.remove()}),this.actors=[],en&&this.workerPool.release(this.id)}registerMessageHandler(en,es){for(let ec of this.actors)ec.registerMessageHandler(en,es)}};function B(){return em||(em=new F(k(),es.K)).registerMessageHandler("GR",(en,ec,ed)=>es.m(ec,ed)),em}function N(en,es){let ec=en.tileID,ed=es.tileID;return ec.overscaledZ-ed.overscaledZ||ec.canonical.y-ed.canonical.y||ec.wrap-ed.wrap||ec.canonical.x-ed.canonical.x}function U(en,es){let ec=en.feature,ed=es.getFeatureState(ec.layer["source-layer"],ec.id);ec.source=ec.layer.source,ec.layer["source-layer"]&&(ec.sourceLayer=ec.layer["source-layer"]),ec.state=ed}function Z(en,ec,ed){return es._(this,void 0,void 0,function*(){let ep=en;if(en.url?ep=(yield es.j(ec.transformRequest(en.url,"Source"),ed)).data:yield ev.frameAsync(ed),!ep)return null;let ef=es.Q(es.e(ep,en),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in ep&&ep.vector_layers&&(ef.vectorLayerIds=ep.vector_layers.map(en=>en.id)),ef})}let G=class G{constructor(en,es){en&&(es?this.setSouthWest(en).setNorthEast(es):Array.isArray(en)&&(4===en.length?this.setSouthWest([en[0],en[1]]).setNorthEast([en[2],en[3]]):this.setSouthWest(en[0]).setNorthEast(en[1])))}setNorthEast(en){return this._ne=en instanceof es.S?new es.S(en.lng,en.lat):es.S.convert(en),this}setSouthWest(en){return this._sw=en instanceof es.S?new es.S(en.lng,en.lat):es.S.convert(en),this}extend(en){let ec,ed;let ep=this._sw,ef=this._ne;if(en instanceof es.S)ec=en,ed=en;else{if(!(en instanceof G))return Array.isArray(en)?4===en.length||en.every(Array.isArray)?this.extend(G.convert(en)):this.extend(es.S.convert(en)):en&&("lng"in en||"lon"in en)&&"lat"in en?this.extend(es.S.convert(en)):this;if(ec=en._sw,ed=en._ne,!ec||!ed)return this}return ep||ef?(ep.lng=Math.min(ec.lng,ep.lng),ep.lat=Math.min(ec.lat,ep.lat),ef.lng=Math.max(ed.lng,ef.lng),ef.lat=Math.max(ed.lat,ef.lat)):(this._sw=new es.S(ec.lng,ec.lat),this._ne=new es.S(ed.lng,ed.lat)),this}getCenter(){return new es.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new es.S(this.getWest(),this.getNorth())}getSouthEast(){return new es.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(en){let{lng:ec,lat:ed}=es.S.convert(en),ep=this._sw.lng<=ec&&ec<=this._ne.lng;return this._sw.lng>this._ne.lng&&(ep=this._sw.lng>=ec&&ec>=this._ne.lng),this._sw.lat<=ed&&ed<=this._ne.lat&&ep}static convert(en){return en instanceof G?en:en?new G(en):en}static fromLngLat(en,ec=0){let ed=360*ec/40075017,ep=ed/Math.cos(Math.PI/180*en.lat);return new G(new es.S(en.lng-ep,en.lat-ed),new es.S(en.lng+ep,en.lat+ed))}adjustAntiMeridian(){let en=new es.S(this._sw.lng,this._sw.lat),ec=new es.S(this._ne.lng,this._ne.lat);return new G(en,en.lng>ec.lng?new es.S(ec.lng+360,ec.lat):ec)}};let V=class V{constructor(en,es,ec){this.bounds=G.convert(this.validateBounds(en)),this.minzoom=es||0,this.maxzoom=ec||24}validateBounds(en){return Array.isArray(en)&&4===en.length?[Math.max(-180,en[0]),Math.max(-90,en[1]),Math.min(180,en[2]),Math.min(90,en[3])]:[-180,-90,180,90]}contains(en){let ec=Math.pow(2,en.z),ed=Math.floor(es.V(this.bounds.getWest())*ec),ep=Math.floor(es.U(this.bounds.getNorth())*ec),ef=Math.ceil(es.V(this.bounds.getEast())*ec),em=Math.ceil(es.U(this.bounds.getSouth())*ec);return en.x>=ed&&en.x<ef&&en.y>=ep&&en.y<em}};let $=class $ extends es.E{constructor(en,ec,ed,ep){if(super(),this.id=en,this.dispatcher=ed,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,es.e(this,es.Q(ec,["url","scheme","tileSize","promoteId"])),this._options=es.e({type:"vector"},ec),this._collectResourceTiming=ec.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ep)}load(){return es._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new es.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let en=yield Z(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),en&&(es.e(this,en),en.bounds&&(this.tileBounds=new V(en.bounds,this.minzoom,this.maxzoom)),this.fire(new es.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new es.l("data",{dataType:"source",sourceDataType:"content"})))}catch(en){this._tileJSONRequest=null,this._loaded=!0,this.fire(new es.k(en))}})}loaded(){return this._loaded}hasTile(en){return!this.tileBounds||this.tileBounds.contains(en.canonical)}onAdd(en){this.map=en,this.load()}setSourceProperty(en){this._tileJSONRequest&&this._tileJSONRequest.abort(),en(),this.load()}setTiles(en){return this.setSourceProperty(()=>{this._options.tiles=en}),this}setUrl(en){return this.setSourceProperty(()=>{this.url=en,this._options.url=en}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return es.e({},this._options)}loadTile(en){return es._(this,void 0,void 0,function*(){let es=en.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ec={request:this.map._requestManager.transformRequest(es,"Tile"),uid:en.uid,tileID:en.tileID,zoom:en.tileID.overscaledZ,tileSize:this.tileSize*en.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};ec.request.collectResourceTiming=this._collectResourceTiming;let ed="RT";if(en.actor&&"expired"!==en.state){if("loading"===en.state)return new Promise((es,ec)=>{en.reloadPromise={resolve:es,reject:ec}})}else en.actor=this.dispatcher.getActor(),ed="LT";en.abortController=new AbortController;try{let es=yield en.actor.sendAsync({type:ed,data:ec},en.abortController);if(delete en.abortController,en.aborted)return;this._afterTileLoadWorkerResponse(en,es)}catch(es){if(delete en.abortController,en.aborted)return;if(es&&404!==es.status)throw es;this._afterTileLoadWorkerResponse(en,null)}})}_afterTileLoadWorkerResponse(en,es){if(es&&es.resourceTiming&&(en.resourceTiming=es.resourceTiming),es&&this.map._refreshExpiredTiles&&en.setExpiryData(es),en.loadVectorData(es,this.map.painter),en.reloadPromise){let es=en.reloadPromise;en.reloadPromise=null,this.loadTile(en).then(es.resolve).catch(es.reject)}}abortTile(en){return es._(this,void 0,void 0,function*(){en.abortController&&(en.abortController.abort(),delete en.abortController),en.actor&&(yield en.actor.sendAsync({type:"AT",data:{uid:en.uid,type:this.type,source:this.id}}))})}unloadTile(en){return es._(this,void 0,void 0,function*(){en.unloadVectorData(),en.actor&&(yield en.actor.sendAsync({type:"RMT",data:{uid:en.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}};let q=class q extends es.E{constructor(en,ec,ed,ep){super(),this.id=en,this.dispatcher=ed,this.setEventedParent(ep),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=es.e({type:"raster"},ec),es.e(this,es.Q(ec,["url","scheme","tileSize"]))}load(){return es._(this,arguments,void 0,function*(en=!1){this._loaded=!1,this.fire(new es.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let ec=yield Z(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,ec&&(es.e(this,ec),ec.bounds&&(this.tileBounds=new V(ec.bounds,this.minzoom,this.maxzoom)),this.fire(new es.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new es.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:en})))}catch(en){this._tileJSONRequest=null,this._loaded=!0,this.fire(new es.k(en))}})}loaded(){return this._loaded}onAdd(en){this.map=en,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(en){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),en(),this.load(!0)}setTiles(en){return this.setSourceProperty(()=>{this._options.tiles=en}),this}setUrl(en){return this.setSourceProperty(()=>{this.url=en,this._options.url=en}),this}serialize(){return es.e({},this._options)}hasTile(en){return!this.tileBounds||this.tileBounds.contains(en.canonical)}loadTile(en){return es._(this,void 0,void 0,function*(){let ec=en.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);en.abortController=new AbortController;try{let ed=yield ey.getImage(this.map._requestManager.transformRequest(ec,"Tile"),en.abortController,this.map._refreshExpiredTiles);if(delete en.abortController,en.aborted)return void(en.state="unloaded");if(ed&&ed.data){this.map._refreshExpiredTiles&&(ed.cacheControl||ed.expires)&&en.setExpiryData({cacheControl:ed.cacheControl,expires:ed.expires});let ec=this.map.painter.context,ep=ec.gl,ef=ed.data;en.texture=this.map.painter.getTileTexture(ef.width),en.texture?en.texture.update(ef,{useMipmap:!0}):(en.texture=new es.T(ec,ef,ep.RGBA,{useMipmap:!0}),en.texture.bind(ep.LINEAR,ep.CLAMP_TO_EDGE,ep.LINEAR_MIPMAP_NEAREST)),en.state="loaded"}}catch(es){if(delete en.abortController,en.aborted)en.state="unloaded";else if(es)throw en.state="errored",es}})}abortTile(en){return es._(this,void 0,void 0,function*(){en.abortController&&(en.abortController.abort(),delete en.abortController)})}unloadTile(en){return es._(this,void 0,void 0,function*(){en.texture&&this.map.painter.saveTileTexture(en.texture)})}hasTransition(){return!1}};let W=class W extends q{constructor(en,ec,ed,ep){super(en,ec,ed,ep),this.type="raster-dem",this.maxzoom=22,this._options=es.e({type:"raster-dem"},ec),this.encoding=ec.encoding||"mapbox",this.redFactor=ec.redFactor,this.greenFactor=ec.greenFactor,this.blueFactor=ec.blueFactor,this.baseShift=ec.baseShift}loadTile(en){return es._(this,void 0,void 0,function*(){let ec=en.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ed=this.map._requestManager.transformRequest(ec,"Tile");en.neighboringTiles=this._getNeighboringTiles(en.tileID),en.abortController=new AbortController;try{let ec=yield ey.getImage(ed,en.abortController,this.map._refreshExpiredTiles);if(delete en.abortController,en.aborted)return void(en.state="unloaded");if(ec&&ec.data){let ed=ec.data;this.map._refreshExpiredTiles&&(ec.cacheControl||ec.expires)&&en.setExpiryData({cacheControl:ec.cacheControl,expires:ec.expires});let ep=es.b(ed)&&es.W()?ed:yield this.readImageNow(ed),ef={type:this.type,uid:en.uid,source:this.id,rawImageData:ep,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!en.actor||"expired"===en.state){en.actor=this.dispatcher.getActor();let es=yield en.actor.sendAsync({type:"LDT",data:ef});en.dem=es,en.needsHillshadePrepare=!0,en.needsTerrainPrepare=!0,en.state="loaded"}}}catch(es){if(delete en.abortController,en.aborted)en.state="unloaded";else if(es)throw en.state="errored",es}})}readImageNow(en){return es._(this,void 0,void 0,function*(){if("undefined"!=typeof VideoFrame&&es.X()){let ec=en.width+2,ed=en.height+2;try{return new es.R({width:ec,height:ed},(yield es.Y(en,-1,-1,ec,ed)))}catch(en){}}return ev.getImageData(en,1)})}_getNeighboringTiles(en){let ec=en.canonical,ed=Math.pow(2,ec.z),ep=(ec.x-1+ed)%ed,ef=0===ec.x?en.wrap-1:en.wrap,em=(ec.x+1+ed)%ed,e_=ec.x+1===ed?en.wrap+1:en.wrap,eg={};return eg[new es.Z(en.overscaledZ,ef,ec.z,ep,ec.y).key]={backfilled:!1},eg[new es.Z(en.overscaledZ,e_,ec.z,em,ec.y).key]={backfilled:!1},ec.y>0&&(eg[new es.Z(en.overscaledZ,ef,ec.z,ep,ec.y-1).key]={backfilled:!1},eg[new es.Z(en.overscaledZ,en.wrap,ec.z,ec.x,ec.y-1).key]={backfilled:!1},eg[new es.Z(en.overscaledZ,e_,ec.z,em,ec.y-1).key]={backfilled:!1}),ec.y+1<ed&&(eg[new es.Z(en.overscaledZ,ef,ec.z,ep,ec.y+1).key]={backfilled:!1},eg[new es.Z(en.overscaledZ,en.wrap,ec.z,ec.x,ec.y+1).key]={backfilled:!1},eg[new es.Z(en.overscaledZ,e_,ec.z,em,ec.y+1).key]={backfilled:!1}),eg}unloadTile(en){return es._(this,void 0,void 0,function*(){en.demTexture&&this.map.painter.saveTileTexture(en.demTexture),en.fbo&&(en.fbo.destroy(),delete en.fbo),en.dem&&delete en.dem,delete en.neighboringTiles,en.state="unloaded",en.actor&&(yield en.actor.sendAsync({type:"RDT",data:{type:this.type,uid:en.uid,source:this.id}}))})}};let H=class H extends es.E{constructor(en,ec,ed,ep){super(),this.id=en,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:ec.data},this.actor=ed.getActor(),this.setEventedParent(ep),this._data=ec.data,this._options=es.e({},ec),this._collectResourceTiming=ec.collectResourceTiming,void 0!==ec.maxzoom&&(this.maxzoom=ec.maxzoom),ec.type&&(this.type=ec.type),ec.attribution&&(this.attribution=ec.attribution),this.promoteId=ec.promoteId,void 0!==ec.clusterMaxZoom&&this.maxzoom<=ec.clusterMaxZoom&&es.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${ec.clusterMaxZoom}".`),this.workerOptions=es.e({source:this.id,cluster:ec.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==ec.buffer?ec.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==ec.tolerance?ec.tolerance:.375),extent:es.$,maxZoom:this.maxzoom,lineMetrics:ec.lineMetrics||!1,generateId:ec.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(ec.clusterMaxZoom),minPoints:Math.max(2,ec.clusterMinPoints||2),extent:es.$,radius:this._pixelsToTileUnits(ec.clusterRadius||50),log:!1,generateId:ec.generateId||!1},clusterProperties:ec.clusterProperties,filter:ec.filter},ec.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(en){return en*(es.$/this.tileSize)}_getClusterMaxZoom(en){let ec=en?Math.round(en):this.maxzoom-1;return Number.isInteger(en)||void 0===en||es.w(`Integer expected for option 'clusterMaxZoom': provided value "${en}" rounded to "${ec}"`),ec}load(){return es._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(en){this.map=en,this.load()}setData(en){return this._data=en,this._pendingWorkerUpdate={data:en},this._updateWorkerData(),this}updateData(en){return this._pendingWorkerUpdate.diff=es.a0(this._pendingWorkerUpdate.diff,en),this._updateWorkerData(),this}getData(){return es._(this,void 0,void 0,function*(){let en=es.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:en})})}getCoordinatesFromGeometry(en){return"GeometryCollection"===en.type?en.geometries.map(en=>en.coordinates).flat(1/0):en.coordinates.flat(1/0)}getBounds(){return es._(this,void 0,void 0,function*(){let en;let es=new G,ec=yield this.getData();switch(ec.type){case"FeatureCollection":en=ec.features.map(en=>this.getCoordinatesFromGeometry(en.geometry)).flat(1/0);break;case"Feature":en=this.getCoordinatesFromGeometry(ec.geometry);break;default:en=this.getCoordinatesFromGeometry(ec)}if(0==en.length)return es;for(let ec=0;ec<en.length-1;ec+=2)es.extend([en[ec],en[ec+1]]);return es})}setClusterOptions(en){return this.workerOptions.cluster=en.cluster,en&&(void 0!==en.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(en.clusterRadius)),void 0!==en.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(en.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(en){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:en,source:this.id}})}getClusterChildren(en){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:en,source:this.id}})}getClusterLeaves(en,es,ec){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:en,limit:es,offset:ec}})}_updateWorkerData(){return es._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;let{data:en,diff:ec}=this._pendingWorkerUpdate;if(!en&&!ec)return void es.w(`No data or diff provided to GeoJSONSource ${this.id}.`);let ed=es.e({type:this.type},this.workerOptions);en?("string"==typeof en?(ed.request=this.map._requestManager.transformRequest(ev.resolveURL(en),"Source"),ed.request.collectResourceTiming=this._collectResourceTiming):ed.data=JSON.stringify(en),this._pendingWorkerUpdate.data=void 0):ec&&(ed.dataDiff=ec,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new es.l("dataloading",{dataType:"source"}));try{let en=yield this.actor.sendAsync({type:"LD",data:ed});if(this._isUpdatingWorker=!1,this._removed||en.abandoned)return void this.fire(new es.l("dataabort",{dataType:"source"}));this._data=en.data;let ec=null;en.resourceTiming&&en.resourceTiming[this.id]&&(ec=en.resourceTiming[this.id].slice(0));let ep={dataType:"source"};this._collectResourceTiming&&ec&&ec.length>0&&es.e(ep,{resourceTiming:ec}),this.fire(new es.l("data",Object.assign(Object.assign({},ep),{sourceDataType:"metadata"}))),this.fire(new es.l("data",Object.assign(Object.assign({},ep),{sourceDataType:"content"})))}catch(en){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new es.l("dataabort",{dataType:"source"}));this.fire(new es.k(en))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&void 0===this._pendingWorkerUpdate.data&&void 0===this._pendingWorkerUpdate.diff}loadTile(en){return es._(this,void 0,void 0,function*(){let es=en.actor?"RT":"LT";en.actor=this.actor;let ec={type:this.type,uid:en.uid,tileID:en.tileID,zoom:en.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};en.abortController=new AbortController;let ed=yield this.actor.sendAsync({type:es,data:ec},en.abortController);delete en.abortController,en.unloadVectorData(),en.aborted||en.loadVectorData(ed,this.map.painter,"RT"===es)})}abortTile(en){return es._(this,void 0,void 0,function*(){en.abortController&&(en.abortController.abort(),delete en.abortController),en.aborted=!0})}unloadTile(en){return es._(this,void 0,void 0,function*(){en.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:en.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return es.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}};let X=class X extends es.E{constructor(en,es,ec,ed){super(),this.flippedWindingOrder=!1,this.id=en,this.dispatcher=ec,this.coordinates=es.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(ed),this.options=es}load(en){return es._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new es.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let es=yield ey.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,es&&es.data&&(this.image=es.data,en&&(this.coordinates=en),this._finishLoading())}catch(en){this._request=null,this._loaded=!0,this.fire(new es.k(en))}})}loaded(){return this._loaded}updateImage(en){return en.url&&(this._request&&(this._request.abort(),this._request=null),this.options.url=en.url,this.load(en.coordinates).finally(()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new es.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(en){this.map=en,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(en){var ec;this.coordinates=en;let ed=en.map(es.a1.fromLngLat);return this.tileID=function(en){let ec=es.a2.fromPoints(en),ed=ec.width(),ep=ec.height(),ef=Math.max(0,Math.floor(-Math.log(Math.max(ed,ep))/Math.LN2)),em=Math.pow(2,ef);return new es.a4(ef,Math.floor((ec.minX+ec.maxX)/2*em),Math.floor((ec.minY+ec.maxY)/2*em))}(ed),this.terrainTileRanges=this._getOverlappingTileRanges(ed),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=ed.map(en=>this.tileID.getTilePoint(en)._round()),this.flippedWindingOrder=((ec=this.tileCoords)[1].x-ec[0].x)*(ec[2].y-ec[0].y)-(ec[1].y-ec[0].y)*(ec[2].x-ec[0].x)<0,this.fire(new es.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;let en=this.map.painter.context,ec=en.gl;this.texture||(this.texture=new es.T(en,this.image,ec.RGBA),this.texture.bind(ec.LINEAR,ec.CLAMP_TO_EDGE));let ed=!1;for(let en in this.tiles){let es=this.tiles[en];"loaded"!==es.state&&(es.state="loaded",es.texture=this.texture,ed=!0)}ed&&this.fire(new es.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(en){return es._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(en.tileID.canonical)?(this.tiles[String(en.tileID.wrap)]=en,en.buckets={}):en.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(en){let{minX:ec,minY:ed,maxX:ep,maxY:ef}=es.a2.fromPoints(en),em={};for(let en=0;en<=es.a3;en++){let es=Math.pow(2,en),e_=Math.floor(ec*es),eg=Math.floor(ed*es),ey=Math.floor(ep*es),ex=Math.floor(ef*es);em[en]={minTileX:e_,minTileY:eg,maxTileX:ey,maxTileY:ex}}return em}};let K=class K extends X{constructor(en,es,ec,ed){super(en,es,ec,ed),this.roundZoom=!0,this.type="video",this.options=es}load(){return es._(this,void 0,void 0,function*(){this._loaded=!1;let en=this.options;for(let es of(this.urls=[],en.urls))this.urls.push(this.map._requestManager.transformRequest(es,"Source").url);try{let en=yield es.a5(this.urls);if(this._loaded=!0,!en)return;this.video=en,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(en){this.fire(new es.k(en))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(en){if(this.video){let ec=this.video.seekable;en<ec.start(0)||en>ec.end(0)?this.fire(new es.k(new es.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${ec.start(0)} and ${ec.end(0)}-second mark.`))):this.video.currentTime=en}}getVideo(){return this.video}onAdd(en){this.map||(this.map=en,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let en=this.map.painter.context,ec=en.gl;this.texture?this.video.paused||(this.texture.bind(ec.LINEAR,ec.CLAMP_TO_EDGE),ec.texSubImage2D(ec.TEXTURE_2D,0,0,0,ec.RGBA,ec.UNSIGNED_BYTE,this.video)):(this.texture=new es.T(en,this.video,ec.RGBA),this.texture.bind(ec.LINEAR,ec.CLAMP_TO_EDGE));let ed=!1;for(let en in this.tiles){let es=this.tiles[en];"loaded"!==es.state&&(es.state="loaded",es.texture=this.texture,ed=!0)}ed&&this.fire(new es.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}};let Y=class Y extends X{constructor(en,ec,ed,ep){super(en,ec,ed,ep),ec.coordinates?Array.isArray(ec.coordinates)&&4===ec.coordinates.length&&!ec.coordinates.some(en=>!Array.isArray(en)||2!==en.length||en.some(en=>"number"!=typeof en))||this.fire(new es.k(new es.a6(`sources.${en}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new es.k(new es.a6(`sources.${en}`,null,'missing required property "coordinates"'))),ec.animate&&"boolean"!=typeof ec.animate&&this.fire(new es.k(new es.a6(`sources.${en}`,null,'optional "animate" property must be a boolean value'))),ec.canvas?"string"==typeof ec.canvas||ec.canvas instanceof HTMLCanvasElement||this.fire(new es.k(new es.a6(`sources.${en}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new es.k(new es.a6(`sources.${en}`,null,'missing required property "canvas"'))),this.options=ec,this.animate=void 0===ec.animate||ec.animate}load(){return es._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new es.k(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(en){this.map=en,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let en=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,en=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,en=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let ec=this.map.painter.context,ed=ec.gl;this.texture?(en||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new es.T(ec,this.canvas,ed.RGBA,{premultiply:!0});let ep=!1;for(let en in this.tiles){let es=this.tiles[en];"loaded"!==es.state&&(es.state="loaded",es.texture=this.texture,ep=!0)}ep&&this.fire(new es.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let en of[this.canvas.width,this.canvas.height])if(isNaN(en)||en<=0)return!0;return!1}};let eE={},J=en=>{switch(en){case"geojson":return H;case"image":return X;case"raster":return q;case"raster-dem":return W;case"vector":return $;case"video":return K;case"canvas":return Y}return eE[en]},eA="RTLPluginLoaded";let te=class te extends es.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=B()}_syncState(en){return this.status=en,this.dispatcher.broadcast("SRPS",{pluginStatus:en,pluginURL:this.url}).catch(en=>{throw this.status="error",en})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(en){return es._(this,arguments,void 0,function*(en,es=!1){if(this.url)throw Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ev.resolveURL(en),!this.url)throw Error(`requested url ${en} is invalid`);if("unavailable"===this.status){if(!es)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()})}_requestImport(){return es._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new es.l(eA))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}};let ez=null;function oe(){return ez||(ez=new te),ez}let re=class re{constructor(en,ec){this.timeAdded=0,this.fadeEndTime=0,this.tileID=en,this.uid=es.a7(),this.uses=0,this.tileSize=ec,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(en){let es=en+this.timeAdded;es<this.fadeEndTime||(this.fadeEndTime=es)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(en){this.demTexture&&en.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(en,ec,ed){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",en){for(let ep in en.featureIndex&&(this.latestFeatureIndex=en.featureIndex,en.rawTileData?(this.latestRawTileData=en.rawTileData,this.latestFeatureIndex.rawTileData=en.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=en.collisionBoxArray,this.buckets=function(en,es){let ec={};if(!es)return ec;for(let ed of en){let en=ed.layerIds.map(en=>es.getLayer(en)).filter(Boolean);if(0!==en.length)for(let es of(ed.layers=en,ed.stateDependentLayerIds&&(ed.stateDependentLayers=ed.stateDependentLayerIds.map(es=>en.filter(en=>en.id===es)[0])),en))ec[es.id]=ed}return ec}(en.buckets,null==ec?void 0:ec.style),this.hasSymbolBuckets=!1,this.buckets){let en=this.buckets[ep];if(en instanceof es.a9){if(this.hasSymbolBuckets=!0,!ed)break;en.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let en in this.buckets){let ec=this.buckets[en];if(ec instanceof es.a9&&ec.hasRTLText){this.hasRTLText=!0,oe().lazyLoad();break}}for(let en in this.queryPadding=0,this.buckets){let es=this.buckets[en];this.queryPadding=Math.max(this.queryPadding,ec.style.getLayer(en).queryRadius(es))}en.imageAtlas&&(this.imageAtlas=en.imageAtlas),en.glyphAtlasImage&&(this.glyphAtlasImage=en.glyphAtlasImage),this.dashPositions=en.dashPositions}else this.collisionBoxArray=new es.a8}unloadVectorData(){for(let en in this.buckets)this.buckets[en].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(en){return this.buckets[en.id]}upload(en){for(let es in this.buckets){let ec=this.buckets[es];ec.uploadPending()&&ec.upload(en)}let ec=en.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new es.T(en,this.imageAtlas.image,ec.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new es.T(en,this.glyphAtlasImage,ec.ALPHA),this.glyphAtlasImage=null)}prepare(en){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(en,this.imageAtlasTexture)}queryRenderedFeatures(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:ed,cameraQueryGeometry:ep,scale:ef,tileSize:this.tileSize,pixelPosMatrix:ey,transform:e_,params:em,queryPadding:this.queryPadding*eg,getElevation:ex},en,es,ec):{}}querySourceFeatures(en,ec){let ed=this.latestFeatureIndex;if(!ed||!ed.rawTileData)return;let ep=ed.loadVTLayers(),ef=ec&&ec.sourceLayer?ec.sourceLayer:"",em=ep._geojsonTileLayer||ep[ef];if(!em)return;let e_=es.aa(null==ec?void 0:ec.filter,null==ec?void 0:ec.globalState),{z:eg,x:ey,y:ex}=this.tileID.canonical,ev={z:eg,x:ey,y:ex};for(let ec=0;ec<em.length;ec++){let ep=em.feature(ec);if(e_.needGeometry){let en=es.ab(ep,!0);if(!e_.filter(new es.F(this.tileID.overscaledZ),en,this.tileID.canonical))continue}else if(!e_.filter(new es.F(this.tileID.overscaledZ),ep))continue;let eb=ed.getId(ep,ef),ew=new es.ac(ep,eg,ey,ex,eb);ew.tile=ev,en.push(ew)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(en){let ec=this.expirationTime;if(en.cacheControl){let ec=es.ad(en.cacheControl);ec["max-age"]&&(this.expirationTime=Date.now()+1e3*ec["max-age"])}else en.expires&&(this.expirationTime=new Date(en.expires).getTime());if(this.expirationTime){let en=Date.now(),es=!1;if(this.expirationTime>en)es=!1;else if(ec){if(this.expirationTime<ec)es=!0;else{let ed=this.expirationTime-ec;ed?this.expirationTime=en+Math.max(ed,3e4):es=!0}}else es=!0;es?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),2147483647)}setFeatureState(en,es){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(en).length)return;let ec=this.latestFeatureIndex.loadVTLayers();for(let ed in this.buckets){if(!es.style.hasLayer(ed))continue;let ep=this.buckets[ed],ef=ep.layers[0].sourceLayer||"_geojsonTileLayer",em=ec[ef],e_=en[ef];if(!em||!e_||0===Object.keys(e_).length)continue;ep.update(e_,em,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});let eg=es&&es.style&&es.style.getLayer(ed);eg&&(this.queryPadding=Math.max(this.queryPadding,eg.queryRadius(ep)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ev.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(en){this.symbolFadeHoldUntil=ev.now()+en}setDependencies(en,es){let ec={};for(let en of es)ec[en]=!0;this.dependencies[en]=ec}hasDependency(en,es){for(let ec of en){let en=this.dependencies[ec];if(en){for(let ec of es)if(en[ec])return!0}}return!1}};let ae=class ae{constructor(en,es){this.max=en,this.onRemove=es,this.reset()}reset(){for(let en in this.data)for(let es of this.data[en])es.timeout&&clearTimeout(es.timeout),this.onRemove(es.value);return this.data={},this.order=[],this}add(en,es,ec){let ed=en.wrapped().key;void 0===this.data[ed]&&(this.data[ed]=[]);let ep={value:es,timeout:void 0};if(void 0!==ec&&(ep.timeout=setTimeout(()=>{this.remove(en,ep)},ec)),this.data[ed].push(ep),this.order.push(ed),this.order.length>this.max){let en=this._getAndRemoveByKey(this.order[0]);en&&this.onRemove(en)}return this}has(en){return en.wrapped().key in this.data}getAndRemove(en){return this.has(en)?this._getAndRemoveByKey(en.wrapped().key):null}_getAndRemoveByKey(en){let es=this.data[en].shift();return es.timeout&&clearTimeout(es.timeout),0===this.data[en].length&&delete this.data[en],this.order.splice(this.order.indexOf(en),1),es.value}getByKey(en){let es=this.data[en];return es?es[0].value:null}get(en){return this.has(en)?this.data[en.wrapped().key][0].value:null}remove(en,es){if(!this.has(en))return this;let ec=en.wrapped().key,ed=void 0===es?0:this.data[ec].indexOf(es),ep=this.data[ec][ed];return this.data[ec].splice(ed,1),ep.timeout&&clearTimeout(ep.timeout),0===this.data[ec].length&&delete this.data[ec],this.onRemove(ep.value),this.order.splice(this.order.indexOf(ec),1),this}setMaxSize(en){for(this.max=en;this.order.length>this.max;){let en=this._getAndRemoveByKey(this.order[0]);en&&this.onRemove(en)}return this}filter(en){let es=[];for(let ec in this.data)for(let ed of this.data[ec])en(ed.value)||es.push(ed);for(let en of es)this.remove(en.value.tileID,en)}};let se=class se{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(en,ec,ed){let ep=String(ec);if(this.stateChanges[en]=this.stateChanges[en]||{},this.stateChanges[en][ep]=this.stateChanges[en][ep]||{},es.e(this.stateChanges[en][ep],ed),null===this.deletedStates[en])for(let es in this.deletedStates[en]={},this.state[en])es!==ep&&(this.deletedStates[en][es]=null);else if(this.deletedStates[en]&&null===this.deletedStates[en][ep])for(let es in this.deletedStates[en][ep]={},this.state[en][ep])ed[es]||(this.deletedStates[en][ep][es]=null);else for(let es in ed)this.deletedStates[en]&&this.deletedStates[en][ep]&&null===this.deletedStates[en][ep][es]&&delete this.deletedStates[en][ep][es]}removeFeatureState(en,es,ec){if(null===this.deletedStates[en])return;let ed=String(es);if(this.deletedStates[en]=this.deletedStates[en]||{},ec&&void 0!==es)null!==this.deletedStates[en][ed]&&(this.deletedStates[en][ed]=this.deletedStates[en][ed]||{},this.deletedStates[en][ed][ec]=null);else if(void 0!==es){if(this.stateChanges[en]&&this.stateChanges[en][ed])for(ec in this.deletedStates[en][ed]={},this.stateChanges[en][ed])this.deletedStates[en][ed][ec]=null;else this.deletedStates[en][ed]=null}else this.deletedStates[en]=null}getState(en,ec){let ed=String(ec),ep=es.e({},(this.state[en]||{})[ed],(this.stateChanges[en]||{})[ed]);if(null===this.deletedStates[en])return{};if(this.deletedStates[en]){let es=this.deletedStates[en][ec];if(null===es)return{};for(let en in es)delete ep[en]}return ep}initializeTileState(en,es){en.setFeatureState(this.state,es)}coalesceChanges(en,ec){let ed={};for(let en in this.stateChanges){this.state[en]=this.state[en]||{};let ec={};for(let ed in this.stateChanges[en])this.state[en][ed]||(this.state[en][ed]={}),es.e(this.state[en][ed],this.stateChanges[en][ed]),ec[ed]=this.state[en][ed];ed[en]=ec}for(let en in this.deletedStates){this.state[en]=this.state[en]||{};let ec={};if(null===this.deletedStates[en])for(let es in this.state[en])ec[es]={},this.state[en][es]={};else for(let es in this.deletedStates[en]){if(null===this.deletedStates[en][es])this.state[en][es]={};else for(let ec of Object.keys(this.deletedStates[en][es]))delete this.state[en][es][ec];ec[es]=this.state[en][es]}ed[en]=ed[en]||{},es.e(ed[en],ec)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(ed).length)for(let es in en)en[es].setFeatureState(ed,ec)}};function le(en,ec){let ed=es.ah(ec.lat,-es.ai,es.ai);return new es.P(es.V(ec.lng)*en,es.U(ed)*en)}function ce(en,ec){return new es.a1(ec.x/en,ec.y/en).toLngLat()}function he(en){return en.cameraToCenterDistance*Math.min(.85*Math.tan(es.ae(90-en.pitch)),Math.tan(es.ae(89.25-en.pitch)))}function ue(en,ec){let ed=en.canonical,ep=ec/es.af(ed.z),ef=ed.x+Math.pow(2,ed.z)*en.wrap,em=es.ag(new Float64Array(16));return es.M(em,em,[ef*ep,ed.y*ep,0]),es.N(em,em,[ep/es.$,ep/es.$,1]),em}function de(en,ec,ed,ep,ef){let em=es.a1.fromLngLat(en,ec),e_=ef*es.aj(1,en.lat),eg=e_*Math.cos(es.ae(ed)),ey=Math.sqrt(e_*e_-eg*eg),ex=ey*Math.sin(es.ae(-ep)),ev=ey*Math.cos(es.ae(-ep));return new es.a1(em.x+ex,em.y+ev,em.z+eg)}function pe(en,es,ec){let ed=0,ep=(ec-es)/10;for(let ef=0;ef<10;ef++)ed+=ep*Math.pow(Math.cos(es+(ef+.5)/10*(ec-es)),en);return ed}function me(en,ec){return function(ed,ep,ef,em,e_){let eg=2*((en-1)/es.ak(Math.cos(es.ae(89.25-e_))/Math.cos(es.ae(89.25)))-1),ey=Math.acos(ef/em),ex=2*pe(eg-1,0,es.ae(e_/2)),ev=Math.min(es.ae(89.25),ey+es.ae(e_/2)),eb=pe(eg-1,Math.min(ev,ey-es.ae(e_/2)),ev),ew=Math.atan(ep/ef),eT=Math.hypot(ep,ef),eP=ed;return eP+=es.ak(em/eT/Math.max(.5,Math.cos(es.ae(e_/2))))+eg*es.ak(Math.cos(ew))/2,eP-=es.ak(Math.max(1,eb/ex/ec))/2}}let ek=me(9.314,3);function ge(en,ec){let ed=(ec.roundZoom?Math.round:Math.floor)(en.zoom+es.ak(en.tileSize/ec.tileSize));return Math.max(0,ed)}function ve(en,ec){let ed=en.getCameraFrustum(),ep=en.getClippingPlane(),ef=en.screenPointToMercatorCoordinate(en.getCameraPoint()),em=es.a1.fromLngLat(en.center,en.elevation);ef.z=em.z+Math.cos(en.pitchInRadians)*en.cameraToCenterDistance/en.worldSize;let e_=en.getCoveringTilesDetailsProvider(),eg=e_.allowVariableZoom(en,ec),ey=ge(en,ec),ex=ec.minzoom||0,ev=void 0!==ec.maxzoom?ec.maxzoom:en.maxZoom,eb=Math.min(Math.max(0,ey),ev),ew=Math.pow(2,eb),eT=[ew*ef.x,ew*ef.y,0],eP=[ew*em.x,ew*em.y,0],eS=Math.hypot(em.x-ef.x,em.y-ef.y),eM=Math.abs(em.z-ef.z),eC=Math.hypot(eS,eM),b=en=>({zoom:0,x:0,y:0,wrap:en,fullyVisible:!1}),eI=[],eE=[];if(en.renderWorldCopies&&e_.allowWorldCopies())for(let en=1;en<=3;en++)eI.push(b(-en)),eI.push(b(en));for(eI.push(b(0));eI.length>0;){let ew=eI.pop(),eS=ew.x,eA=ew.y,ez=ew.fullyVisible,eD={x:eS,y:eA,z:ew.zoom},eR=e_.getTileBoundingVolume(eD,ew.wrap,en.elevation,ec);if(!ez){let en=function(en,es,ec){let ed=es.intersectsFrustum(en);if(!ec||0===ed)return ed;let ep=es.intersectsPlane(ec);return 0===ep?0:2===ed&&2===ep?2:1}(ed,eR,ep);if(0===en)continue;ez=2===en}let eL=e_.distanceToTile2d(ef.x,ef.y,eD,eR),eB=ey;eg&&(eB=(ec.calculateTileZoom||ek)(en.zoom+es.ak(en.tileSize/ec.tileSize),eL,eM,eC,en.fov)),eB=Math.max(0,eB=(ec.roundZoom?Math.round:Math.floor)(eB));let eF=Math.min(eB,ev);if(ew.wrap=e_.getWrap(em,eD,ew.wrap),ew.zoom>=eF){if(ew.zoom<ex)continue;let en=eb-ew.zoom,ed=eT[0]-.5-(eS<<en),ep=eT[1]-.5-(eA<<en),ef=ec.reparseOverscaled?Math.max(ew.zoom,eB):ew.zoom;eE.push({tileID:new es.Z(ew.zoom===ev?ef:ew.zoom,ew.wrap,ew.zoom,eS,eA),distanceSq:es.al([eP[0]-.5-eS,eP[1]-.5-eA]),tileDistanceToCamera:Math.sqrt(ed*ed+ep*ep)})}else for(let en=0;en<4;en++)eI.push({zoom:ew.zoom+1,x:(eS<<1)+en%2,y:(eA<<1)+(en>>1),wrap:ew.wrap,fullyVisible:ez})}return eE.sort((en,es)=>en.distanceSq-es.distanceSq).map(en=>en.tileID)}let eD=es.a2.fromPoints([new es.P(0,0),new es.P(es.$,es.$)]);let xe=class xe extends es.E{constructor(en,es,ec){super(),this.id=en,this.dispatcher=ec,this.on("data",en=>this._dataHandler(en)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((en,es,ec,ed)=>{let ep=new(J(es.type))(en,es,ec,ed);if(ep.id!==en)throw Error(`Expected Source id to be ${en} instead of ${ep.id}`);return ep})(en,es,ec,this),this._tiles={},this._cache=new ae(0,en=>this._unloadTile(en)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new se,this._didEmitContent=!1,this._updated=!1}onAdd(en){this.map=en,this._maxTileCacheSize=en?en._maxTileCacheSize:null,this._maxTileCacheZoomLevels=en?en._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(en)}onRemove(en){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(en)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let en in this._tiles){let es=this._tiles[en];if("loaded"!==es.state&&"errored"!==es.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let en=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,en&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(en,ec,ed){return es._(this,void 0,void 0,function*(){try{yield this._source.loadTile(en),this._tileLoaded(en,ec,ed)}catch(ec){en.state="errored",404!==ec.status?this._source.fire(new es.k(ec,{tile:en})):this.update(this.transform,this.terrain)}})}_unloadTile(en){this._source.unloadTile&&this._source.unloadTile(en)}_abortTile(en){this._source.abortTile&&this._source.abortTile(en),this._source.fire(new es.l("dataabort",{tile:en,coord:en.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(en){for(let es in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let ec=this._tiles[es];ec.upload(en),ec.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(en=>en.tileID).sort(ye).map(en=>en.key)}getRenderableIds(en){let ec=[];for(let es in this._tiles)this._isIdRenderable(es,en)&&ec.push(this._tiles[es]);return en?ec.sort((en,ec)=>{let ed=en.tileID,ep=ec.tileID,ef=new es.P(ed.canonical.x,ed.canonical.y)._rotate(-this.transform.bearingInRadians),em=new es.P(ep.canonical.x,ep.canonical.y)._rotate(-this.transform.bearingInRadians);return ed.overscaledZ-ep.overscaledZ||em.y-ef.y||em.x-ef.x}).map(en=>en.tileID.key):ec.map(en=>en.tileID).sort(ye).map(en=>en.key)}hasRenderableParent(en){let es=this.findLoadedParent(en,0);return!!es&&this._isIdRenderable(es.tileID.key)}_isIdRenderable(en,es){return this._tiles[en]&&this._tiles[en].hasData()&&!this._coveredTiles[en]&&(es||!this._tiles[en].holdingForFade())}reload(en){if(this._paused)this._shouldReloadOnResume=!0;else for(let es in this._cache.reset(),this._tiles)en?this._reloadTile(es,"expired"):"errored"!==this._tiles[es].state&&this._reloadTile(es,"reloading")}_reloadTile(en,ec){return es._(this,void 0,void 0,function*(){let es=this._tiles[en];es&&("loading"!==es.state&&(es.state=ec),yield this._loadTile(es,en,ec))})}_tileLoaded(en,ec,ed){en.timeAdded=ev.now(),"expired"===ed&&(en.refreshedUponExpiration=!0),this._setTileReloadTimer(ec,en),"raster-dem"===this.getSource().type&&en.dem&&this._backfillDEM(en),this._state.initializeTileState(en,this.map?this.map.painter:null),en.aborted||this._source.fire(new es.l("data",{dataType:"source",tile:en,coord:en.tileID}))}_backfillDEM(en){let es=this.getRenderableIds();for(let ec=0;ec<es.length;ec++){let ed=es[ec];if(en.neighboringTiles&&en.neighboringTiles[ed]){let es=this.getTileByID(ed);i(en,es),i(es,en)}}function i(en,es){en.needsHillshadePrepare=!0,en.needsTerrainPrepare=!0;let ec=es.tileID.canonical.x-en.tileID.canonical.x,ed=es.tileID.canonical.y-en.tileID.canonical.y,ep=Math.pow(2,en.tileID.canonical.z),ef=es.tileID.key;0===ec&&0===ed||Math.abs(ed)>1||(Math.abs(ec)>1&&(1===Math.abs(ec+ep)?ec+=ep:1===Math.abs(ec-ep)&&(ec-=ep)),es.dem&&en.dem&&(en.dem.backfillBorder(es.dem,ec,ed),en.neighboringTiles&&en.neighboringTiles[ef]&&(en.neighboringTiles[ef].backfilled=!0)))}}getTile(en){return this.getTileByID(en.key)}getTileByID(en){return this._tiles[en]}_retainLoadedChildren(en,es){let ec=Object.values(en),ed=this._getLoadedDescendents(ec),ep={};for(let en of ec){let ec=ed[en.key];if(!(null==ec?void 0:ec.length)){ep[en.key]=en;continue}let ef=en.overscaledZ+xe.maxUnderzooming,em=ec.filter(en=>en.tileID.overscaledZ<=ef);if(!em.length){ep[en.key]=en;continue}let e_=Math.min(...em.map(en=>en.tileID.overscaledZ)),eg=em.filter(en=>en.tileID.overscaledZ===e_).map(en=>en.tileID);for(let en of eg)es[en.key]=en;this._areDescendentsComplete(eg,e_,en.overscaledZ)||(ep[en.key]=en)}return ep}_getLoadedDescendents(en){var es;let ec={};for(let ed in this._tiles){let ep=this._tiles[ed];if(ep.hasData())for(let ed of en)ep.tileID.isChildOf(ed)&&(ec[es=ed.key]||(ec[es]=[])).push(ep)}return ec}_areDescendentsComplete(en,es,ec){return 1===en.length&&en[0].isOverscaled()?en[0].overscaledZ===es:Math.pow(4,es-ec)===en.length}findLoadedParent(en,es){if(en.key in this._loadedParentTiles){let ec=this._loadedParentTiles[en.key];return ec&&ec.tileID.overscaledZ>=es?ec:null}for(let ec=en.overscaledZ-1;ec>=es;ec--){let es=en.scaledTo(ec),ed=this._getLoadedTile(es);if(ed)return ed}}findLoadedSibling(en){return this._getLoadedTile(en)}_getLoadedTile(en){let es=this._tiles[en.key];return es&&es.hasData()?es:this._cache.getByKey(en.wrapped().key)}updateCacheSize(en){let ec=Math.ceil(en.width/this._source.tileSize)+1,ed=Math.ceil(en.height/this._source.tileSize)+1,ep=Math.floor(ec*ed*(null===this._maxTileCacheZoomLevels?es.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),ef="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,ep):ep;this._cache.setMaxSize(ef)}handleWrapJump(en){let es=Math.round((en-(void 0===this._prevLng?en:this._prevLng))/360);if(this._prevLng=en,es){let en={};for(let ec in this._tiles){let ed=this._tiles[ec];ed.tileID=ed.tileID.unwrapTo(ed.tileID.wrap+es),en[ed.tileID.key]=ed}for(let es in this._tiles=en,this._timers)clearTimeout(this._timers[es]),delete this._timers[es];for(let en in this._tiles)this._setTileReloadTimer(en,this._tiles[en])}}update(en,ec){let ed;if(!this._sourceLoaded||this._paused)return;this.transform=en,this.terrain=ec,this.updateCacheSize(en),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?ed=en.getVisibleUnwrappedCoordinates(this._source.tileID).map(en=>new es.Z(en.canonical.z,en.wrap,en.canonical.z,en.canonical.x,en.canonical.y)):(ed=ve(en,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:ec,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(ed=ed.filter(en=>this._source.hasTile(en)))):ed=[],this.usedForTerrain&&(ed=this._addTerrainIdealTiles(ed));let ep=ge(en,this._source),ef=Math.max(ep-xe.maxOverzooming,this._source.minzoom),em=0===ed.length&&!this._updated&&this._didEmitContent;this._updated=!0,em&&this.fire(new es.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let e_=this._updateRetainedTiles(ed,ep);for(let en in we(this._source.type)&&!ec&&this._updateFadingTiles(e_,ef),e_)this._tiles[en].clearFadeHold();let eg=es.am(this._tiles,e_);for(let en of eg){let es=this._tiles[en];es.hasSymbolBuckets&&!es.holdingForFade()?es.setHoldDuration(this.map._fadeDuration):es.hasSymbolBuckets&&!es.symbolFadeFinished()||this._removeTile(en)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}_addTerrainIdealTiles(en){let es=[];for(let ec of en)if(ec.canonical.z>this._source.minzoom){let en=ec.scaledTo(ec.canonical.z-1);es.push(en);let ed=ec.scaledTo(Math.max(this._source.minzoom,Math.min(ec.canonical.z,5)));es.push(ed)}return en.concat(es)}releaseSymbolFadeTiles(){for(let en in this._tiles)this._tiles[en].holdingForFade()&&this._removeTile(en)}_updateRetainedTiles(en,es){var ec;let ed={},ep={},ef=Math.max(es-xe.maxOverzooming,this._source.minzoom),em={};for(let es of en){let en=this._addTile(es);ed[es.key]=es,en.hasData()||(em[es.key]=es)}for(let en in em=this._retainLoadedChildren(em,ed)){let es=em[en],e_=this._tiles[en],eg=null==e_?void 0:e_.wasRequested();for(let en=es.overscaledZ-1;en>=ef;--en){let ef=es.scaledTo(en);if(ep[ef.key])break;if(ep[ef.key]=!0,(e_=this.getTile(ef))||!eg||(e_=this._addTile(ef)),e_){let en=e_.hasData();if((en||!(null===(ec=this.map)||void 0===ec?void 0:ec.cancelPendingTileRequestsWhileZooming)||eg)&&(ed[ef.key]=ef),eg=e_.wasRequested(),en)break}}}return ed}_updateFadingTiles(en,es){let ec={},ed={},ep=Object.keys(en),ef=ev.now();for(let em of ep){let ep=en[em],e_=this._tiles[em];if(!e_||0!==e_.fadeEndTime&&e_.fadeEndTime<=ef)continue;let eg=this.findLoadedParent(ep,es),ey=this.findLoadedSibling(ep),ex=eg||ey||null;ex&&(this._addTile(ex.tileID),ec[ex.tileID.key]=ex.tileID),ed[em]=ep}for(let es in this._retainLoadedChildren(ed,en),ec)en[es]||(this._coveredTiles[es]=!0,en[es]=ec[es])}_updateLoadedParentTileCache(){for(let en in this._loadedParentTiles={},this._tiles){let es=[],ec,ed=this._tiles[en].tileID;for(;ed.overscaledZ>0;){if(ed.key in this._loadedParentTiles){ec=this._loadedParentTiles[ed.key];break}es.push(ed.key);let en=ed.scaledTo(ed.overscaledZ-1);if(ec=this._getLoadedTile(en))break;ed=en}for(let en of es)this._loadedParentTiles[en]=ec}}_updateLoadedSiblingTileCache(){for(let en in this._loadedSiblingTiles={},this._tiles){let es=this._tiles[en].tileID,ec=this._getLoadedTile(es);this._loadedSiblingTiles[es.key]=ec}}_addTile(en){let ec=this._tiles[en.key];if(ec)return ec;(ec=this._cache.getAndRemove(en))&&(this._setTileReloadTimer(en.key,ec),ec.tileID=en,this._state.initializeTileState(ec,this.map?this.map.painter:null),this._cacheTimers[en.key]&&(clearTimeout(this._cacheTimers[en.key]),delete this._cacheTimers[en.key],this._setTileReloadTimer(en.key,ec)));let ed=ec;return ec||(ec=new re(en,this._source.tileSize*en.overscaleFactor()),this._loadTile(ec,en.key,ec.state)),ec.uses++,this._tiles[en.key]=ec,ed||this._source.fire(new es.l("dataloading",{tile:ec,coord:ec.tileID,dataType:"source"})),ec}_setTileReloadTimer(en,es){en in this._timers&&(clearTimeout(this._timers[en]),delete this._timers[en]);let ec=es.getExpiryTimeout();ec&&(this._timers[en]=setTimeout(()=>{this._reloadTile(en,"expired"),delete this._timers[en]},ec))}refreshTiles(en){for(let es in this._tiles)(this._isIdRenderable(es)||"errored"==this._tiles[es].state)&&en.some(en=>en.equals(this._tiles[es].tileID.canonical))&&this._reloadTile(es,"expired")}_removeTile(en){let es=this._tiles[en];es&&(es.uses--,delete this._tiles[en],this._timers[en]&&(clearTimeout(this._timers[en]),delete this._timers[en]),es.uses>0||(es.hasData()&&"reloading"!==es.state?this._cache.add(es.tileID,es,es.getExpiryTimeout()):(es.aborted=!0,this._abortTile(es),this._unloadTile(es))))}_dataHandler(en){let es=en.sourceDataType;"source"===en.dataType&&"metadata"===es&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===en.dataType&&"content"===es&&(this.reload(en.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){for(let en in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(en);this._cache.reset()}tilesIn(en,ec,ed){let ep=[],ef=this.transform;if(!ef)return ep;let em=ef.getCoveringTilesDetailsProvider().allowWorldCopies(),e_=ed?ef.getCameraQueryGeometry(en):en,l=en=>ef.screenPointToMercatorCoordinate(en,this.terrain),eg=this.transformBbox(en,l,!em),ey=this.transformBbox(e_,l,!em),ex=this.getIds(),ev=es.a2.fromPoints(ey);for(let en=0;en<ex.length;en++){let ed=this._tiles[ex[en]];if(ed.holdingForFade())continue;let e_=em?[ed.tileID]:[ed.tileID.unwrapTo(-1),ed.tileID.unwrapTo(0)],eb=Math.pow(2,ef.zoom-ed.tileID.overscaledZ),ew=ec*ed.queryPadding*es.$/ed.tileSize/eb;for(let en of e_){let ec=ev.map(ec=>en.getTilePoint(new es.a1(ec.x,ec.y)));if(ec.expandBy(ew),ec.intersects(eD)){let es=eg.map(es=>en.getTilePoint(es)),ec=ey.map(es=>en.getTilePoint(es));ep.push({tile:ed,tileID:em?en:en.unwrapTo(0),queryGeometry:es,cameraQueryGeometry:ec,scale:eb})}}}return ep}transformBbox(en,ec,ed){let ep=en.map(ec);if(ed){let ed=es.a2.fromPoints(en);ed.shrinkBy(.001*Math.min(ed.width(),ed.height()));let ef=ed.map(ec);es.a2.fromPoints(ep).covers(ef)||(ep=ep.map(en=>en.x>.5?new es.a1(en.x-1,en.y,en.z):en))}return ep}getVisibleCoordinates(en){let es=this.getRenderableIds(en).map(en=>this._tiles[en].tileID);return this.transform&&this.transform.populateCache(es),es}hasTransition(){if(this._source.hasTransition())return!0;if(we(this._source.type)){let en=ev.now();for(let es in this._tiles)if(this._tiles[es].fadeEndTime>=en)return!0}return!1}setFeatureState(en,es,ec){this._state.updateState(en=en||"_geojsonTileLayer",es,ec)}removeFeatureState(en,es,ec){this._state.removeFeatureState(en=en||"_geojsonTileLayer",es,ec)}getFeatureState(en,es){return this._state.getState(en=en||"_geojsonTileLayer",es)}setDependencies(en,es,ec){let ed=this._tiles[en];ed&&ed.setDependencies(es,ec)}reloadTilesForDependencies(en,es){for(let ec in this._tiles)this._tiles[ec].hasDependency(en,es)&&this._reloadTile(ec,"reloading");this._cache.filter(ec=>!ec.hasDependency(en,es))}};function ye(en,es){let ec=Math.abs(2*en.wrap)-+(en.wrap<0),ed=Math.abs(2*es.wrap)-+(es.wrap<0);return en.overscaledZ-es.overscaledZ||ed-ec||es.canonical.y-en.canonical.y||es.canonical.x-en.canonical.x}function we(en){return"raster"===en||"image"===en||"video"===en}xe.maxOverzooming=10,xe.maxUnderzooming=3;let Te=class Te{constructor(en,es){this.reset(en,es)}reset(en,es){this.points=en||[],this._distances=[0];for(let en=1;en<this.points.length;en++)this._distances[en]=this._distances[en-1]+this.points[en].dist(this.points[en-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(es||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(en){if(1===this.points.length)return this.points[0];en=es.ah(en,0,1);let ec=1,ed=this._distances[ec],ep=en*this.paddedLength+this.padding;for(;ed<ep&&ec<this._distances.length;)ed=this._distances[++ec];let ef=ec-1,em=this._distances[ef],e_=ed-em,eg=e_>0?(ep-em)/e_:0;return this.points[ef].mult(1-eg).add(this.points[ec].mult(eg))}};function Pe(en,es){let ec=!0;return"always"===en||"never"!==en&&"never"!==es||(ec=!1),ec}let Ce=class Ce{constructor(en,es,ec){let ed=this.boxCells=[],ep=this.circleCells=[];this.xCellCount=Math.ceil(en/ec),this.yCellCount=Math.ceil(es/ec);for(let en=0;en<this.xCellCount*this.yCellCount;en++)ed.push([]),ep.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=en,this.height=es,this.xScale=this.xCellCount/en,this.yScale=this.yCellCount/es,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(en,es,ec,ed,ep){this._forEachCell(es,ec,ed,ep,this._insertBoxCell,this.boxUid++),this.boxKeys.push(en),this.bboxes.push(es),this.bboxes.push(ec),this.bboxes.push(ed),this.bboxes.push(ep)}insertCircle(en,es,ec,ed){this._forEachCell(es-ed,ec-ed,es+ed,ec+ed,this._insertCircleCell,this.circleUid++),this.circleKeys.push(en),this.circles.push(es),this.circles.push(ec),this.circles.push(ed)}_insertBoxCell(en,es,ec,ed,ep,ef){this.boxCells[ep].push(ef)}_insertCircleCell(en,es,ec,ed,ep,ef){this.circleCells[ep].push(ef)}_query(en,es,ec,ed,ep,ef,em){if(ec<0||en>this.width||ed<0||es>this.height)return[];let e_=[];if(en<=0&&es<=0&&this.width<=ec&&this.height<=ed){if(ep)return[{key:null,x1:en,y1:es,x2:ec,y2:ed}];for(let en=0;en<this.boxKeys.length;en++)e_.push({key:this.boxKeys[en],x1:this.bboxes[4*en],y1:this.bboxes[4*en+1],x2:this.bboxes[4*en+2],y2:this.bboxes[4*en+3]});for(let en=0;en<this.circleKeys.length;en++){let es=this.circles[3*en],ec=this.circles[3*en+1],ed=this.circles[3*en+2];e_.push({key:this.circleKeys[en],x1:es-ed,y1:ec-ed,x2:es+ed,y2:ec+ed})}}else this._forEachCell(en,es,ec,ed,this._queryCell,e_,{hitTest:ep,overlapMode:ef,seenUids:{box:{},circle:{}}},em);return e_}query(en,es,ec,ed){return this._query(en,es,ec,ed,!1,null)}hitTest(en,es,ec,ed,ep,ef){return this._query(en,es,ec,ed,!0,ep,ef).length>0}hitTestCircle(en,es,ec,ed,ep){let ef=en-ec,em=en+ec,e_=es-ec,eg=es+ec;if(em<0||ef>this.width||eg<0||e_>this.height)return!1;let ey=[];return this._forEachCell(ef,e_,em,eg,this._queryCellCircle,ey,{hitTest:!0,overlapMode:ed,circle:{x:en,y:es,radius:ec},seenUids:{box:{},circle:{}}},ep),ey.length>0}_queryCell(en,es,ec,ed,ep,ef,em,e_){let{seenUids:eg,hitTest:ey,overlapMode:ex}=em,ev=this.boxCells[ep];if(null!==ev){let ep=this.bboxes;for(let em of ev)if(!eg.box[em]){eg.box[em]=!0;let ev=4*em,eb=this.boxKeys[em];if(en<=ep[ev+2]&&es<=ep[ev+3]&&ec>=ep[ev+0]&&ed>=ep[ev+1]&&(!e_||e_(eb))&&(!ey||!Pe(ex,eb.overlapMode))&&(ef.push({key:eb,x1:ep[ev],y1:ep[ev+1],x2:ep[ev+2],y2:ep[ev+3]}),ey))return!0}}let eb=this.circleCells[ep];if(null!==eb){let ep=this.circles;for(let em of eb)if(!eg.circle[em]){eg.circle[em]=!0;let ev=3*em,eb=this.circleKeys[em];if(this._circleAndRectCollide(ep[ev],ep[ev+1],ep[ev+2],en,es,ec,ed)&&(!e_||e_(eb))&&(!ey||!Pe(ex,eb.overlapMode))){let en=ep[ev],es=ep[ev+1],ec=ep[ev+2];if(ef.push({key:eb,x1:en-ec,y1:es-ec,x2:en+ec,y2:es+ec}),ey)return!0}}}return!1}_queryCellCircle(en,es,ec,ed,ep,ef,em,e_){let{circle:eg,seenUids:ey,overlapMode:ex}=em,ev=this.boxCells[ep];if(null!==ev){let en=this.bboxes;for(let es of ev)if(!ey.box[es]){ey.box[es]=!0;let ec=4*es,ed=this.boxKeys[es];if(this._circleAndRectCollide(eg.x,eg.y,eg.radius,en[ec+0],en[ec+1],en[ec+2],en[ec+3])&&(!e_||e_(ed))&&!Pe(ex,ed.overlapMode))return ef.push(!0),!0}}let eb=this.circleCells[ep];if(null!==eb){let en=this.circles;for(let es of eb)if(!ey.circle[es]){ey.circle[es]=!0;let ec=3*es,ed=this.circleKeys[es];if(this._circlesCollide(en[ec],en[ec+1],en[ec+2],eg.x,eg.y,eg.radius)&&(!e_||e_(ed))&&!Pe(ex,ed.overlapMode))return ef.push(!0),!0}}}_forEachCell(en,es,ec,ed,ep,ef,em,e_){let eg=this._convertToXCellCoord(en),ey=this._convertToYCellCoord(es),ex=this._convertToXCellCoord(ec),ev=this._convertToYCellCoord(ed);for(let eb=eg;eb<=ex;eb++)for(let eg=ey;eg<=ev;eg++)if(ep.call(this,en,es,ec,ed,this.xCellCount*eg+eb,ef,em,e_))return}_convertToXCellCoord(en){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(en*this.xScale)))}_convertToYCellCoord(en){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(en*this.yScale)))}_circlesCollide(en,es,ec,ed,ep,ef){let em=ed-en,e_=ep-es,eg=ec+ef;return eg*eg>em*em+e_*e_}_circleAndRectCollide(en,es,ec,ed,ep,ef,em){let e_=(ef-ed)/2,eg=Math.abs(en-(ed+e_));if(eg>e_+ec)return!1;let ey=(em-ep)/2,ex=Math.abs(es-(ep+ey));if(ex>ey+ec)return!1;if(eg<=e_||ex<=ey)return!0;let ev=eg-e_,eb=ex-ey;return ev*ev+eb*eb<=ec*ec}};function Ie(en,ec,ed){var ep,ef,em,e_,eg;let ey=es.L();if(!en){let{vecSouth:en,vecEast:es}=Se(ec),ed=o();ed[0]=es[0],ed[1]=es[1],ed[2]=en[0],ed[3]=en[1],(eg=(ep=ed[0])*(e_=ed[3])-(em=ed[2])*(ef=ed[1]))&&(ed[0]=e_*(eg=1/eg),ed[1]=-ef*eg,ed[2]=-em*eg,ed[3]=ep*eg),ey[0]=ed[0],ey[1]=ed[1],ey[4]=ed[2],ey[5]=ed[3]}return es.N(ey,ey,[1/ed,1/ed,1]),ey}function Se(en){let ec=Math.cos(en.rollInRadians),ed=Math.sin(en.rollInRadians),ep=Math.cos(en.pitchInRadians),ef=Math.cos(en.bearingInRadians),em=Math.sin(en.bearingInRadians),e_=es.ar();e_[0]=-ef*ep*ed-em*ec,e_[1]=-em*ep*ed+ef*ec;let eg=es.as(e_);eg<1e-9?es.at(e_):es.au(e_,e_,1/eg);let ey=es.ar();ey[0]=ef*ep*ec-em*ed,ey[1]=em*ep*ec+ef*ed;let ex=es.as(ey);return ex<1e-9?es.at(ey):es.au(ey,ey,1/ex),{vecEast:ey,vecSouth:e_}}function Ee(en,ec,ed,ep){let ef;ep?(ef=[en,ec,ep(en,ec),1],es.aw(ef,ef,ed)):qe(ef=[en,ec,0,1],ef,ed);let em=ef[3];return{point:new es.P(ef[0]/em,ef[1]/em),signedDistanceFromCamera:em,isOccluded:!1}}function Ae(en,es,ec,ed,ep,ef,em,e_){let eg=ef.glyphStartIndex+ef.numGlyphs,ey=ef.lineStartIndex,ex=ef.lineStartIndex+ef.lineLength,ev=es.getoffsetX(ef.glyphStartIndex),eb=es.getoffsetX(eg-1),ew=Ge(en*ev,ec,ed,ep,ef.segment,ey,ex,e_,em);if(!ew)return null;let eT=Ge(en*eb,ec,ed,ep,ef.segment,ey,ex,e_,em);return eT?e_.projectionCache.anyProjectionOccluded?null:{first:ew,last:eT}:null}function Le(en,ec,ed,ep){return en===es.ao.horizontal&&Math.abs(ed.y-ec.y)>Math.abs(ed.x-ec.x)*ep?{useVertical:!0}:(en===es.ao.vertical?ec.y<ed.y:ec.x>ed.x)?{needsFlipping:!0}:null}function ke(en){let ec;let{projectionContext:ed,pitchedLabelPlaneMatrixInverse:ep,symbol:ef,fontSize:em,flip:e_,keepUpright:eg,glyphOffsetArray:ey,dynamicLayoutVertexArray:ex,aspectRatio:ev,rotateToLine:eb}=en,ew=em/24,eT=ef.lineOffsetX*ew,eP=ef.lineOffsetY*ew;if(ef.numGlyphs>1){let en=ef.glyphStartIndex+ef.numGlyphs,es=ef.lineStartIndex,em=ef.lineStartIndex+ef.lineLength,ex=Ae(ew,ey,eT,eP,e_,ef,eb,ed);if(!ex)return{notEnoughRoom:!0};let eS=je(ex.first.point.x,ex.first.point.y,ed,ep),eM=je(ex.last.point.x,ex.last.point.y,ed,ep);if(eg&&!e_){let en=Le(ef.writingMode,eS,eM,ev);if(en)return en}ec=[ex.first];for(let ep=ef.glyphStartIndex+1;ep<en-1;ep++){let en=Ge(ew*ey.getoffsetX(ep),eT,eP,e_,ef.segment,es,em,ed,eb);if(!en)return{notEnoughRoom:!0};ec.push(en)}ec.push(ex.last)}else{if(eg&&!e_){let en=Oe(ed.tileAnchorPoint.x,ed.tileAnchorPoint.y,ed).point,ec=ef.lineStartIndex+ef.segment+1,em=new es.P(ed.lineVertexArray.getx(ec),ed.lineVertexArray.gety(ec)),e_=Oe(em.x,em.y,ed),eg=e_.signedDistanceFromCamera>0?e_.point:Fe(ed.tileAnchorPoint,em,en,1,ed),ey=je(en.x,en.y,ed,ep),ex=je(eg.x,eg.y,ed,ep),eb=Le(ef.writingMode,ey,ex,ev);if(eb)return eb}let en=Ge(ew*ey.getoffsetX(ef.glyphStartIndex),eT,eP,e_,ef.segment,ef.lineStartIndex,ef.lineStartIndex+ef.lineLength,ed,eb);if(!en||ed.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ec=[en]}for(let en of ec)es.av(ex,en.point,en.angle);return{}}function Fe(en,es,ec,ed,ep){let ef=en.add(en.sub(es)._unit()),em=Oe(ef.x,ef.y,ep).point,e_=ec.sub(em);return ec.add(e_._mult(ed/e_.mag()))}function Be(en,ec,ed){let ep=ec.projectionCache;if(ep.projections[en])return ep.projections[en];let ef=new es.P(ec.lineVertexArray.getx(en),ec.lineVertexArray.gety(en)),em=Oe(ef.x,ef.y,ec);if(em.signedDistanceFromCamera>0)return ep.projections[en]=em.point,ep.anyProjectionOccluded=ep.anyProjectionOccluded||em.isOccluded,em.point;let e_=en-ed.direction;return Fe(0===ed.distanceFromAnchor?ec.tileAnchorPoint:new es.P(ec.lineVertexArray.getx(e_),ec.lineVertexArray.gety(e_)),ef,ed.previousVertex,ed.absOffsetX-ed.distanceFromAnchor+1,ec)}function Oe(en,es,ec){let ed;let ep=en+ec.translation[0],ef=es+ec.translation[1];return ec.pitchWithMap?(ed=Ee(ep,ef,ec.pitchedLabelPlaneMatrix,ec.getElevation)).isOccluded=!1:((ed=ec.transform.projectTileCoordinates(ep,ef,ec.unwrappedTileID,ec.getElevation)).point.x=(.5*ed.point.x+.5)*ec.width,ed.point.y=(-(.5*ed.point.y)+.5)*ec.height),ed}function je(en,ec,ed,ep){if(ed.pitchWithMap){let ef=[en,ec,0,1];return es.aw(ef,ef,ep),ed.transform.projectTileCoordinates(ef[0]/ef[3],ef[1]/ef[3],ed.unwrappedTileID,ed.getElevation).point}return{x:en/ed.width*2-1,y:1-ec/ed.height*2}}function Ne(en,es,ec){return ec.transform.projectTileCoordinates(en,es,ec.unwrappedTileID,ec.getElevation)}function Ue(en,es,ec){return en._unit()._perp()._mult(es*ec)}function Ge(en,ec,ed,ep,ef,em,e_,eg,ey){let ex;let ev=ep?en-ec:en+ec,eb=ev>0?1:-1,ew=0;ep&&(eb*=-1,ew=Math.PI),eb<0&&(ew+=Math.PI);let eT,eP=eb>0?em+ef:em+ef+1;eg.projectionCache.cachedAnchorPoint?eT=eg.projectionCache.cachedAnchorPoint:(eT=Oe(eg.tileAnchorPoint.x,eg.tileAnchorPoint.y,eg).point,eg.projectionCache.cachedAnchorPoint=eT);let eS,eM,eC=eT,eI=eT,eE=0,eA=0,ez=Math.abs(ev),ek=[];for(;eE+eA<=ez;){if((eP+=eb)<em||eP>=e_)return null;eE+=eA,eI=eC,eM=eS;let en={absOffsetX:ez,direction:eb,distanceFromAnchor:eE,previousVertex:eI};if(eC=Be(eP,eg,en),0===ed)ek.push(eI),ex=eC.sub(eI);else{let ec;let ep=eC.sub(eI);ec=0===ep.mag()?Ue(Be(eP+eb,eg,en).sub(eC),ed,eb):Ue(ep,ed,eb),eM||(eM=eI.add(ec)),eS=function(en,ec,ed,ep,ef,em,e_,eg,ey){if(eg.projectionCache.offsets[en])return eg.projectionCache.offsets[en];let ex=ed.add(ec);if(en+ey.direction<ep||en+ey.direction>=ef)return eg.projectionCache.offsets[en]=ex,ex;let ev=Be(en+ey.direction,eg,ey),eb=Ue(ev.sub(ed),e_,ey.direction),ew=ed.add(eb),eT=ev.add(eb);return eg.projectionCache.offsets[en]=es.ax(em,ex,ew,eT)||ex,eg.projectionCache.offsets[en]}(eP,ec,eC,em,e_,eM,ed,eg,en),ek.push(eM),ex=eS.sub(eM)}eA=ex.mag()}let eD=ex._mult((ez-eE)/eA)._add(eM||eI),eR=ew+Math.atan2(eC.y-eI.y,eC.x-eI.x);return ek.push(eD),{point:eD,angle:ey?eR:0,path:ek}}let eR=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $e(en,es){for(let ec=0;ec<en;ec++){let en=es.length;es.resize(en+4),es.float32.set(eR,3*en)}}function qe(en,es,ec){let ed=es[0],ep=es[1];return en[0]=ec[0]*ed+ec[4]*ep+ec[12],en[1]=ec[1]*ed+ec[5]*ep+ec[13],en[3]=ec[3]*ed+ec[7]*ep+ec[15],en}let He=class He{constructor(en,es=new Ce(en.width+200,en.height+200,25),ec=new Ce(en.width+200,en.height+200,25)){this.transform=en,this.grid=es,this.ignoredGrid=ec,this.pitchFactor=Math.cos(en.pitch*Math.PI/180)*en.cameraToCenterDistance,this.screenRightBoundary=en.width+100,this.screenBottomBoundary=en.height+100,this.gridRightBoundary=en.width+200,this.gridBottomBoundary=en.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev){let eb;let ew=this.projectAndGetPerspectiveRatio(en.anchorPointX+e_[0],en.anchorPointY+e_[1],ep,ey,ev),eT=ec*ew.perspectiveRatio;if(ef||em)eb=this._projectCollisionBox(en,eT,ed,ep,ef,em,e_,ew,ey,ex,ev);else{let es=ew.x+(ex?ex.x*eT:0),ec=ew.y+(ex?ex.y*eT:0);eb={allPointsOccluded:!1,box:[es+en.x1*eT,ec+en.y1*eT,es+en.x2*eT,ec+en.y2*eT]}}let[eP,eS,eM,eC]=eb.box,eI=ef?eb.allPointsOccluded:ew.isOccluded,eE=eI;return eE||(eE=ew.perspectiveRatio<this.perspectiveRatioCutoff),eE||(eE=!this.isInsideGrid(eP,eS,eM,eC)),eE||"always"!==es&&this.grid.hitTest(eP,eS,eM,eC,es,eg)?{box:[eP,eS,eM,eC],placeable:!1,offscreen:!1,occluded:eI}:{box:[eP,eS,eM,eC],placeable:!0,offscreen:this.isOffscreen(eP,eS,eM,eC),occluded:eI}}placeCollisionCircles(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT){let eP=[],eS=new es.P(ec.anchorX,ec.anchorY),eM=this.getPerspectiveRatio(eS.x,eS.y,em,eT),eC=(ey?ef*this.transform.getPitchedTextCorrection(ec.anchorX,ec.anchorY,em)/eM:ef*eM)/es.aB,eI={getElevation:eT,pitchedLabelPlaneMatrix:e_,lineVertexArray:ed,pitchWithMap:ey,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:eS,unwrappedTileID:em,width:this.transform.width,height:this.transform.height,translation:ew},eE=Ae(eC,ep,ec.lineOffsetX*eC,ec.lineOffsetY*eC,!1,ec,!1,eI),eA=!1,ez=!1,ek=!0;if(eE){let ec=.5*ev*eM+eb,ed=new es.P(-100,-100),ep=new es.P(this.screenRightBoundary,this.screenBottomBoundary),ef=new Te,em=eE.first,e_=eE.last,ew=[];for(let en=em.path.length-1;en>=1;en--)ew.push(em.path[en]);for(let en=1;en<e_.path.length;en++)ew.push(e_.path[en]);let eT=2.5*ec;if(ey){let en=this.projectPathToScreenSpace(ew,eI);ew=en.some(en=>en.signedDistanceFromCamera<=0)?[]:en.map(en=>en.point)}let eS=[];if(ew.length>0){let en=ew[0].clone(),ec=ew[0].clone();for(let es=1;es<ew.length;es++)en.x=Math.min(en.x,ew[es].x),en.y=Math.min(en.y,ew[es].y),ec.x=Math.max(ec.x,ew[es].x),ec.y=Math.max(ec.y,ew[es].y);eS=en.x>=ed.x&&ec.x<=ep.x&&en.y>=ed.y&&ec.y<=ep.y?[ew]:ec.x<ed.x||en.x>ep.x||ec.y<ed.y||en.y>ep.y?[]:es.ay([ew],ed.x,ed.y,ep.x,ep.y)}for(let es of eS){ef.reset(es,.25*ec);let ed=0;ed=ef.length<=.5*ec?1:Math.ceil(ef.paddedLength/eT)+1;for(let es=0;es<ed;es++){let ep=es/Math.max(ed-1,1),em=ef.lerp(ep),e_=em.x+100,ey=em.y+100;eP.push(e_,ey,ec,0);let ev=e_-ec,eb=ey-ec,ew=e_+ec,eT=ey+ec;if(ek=ek&&this.isOffscreen(ev,eb,ew,eT),ez=ez||this.isInsideGrid(ev,eb,ew,eT),"always"!==en&&this.grid.hitTestCircle(e_,ey,ec,en,ex)&&(eA=!0,!eg))return{circles:[],offscreen:!1,collisionDetected:eA}}}}return{circles:!eg&&eA||!ez||eM<this.perspectiveRatioCutoff?[]:eP,offscreen:ek,collisionDetected:eA}}projectPathToScreenSpace(en,ec){let ed=function(en,ec){let ed=es.L();return es.aq(ed,ec.pitchedLabelPlaneMatrix),en.map(en=>{let es=Ee(en.x,en.y,ed,ec.getElevation),ep=ec.transform.projectTileCoordinates(es.point.x,es.point.y,ec.unwrappedTileID,ec.getElevation);return ep.point.x=(.5*ep.point.x+.5)*ec.width,ep.point.y=(-(.5*ep.point.y)+.5)*ec.height,ep})}(en,ec);return function(en){let es=0,ec=0,ed=0,ep=0;for(let ef=0;ef<en.length;ef++)en[ef].isOccluded?(ed=ef+1,ep=0):++ep>ec&&(ec=ep,es=ed);return en.slice(es,es+ec)}(ed)}queryRenderedSymbols(en){if(0===en.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let ec=[],ed=new es.a2;for(let ep of en){let en=new es.P(ep.x+100,ep.y+100);ed.extend(en),ec.push(en)}let{minX:ep,minY:ef,maxX:em,maxY:e_}=ed,eg=this.grid.query(ep,ef,em,e_).concat(this.ignoredGrid.query(ep,ef,em,e_)),ey={},ex={};for(let en of eg){let ed=en.key;if(void 0===ey[ed.bucketInstanceId]&&(ey[ed.bucketInstanceId]={}),ey[ed.bucketInstanceId][ed.featureIndex])continue;let ep=[new es.P(en.x1,en.y1),new es.P(en.x2,en.y1),new es.P(en.x2,en.y2),new es.P(en.x1,en.y2)];es.az(ec,ep)&&(ey[ed.bucketInstanceId][ed.featureIndex]=!0,void 0===ex[ed.bucketInstanceId]&&(ex[ed.bucketInstanceId]=[]),ex[ed.bucketInstanceId].push(ed.featureIndex))}return ex}insertCollisionBox(en,es,ec,ed,ep,ef){(ec?this.ignoredGrid:this.grid).insert({bucketInstanceId:ed,featureIndex:ep,collisionGroupID:ef,overlapMode:es},en[0],en[1],en[2],en[3])}insertCollisionCircles(en,es,ec,ed,ep,ef){let em=ec?this.ignoredGrid:this.grid,e_={bucketInstanceId:ed,featureIndex:ep,collisionGroupID:ef,overlapMode:es};for(let es=0;es<en.length;es+=4)em.insertCircle(e_,en[es],en[es+1],en[es+2])}projectAndGetPerspectiveRatio(en,ec,ed,ep,ef){if(ef){let ed;ep?(ed=[en,ec,ep(en,ec),1],es.aw(ed,ed,ef)):qe(ed=[en,ec,0,1],ed,ef);let em=ed[3];return{x:(ed[0]/em+1)/2*this.transform.width+100,y:(-ed[1]/em+1)/2*this.transform.height+100,perspectiveRatio:.5+this.transform.cameraToCenterDistance/em*.5,isOccluded:!1,signedDistanceFromCamera:em}}{let es=this.transform.projectTileCoordinates(en,ec,ed,ep);return{x:(es.point.x+1)/2*this.transform.width+100,y:(1-es.point.y)/2*this.transform.height+100,perspectiveRatio:.5+this.transform.cameraToCenterDistance/es.signedDistanceFromCamera*.5,isOccluded:es.isOccluded,signedDistanceFromCamera:es.signedDistanceFromCamera}}}getPerspectiveRatio(en,es,ec,ed){let ep=this.transform.projectTileCoordinates(en,es,ec,ed);return .5+this.transform.cameraToCenterDistance/ep.signedDistanceFromCamera*.5}isOffscreen(en,es,ec,ed){return ec<100||en>=this.screenRightBoundary||ed<100||es>this.screenBottomBoundary}isInsideGrid(en,es,ec,ed){return ec>=0&&en<this.gridRightBoundary&&ed>=0&&es<this.gridBottomBoundary}getViewportMatrix(){let en=es.ag([]);return es.M(en,en,[-100,-100,0]),en}_projectCollisionBox(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev){let eb=1,ew=0,eT=0,eP=1,eS=en.anchorPointX+e_[0],eM=en.anchorPointY+e_[1];if(em&&!ef){let en=this.projectAndGetPerspectiveRatio(eS+1,eM,ep,ey,ev),es=en.x-eg.x,ec=Math.atan((en.y-eg.y)/es)+(es<0?Math.PI:0),ed=Math.sin(ec),ef=Math.cos(ec);eb=ef,ew=ed,eT=-ed,eP=ef}else if(!em&&ef){let en=Se(this.transform);eb=en.vecEast[0],ew=en.vecEast[1],eT=en.vecSouth[0],eP=en.vecSouth[1]}let eC=eg.x,eI=eg.y,eE=ec;ef&&(eC=eS,eI=eM,eE=Math.pow(2,-(this.transform.zoom-ed.overscaledZ))*this.transform.getPitchedTextCorrection(eS,eM,ep),ex||(eE*=es.ah(.5+eg.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),ex&&(eC+=eb*ex.x*eE+eT*ex.y*eE,eI+=ew*ex.x*eE+eP*ex.y*eE);let eA=en.x1*eE,ez=en.x2*eE,ek=(eA+ez)/2,eD=en.y1*eE,eR=en.y2*eE,eL=(eD+eR)/2,eB=[];for(let{offsetX:en,offsetY:ec}of[{offsetX:eA,offsetY:eD},{offsetX:ek,offsetY:eD},{offsetX:ez,offsetY:eD},{offsetX:ez,offsetY:eL},{offsetX:ez,offsetY:eR},{offsetX:ek,offsetY:eR},{offsetX:eA,offsetY:eR},{offsetX:eA,offsetY:eL}])eB.push(new es.P(eC+eb*en+eT*ec,eI+ew*en+eP*ec));let eF=!1;if(ef){let en=eB.map(en=>this.projectAndGetPerspectiveRatio(en.x,en.y,ep,ey,ev));eF=en.some(en=>!en.isOccluded),eB=en.map(en=>new es.P(en.x,en.y))}else eF=!0;return{box:es.aA(eB),allPointsOccluded:!eF}}};let Xe=class Xe{constructor(en,es,ec,ed){this.opacity=en?Math.max(0,Math.min(1,en.opacity+(en.placed?es:-es))):ed&&ec?1:0,this.placed=ec}isHidden(){return 0===this.opacity&&!this.placed}};let Ke=class Ke{constructor(en,es,ec,ed,ep){this.text=new Xe(en?en.text:null,es,ec,ep),this.icon=new Xe(en?en.icon:null,es,ed,ep)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}};let Ye=class Ye{constructor(en,es,ec){this.text=en,this.icon=es,this.skipFade=ec}};let Qe=class Qe{constructor(en,es,ec,ed,ep){this.bucketInstanceId=en,this.featureIndex=es,this.sourceLayerIndex=ec,this.bucketIndex=ed,this.tileID=ep}};let Je=class Je{constructor(en){this.crossSourceCollisions=en,this.maxGroupID=0,this.collisionGroups={}}get(en){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[en]){let es=++this.maxGroupID;this.collisionGroups[en]={ID:es,predicate:en=>en.collisionGroupID===es}}return this.collisionGroups[en]}};function et(en,ec,ed,ep,ef){let{horizontalAlign:em,verticalAlign:e_}=es.aH(en);return new es.P(-(em-.5)*ec+ep[0]*ef,-(e_-.5)*ed+ep[1]*ef)}let tt=class tt{constructor(en,es,ec,ed,ep){this.transform=en.clone(),this.terrain=es,this.collisionIndex=new He(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=ec,this.retainedQueryData={},this.collisionGroups=new Je(ed),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=ep,ep&&(ep.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(en){let es=this.terrain;return es?(ec,ed)=>es.getElevation(en,ec,ed):null}getBucketParts(en,ec,ed,ep){let ef=ed.getBucket(ec),em=ed.latestFeatureIndex;if(!ef||!em||ec.id!==ef.layerIds[0])return;let e_=ed.collisionBoxArray,eg=ef.layers[0].layout,ey=ef.layers[0].paint,ex=Math.pow(2,this.transform.zoom-ed.tileID.overscaledZ),ev=ed.tileSize/es.$,eb=ed.tileID.toUnwrapped(),ew="map"===eg.get("text-rotation-alignment"),eT=es.aC(ed,1,this.transform.zoom),eP=es.aD(this.collisionIndex.transform,ed,ey.get("text-translate"),ey.get("text-translate-anchor")),eS=es.aD(this.collisionIndex.transform,ed,ey.get("icon-translate"),ey.get("icon-translate-anchor")),eM=Ie(ew,this.transform,eT);this.retainedQueryData[ef.bucketInstanceId]=new Qe(ef.bucketInstanceId,em,ef.sourceLayerIndex,ef.index,ed.tileID);let eC={bucket:ef,layout:eg,translationText:eP,translationIcon:eS,unwrappedTileID:eb,pitchedLabelPlaneMatrix:eM,scale:ex,textPixelRatio:ev,holdingForFade:ed.holdingForFade(),collisionBoxArray:e_,partiallyEvaluatedTextSize:es.an(ef.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(ef.sourceID)};if(ep)for(let es of ef.sortKeyRanges){let{sortKey:ec,symbolInstanceStart:ed,symbolInstanceEnd:ep}=es;en.push({sortKey:ec,symbolInstanceStart:ed,symbolInstanceEnd:ep,parameters:eC})}else en.push({symbolInstanceStart:0,symbolInstanceEnd:ef.symbolInstances.length,parameters:eC})}attemptAnchorPlacement(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC,eI,eE){let eA=es.aE[en.textAnchor],ez=[en.textOffset0,en.textOffset1],ek=et(eA,ed,ep,ez,ef),eD=this.collisionIndex.placeCollisionBox(ec,eb,eg,ey,ex,e_,em,eS,ev.predicate,eI,ek,eE);if((!eC||this.collisionIndex.placeCollisionBox(eC,eb,eg,ey,ex,e_,em,eM,ev.predicate,eI,ek,eE).placeable)&&eD.placeable){let en;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ew.crossTileID]&&this.prevPlacement.placements[ew.crossTileID]&&this.prevPlacement.placements[ew.crossTileID].text&&(en=this.prevPlacement.variableOffsets[ew.crossTileID].anchor),0===ew.crossTileID)throw Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ew.crossTileID]={textOffset:ez,width:ed,height:ep,anchor:eA,textBoxScale:ef,prevAnchor:en},this.markUsedJustification(eT,eA,ew,eP),eT.allowVerticalPlacement&&(this.markUsedOrientation(eT,eP,ew),this.placedOrientations[ew.crossTileID]=eP),{shift:ek,placedGlyphBoxes:eD}}}placeLayerBucketPart(en,ec,ed){let{bucket:ep,layout:ef,translationText:em,translationIcon:e_,unwrappedTileID:eg,pitchedLabelPlaneMatrix:ey,textPixelRatio:ex,holdingForFade:ev,collisionBoxArray:eb,partiallyEvaluatedTextSize:ew,collisionGroup:eT}=en.parameters,eP=ef.get("text-optional"),eS=ef.get("icon-optional"),eM=es.aF(ef,"text-overlap","text-allow-overlap"),eC="always"===eM,eI=es.aF(ef,"icon-overlap","icon-allow-overlap"),eE="always"===eI,eA="map"===ef.get("text-rotation-alignment"),ez="map"===ef.get("text-pitch-alignment"),ek="none"!==ef.get("icon-text-fit"),eD="viewport-y"===ef.get("symbol-z-order"),eR=eC&&(eE||!ep.hasIconData()||eS),eL=eE&&(eC||!ep.hasTextData()||eP);!ep.collisionArrays&&eb&&ep.deserializeCollisionBoxes(eb);let eB=this.retainedQueryData[ep.bucketInstanceId].tileID,eF=this._getTerrainElevationFunc(eB),eO=this.transform.getFastPathSimpleProjectionMatrix(eB),R=(en,eb,eE)=>{var eD,ej;if(ec[en.crossTileID])return;if(ev)return void(this.placements[en.crossTileID]=new Ye(!1,!1,!1));let eV=!1,eU=!1,eN=!0,eZ=null,eG={box:null,placeable:!1,offscreen:null,occluded:!1},e$={placeable:!1},eq=null,eW=null,eH=null,eX=0,eK=0,eY=0;eb.textFeatureIndex?eX=eb.textFeatureIndex:en.useRuntimeCollisionCircles&&(eX=en.featureIndex),eb.verticalTextFeatureIndex&&(eK=eb.verticalTextFeatureIndex);let eJ=eb.textBox;if(eJ){let i=ec=>{let ed=es.ao.horizontal;if(ep.allowVerticalPlacement&&!ec&&this.prevPlacement){let es=this.prevPlacement.placedOrientations[en.crossTileID];es&&(this.placedOrientations[en.crossTileID]=es,ed=es,this.markUsedOrientation(ep,ed,en))}return ed},a=(ec,ed)=>{if(ep.allowVerticalPlacement&&en.numVerticalGlyphVertices>0&&eb.verticalTextBox){for(let en of ep.writingModes)if(en===es.ao.vertical?e$=eG=ed():eG=ec(),eG&&eG.placeable)break}else eG=ec()},ec=en.textAnchorOffsetStartIndex,ef=en.textAnchorOffsetEndIndex;if(ef===ec){let o=(es,ec)=>{let ed=this.collisionIndex.placeCollisionBox(es,eM,ex,eB,eg,ez,eA,em,eT.predicate,eF,void 0,eO);return ed&&ed.placeable&&(this.markUsedOrientation(ep,ec,en),this.placedOrientations[en.crossTileID]=ec),ed};a(()=>o(eJ,es.ao.horizontal),()=>{let ec=eb.verticalTextBox;return ep.allowVerticalPlacement&&en.numVerticalGlyphVertices>0&&ec?o(ec,es.ao.vertical):{box:null,offscreen:null}}),i(eG&&eG.placeable)}else{let ey=es.aE[null===(ej=null===(eD=this.prevPlacement)||void 0===eD?void 0:eD.variableOffsets[en.crossTileID])||void 0===ej?void 0:ej.anchor],m=(es,ev,eb)=>{let ew=es.x2-es.x1,eP=es.y2-es.y1,eS=en.textBoxScale,eC=ek&&"never"===eI?ev:null,eE=null,eD="never"===eM?1:2,eR="never";ey&&eD++;for(let ed=0;ed<eD;ed++){for(let ed=ec;ed<ef;ed++){let ec=ep.textAnchorOffsets.get(ed);if(ey&&ec.textAnchor!==ey)continue;let ef=this.attemptAnchorPlacement(ec,es,ew,eP,eS,eA,ez,ex,eB,eg,eT,eR,en,ep,eb,em,e_,eC,eF);if(ef&&(eE=ef.placedGlyphBoxes)&&eE.placeable)return eV=!0,eZ=ef.shift,eE}ey?ey=null:eR=eM}return ed&&!eE&&(eE={box:this.collisionIndex.placeCollisionBox(eJ,"always",ex,eB,eg,ez,eA,em,eT.predicate,eF,void 0,eO).box,offscreen:!1,placeable:!1,occluded:!1}),eE};a(()=>m(eJ,eb.iconBox,es.ao.horizontal),()=>{let ec=eb.verticalTextBox;return ep.allowVerticalPlacement&&(!eG||!eG.placeable)&&en.numVerticalGlyphVertices>0&&ec?m(ec,eb.verticalIconBox,es.ao.vertical):{box:null,occluded:!0,offscreen:null}}),eG&&(eV=eG.placeable,eN=eG.offscreen);let ev=i(eG&&eG.placeable);if(!eV&&this.prevPlacement){let es=this.prevPlacement.variableOffsets[en.crossTileID];es&&(this.variableOffsets[en.crossTileID]=es,this.markUsedJustification(ep,es.anchor,en,ev))}}}if(eV=(eq=eG)&&eq.placeable,eN=eq&&eq.offscreen,en.useRuntimeCollisionCircles&&en.centerJustifiedTextSymbolIndex>=0){let ec=ep.text.placedSymbolArray.get(en.centerJustifiedTextSymbolIndex),e_=es.ap(ep.textSizeData,ew,ec),ex=ef.get("text-padding");(eW=this.collisionIndex.placeCollisionCircles(eM,ec,ep.lineVertexArray,ep.glyphOffsetArray,e_,eg,ey,ed,ez,eT.predicate,en.collisionCircleDiameter,ex,em,eF)).circles.length&&eW.collisionDetected&&!ed&&es.w("Collisions detected, but collision boxes are not shown"),eV=eC||eW.circles.length>0&&!eW.collisionDetected,eN=eN&&eW.offscreen}if(eb.iconFeatureIndex&&(eY=eb.iconFeatureIndex),eb.iconBox){let e=en=>this.collisionIndex.placeCollisionBox(en,eI,ex,eB,eg,ez,eA,e_,eT.predicate,eF,ek&&eZ?eZ:void 0,eO);eU=e$&&e$.placeable&&eb.verticalIconBox?(eH=e(eb.verticalIconBox)).placeable:(eH=e(eb.iconBox)).placeable,eN=eN&&eH.offscreen}let eQ=eP||0===en.numHorizontalGlyphVertices&&0===en.numVerticalGlyphVertices,e0=eS||0===en.numIconVertices;eQ||e0?e0?eQ||(eU=eU&&eV):eV=eU&&eV:eU=eV=eU&&eV;let e1=eU&&eH.placeable;if(eV&&eq.placeable&&this.collisionIndex.insertCollisionBox(eq.box,eM,ef.get("text-ignore-placement"),ep.bucketInstanceId,e$&&e$.placeable&&eK?eK:eX,eT.ID),e1&&this.collisionIndex.insertCollisionBox(eH.box,eI,ef.get("icon-ignore-placement"),ep.bucketInstanceId,eY,eT.ID),eW&&eV&&this.collisionIndex.insertCollisionCircles(eW.circles,eM,ef.get("text-ignore-placement"),ep.bucketInstanceId,eX,eT.ID),ed&&this.storeCollisionData(ep.bucketInstanceId,eE,eb,eq,eH,eW),0===en.crossTileID)throw Error("symbolInstance.crossTileID can't be 0");if(0===ep.bucketInstanceId)throw Error("bucket.bucketInstanceId can't be 0");this.placements[en.crossTileID]=new Ye((eV||eR)&&!(null==eq?void 0:eq.occluded),(eU||eL)&&!(null==eH?void 0:eH.occluded),eN||ep.justReloaded),ec[en.crossTileID]=!0};if(eD){if(0!==en.symbolInstanceStart)throw Error("bucket.bucketInstanceId should be 0");let es=ep.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let en=es.length-1;en>=0;--en){let ec=es[en];R(ep.symbolInstances.get(ec),ep.collisionArrays[ec],ec)}}else for(let es=en.symbolInstanceStart;es<en.symbolInstanceEnd;es++)R(ep.symbolInstances.get(es),ep.collisionArrays[es],es);ep.justReloaded=!1}storeCollisionData(en,es,ec,ed,ep,ef){if(ec.textBox||ec.iconBox){let ef,em;this.collisionBoxArrays.has(en)?ef=this.collisionBoxArrays.get(en):(ef=new Map,this.collisionBoxArrays.set(en,ef)),ef.has(es)?em=ef.get(es):(em={text:null,icon:null},ef.set(es,em)),ec.textBox&&(em.text=ed.box),ec.iconBox&&(em.icon=ep.box)}if(ef){let es=this.collisionCircleArrays[en];void 0===es&&(es=this.collisionCircleArrays[en]=[]);for(let en=0;en<ef.circles.length;en+=4)es.push(ef.circles[en+0]-100),es.push(ef.circles[en+1]-100),es.push(ef.circles[en+2]),es.push(ef.collisionDetected?1:0)}}markUsedJustification(en,ec,ed,ep){let ef;ef=ep===es.ao.vertical?ed.verticalPlacedTextSymbolIndex:({left:ed.leftJustifiedTextSymbolIndex,center:ed.centerJustifiedTextSymbolIndex,right:ed.rightJustifiedTextSymbolIndex})[es.aG(ec)];let em=[ed.leftJustifiedTextSymbolIndex,ed.centerJustifiedTextSymbolIndex,ed.rightJustifiedTextSymbolIndex,ed.verticalPlacedTextSymbolIndex];for(let es of em)es>=0&&(en.text.placedSymbolArray.get(es).crossTileID=ef>=0&&es!==ef?0:ed.crossTileID)}markUsedOrientation(en,ec,ed){let ep=ec===es.ao.horizontal||ec===es.ao.horizontalOnly?ec:0,ef=ec===es.ao.vertical?ec:0,em=[ed.leftJustifiedTextSymbolIndex,ed.centerJustifiedTextSymbolIndex,ed.rightJustifiedTextSymbolIndex];for(let es of em)en.text.placedSymbolArray.get(es).placedOrientation=ep;ed.verticalPlacedTextSymbolIndex&&(en.text.placedSymbolArray.get(ed.verticalPlacedTextSymbolIndex).placedOrientation=ef)}commit(en){this.commitTime=en,this.zoomAtLastRecencyCheck=this.transform.zoom;let es=this.prevPlacement,ec=!1;this.prevZoomAdjustment=es?es.zoomAdjustment(this.transform.zoom):0;let ed=es?es.symbolFadeChange(en):1,ep=es?es.opacities:{},ef=es?es.variableOffsets:{},em=es?es.placedOrientations:{};for(let en in this.placements){let es=this.placements[en],ef=ep[en];ef?(this.opacities[en]=new Ke(ef,ed,es.text,es.icon),ec=ec||es.text!==ef.text.placed||es.icon!==ef.icon.placed):(this.opacities[en]=new Ke(null,ed,es.text,es.icon,es.skipFade),ec=ec||es.text||es.icon)}for(let en in ep){let es=ep[en];if(!this.opacities[en]){let ep=new Ke(es,ed,!1,!1);ep.isHidden()||(this.opacities[en]=ep,ec=ec||es.text.placed||es.icon.placed)}}for(let en in ef)this.variableOffsets[en]||!this.opacities[en]||this.opacities[en].isHidden()||(this.variableOffsets[en]=ef[en]);for(let en in em)this.placedOrientations[en]||!this.opacities[en]||this.opacities[en].isHidden()||(this.placedOrientations[en]=em[en]);if(es&&void 0===es.lastPlacementChangeTime)throw Error("Last placement time for previous placement is not defined");ec?this.lastPlacementChangeTime=en:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=es?es.lastPlacementChangeTime:en)}updateLayerOpacities(en,es){let ec={};for(let ed of es){let es=ed.getBucket(en);es&&ed.latestFeatureIndex&&en.id===es.layerIds[0]&&this.updateBucketOpacities(es,ed.tileID,ec,ed.collisionBoxArray)}}updateBucketOpacities(en,ec,ed,ep){en.hasTextData()&&(en.text.opacityVertexArray.clear(),en.text.hasVisibleVertices=!1),en.hasIconData()&&(en.icon.opacityVertexArray.clear(),en.icon.hasVisibleVertices=!1),en.hasIconCollisionBoxData()&&en.iconCollisionBox.collisionVertexArray.clear(),en.hasTextCollisionBoxData()&&en.textCollisionBox.collisionVertexArray.clear();let ef=en.layers[0],em=ef.layout,e_=new Ke(null,0,!1,!1,!0),eg=em.get("text-allow-overlap"),ey=em.get("icon-allow-overlap"),ex=ef._unevaluatedLayout.hasValue("text-variable-anchor")||ef._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ev="map"===em.get("text-rotation-alignment"),eb="map"===em.get("text-pitch-alignment"),ew="none"!==em.get("icon-text-fit"),eT=new Ke(null,0,eg&&(ey||!en.hasIconData()||em.get("icon-optional")),ey&&(eg||!en.hasTextData()||em.get("text-optional")),!0);!en.collisionArrays&&ep&&(en.hasIconCollisionBoxData()||en.hasTextCollisionBoxData())&&en.deserializeCollisionBoxes(ep);let m=(en,es,ec)=>{for(let ed=0;ed<es/4;ed++)en.opacityVertexArray.emplaceBack(ec);en.hasVisibleVertices=en.hasVisibleVertices||ec!==eL},eP=this.collisionBoxArrays.get(en.bucketInstanceId);for(let ec=0;ec<en.symbolInstances.length;ec++){let ep=en.symbolInstances.get(ec),{numHorizontalGlyphVertices:ef,numVerticalGlyphVertices:em,crossTileID:eg}=ep,ey=this.opacities[eg];ed[eg]?ey=e_:ey||(ey=eT,this.opacities[eg]=ey),ed[eg]=!0;let eS=ep.numIconVertices>0,eM=this.placedOrientations[ep.crossTileID],eC=eM===es.ao.vertical,eI=eM===es.ao.horizontal||eM===es.ao.horizontalOnly;if(ef>0||em>0){let es=ht(ey.text);m(en.text,ef,eC?eL:es),m(en.text,em,eI?eL:es);let ec=ey.text.isHidden();[ep.rightJustifiedTextSymbolIndex,ep.centerJustifiedTextSymbolIndex,ep.leftJustifiedTextSymbolIndex].forEach(es=>{es>=0&&(en.text.placedSymbolArray.get(es).hidden=ec||eC?1:0)}),ep.verticalPlacedTextSymbolIndex>=0&&(en.text.placedSymbolArray.get(ep.verticalPlacedTextSymbolIndex).hidden=ec||eI?1:0);let ed=this.variableOffsets[ep.crossTileID];ed&&this.markUsedJustification(en,ed.anchor,ep,eM);let e_=this.placedOrientations[ep.crossTileID];e_&&(this.markUsedJustification(en,"left",ep,e_),this.markUsedOrientation(en,e_,ep))}if(eS){let es=ht(ey.icon),ec=!(ew&&ep.verticalPlacedIconSymbolIndex&&eC);ep.placedIconSymbolIndex>=0&&(m(en.icon,ep.numIconVertices,ec?es:eL),en.icon.placedSymbolArray.get(ep.placedIconSymbolIndex).hidden=ey.icon.isHidden()),ep.verticalPlacedIconSymbolIndex>=0&&(m(en.icon,ep.numVerticalIconVertices,ec?eL:es),en.icon.placedSymbolArray.get(ep.verticalPlacedIconSymbolIndex).hidden=ey.icon.isHidden())}let eE=eP&&eP.has(ec)?eP.get(ec):{text:null,icon:null};if(en.hasIconCollisionBoxData()||en.hasTextCollisionBoxData()){let ed=en.collisionArrays[ec];if(ed){let ec=new es.P(0,0);if(ed.textBox||ed.verticalTextBox){let es=!0;if(ex){let en=this.variableOffsets[eg];en?(ec=et(en.anchor,en.width,en.height,en.textOffset,en.textBoxScale),ev&&ec._rotate(eb?-this.transform.bearingInRadians:this.transform.bearingInRadians)):es=!1}if(ed.textBox||ed.verticalTextBox){let ep;ed.textBox&&(ep=eC),ed.verticalTextBox&&(ep=eI),it(en.textCollisionBox.collisionVertexArray,ey.text.placed,!es||ep,eE.text,ec.x,ec.y)}}if(ed.iconBox||ed.verticalIconBox){let es;let ep=!!(!eI&&ed.verticalIconBox);ed.iconBox&&(es=ep),ed.verticalIconBox&&(es=!ep),it(en.iconCollisionBox.collisionVertexArray,ey.icon.placed,es,eE.icon,ew?ec.x:0,ew?ec.y:0)}}}}if(en.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[en.bucketInstanceId]&&(this.retainedQueryData[en.bucketInstanceId].featureSortOrder=en.featureSortOrder),en.hasTextData()&&en.text.opacityVertexBuffer&&en.text.opacityVertexBuffer.updateData(en.text.opacityVertexArray),en.hasIconData()&&en.icon.opacityVertexBuffer&&en.icon.opacityVertexBuffer.updateData(en.icon.opacityVertexArray),en.hasIconCollisionBoxData()&&en.iconCollisionBox.collisionVertexBuffer&&en.iconCollisionBox.collisionVertexBuffer.updateData(en.iconCollisionBox.collisionVertexArray),en.hasTextCollisionBoxData()&&en.textCollisionBox.collisionVertexBuffer&&en.textCollisionBox.collisionVertexBuffer.updateData(en.textCollisionBox.collisionVertexArray),en.text.opacityVertexArray.length!==en.text.layoutVertexArray.length/4)throw Error(`bucket.text.opacityVertexArray.length (= ${en.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${en.text.layoutVertexArray.length}) / 4`);if(en.icon.opacityVertexArray.length!==en.icon.layoutVertexArray.length/4)throw Error(`bucket.icon.opacityVertexArray.length (= ${en.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${en.icon.layoutVertexArray.length}) / 4`);en.bucketInstanceId in this.collisionCircleArrays&&(en.collisionCircleArray=this.collisionCircleArrays[en.bucketInstanceId],delete this.collisionCircleArrays[en.bucketInstanceId])}symbolFadeChange(en){return 0===this.fadeDuration?1:(en-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(en){return Math.max(0,(this.transform.zoom-en)/1.5)}hasTransitions(en){return this.stale||en-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(en,es){let ec=this.zoomAtLastRecencyCheck===es?1-this.zoomAdjustment(es):1;return this.zoomAtLastRecencyCheck=es,this.commitTime+this.fadeDuration*ec>en}setStale(){this.stale=!0}};function it(en,es,ec,ed,ep,ef){ed&&0!==ed.length||(ed=[0,0,0,0]);let em=ed[0]-100,e_=ed[1]-100,eg=ed[2]-100,ey=ed[3]-100;en.emplaceBack(es?1:0,ec?1:0,ep||0,ef||0,em,e_),en.emplaceBack(es?1:0,ec?1:0,ep||0,ef||0,eg,e_),en.emplaceBack(es?1:0,ec?1:0,ep||0,ef||0,eg,ey),en.emplaceBack(es?1:0,ec?1:0,ep||0,ef||0,em,ey)}function ht(en){if(0===en.opacity&&!en.placed)return 0;if(1===en.opacity&&en.placed)return 4294967295;let es=en.placed?1:0,ec=Math.floor(127*en.opacity);return 33554432*ec+16777216*es+131072*ec+65536*es+512*ec+256*es+2*ec+es}let eL=0;let dt=class dt{constructor(en){this._sortAcrossTiles="viewport-y"!==en.layout.get("symbol-z-order")&&!en.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(en,es,ec,ed,ep){let ef=this._bucketParts;for(;this._currentTileIndex<en.length;)if(es.getBucketParts(ef,ed,en[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,ep())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,ef.sort((en,es)=>en.sortKey-es.sortKey));this._currentPartIndex<ef.length;)if(es.placeLayerBucketPart(ef[this._currentPartIndex],this._seenCrossTileIDs,ec),this._currentPartIndex++,ep())return!0;return!1}};let _t=class _t{constructor(en,es,ec,ed,ep,ef,em,e_){this.placement=new tt(en,es,ef,em,e_),this._currentPlacementIndex=ec.length-1,this._forceFullPlacement=ed,this._showCollisionBoxes=ep,this._done=!1}isDone(){return this._done}continuePlacement(en,es,ec){let ed=ev.now(),r=()=>!this._forceFullPlacement&&ev.now()-ed>2;for(;this._currentPlacementIndex>=0;){let ed=es[en[this._currentPlacementIndex]],ep=this.placement.collisionIndex.transform.zoom;if("symbol"===ed.type&&(!ed.minzoom||ed.minzoom<=ep)&&(!ed.maxzoom||ed.maxzoom>ep)){if(this._inProgressLayer||(this._inProgressLayer=new dt(ed)),this._inProgressLayer.continuePlacement(ec[ed.source],this.placement,this._showCollisionBoxes,ed,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(en){return this.placement.commit(en),this.placement}};let eB=512/es.$/2;let mt=class mt{constructor(en,ec,ed){this.tileID=en,this.bucketInstanceId=ed,this._symbolsByKey={};let ep=new Map;for(let en=0;en<ec.length;en++){let es=ec.get(en),ed=es.key,ef=ep.get(ed);ef?ef.push(es):ep.set(ed,[es])}for(let[en,ec]of ep){let ed={positions:ec.map(en=>({x:Math.floor(en.anchorX*eB),y:Math.floor(en.anchorY*eB)})),crossTileIDs:ec.map(en=>en.crossTileID)};if(ed.positions.length>128){let en=new es.aI(ed.positions.length,16,Uint16Array);for(let{x:es,y:ec}of ed.positions)en.add(es,ec);en.finish(),delete ed.positions,ed.index=en}this._symbolsByKey[en]=ed}}getScaledCoordinates(en,ec){let{x:ed,y:ep,z:ef}=this.tileID.canonical,{x:em,y:e_,z:eg}=ec.canonical,ey=eB/Math.pow(2,eg-ef),ex=(e_*es.$+en.anchorY)*ey,ev=ep*es.$*eB;return{x:Math.floor((em*es.$+en.anchorX)*ey-ed*es.$*eB),y:Math.floor(ex-ev)}}findMatches(en,es,ec){let ed=this.tileID.canonical.z<es.canonical.z?1:Math.pow(2,this.tileID.canonical.z-es.canonical.z);for(let ep=0;ep<en.length;ep++){let ef=en.get(ep);if(ef.crossTileID)continue;let em=this._symbolsByKey[ef.key];if(!em)continue;let e_=this.getScaledCoordinates(ef,es);if(em.index){let en=em.index.range(e_.x-ed,e_.y-ed,e_.x+ed,e_.y+ed).sort();for(let es of en){let en=em.crossTileIDs[es];if(!ec[en]){ec[en]=!0,ef.crossTileID=en;break}}}else if(em.positions)for(let en=0;en<em.positions.length;en++){let es=em.positions[en],ep=em.crossTileIDs[en];if(Math.abs(es.x-e_.x)<=ed&&Math.abs(es.y-e_.y)<=ed&&!ec[ep]){ec[ep]=!0,ef.crossTileID=ep;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:en})=>en)}};let ft=class ft{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}};let gt=class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(en){let es=Math.round((en-this.lng)/360);if(0!==es)for(let en in this.indexes){let ec=this.indexes[en],ed={};for(let en in ec){let ep=ec[en];ep.tileID=ep.tileID.unwrapTo(ep.tileID.wrap+es),ed[ep.tileID.key]=ep}this.indexes[en]=ed}this.lng=en}addBucket(en,es,ec){if(this.indexes[en.overscaledZ]&&this.indexes[en.overscaledZ][en.key]){if(this.indexes[en.overscaledZ][en.key].bucketInstanceId===es.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(en.overscaledZ,this.indexes[en.overscaledZ][en.key])}for(let en=0;en<es.symbolInstances.length;en++)es.symbolInstances.get(en).crossTileID=0;this.usedCrossTileIDs[en.overscaledZ]||(this.usedCrossTileIDs[en.overscaledZ]={});let ed=this.usedCrossTileIDs[en.overscaledZ];for(let ec in this.indexes){let ep=this.indexes[ec];if(Number(ec)>en.overscaledZ)for(let ec in ep){let ef=ep[ec];ef.tileID.isChildOf(en)&&ef.findMatches(es.symbolInstances,en,ed)}else{let ef=ep[en.scaledTo(Number(ec)).key];ef&&ef.findMatches(es.symbolInstances,en,ed)}}for(let en=0;en<es.symbolInstances.length;en++){let ep=es.symbolInstances.get(en);ep.crossTileID||(ep.crossTileID=ec.generate(),ed[ep.crossTileID]=!0)}return void 0===this.indexes[en.overscaledZ]&&(this.indexes[en.overscaledZ]={}),this.indexes[en.overscaledZ][en.key]=new mt(en,es.symbolInstances,es.bucketInstanceId),!0}removeBucketCrossTileIDs(en,es){for(let ec of es.getCrossTileIDsLists())for(let es of ec)delete this.usedCrossTileIDs[en][es]}removeStaleBuckets(en){let es=!1;for(let ec in this.indexes){let ed=this.indexes[ec];for(let ep in ed)en[ed[ep].bucketInstanceId]||(this.removeBucketCrossTileIDs(ec,ed[ep]),delete ed[ep],es=!0)}return es}};let vt=class vt{constructor(){this.layerIndexes={},this.crossTileIDs=new ft,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(en,es,ec){let ed=this.layerIndexes[en.id];void 0===ed&&(ed=this.layerIndexes[en.id]=new gt);let ep=!1,ef={};for(let em of(ed.handleWrapJump(ec),es)){let es=em.getBucket(en);es&&en.id===es.layerIds[0]&&(es.bucketInstanceId||(es.bucketInstanceId=++this.maxBucketInstanceId),ed.addBucket(em.tileID,es,this.crossTileIDs)&&(ep=!0),ef[es.bucketInstanceId]=!0)}return ed.removeStaleBuckets(ef)&&(ep=!0),ep}pruneUnusedLayers(en){let es={};for(let ec in en.forEach(en=>{es[en]=!0}),this.layerIndexes)es[ec]||delete this.layerIndexes[ec]}};var eF="void main() {fragColor=vec4(1.0);}";let eO={prelude:yt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:yt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:yt("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:yt("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:yt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yt("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:yt(eF,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:yt("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:yt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:yt(eF,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:yt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:yt("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:yt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:yt("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yt("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:yt("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:yt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:yt("uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),raster:yt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:yt("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:yt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:yt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:yt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:yt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:yt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:yt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:yt("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:yt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function yt(en,es){let ec=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,ed=es.match(/in ([\w]+) ([\w]+)/g),ep=en.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),ef=es.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),em=ef?ef.concat(ep):ep,e_={};return{fragmentSource:en=en.replace(ec,(en,es,ec,ed,ep)=>(e_[ep]=!0,"define"===es?`
#ifndef HAS_UNIFORM_u_${ep}
in ${ec} ${ed} ${ep};
#else
uniform ${ec} ${ed} u_${ep};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ep}
    ${ec} ${ed} ${ep} = u_${ep};
#endif
`)),vertexSource:es=es.replace(ec,(en,es,ec,ed,ep)=>{let ef="float"===ed?"vec2":"vec4",em=ep.match(/color/)?"color":ef;return e_[ep]?"define"===es?`
#ifndef HAS_UNIFORM_u_${ep}
uniform lowp float u_${ep}_t;
in ${ec} ${ef} a_${ep};
out ${ec} ${ed} ${ep};
#else
uniform ${ec} ${ed} u_${ep};
#endif
`:"vec4"===em?`
#ifndef HAS_UNIFORM_u_${ep}
    ${ep} = a_${ep};
#else
    ${ec} ${ed} ${ep} = u_${ep};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ep}
    ${ep} = unpack_mix_${em}(a_${ep}, u_${ep}_t);
#else
    ${ec} ${ed} ${ep} = u_${ep};
#endif
`:"define"===es?`
#ifndef HAS_UNIFORM_u_${ep}
uniform lowp float u_${ep}_t;
in ${ec} ${ef} a_${ep};
#else
uniform ${ec} ${ed} u_${ep};
#endif
`:"vec4"===em?`
#ifndef HAS_UNIFORM_u_${ep}
    ${ec} ${ed} ${ep} = a_${ep};
#else
    ${ec} ${ed} ${ep} = u_${ep};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ep}
    ${ec} ${ed} ${ep} = unpack_mix_${em}(a_${ep}, u_${ep}_t);
#else
    ${ec} ${ed} ${ep} = u_${ep};
#endif
`}),staticAttributes:ed,staticUniforms:em}}let wt=class wt{constructor(en,es,ec){this.vertexBuffer=en,this.indexBuffer=es,this.segments=ec}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}};var ej=es.aJ([{name:"a_pos",type:"Int16",components:2}]);let eV="#define PROJECTION_MERCATOR",eU="mercator";let It=class It{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return eU}get shaderDefine(){return eV}get shaderPreludeCode(){return eO.projectionMercator}get vertexShaderPreludeCode(){return eO.projectionMercator.vertexSource}get subdivisionGranularity(){return es.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(en){}getMeshFromTileID(en,ec,ed,ep,ef){if(this._cachedMesh)return this._cachedMesh;let em=new es.aL;em.emplaceBack(0,0),em.emplaceBack(es.$,0),em.emplaceBack(0,es.$),em.emplaceBack(es.$,es.$);let e_=en.createVertexBuffer(em,ej.members),eg=es.aM.simpleSegment(0,0,4,2),ey=new es.aN;ey.emplaceBack(1,0,2),ey.emplaceBack(1,2,3);let ex=en.createIndexBuffer(ey);return this._cachedMesh=new wt(e_,ex,eg),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(en){}};let Mt=class Mt{constructor(en=0,es=0,ec=0,ed=0){if(isNaN(en)||en<0||isNaN(es)||es<0||isNaN(ec)||ec<0||isNaN(ed)||ed<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=en,this.bottom=es,this.left=ec,this.right=ed}interpolate(en,ec,ed){return null!=ec.top&&null!=en.top&&(this.top=es.C.number(en.top,ec.top,ed)),null!=ec.bottom&&null!=en.bottom&&(this.bottom=es.C.number(en.bottom,ec.bottom,ed)),null!=ec.left&&null!=en.left&&(this.left=es.C.number(en.left,ec.left,ed)),null!=ec.right&&null!=en.right&&(this.right=es.C.number(en.right,ec.right,ed)),this}getCenter(en,ec){let ed=es.ah((this.left+en-this.right)/2,0,en),ep=es.ah((this.top+ec-this.bottom)/2,0,ec);return new es.P(ed,ep)}equals(en){return this.top===en.top&&this.bottom===en.bottom&&this.left===en.left&&this.right===en.right}clone(){return new Mt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}};function St(en,es){if(!en.renderWorldCopies||en.lngRange)return;let ec=es.lng-en.center.lng;es.lng+=ec>180?-360:ec<-180?360:0}function Et(en){return Math.max(0,Math.floor(en))}let Rt=class Rt{constructor(en,ec,ed,ep,ef,em){this._callbacks=en,this._tileSize=512,this._renderWorldCopies=void 0===em||!!em,this._minZoom=ec||0,this._maxZoom=ed||22,this._minPitch=null==ep?0:ep,this._maxPitch=null==ef?60:ef,this.setMaxBounds(),this._width=0,this._height=0,this._center=new es.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Et(this._zoom),this._scale=es.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Mt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(en,ec,ed){this._latRange=en.latRange,this._lngRange=en.lngRange,this._width=en.width,this._height=en.height,this._center=en.center,this._elevation=en.elevation,this._minElevationForCurrentTile=en.minElevationForCurrentTile,this._zoom=en.zoom,this._tileZoom=Et(this._zoom),this._scale=es.af(this._zoom),this._bearingInRadians=en.bearingInRadians,this._fovInRadians=en.fovInRadians,this._pitchInRadians=en.pitchInRadians,this._rollInRadians=en.rollInRadians,this._unmodified=en.unmodified,this._edgeInsets=new Mt(en.padding.top,en.padding.bottom,en.padding.left,en.padding.right),this._minZoom=en.minZoom,this._maxZoom=en.maxZoom,this._minPitch=en.minPitch,this._maxPitch=en.maxPitch,this._renderWorldCopies=en.renderWorldCopies,this._cameraToCenterDistance=en.cameraToCenterDistance,this._nearZ=en.nearZ,this._farZ=en.farZ,this._autoCalculateNearFarZ=!ed&&en.autoCalculateNearFarZ,ec&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(en){this._minElevationForCurrentTile=en}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(en){this._minZoom!==en&&(this._minZoom=en,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(en){this._maxZoom!==en&&(this._maxZoom=en,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(en){this._minPitch!==en&&(this._minPitch=en,this.setPitch(Math.max(this.pitch,en)))}get maxPitch(){return this._maxPitch}setMaxPitch(en){this._maxPitch!==en&&(this._maxPitch=en,this.setPitch(Math.min(this.pitch,en)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(en){void 0===en?en=!0:null===en&&(en=!1),this._renderWorldCopies=en}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new es.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(en){var ec,ed,ep,ef,em,e_,eg,ey,ex;let ev=es.aO(en,-180,180)*Math.PI/180;this._bearingInRadians!==ev&&(this._unmodified=!1,this._bearingInRadians=ev,this._calcMatrices(),this._rotationMatrix=o(),ec=this._rotationMatrix,ep=-this._bearingInRadians,ef=(ed=this._rotationMatrix)[0],em=ed[1],e_=ed[2],eg=ed[3],ey=Math.sin(ep),ex=Math.cos(ep),ec[0]=ef*ex+e_*ey,ec[1]=em*ex+eg*ey,ec[2]=-(ef*ey)+e_*ex,ec[3]=-(em*ey)+eg*ex)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(en){let ec=es.ah(en,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==ec&&(this._unmodified=!1,this._pitchInRadians=ec,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(en){let es=en/180*Math.PI;this._rollInRadians!==es&&(this._unmodified=!1,this._rollInRadians=es,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return es.aP(this._fovInRadians)}setFov(en){en=es.ah(en,.1,150),this.fov!==en&&(this._unmodified=!1,this._fovInRadians=es.ae(en),this._calcMatrices())}get zoom(){return this._zoom}setZoom(en){let ec=this.getConstrained(this._center,en).zoom;this._zoom!==ec&&(this._unmodified=!1,this._zoom=ec,this._tileZoom=Math.max(0,Math.floor(ec)),this._scale=es.af(ec),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(en){en.lat===this._center.lat&&en.lng===this._center.lng||(this._unmodified=!1,this._center=en,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(en){en!==this._elevation&&(this._elevation=en,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(en){this._edgeInsets.equals(en)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,en,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(en,es){this._autoCalculateNearFarZ=!1,this._nearZ=en,this._farZ=es,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(en){return this._edgeInsets.equals(en)}interpolatePadding(en,es,ec){this._unmodified=!1,this._edgeInsets.interpolate(en,es,ec),this._constrain(),this._calcMatrices()}resize(en,es,ec=!0){this._width=en,this._height=es,ec&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new G([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(en){en?(this._lngRange=[en.getWest(),en.getEast()],this._latRange=[en.getSouth(),en.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-es.ai,es.ai])}getConstrained(en,es){return this._callbacks.getConstrained(en,es)}getCameraQueryGeometry(en,ec){if(1===ec.length)return[ec[0],en];{let{minX:ed,minY:ep,maxX:ef,maxY:em}=es.a2.fromPoints(ec).extend(en);return[new es.P(ed,ep),new es.P(ef,ep),new es.P(ef,em),new es.P(ed,em),new es.P(ed,ep)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let en=this._unmodified,{center:es,zoom:ec}=this.getConstrained(this.center,this.zoom);this.setCenter(es),this.setZoom(ec),this._unmodified=en,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let en=es.ag(new Float64Array(16));es.N(en,en,[this._width/2,-this._height/2,1]),es.M(en,en,[1,-1,0]),this._clipSpaceToPixelsMatrix=en,en=es.ag(new Float64Array(16)),es.N(en,en,[1,-1,1]),es.M(en,en,[-1,-1,0]),es.N(en,en,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=en,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(en,ec,ed,ep){let ef;let em=void 0!==ed?ed:this.bearing,e_=ep=void 0!==ep?ep:this.pitch,eg=es.a1.fromLngLat(en,ec),ey=-Math.cos(es.ae(e_)),ex=Math.sin(es.ae(e_)),ev=ex*Math.sin(es.ae(em)),eb=-ex*Math.cos(es.ae(em)),ew=this.elevation,eT=ec-ew;ey*eT>=0||.1>Math.abs(ey)?ew=ec+(ef=1e4)*ey:ef=-eT/ey;let eP,eS,eM=es.aQ(1,eg.y),eC=0;do{if((eC+=1)>10)break;eS=ef/eM,eM=1/(eP=new es.a1(eg.x+ev*eS,eg.y+eb*eS)).meterInMercatorCoordinateUnits()}while(Math.abs(ef-eS*eM)>1e-12);return{center:eP.toLngLat(),elevation:ew,zoom:es.ak(this.height/2/Math.tan(this.fovInRadians/2)/eS/this.tileSize)}}recalculateZoomAndCenter(en){if(this.elevation-en==0)return;let ec=es.aj(1,this.center.lat)*this.worldSize,ed=this.cameraToCenterDistance/ec,ep=es.a1.fromLngLat(this.center,this.elevation),ef=de(this.center,this.elevation,this.pitch,this.bearing,ed);this._elevation=en;let em=this.calculateCenterFromCameraLngLatAlt(ef.toLngLat(),es.aQ(ef.z,ep.y),this.bearing,this.pitch);this._elevation=em.elevation,this._center=em.center,this.setZoom(em.zoom)}getCameraPoint(){let en=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new es.P(en*Math.sin(this.rollInRadians),en*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let en=es.aj(1,this.center.lat)*this.worldSize;return de(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/en).toLngLat()}getMercatorTileCoordinates(en){if(!en)return[0,0,1,1];let ec=en.canonical.z>=0?1<<en.canonical.z:Math.pow(2,en.canonical.z);return[en.canonical.x/ec,en.canonical.y/ec,1/ec/es.$,1/ec/es.$]}};let zt=class zt{constructor(en,ec){this.min=en,this.max=ec,this.center=es.aR([],es.aS([],this.min,this.max),.5)}quadrant(en){let ec=[en%2==0,en<2],ed=es.aT(this.min),ep=es.aT(this.max);for(let en=0;en<ec.length;en++)ed[en]=ec[en]?this.min[en]:this.center[en],ep[en]=ec[en]?this.center[en]:this.max[en];return ep[2]=this.max[2],new zt(ed,ep)}distanceX(en){return Math.max(Math.min(this.max[0],en[0]),this.min[0])-en[0]}distanceY(en){return Math.max(Math.min(this.max[1],en[1]),this.min[1])-en[1]}intersectsFrustum(en){let es=!0;for(let ec=0;ec<en.planes.length;ec++){let ed=this.intersectsPlane(en.planes[ec]);if(0===ed)return 0;1===ed&&(es=!1)}return es?2:en.aabb.min[0]>this.max[0]||en.aabb.min[1]>this.max[1]||en.aabb.min[2]>this.max[2]||en.aabb.max[0]<this.min[0]||en.aabb.max[1]<this.min[1]||en.aabb.max[2]<this.min[2]?0:1}intersectsPlane(en){let es=en[3],ec=en[3];for(let ed=0;ed<3;ed++)en[ed]>0?(es+=en[ed]*this.min[ed],ec+=en[ed]*this.max[ed]):(ec+=en[ed]*this.min[ed],es+=en[ed]*this.max[ed]);return es>=0?2:ec<0?0:1}};let Dt=class Dt{distanceToTile2d(en,es,ec,ed){let ep=ed.distanceX([en,es]),ef=ed.distanceY([en,es]);return Math.hypot(ep,ef)}getWrap(en,es,ec){return ec}getTileBoundingVolume(en,ec,ed,ep){var ef,em;let e_=0,eg=0;if(null==ep?void 0:ep.terrain){let ey=new es.Z(en.z,ec,en.z,en.x,en.y),ex=ep.terrain.getMinMaxElevation(ey);e_=null!==(ef=ex.minElevation)&&void 0!==ef?ef:Math.min(0,ed),eg=null!==(em=ex.maxElevation)&&void 0!==em?em:Math.max(0,ed)}let ey=1<<en.z;return new zt([ec+en.x/ey,en.y/ey,e_],[ec+(en.x+1)/ey,(en.y+1)/ey,eg])}allowVariableZoom(en,ec){let ed=en.fov*(Math.abs(Math.cos(en.rollInRadians))*en.height+Math.abs(Math.sin(en.rollInRadians))*en.width)/en.height,ep=es.ah(78.5-ed/2,0,60);return!!ec.terrain||en.pitch>ep}allowWorldCopies(){return!0}prepareNextFrame(){}};let At=class At{constructor(en,es,ec){this.points=en,this.planes=es,this.aabb=ec}static fromInvProjectionMatrix(en,ec=1,ed=0,ep,ef){let em=ef?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],e_=Math.pow(2,ed),eg=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ed=>(function(en,ec,ed,ep){let ef=es.aw([],en,ec),em=1/ef[3]/ed*ep;return es.aY(ef,ef,[em,em,1/ef[3],em])})(ed,en,ec,e_));ep&&function(en,ec,ed,ep){let ef=ep?4:0,em=ep?0:4,e_=0,eg=[],ey=[];for(let ec=0;ec<4;ec++){let ed=es.aU([],en[ec+em],en[ec+ef]),ep=es.aZ(ed);es.aR(ed,ed,1/ep),eg.push(ep),ey.push(ed)}for(let ec=0;ec<4;ec++){let ep=es.a_(en[ec+ef],ey[ec],ed);e_=null!==ep&&ep>=0?Math.max(e_,ep):Math.max(e_,eg[ec])}let ex=function(en,ec){let ed=es.aU([],en[ec[0]],en[ec[1]]),ep=es.aU([],en[ec[2]],en[ec[1]]),ef=[0,0,0,0];return es.aV(ef,es.aW([],ed,ep)),ef[3]=-es.aX(ef,en[ec[0]]),ef}(en,ec),ev=function(en,ec){let ed=es.a$(en),ep=es.b0([],en,1/ed),ef=es.aU([],ec,es.aR([],ep,es.aX(ec,ep))),em=es.a$(ef);if(em>0){let en=Math.sqrt(1-ep[3]*ep[3]),ed=es.aR([],ep,-ep[3]),e_=es.aS([],ed,es.aR([],ef,en/em));return es.b1(ec,e_)}return null}(ed,ex);if(null!==ev){let en=ev/es.aX(ey[0],ex);e_=Math.min(e_,en)}for(let es=0;es<4;es++){let ec=Math.min(e_,eg[es]);en[es+em]=[en[es+ef][0]+ey[es][0]*ec,en[es+ef][1]+ey[es][1]*ec,en[es+ef][2]+ey[es][2]*ec,1]}}(eg,em[0],ep,ef);let ey=em.map(en=>{let ec=es.aU([],eg[en[0]],eg[en[1]]),ed=es.aU([],eg[en[2]],eg[en[1]]),ep=es.aV([],es.aW([],ec,ed)),ef=-es.aX(ep,eg[en[1]]);return ep.concat(ef)}),ex=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ev=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let en of eg)for(let es=0;es<3;es++)ex[es]=Math.min(ex[es],en[es]),ev[es]=Math.max(ev[es],en[es]);return new At(eg,ey,new zt(ex,ev))}};let Lt=class Lt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(en){this._helper.setMinZoom(en)}setMaxZoom(en){this._helper.setMaxZoom(en)}setMinPitch(en){this._helper.setMinPitch(en)}setMaxPitch(en){this._helper.setMaxPitch(en)}setRenderWorldCopies(en){this._helper.setRenderWorldCopies(en)}setBearing(en){this._helper.setBearing(en)}setPitch(en){this._helper.setPitch(en)}setRoll(en){this._helper.setRoll(en)}setFov(en){this._helper.setFov(en)}setZoom(en){this._helper.setZoom(en)}setCenter(en){this._helper.setCenter(en)}setElevation(en){this._helper.setElevation(en)}setMinElevationForCurrentTile(en){this._helper.setMinElevationForCurrentTile(en)}setPadding(en){this._helper.setPadding(en)}interpolatePadding(en,es,ec){return this._helper.interpolatePadding(en,es,ec)}isPaddingEqual(en){return this._helper.isPaddingEqual(en)}resize(en,es,ec=!0){this._helper.resize(en,es,ec)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(en){this._helper.setMaxBounds(en)}overrideNearFarZ(en,es){this._helper.overrideNearFarZ(en,es)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(en){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),en)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(en,es){}constructor(en,es,ec,ed,ep){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Rt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(en,es)=>this.getConstrained(en,es)},en,es,ec,ed,ep),this._coveringTilesDetailsProvider=new Dt}clone(){let en=new Lt;return en.apply(this),en}apply(en,es,ec){this._helper.apply(en,es,ec)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(en){let ec=[new es.b2(0,en)];if(this._helper._renderWorldCopies){let ed=this.screenPointToMercatorCoordinate(new es.P(0,0)),ep=this.screenPointToMercatorCoordinate(new es.P(this._helper._width,0)),ef=this.screenPointToMercatorCoordinate(new es.P(this._helper._width,this._helper._height)),em=this.screenPointToMercatorCoordinate(new es.P(0,this._helper._height)),e_=Math.floor(Math.min(ed.x,ep.x,ef.x,em.x)),eg=Math.floor(Math.max(ed.x,ep.x,ef.x,em.x));for(let ed=e_-1;ed<=eg+1;ed++)0!==ed&&ec.push(new es.b2(ed,en))}return ec}getCameraFrustum(){return At.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(en){let es=this.screenPointToLocation(this.centerPoint,en),ec=en?en.getElevationForLngLatZoom(es,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(ec)}setLocationAtPoint(en,ec){let ed=es.aj(this.elevation,this.center.lat),ep=this.screenPointToMercatorCoordinateAtZ(ec,ed),ef=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,ed),em=es.a1.fromLngLat(en),e_=new es.a1(em.x-(ep.x-ef.x),em.y-(ep.y-ef.y));this.setCenter(null==e_?void 0:e_.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(en,ec){return ec?this.coordinatePoint(es.a1.fromLngLat(en),ec.getElevationForLngLatZoom(en,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(es.a1.fromLngLat(en))}screenPointToLocation(en,es){var ec;return null===(ec=this.screenPointToMercatorCoordinate(en,es))||void 0===ec?void 0:ec.toLngLat()}screenPointToMercatorCoordinate(en,es){if(es){let ec=es.pointCoordinate(en);if(null!=ec)return ec}return this.screenPointToMercatorCoordinateAtZ(en)}screenPointToMercatorCoordinateAtZ(en,ec){let ed=ec||0,ep=[en.x,en.y,0,1],ef=[en.x,en.y,1,1];es.aw(ep,ep,this._pixelMatrixInverse),es.aw(ef,ef,this._pixelMatrixInverse);let em=ep[3],e_=ef[3],eg=ep[1]/em,ey=ef[1]/e_,ex=ep[2]/em,ev=ef[2]/e_,eb=ex===ev?0:(ed-ex)/(ev-ex);return new es.a1(es.C.number(ep[0]/em,ef[0]/e_,eb)/this.worldSize,es.C.number(eg,ey,eb)/this.worldSize,ed)}coordinatePoint(en,ec=0,ed=this._pixelMatrix){let ep=[en.x*this.worldSize,en.y*this.worldSize,ec,1];return es.aw(ep,ep,ed),new es.P(ep[0]/ep[3],ep[1]/ep[3])}getBounds(){let en=Math.max(0,this._helper._height/2-he(this));return(new G).extend(this.screenPointToLocation(new es.P(0,en))).extend(this.screenPointToLocation(new es.P(this._helper._width,en))).extend(this.screenPointToLocation(new es.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new es.P(0,this._helper._height)))}isPointOnMapSurface(en,es){return es?null!=es.pointCoordinate(en):en.y>this.height/2-he(this)}calculatePosMatrix(en,ec=!1,ed){var ep;let ef=null!==(ep=en.key)&&void 0!==ep?ep:es.b3(en.wrap,en.canonical.z,en.canonical.z,en.canonical.x,en.canonical.y),em=ec?this._alignedPosMatrixCache:this._posMatrixCache;if(em.has(ef)){let en=em.get(ef);return ed?en.f32:en.f64}let e_=ue(en,this.worldSize);es.O(e_,ec?this._alignedProjMatrix:this._viewProjMatrix,e_);let eg={f64:e_,f32:new Float32Array(e_)};return em.set(ef,eg),ed?eg.f32:eg.f64}calculateFogMatrix(en){let ec=en.key,ed=this._fogMatrixCacheF32;if(ed.has(ec))return ed.get(ec);let ep=ue(en,this.worldSize);return es.O(ep,this._fogMatrix,ep),ed.set(ec,new Float32Array(ep)),ed.get(ec)}getConstrained(en,ec){let ed,ep;ec=es.ah(+ec,this.minZoom,this.maxZoom);let ef={center:new es.S(en.lng,en.lat),zoom:ec},em=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===em){let en=180-1e-10;em=[-en,en]}let e_=this.tileSize*es.af(ef.zoom),eg=0,ey=e_,ex=0,ev=e_,eb=0,ew=0,{x:eT,y:eP}=this.size;if(this._helper._latRange){let en=this._helper._latRange;eg=es.U(en[1])*e_,(ey=es.U(en[0])*e_)-eg<eP&&(eb=eP/(ey-eg))}em&&(ex=es.aO(es.V(em[0])*e_,0,e_),(ev=es.aO(es.V(em[1])*e_,0,e_))<ex&&(ev+=e_),ev-ex<eT&&(ew=eT/(ev-ex)));let{x:eS,y:eM}=le(e_,en),eC=Math.max(ew||0,eb||0);if(eC){let en=new es.P(ew?(ev+ex)/2:eS,eb?(ey+eg)/2:eM);return ef.center=ce(e_,en).wrap(),ef.zoom+=es.ak(eC),ef}if(this._helper._latRange){let en=eP/2;eM-en<eg&&(ep=eg+en),eM+en>ey&&(ep=ey-en)}if(em){let en=(ex+ev)/2,ec=eS;this._helper._renderWorldCopies&&(ec=es.aO(eS,en-e_/2,en+e_/2));let ep=eT/2;ec-ep<ex&&(ed=ex+ep),ec+ep>ev&&(ed=ev-ep)}if(void 0!==ed||void 0!==ep){let en=new es.P(null!=ed?ed:eS,null!=ep?ep:eM);ef.center=ce(e_,en).wrap()}return ef}calculateCenterFromCameraLngLatAlt(en,es,ec,ed){return this._helper.calculateCenterFromCameraLngLatAlt(en,es,ec,ed)}_calculateNearFarZIfNeeded(en,ec,ed){if(!this._helper.autoCalculateNearFarZ)return;let ep=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),ef=en-ep*this._helper._pixelPerMeter/Math.cos(ec),em=ep<0?ef:en,e_=Math.PI/2+this.pitchInRadians,eg=es.ae(this.fov)*(Math.abs(Math.cos(es.ae(this.roll)))*this.height+Math.abs(Math.sin(es.ae(this.roll)))*this.width)/this.height*(.5+ed.y/this.height),ey=Math.sin(eg)*em/Math.sin(es.ah(Math.PI-e_-eg,.01,Math.PI-.01)),ex=he(this),ev=Math.atan(ex/this._helper.cameraToCenterDistance),eb=es.ae(.75),ew=ev>eb?2*ev*(.5+ed.y/(2*ex)):eb,eT=Math.sin(ew)*em/Math.sin(es.ah(Math.PI-e_-ew,.01,Math.PI-.01));this._helper._farZ=1.01*(Math.cos(Math.PI/2-ec)*Math.min(ey,eT)+em),this._helper._nearZ=this._helper._height/50}_calcMatrices(){let en;if(!this._helper._height)return;let ec=this.centerOffset,ed=le(this.worldSize,this.center),ep=ed.x,ef=ed.y;this._helper._pixelPerMeter=es.aj(1,this.center.lat)*this.worldSize;let em=es.ae(Math.min(this.pitch,89.25)),e_=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(em));this._calculateNearFarZIfNeeded(e_,em,ec),en=new Float64Array(16),es.b4(en,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),es.aq(this._invProjMatrix,en),en[8]=-(2*ec.x)/this._helper._width,en[9]=2*ec.y/this._helper._height,this._projectionMatrix=es.b5(en),es.N(en,en,[1,-1,1]),es.M(en,en,[0,0,-this._helper.cameraToCenterDistance]),es.b6(en,en,-this.rollInRadians),es.b7(en,en,this.pitchInRadians),es.b6(en,en,-this.bearingInRadians),es.M(en,en,[-ep,-ef,0]),this._mercatorMatrix=es.N([],en,[this.worldSize,this.worldSize,this.worldSize]),es.N(en,en,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=es.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,en),es.M(en,en,[0,0,-this.elevation]),this._viewProjMatrix=en,this._invViewProjMatrix=es.aq([],en);let eg=[0,0,-1,1];es.aw(eg,eg,this._invViewProjMatrix),this._cameraPosition=[eg[0]/eg[3],eg[1]/eg[3],eg[2]/eg[3]],this._fogMatrix=new Float64Array(16),es.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,e_,this._helper._farZ),this._fogMatrix[8]=-(2*ec.x)/this.width,this._fogMatrix[9]=2*ec.y/this.height,es.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),es.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),es.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),es.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),es.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),es.M(this._fogMatrix,this._fogMatrix,[-ep,-ef,0]),es.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),es.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=es.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,en);let ey=this._helper._width%2/2,ex=this._helper._height%2/2,ev=Math.cos(this.bearingInRadians),eb=Math.sin(-this.bearingInRadians),ew=ep-Math.round(ep)+ev*ey+eb*ex,eT=ef-Math.round(ef)+ev*ex+eb*ey,eP=new Float64Array(en);if(es.M(eP,eP,[ew>.5?ew-1:ew,eT>.5?eT-1:eT,0]),this._alignedProjMatrix=eP,!(en=es.aq(new Float64Array(16),this._pixelMatrix)))throw Error("failed to invert matrix");this._pixelMatrixInverse=en,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let en=this.screenPointToMercatorCoordinate(new es.P(0,0)),ec=[en.x*this.worldSize,en.y*this.worldSize,0,1];return es.aw(ec,ec,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let en=es.aj(1,this.center.lat)*this.worldSize;return de(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/en).toLngLat()}lngLatToCameraDepth(en,ec){let ed=es.a1.fromLngLat(en),ep=[ed.x*this.worldSize,ed.y*this.worldSize,ec,1];return es.aw(ep,ep,this._viewProjMatrix),ep[2]/ep[3]}getProjectionData(en){let ec;let{overscaledTileID:ed,aligned:ep,applyTerrainMatrix:ef}=en,em=this._helper.getMercatorTileCoordinates(ed),e_=ed?this.calculatePosMatrix(ed,ep,!0):null;return{mainMatrix:ec=ed&&ed.terrainRttPosMatrix32f&&ef?ed.terrainRttPosMatrix32f:e_||es.b8(),tileMercatorCoords:em,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:ec}}isLocationOccluded(en){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(en,es,ec){return 1}transformLightDirection(en){return es.aT(en)}getRayDirectionFromPixel(en){throw Error("Not implemented.")}projectTileCoordinates(en,ec,ed,ep){let ef;let em=this.calculatePosMatrix(ed);ep?(ef=[en,ec,ep(en,ec),1],es.aw(ef,ef,em)):qe(ef=[en,ec,0,1],ef,em);let e_=ef[3];return{point:new es.P(ef[0]/e_,ef[1]/e_),signedDistanceFromCamera:e_,isOccluded:!1}}populateCache(en){for(let es of en)this.calculatePosMatrix(es)}getMatrixForModel(en,ec){let ed=es.a1.fromLngLat(en,ec),ep=ed.meterInMercatorCoordinateUnits(),ef=es.b9();return es.M(ef,ef,[ed.x,ed.y,ed.z]),es.b6(ef,ef,Math.PI),es.b7(ef,ef,Math.PI/2),es.N(ef,ef,[-ep,ep,ep]),ef}getProjectionDataForCustomLayer(en=!0){let ec=new es.Z(0,0,0,0,0),ed=this.getProjectionData({overscaledTileID:ec,applyGlobeMatrix:en}),ep=ue(ec,this.worldSize);es.O(ep,this._viewProjMatrix,ep),ed.tileMercatorCoords=[0,0,1,1];let ef=[es.$,es.$,this.worldSize/this._helper.pixelsPerMeter],em=es.ba();return es.N(em,ep,ef),ed.fallbackMatrix=em,ed.mainMatrix=em,ed}getFastPathSimpleProjectionMatrix(en){return this.calculatePosMatrix(en)}};function kt(){es.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ft(en){if(en.useSlerp){if(en.k<1){let ec=es.bb(en.startEulerAngles.roll,en.startEulerAngles.pitch,en.startEulerAngles.bearing),ed=es.bb(en.endEulerAngles.roll,en.endEulerAngles.pitch,en.endEulerAngles.bearing),ep=new Float64Array(4);es.bc(ep,ec,ed,en.k);let ef=es.bd(ep);en.tr.setRoll(ef.roll),en.tr.setPitch(ef.pitch),en.tr.setBearing(ef.bearing)}else en.tr.setRoll(en.endEulerAngles.roll),en.tr.setPitch(en.endEulerAngles.pitch),en.tr.setBearing(en.endEulerAngles.bearing)}else en.tr.setRoll(es.C.number(en.startEulerAngles.roll,en.endEulerAngles.roll,en.k)),en.tr.setPitch(es.C.number(en.startEulerAngles.pitch,en.endEulerAngles.pitch,en.k)),en.tr.setBearing(es.C.number(en.startEulerAngles.bearing,en.endEulerAngles.bearing,en.k))}function Bt(en,ec,ed,ep,ef){let em=ef.padding,e_=le(ef.worldSize,ed.getNorthWest()),eg=le(ef.worldSize,ed.getNorthEast()),ey=le(ef.worldSize,ed.getSouthEast()),ex=le(ef.worldSize,ed.getSouthWest()),ev=es.ae(-ep),eb=e_.rotate(ev),ew=eg.rotate(ev),eT=ey.rotate(ev),eP=ex.rotate(ev),eS=new es.P(Math.max(eb.x,ew.x,eP.x,eT.x),Math.max(eb.y,ew.y,eP.y,eT.y)),eM=new es.P(Math.min(eb.x,ew.x,eP.x,eT.x),Math.min(eb.y,ew.y,eP.y,eT.y)),eC=eS.sub(eM),eI=(ef.width-(em.left+em.right+ec.left+ec.right))/eC.x,eE=(ef.height-(em.top+em.bottom+ec.top+ec.bottom))/eC.y;if(eE<0||eI<0)return void kt();let eA=Math.min(es.ak(ef.scale*Math.min(eI,eE)),en.maxZoom),ez=es.P.convert(en.offset),ek=new es.P((ec.left-ec.right)/2,(ec.top-ec.bottom)/2).rotate(es.ae(ep)),eD=ez.add(ek).mult(ef.scale/es.af(eA));return{center:ce(ef.worldSize,e_.add(ey).div(2).sub(eD)),zoom:eA,bearing:ep}}let Ot=class Ot{get useGlobeControls(){return!1}handlePanInertia(en,es){let ec=en.mag(),ed=Math.abs(he(es));return{easingOffset:en.mult(Math.min(.75*ed/ec,1)),easingCenter:es.center}}handleMapControlsRollPitchBearingZoom(en,es){en.bearingDelta&&es.setBearing(es.bearing+en.bearingDelta),en.pitchDelta&&es.setPitch(es.pitch+en.pitchDelta),en.rollDelta&&es.setRoll(es.roll+en.rollDelta),en.zoomDelta&&es.setZoom(es.zoom+en.zoomDelta)}handleMapControlsPan(en,es,ec){.01>en.around.distSqr(es.centerPoint)||es.setLocationAtPoint(ec,en.around)}cameraForBoxAndBearing(en,es,ec,ed,ep){return Bt(en,es,ec,ed,ep)}handleJumpToCenterZoom(en,ec){en.zoom!==(void 0!==ec.zoom?+ec.zoom:en.zoom)&&en.setZoom(+ec.zoom),void 0!==ec.center&&en.setCenter(es.S.convert(ec.center))}handleEaseTo(en,ec){let ed=en.zoom,ep=en.padding,ef={roll:en.roll,pitch:en.pitch,bearing:en.bearing},em={roll:void 0===ec.roll?en.roll:ec.roll,pitch:void 0===ec.pitch?en.pitch:ec.pitch,bearing:void 0===ec.bearing?en.bearing:ec.bearing},e_=void 0!==ec.zoom,eg=!en.isPaddingEqual(ec.padding),ey=!1,ex=e_?+ec.zoom:en.zoom,ev=en.centerPoint.add(ec.offsetAsPoint),eb=en.screenPointToLocation(ev),{center:ew,zoom:eT}=en.getConstrained(es.S.convert(ec.center||eb),null!=ex?ex:ed);St(en,ew);let eP=le(en.worldSize,eb),eS=le(en.worldSize,ew).sub(eP),eM=es.af(eT-ed);return{easeFunc:e_=>{if(ey&&en.setZoom(es.C.number(ed,eT,e_)),es.be(ef,em)||Ft({startEulerAngles:ef,endEulerAngles:em,tr:en,k:e_,useSlerp:ef.roll!=em.roll}),eg&&(en.interpolatePadding(ep,ec.padding,e_),ev=en.centerPoint.add(ec.offsetAsPoint)),ec.around)en.setLocationAtPoint(ec.around,ec.aroundPoint);else{let ec=es.af(en.zoom-ed),ep=eT>ed?Math.min(2,eM):Math.max(.5,eM),ef=Math.pow(ep,1-e_),em=ce(en.worldSize,eP.add(eS.mult(e_*ef)).mult(ec));en.setLocationAtPoint(en.renderWorldCopies?em.wrap():em,ev)}},isZooming:ey=eT!==ed,elevationCenter:ew}}handleFlyTo(en,ec){let ed;let ep=void 0!==ec.zoom,ef=en.zoom,em=en.getConstrained(es.S.convert(ec.center||ec.locationAtOffset),ep?+ec.zoom:ef),e_=em.center,eg=em.zoom;St(en,e_);let ey=le(en.worldSize,ec.locationAtOffset),ex=le(en.worldSize,e_).sub(ey),ev=ex.mag(),eb=es.af(eg-ef);if(void 0!==ec.minZoom){let ep=Math.min(+ec.minZoom,ef,eg),em=en.getConstrained(e_,ep).zoom;ed=es.af(em-ef)}return{easeFunc:(ec,ed,ep,em)=>{en.setZoom(1===ec?eg:ef+es.ak(ed));let ev=1===ec?e_:ce(en.worldSize,ey.add(ex.mult(ep)).mult(ed));en.setLocationAtPoint(en.renderWorldCopies?ev.wrap():ev,em)},scaleOfZoom:eb,targetCenter:e_,scaleOfMinZoom:ed,pixelPathLength:ev}}};let jt=class jt{constructor(en,es,ec){this.blendFunction=en,this.blendColor=es,this.mask=ec}};jt.Replace=[1,0],jt.disabled=new jt(jt.Replace,es.bf.transparent,[!1,!1,!1,!1]),jt.unblended=new jt(jt.Replace,es.bf.transparent,[!0,!0,!0,!0]),jt.alphaBlended=new jt([1,771],es.bf.transparent,[!0,!0,!0,!0]);let Ut=class Ut{constructor(en,es,ec){this.enable=en,this.mode=es,this.frontFace=ec}};Ut.disabled=new Ut(!1,1029,2305),Ut.backCCW=new Ut(!0,1029,2305),Ut.frontCCW=new Ut(!0,1028,2305);let Zt=class Zt{constructor(en,es,ec){this.func=en,this.mask=es,this.range=ec}};Zt.ReadOnly=!1,Zt.ReadWrite=!0,Zt.disabled=new Zt(519,Zt.ReadOnly,[0,1]);let Vt=class Vt{constructor(en,es,ec,ed,ep,ef){this.test=en,this.ref=es,this.mask=ec,this.fail=ed,this.depthFail=ep,this.pass=ef}};Vt.disabled=new Vt({func:519,mask:0},0,0,7680,7680,7680);let eN=new WeakMap;function qt(en){var es;if(eN.has(en))return eN.get(en);{let ec=null===(es=en.getParameter(en.VERSION))||void 0===es?void 0:es.startsWith("WebGL 2.0");return eN.set(en,ec),ec}}let Wt=class Wt{get awaitingQuery(){return!!this._readbackQueue}constructor(en){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=en;let ec=en.context,ed=ec.gl;this._texFormat=ed.RGBA,this._texType=ed.UNSIGNED_BYTE;let ep=new es.aL;ep.emplaceBack(-1,-1),ep.emplaceBack(2,-1),ep.emplaceBack(-1,2);let ef=new es.aN;ef.emplaceBack(0,1,2),this._fullscreenTriangle=new wt(ec.createVertexBuffer(ep,ej.members),ec.createIndexBuffer(ef),es.aM.simpleSegment(0,0,ep.length,ef.length)),this._resultBuffer=new Uint8Array(4),ec.activeTexture.set(ed.TEXTURE1);let em=ed.createTexture();ed.bindTexture(ed.TEXTURE_2D,em),ed.texParameteri(ed.TEXTURE_2D,ed.TEXTURE_WRAP_S,ed.CLAMP_TO_EDGE),ed.texParameteri(ed.TEXTURE_2D,ed.TEXTURE_WRAP_T,ed.CLAMP_TO_EDGE),ed.texParameteri(ed.TEXTURE_2D,ed.TEXTURE_MIN_FILTER,ed.NEAREST),ed.texParameteri(ed.TEXTURE_2D,ed.TEXTURE_MAG_FILTER,ed.NEAREST),ed.texImage2D(ed.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=ec.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(em),qt(ed)&&(this._pbo=ed.createBuffer(),ed.bindBuffer(ed.PIXEL_PACK_BUFFER,this._pbo),ed.bufferData(ed.PIXEL_PACK_BUFFER,4,ed.STREAM_READ),ed.bindBuffer(ed.PIXEL_PACK_BUFFER,null))}destroy(){let en=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),en.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(en,es){let ec=this._updateCount;return this._readbackQueue?ec>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():ec>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(en,es),this._updateCount++,this._measuredError}_bindFramebuffer(){let en=this._cachedRenderContext.context,es=en.gl;en.activeTexture.set(es.TEXTURE1),es.bindTexture(es.TEXTURE_2D,this._fbo.colorAttachment.get()),en.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(en,ec){let ed=this._cachedRenderContext.context,ep=ed.gl;if(this._bindFramebuffer(),ed.viewport.set([0,0,this._texWidth,this._texHeight]),ed.clear({color:es.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(ed,ep.TRIANGLES,Zt.disabled,Vt.disabled,jt.unblended,Ut.disabled,{u_input:en,u_output_expected:ec},null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&qt(ep)){ep.bindBuffer(ep.PIXEL_PACK_BUFFER,this._pbo),ep.readBuffer(ep.COLOR_ATTACHMENT0),ep.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),ep.bindBuffer(ep.PIXEL_PACK_BUFFER,null);let en=ep.fenceSync(ep.SYNC_GPU_COMMANDS_COMPLETE,0);ep.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:en}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let en=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&qt(en)){let ec=en.clientWaitSync(this._readbackQueue.sync,0,0);if(ec===en.WAIT_FAILED)return es.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(ec===en.TIMEOUT_EXPIRED)return;en.bindBuffer(en.PIXEL_PACK_BUFFER,this._pbo),en.getBufferSubData(en.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),en.bindBuffer(en.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),en.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Wt._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(en){let es;return es=0+(en[0]/256+en[1]/65536+en[2]/16777216),en[3]<127&&(es=-es),es/128}};let eZ=es.$/128;function Xt(en,ec){let ed=void 0!==en.granularity?Math.max(en.granularity,1):1,ep=ed+(en.generateBorders?2:0),ef=ed+(en.extendToNorthPole||en.generateBorders?1:0)+(en.extendToSouthPole||en.generateBorders?1:0),em=ep+1,e_=ef+1,eg=en.generateBorders?-1:0,ey=en.generateBorders||en.extendToNorthPole?-1:0,ex=ed+(en.generateBorders?1:0),ev=ed+(en.generateBorders||en.extendToSouthPole?1:0),eb=ep*ef*6,ew=em*e_>65536;if(ew&&"16bit"===ec)throw Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let eT=ew||"32bit"===ec,eP=new Int16Array(2*(em*e_)),eS=0;for(let ec=ey;ec<=ev;ec++)for(let ep=eg;ep<=ex;ep++){let ef=ep/ed*es.$;-1===ep&&(ef=-eZ),ep===ed+1&&(ef=es.$+eZ);let em=ec/ed*es.$;-1===ec&&(em=en.extendToNorthPole?es.bh:-eZ),ec===ed+1&&(em=en.extendToSouthPole?es.bi:es.$+eZ),eP[eS++]=ef,eP[eS++]=em}let eM=eT?new Uint32Array(eb):new Uint16Array(eb),eC=0;for(let en=0;en<ef;en++)for(let es=0;es<ep;es++){let ec=es+1+en*em,ed=es+(en+1)*em,ep=es+1+(en+1)*em;eM[eC++]=es+en*em,eM[eC++]=ed,eM[eC++]=ec,eM[eC++]=ec,eM[eC++]=ed,eM[eC++]=ep}return{vertices:eP.buffer.slice(0),indices:eM.buffer.slice(0),uses32bitIndices:eT}}let eG=new es.aK({fill:new es.bj(128,2),line:new es.bj(512,0),tile:new es.bj(128,32),stencil:new es.bj(128,1),circle:3});let Yt=class Yt{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return eO.projectionGlobe}get vertexShaderPreludeCode(){return eO.projectionMercator.vertexSource}get subdivisionGranularity(){return eG}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(en){this._errorMeasurement||(this._errorMeasurement=new Wt(en));let ec=es.U(this._errorQueryLatitudeDegrees),ed=2*Math.atan(Math.exp(Math.PI-ec*Math.PI*2))-.5*Math.PI,ep=this._errorMeasurement.updateErrorLoop(ec,ed),ef=ev.now();ep!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=ep,this._errorMeasurementLastChangeTime=ef);let em=Math.min(Math.max((ef-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=es.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,es.bl(em))}_getMeshKey(en){return`${en.granularity.toString(36)}_${en.generateBorders?"b":""}${en.extendToNorthPole?"n":""}${en.extendToSouthPole?"s":""}`}getMeshFromTileID(en,es,ec,ed,ep){let ef=("stencil"===ep?eG.stencil:eG.tile).getGranularityForZoomLevel(es.z);return this._getMesh(en,{granularity:ef,generateBorders:ec,extendToNorthPole:0===es.y&&ed,extendToSouthPole:es.y===(1<<es.z)-1&&ed})}_getMesh(en,ec){let ed=this._getMeshKey(ec);if(ed in this._tileMeshCache)return this._tileMeshCache[ed];let ep=function(en,ec){let ed=Xt(ec,"16bit"),ep=es.aL.deserialize({arrayBuffer:ed.vertices,length:ed.vertices.byteLength/2/2}),ef=es.aN.deserialize({arrayBuffer:ed.indices,length:ed.indices.byteLength/2/3});return new wt(en.createVertexBuffer(ep,ej.members),en.createIndexBuffer(ef),es.aM.simpleSegment(0,0,ep.length,ef.length))}(en,ec);return this._tileMeshCache[ed]=ep,ep}recalculate(en){}hasTransition(){let en=ev.now();return(en-this._errorMeasurementLastChangeTime)/1e3<.7||this._errorMeasurement&&this._errorMeasurement.awaitingQuery}setErrorQueryLatitudeDegrees(en){this._errorQueryLatitudeDegrees=en}};let e$=new es.r({type:new es.D(es.v.projection.type)});let Jt=class Jt extends es.E{constructor(en){super(),this._transitionable=new es.t(e$,void 0),this.setProjection(en),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new es.F(0)),this._mercatorProjection=new It,this._verticalPerspectiveProjection=new Yt}get transitionState(){let en=this.properties.get("type");if("string"==typeof en&&"mercator"===en)return 0;if("string"==typeof en&&"vertical-perspective"===en)return 1;if(en instanceof es.bm){if("vertical-perspective"===en.from&&"mercator"===en.to)return 1-en.transition;if("mercator"===en.from&&"vertical-perspective"===en.to)return en.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(en){this._mercatorProjection.updateGPUdependent(en),this._verticalPerspectiveProjection.updateGPUdependent(en)}getMeshFromTileID(en,es,ec,ed,ep){return this.currentProjection.getMeshFromTileID(en,es,ec,ed,ep)}setProjection(en){this._transitionable.setValue("type",(null==en?void 0:en.type)||"mercator")}updateTransitions(en){this._transitioning=this._transitionable.transitioned(en,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(en){this.properties=this._transitioning.possiblyEvaluate(en)}setErrorQueryLatitudeDegrees(en){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(en),this._mercatorProjection.setErrorQueryLatitudeDegrees(en)}};function ei(en){let es=oi(en.worldSize,en.center.lat);return 2*Math.PI*es}function ti(en,ec,ed,ep,ef){let em=1/(1<<ef),e_=ec/es.$*em+ep*em,eg=es.bo((en/es.$*em+ed*em)*Math.PI*2+Math.PI,2*Math.PI),ey=2*Math.atan(Math.exp(Math.PI-e_*Math.PI*2))-.5*Math.PI,ex=Math.cos(ey),ev=new Float64Array(3);return ev[0]=Math.sin(eg)*ex,ev[1]=Math.sin(ey),ev[2]=Math.cos(eg)*ex,ev}function ii(en){return function(en,es){let ec=Math.cos(es),ed=new Float64Array(3);return ed[0]=Math.sin(en)*ec,ed[1]=Math.sin(es),ed[2]=Math.cos(en)*ec,ed}(en.lng*Math.PI/180,en.lat*Math.PI/180)}function oi(en,es){return en/(2*Math.PI)/Math.cos(es*Math.PI/180)}function ri(en){let ec=Math.asin(en[1])/Math.PI*180,ed=Math.sqrt(en[0]*en[0]+en[2]*en[2]);if(ed>1e-6){let ep=en[0]/ed,ef=Math.acos(en[2]/ed),em=(ep>0?ef:-ef)/Math.PI*180;return new es.S(es.aO(em,-180,180),ec)}return new es.S(0,ec)}function ai(en){return Math.cos(en*Math.PI/180)}function si(en,ec){let ed=ai(en),ep=ai(ec);return es.ak(ep/ed)}function ni(en,ec){let ed=en.rotate(ec.bearingInRadians),ep=ec.zoom+si(ec.center.lat,0),ef=es.bk(1/ai(ec.center.lat),1/ai(Math.min(Math.abs(ec.center.lat),60)),es.bn(ep,7,3,0,1)),em=360/ei({worldSize:ec.worldSize,center:{lat:ec.center.lat}});return new es.S(ec.center.lng-ed.x*em*ef,es.ah(ec.center.lat+ed.y*em,-es.ai,es.ai))}function li(en){let es=.5*en,ec=Math.sin(es),ed=Math.cos(es);return Math.log(ec+ed)-Math.log(ed-ec)}function ci(en,ec,ed,ep){let ef=en.lat+ed*ep;if(Math.abs(ed)>1){let em=(Math.sign(en.lat+ed)!==Math.sign(en.lat)?-Math.abs(en.lat):Math.abs(en.lat))*Math.PI/180,e_=Math.abs(en.lat+ed)*Math.PI/180,eg=li(em+ep*(e_-em)),ey=li(em),ex=li(e_);return new es.S(en.lng+ec*((eg-ey)/(ex-ey)),ef)}return new es.S(en.lng+ec*ep,ef)}let hi=class hi{constructor(en){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=en}swapBuffers(){if(!this._hadAnyChanges)return;let en=this._cachePrevious;this._cachePrevious=this._cache,this._cache=en,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(en,es,ec,ed){let ep=`${en.z}_${en.x}_${en.y}_${(null==ed?void 0:ed.terrain)?"t":""}`,ef=this._cache.get(ep);if(ef)return ef;let em=this._cachePrevious.get(ep);if(em)return this._cache.set(ep,em),em;let e_=this._boundingVolumeFactory(en,es,ec,ed);return this._cache.set(ep,e_),this._hadAnyChanges=!0,e_}};let ui=class ui{constructor(en,es,ec,ed){this.min=ec,this.max=ed,this.points=en,this.planes=es}static fromAabb(en,es){let ec=[];for(let ed=0;ed<8;ed++)ec.push([1&~ed?en[0]:es[0],1==(ed>>1&1)?es[1]:en[1],1==(ed>>2&1)?es[2]:en[2]]);return new ui(ec,[[-1,0,0,es[0]],[1,0,0,-en[0]],[0,-1,0,es[1]],[0,1,0,-en[1]],[0,0,-1,es[2]],[0,0,1,-en[2]]],en,es)}static fromCenterSizeAngles(en,ec,ed){let ep=es.br([],ed[0],ed[1],ed[2]),ef=es.bs([],[ec[0],0,0],ep),em=es.bs([],[0,ec[1],0],ep),e_=es.bs([],[0,0,ec[2]],ep),eg=[...en],ey=[...en];for(let es=0;es<8;es++)for(let ec=0;ec<3;ec++){let ed=en[ec]+ef[ec]*(1&~es?-1:1)+em[ec]*(1==(es>>1&1)?1:-1)+e_[ec]*(1==(es>>2&1)?1:-1);eg[ec]=Math.min(eg[ec],ed),ey[ec]=Math.max(ey[ec],ed)}let ex=[];for(let ec=0;ec<8;ec++){let ed=[...en];es.aS(ed,ed,es.aR([],ef,1&~ec?-1:1)),es.aS(ed,ed,es.aR([],em,1==(ec>>1&1)?1:-1)),es.aS(ed,ed,es.aR([],e_,1==(ec>>2&1)?1:-1)),ex.push(ed)}return new ui(ex,[[...ef,-es.aX(ef,ex[0])],[...em,-es.aX(em,ex[0])],[...e_,-es.aX(e_,ex[0])],[-ef[0],-ef[1],-ef[2],-es.aX(ef,ex[7])],[-em[0],-em[1],-em[2],-es.aX(em,ex[7])],[-e_[0],-e_[1],-e_[2],-es.aX(e_,ex[7])]],eg,ey)}intersectsFrustum(en){let es=!0,ec=this.points.length,ed=this.planes.length,ep=en.planes.length,ef=en.points.length;for(let ed=0;ed<ep;ed++){let ep=en.planes[ed],ef=0;for(let en=0;en<ec;en++){let es=this.points[en];ep[0]*es[0]+ep[1]*es[1]+ep[2]*es[2]+ep[3]>=0&&ef++}if(0===ef)return 0;ef<ec&&(es=!1)}if(es)return 2;for(let es=0;es<ed;es++){let ec=this.planes[es],ed=0;for(let es=0;es<ef;es++){let ep=en.points[es];ec[0]*ep[0]+ec[1]*ep[1]+ec[2]*ep[2]+ec[3]>=0&&ed++}if(0===ed)return 0}return 1}intersectsPlane(en){let es=this.points.length,ec=0;for(let ed=0;ed<es;ed++){let es=this.points[ed];en[0]*es[0]+en[1]*es[1]+en[2]*es[2]+en[3]>=0&&ec++}return ec===es?2:0===ec?0:1}};function di(en,es,ec){let ed=en-es;return ed<0?-ed:Math.max(0,ed-ec)}function _i(en,es,ec,ed,ep){let ef=en-ec;return Math.max(ef<0?Math.min(-ef,1+ef-ep):ef>1?Math.min(Math.max(ef-ep,0),1-ef):0,di(es,ed,ep))}let pi=class pi{constructor(){this._boundingVolumeCache=new hi(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(en,es,ec,ed){let ep=1<<ec.z,ef=1/ep,em=ec.x/ep,e_=ec.y/ep;return Math.min(Math.min(Math.min(2,_i(en,es,em,e_,ef)),_i(en,es,em+.5,-e_-ef,ef)),_i(en,es,em+.5,2-e_-ef,ef))}getWrap(en,es,ec){let ed=1<<es.z,ep=1/ed,ef=es.x/ed,em=di(en.x,ef,ep),e_=di(en.x,ef-1,ep),eg=di(en.x,ef+1,ep),ey=Math.min(em,e_,eg);return ey===eg?1:ey===e_?-1:0}allowVariableZoom(en,es){return ge(en,es)>4}allowWorldCopies(){return!1}getTileBoundingVolume(en,es,ec,ed){return this._boundingVolumeCache.getTileBoundingVolume(en,es,ec,ed)}_computeTileBoundingVolume(en,ec,ed,ep){var ef,em;let e_=0,eg=0;if(null==ep?void 0:ep.terrain){let ey=new es.Z(en.z,ec,en.z,en.x,en.y),ex=ep.terrain.getMinMaxElevation(ey);e_=null!==(ef=ex.minElevation)&&void 0!==ef?ef:Math.min(0,ed),eg=null!==(em=ex.maxElevation)&&void 0!==em?em:Math.max(0,ed)}if(e_/=es.bu,eg/=es.bu,e_+=1,eg+=1,en.z<=0)return ui.fromAabb([-eg,-eg,-eg],[eg,eg,eg]);if(1===en.z)return ui.fromAabb([0===en.x?-eg:0,0===en.y?0:-eg,-eg],[0===en.x?0:eg,0===en.y?eg:0,eg]);{let ec=[ti(0,0,en.x,en.y,en.z),ti(es.$,0,en.x,en.y,en.z),ti(es.$,es.$,en.x,en.y,en.z),ti(0,es.$,en.x,en.y,en.z)],ed=[];for(let en of ec)ed.push(es.aR([],en,eg));if(eg!==e_)for(let en of ec)ed.push(es.aR([],en,e_));0===en.y&&ed.push([0,1,0]),en.y===(1<<en.z)-1&&ed.push([0,-1,0]);let ep=[1,1,1],ef=[-1,-1,-1];for(let en of ed)for(let es=0;es<3;es++)ep[es]=Math.min(ep[es],en[es]),ef[es]=Math.max(ef[es],en[es]);let em=ti(es.$/2,es.$/2,en.x,en.y,en.z),ey=es.aW([],[0,1,0],em);es.aV(ey,ey);let ex=es.aW([],em,ey);es.aV(ex,ex);let ev=es.aW([],ec[2],ec[1]);es.aV(ev,ev);let eb=es.aW([],ec[0],ec[3]);es.aV(eb,eb),ed.push(es.aR([],em,eg)),en.y>=(1<<en.z)/2&&ed.push(es.aR([],ti(es.$/2,0,en.x,en.y,en.z),eg)),en.y<(1<<en.z)/2&&ed.push(es.aR([],ti(es.$/2,es.$,en.x,en.y,en.z),eg));let ew=mi(em,ed),eT=mi(ex,ed),eP=[-em[0],-em[1],-em[2],ew.max],eS=[em[0],em[1],em[2],-ew.min],eM=[-ex[0],-ex[1],-ex[2],eT.max],eC=[ex[0],ex[1],ex[2],-eT.min],eI=[...ev,0],eE=[...eb,0],eA=[];return 0===en.y?eA.push(es.bt(eE,eI,eP),es.bt(eE,eI,eS)):eA.push(es.bt(eM,eI,eP),es.bt(eM,eI,eS),es.bt(eM,eE,eP),es.bt(eM,eE,eS)),en.y===(1<<en.z)-1?eA.push(es.bt(eE,eI,eP),es.bt(eE,eI,eS)):eA.push(es.bt(eC,eI,eP),es.bt(eC,eI,eS),es.bt(eC,eE,eP),es.bt(eC,eE,eS)),new ui(eA,[eP,eS,eM,eC,eI,eE],ep,ef)}}};function mi(en,ec){let ed=1/0,ep=-1/0;for(let ef of ec){let ec=es.aX(en,ef);ed=Math.min(ed,ec),ep=Math.max(ep,ec)}return{min:ed,max:ep}}let fi=class fi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(en){this._helper.setMinZoom(en)}setMaxZoom(en){this._helper.setMaxZoom(en)}setMinPitch(en){this._helper.setMinPitch(en)}setMaxPitch(en){this._helper.setMaxPitch(en)}setRenderWorldCopies(en){this._helper.setRenderWorldCopies(en)}setBearing(en){this._helper.setBearing(en)}setPitch(en){this._helper.setPitch(en)}setRoll(en){this._helper.setRoll(en)}setFov(en){this._helper.setFov(en)}setZoom(en){this._helper.setZoom(en)}setCenter(en){this._helper.setCenter(en)}setElevation(en){this._helper.setElevation(en)}setMinElevationForCurrentTile(en){this._helper.setMinElevationForCurrentTile(en)}setPadding(en){this._helper.setPadding(en)}interpolatePadding(en,es,ec){return this._helper.interpolatePadding(en,es,ec)}isPaddingEqual(en){return this._helper.isPaddingEqual(en)}resize(en,es){this._helper.resize(en,es)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(en){this._helper.setMaxBounds(en)}overrideNearFarZ(en,es){this._helper.overrideNearFarZ(en,es)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(en){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),en)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(en){}constructor(){this._cachedClippingPlane=es.bv(),this._projectionMatrix=es.b9(),this._globeViewProjMatrix32f=es.b8(),this._globeViewProjMatrixNoCorrection=es.b9(),this._globeViewProjMatrixNoCorrectionInverted=es.b9(),this._globeProjMatrixInverted=es.b9(),this._cameraPosition=es.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Rt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(en,es)=>this.getConstrained(en,es)}),this._coveringTilesDetailsProvider=new pi}clone(){let en=new fi;return en.apply(this),en}apply(en,es){this._globeLatitudeErrorCorrectionRadians=es||0,this._helper.apply(en)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let en=es.bp();return en[0]=this._cameraPosition[0],en[1]=this._cameraPosition[1],en[2]=this._cameraPosition[2],en}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(en){let{overscaledTileID:es,applyGlobeMatrix:ec}=en,ed=this._helper.getMercatorTileCoordinates(es);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:ed,clippingPlane:this._cachedClippingPlane,projectionTransition:ec?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(en){let ec=this.pitchInRadians,ed=this.cameraToCenterDistance/en,ep=Math.sin(ec)*ed,ef=Math.cos(ec)*ed+1,em=-ep,e_=ef,eg=Math.sqrt(em*em+e_*e_);em/=eg,e_/=eg;let ey=[0,em,e_];es.bw(ey,ey,[0,0,0],-this.bearingInRadians),es.bx(ey,ey,[0,0,0],-1*this.center.lat*Math.PI/180),es.by(ey,ey,[0,0,0],this.center.lng*Math.PI/180);let ex=1/es.aZ(ey);return es.aR(ey,ey,ex),[...ey,-(1/Math.sqrt(ep*ep+ef*ef)*1)*ex]}isLocationOccluded(en){return!this.isSurfacePointVisible(ii(en))}transformLightDirection(en){let ec=this._helper._center.lng*Math.PI/180,ed=this._helper._center.lat*Math.PI/180,ep=Math.cos(ed),ef=[Math.sin(ec)*ep,Math.sin(ed),Math.cos(ec)*ep],em=[ef[2],0,-ef[0]],e_=[0,0,0];es.aW(e_,em,ef),es.aV(em,em),es.aV(e_,e_);let eg=[0,0,0];return es.aV(eg,[em[0]*en[0]+e_[0]*en[1]+ef[0]*en[2],em[1]*en[0]+e_[1]*en[1]+ef[1]*en[2],em[2]*en[0]+e_[2]*en[1]+ef[2]*en[2]]),eg}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(en,ec,ed){var ep;let ef=function(en,ec,ed){let ep=1/(1<<ed.z);return new es.a1(en/es.$*ep+ed.x*ep,ec/es.$*ep+ed.y*ep)}(en,ec,ed.canonical),em=(ep=ef.y,[es.bo(ef.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-ep*Math.PI*2))-.5*Math.PI]);return this.getCircleRadiusCorrection()/Math.cos(em[1])}projectTileCoordinates(en,ec,ed,ep){let ef=ed.canonical,em=ti(en,ec,ef.x,ef.y,ef.z),e_=1+(ep?ep(en,ec):0)/es.bu,eg=[em[0]*e_,em[1]*e_,em[2]*e_,1];es.aw(eg,eg,this._globeViewProjMatrixNoCorrection);let ey=this._cachedClippingPlane,ex=ey[0]*em[0]+ey[1]*em[1]+ey[2]*em[2]+ey[3]<0;return{point:new es.P(eg[0]/eg[3],eg[1]/eg[3]),signedDistanceFromCamera:eg[3],isOccluded:ex}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let en=oi(this.worldSize,this.center.lat),ec=es.ba(),ed=es.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*en),es.b4(ec,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let ep=this.centerOffset;ec[8]=-(2*ep.x)/this._helper._width,ec[9]=2*ep.y/this._helper._height,this._projectionMatrix=es.b5(ec),this._globeProjMatrixInverted=es.ba(),es.aq(this._globeProjMatrixInverted,ec),es.M(ec,ec,[0,0,-this.cameraToCenterDistance]),es.b6(ec,ec,this.rollInRadians),es.b7(ec,ec,-this.pitchInRadians),es.b6(ec,ec,this.bearingInRadians),es.M(ec,ec,[0,0,-en]);let ef=es.bp();ef[0]=en,ef[1]=en,ef[2]=en,es.b7(ed,ec,this.center.lat*Math.PI/180),es.bz(ed,ed,-this.center.lng*Math.PI/180),es.N(ed,ed,ef),this._globeViewProjMatrixNoCorrection=ed,es.b7(ec,ec,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),es.bz(ec,ec,-this.center.lng*Math.PI/180),es.N(ec,ec,ef),this._globeViewProjMatrix32f=new Float32Array(ec),this._globeViewProjMatrixNoCorrectionInverted=es.ba(),es.aq(this._globeViewProjMatrixNoCorrectionInverted,ed);let em=es.bp();this._cameraPosition=es.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/en,es.bw(this._cameraPosition,this._cameraPosition,em,-this.rollInRadians),es.bx(this._cameraPosition,this._cameraPosition,em,this.pitchInRadians),es.bw(this._cameraPosition,this._cameraPosition,em,-this.bearingInRadians),es.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),es.bx(this._cameraPosition,this._cameraPosition,em,-this.center.lat*Math.PI/180),es.by(this._cameraPosition,this._cameraPosition,em,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(en);let e_=es.b5(this._globeViewProjMatrixNoCorrectionInverted);es.N(e_,e_,[1,1,-1]),this._cachedFrustum=At.fromInvProjectionMatrix(e_,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(en){es.w("calculateFogMatrix is not supported on globe projection.");let ec=es.ba();return es.ag(ec),ec}getVisibleUnwrappedCoordinates(en){return[new es.b2(0,en)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(en){en&&es.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(en,ec){if(!this._globeViewProjMatrixNoCorrection)return 1;let ed=ii(en);es.aR(ed,ed,1+ec/es.bu);let ep=es.bv();return es.aw(ep,[ed[0],ed[1],ed[2],1],this._globeViewProjMatrixNoCorrection),ep[2]/ep[3]}populateCache(en){}getBounds(){let en=.5*this.width,ec=.5*this.height,ed=[new es.P(0,0),new es.P(en,0),new es.P(this.width,0),new es.P(this.width,ec),new es.P(this.width,this.height),new es.P(en,this.height),new es.P(0,this.height),new es.P(0,ec)],ep=[];for(let en of ed)ep.push(this.unprojectScreenPoint(en));let ef=0,em=0,e_=0,eg=0,ey=this.center;for(let en of ep){let ec=es.bA(ey.lng,en.lng),ed=es.bA(ey.lat,en.lat);ec<em&&(em=ec),ec>ef&&(ef=ec),ed<eg&&(eg=ed),ed>e_&&(e_=ed)}let ex=[ey.lng+em,ey.lat+eg,ey.lng+ef,ey.lat+e_];return this.isSurfacePointOnScreen([0,1,0])&&(ex[3]=90,ex[0]=-180,ex[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(ex[1]=-90,ex[0]=-180,ex[2]=180),new G(ex)}getConstrained(en,ec){let ed=es.ah(en.lat,-es.ai,es.ai),ep=es.ah(+ec,this.minZoom+si(0,ed),this.maxZoom);return{center:new es.S(en.lng,ed),zoom:ep}}calculateCenterFromCameraLngLatAlt(en,es,ec,ed){return this._helper.calculateCenterFromCameraLngLatAlt(en,es,ec,ed)}setLocationAtPoint(en,ec){let ed,ep;let ef=ii(this.unprojectScreenPoint(ec)),em=ii(en),e_=es.bp();es.bB(e_);let eg=es.bp();es.by(eg,ef,e_,-this.center.lng*Math.PI/180),es.bx(eg,eg,e_,this.center.lat*Math.PI/180);let ey=em[0]*em[0]+em[2]*em[2],ex=eg[0]*eg[0];if(ey<ex)return;let ev=Math.sqrt(ey-ex),eb=-ev,ew=es.bC(em[0],em[2],eg[0],ev),eT=es.bC(em[0],em[2],eg[0],eb),eP=es.bp();es.by(eP,em,e_,-ew);let eS=es.bC(eP[1],eP[2],eg[1],eg[2]),eM=es.bp();es.by(eM,em,e_,-eT);let eC=es.bC(eM[1],eM[2],eg[1],eg[2]),eI=.5*Math.PI,eE=eS>=-eI&&eS<=eI,eA=eC>=-eI&&eC<=eI;if(eE&&eA){let en=this.center.lng*Math.PI/180,ec=this.center.lat*Math.PI/180;es.bD(ew,en)+es.bD(eS,ec)<es.bD(eT,en)+es.bD(eC,ec)?(ed=ew,ep=eS):(ed=eT,ep=eC)}else if(eE)ed=ew,ep=eS;else{if(!eA)return;ed=eT,ep=eC}let ez=ed/Math.PI*180,ek=ep/Math.PI*180,eD=this.center.lat;this.setCenter(new es.S(ez,es.ah(ek,-90,90))),this.setZoom(this.zoom+si(eD,this.center.lat))}locationToScreenPoint(en,ec){let ed=ii(en);if(ec){let ep=ec.getElevationForLngLatZoom(en,this._helper._tileZoom);es.aR(ed,ed,1+ep/es.bu)}return this._projectSurfacePointToScreen(ed)}_projectSurfacePointToScreen(en){let ec=es.bv();return es.aw(ec,[...en,1],this._globeViewProjMatrixNoCorrection),ec[0]/=ec[3],ec[1]/=ec[3],new es.P((.5*ec[0]+.5)*this.width,(-(.5*ec[1])+.5)*this.height)}screenPointToMercatorCoordinate(en,ec){if(ec){let es=ec.pointCoordinate(en);if(es)return es}return es.a1.fromLngLat(this.unprojectScreenPoint(en))}screenPointToLocation(en,es){var ec;return null===(ec=this.screenPointToMercatorCoordinate(en,es))||void 0===ec?void 0:ec.toLngLat()}isPointOnMapSurface(en,es){let ec=this._cameraPosition,ed=this.getRayDirectionFromPixel(en);return!!this.rayPlanetIntersection(ec,ed)}getRayDirectionFromPixel(en){let ec=es.bv();ec[0]=en.x/this.width*2-1,ec[1]=-1*(en.y/this.height*2-1),ec[2]=1,ec[3]=1,es.aw(ec,ec,this._globeViewProjMatrixNoCorrectionInverted),ec[0]/=ec[3],ec[1]/=ec[3],ec[2]/=ec[3];let ed=es.bp();ed[0]=ec[0]-this._cameraPosition[0],ed[1]=ec[1]-this._cameraPosition[1],ed[2]=ec[2]-this._cameraPosition[2];let ep=es.bp();return es.aV(ep,ed),ep}isSurfacePointVisible(en){let es=this._cachedClippingPlane;return es[0]*en[0]+es[1]*en[1]+es[2]*en[2]+es[3]>=0}isSurfacePointOnScreen(en){if(!this.isSurfacePointVisible(en))return!1;let ec=es.bv();return es.aw(ec,[...en,1],this._globeViewProjMatrixNoCorrection),ec[0]/=ec[3],ec[1]/=ec[3],ec[2]/=ec[3],ec[0]>-1&&ec[0]<1&&ec[1]>-1&&ec[1]<1&&ec[2]>-1&&ec[2]<1}rayPlanetIntersection(en,ec){let ed=es.aX(en,ec),ep=es.bp(),ef=es.bp();es.aR(ef,ec,ed),es.aU(ep,en,ef);let em=1-es.aX(ep,ep);if(em<0)return null;let e_=es.aX(en,en)-1,eg=-ed+(ed<0?1:-1)*Math.sqrt(em),ey=e_/eg;return{tMin:Math.min(ey,eg),tMax:Math.max(ey,eg)}}unprojectScreenPoint(en){let ec=this._cameraPosition,ed=this.getRayDirectionFromPixel(en),ep=this.rayPlanetIntersection(ec,ed);if(ep){let en=es.bp();es.aS(en,ec,[ed[0]*ep.tMin,ed[1]*ep.tMin,ed[2]*ep.tMin]);let ef=es.bp();return es.aV(ef,en),ri(ef)}let ef=this._cachedClippingPlane,em=ef[0]*ed[0]+ef[1]*ed[1]+ef[2]*ed[2],e_=-es.b1(ef,ec)/em,eg=es.bp();if(e_>0)es.aS(eg,ec,[ed[0]*e_,ed[1]*e_,ed[2]*e_]);else{let en=es.bp();es.aS(en,ec,[2*ed[0],2*ed[1],2*ed[2]]);let ep=es.b1(this._cachedClippingPlane,en);es.aU(eg,en,[this._cachedClippingPlane[0]*ep,this._cachedClippingPlane[1]*ep,this._cachedClippingPlane[2]*ep])}let ey=function(en){let ec=es.bp();return ec[0]=-(en[0]*en[3]),ec[1]=-(en[1]*en[3]),ec[2]=-(en[2]*en[3]),{center:ec,radius:Math.sqrt(1-en[3]*en[3])}}(ef);return ri(function(en,ec,ed){let ep=es.bp();es.aU(ep,ed,en);let ef=es.bp();return es.bq(ef,en,ep,ec/es.a$(ep)),ef}(ey.center,ey.radius,eg))}getMatrixForModel(en,ec){let ed=es.S.convert(en),ep=1/es.bu,ef=es.b9();return es.bz(ef,ef,ed.lng/180*Math.PI),es.b7(ef,ef,-ed.lat/180*Math.PI),es.M(ef,ef,[0,0,1+ec/es.bu]),es.b7(ef,ef,.5*Math.PI),es.N(ef,ef,[ep,ep,ep]),ef}getProjectionDataForCustomLayer(en=!0){let ec=this.getProjectionData({overscaledTileID:new es.Z(0,0,0,0,0),applyGlobeMatrix:en});return ec.tileMercatorCoords=[0,0,1,1],ec}getFastPathSimpleProjectionMatrix(en){}};let gi=class gi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(en){this._helper.setMinZoom(en)}setMaxZoom(en){this._helper.setMaxZoom(en)}setMinPitch(en){this._helper.setMinPitch(en)}setMaxPitch(en){this._helper.setMaxPitch(en)}setRenderWorldCopies(en){this._helper.setRenderWorldCopies(en)}setBearing(en){this._helper.setBearing(en)}setPitch(en){this._helper.setPitch(en)}setRoll(en){this._helper.setRoll(en)}setFov(en){this._helper.setFov(en)}setZoom(en){this._helper.setZoom(en)}setCenter(en){this._helper.setCenter(en)}setElevation(en){this._helper.setElevation(en)}setMinElevationForCurrentTile(en){this._helper.setMinElevationForCurrentTile(en)}setPadding(en){this._helper.setPadding(en)}interpolatePadding(en,es,ec){return this._helper.interpolatePadding(en,es,ec)}isPaddingEqual(en){return this._helper.isPaddingEqual(en)}resize(en,es,ec=!0){this._helper.resize(en,es,ec)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(en){this._helper.setMaxBounds(en)}overrideNearFarZ(en,es){this._helper.overrideNearFarZ(en,es)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(en){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),en)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(en,es){this._globeness=en,this._globeLatitudeErrorCorrectionRadians=es,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Rt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(en,es)=>this.getConstrained(en,es)}),this._globeness=1,this._mercatorTransform=new Lt,this._verticalPerspectiveTransform=new fi}clone(){let en=new gi;return en._globeness=this._globeness,en._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,en.apply(this),en}apply(en){this._helper.apply(en),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(en){let es=this._mercatorTransform.getProjectionData(en),ec=this._verticalPerspectiveTransform.getProjectionData(en);return{mainMatrix:this.isGlobeRendering?ec.mainMatrix:es.mainMatrix,clippingPlane:ec.clippingPlane,tileMercatorCoords:ec.tileMercatorCoords,projectionTransition:en.applyGlobeMatrix?this._globeness:0,fallbackMatrix:es.fallbackMatrix}}isLocationOccluded(en){return this.currentTransform.isLocationOccluded(en)}transformLightDirection(en){return this.currentTransform.transformLightDirection(en)}getPixelScale(){return es.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return es.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(en,ec,ed){let ep=this._mercatorTransform.getPitchedTextCorrection(en,ec,ed),ef=this._verticalPerspectiveTransform.getPitchedTextCorrection(en,ec,ed);return es.bk(ep,ef,this._globeness)}projectTileCoordinates(en,es,ec,ed){return this.currentTransform.projectTileCoordinates(en,es,ec,ed)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(en){return this.currentTransform.calculateFogMatrix(en)}getVisibleUnwrappedCoordinates(en){return this.currentTransform.getVisibleUnwrappedCoordinates(en)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(en){this._mercatorTransform.recalculateZoomAndCenter(en),this._verticalPerspectiveTransform.recalculateZoomAndCenter(en)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(en,es){return this.currentTransform.lngLatToCameraDepth(en,es)}populateCache(en){this._mercatorTransform.populateCache(en),this._verticalPerspectiveTransform.populateCache(en)}getBounds(){return this.currentTransform.getBounds()}getConstrained(en,es){return this.currentTransform.getConstrained(en,es)}calculateCenterFromCameraLngLatAlt(en,es,ec,ed){return this._helper.calculateCenterFromCameraLngLatAlt(en,es,ec,ed)}setLocationAtPoint(en,es){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(en,es),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(en,es),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(en,es){return this.currentTransform.locationToScreenPoint(en,es)}screenPointToMercatorCoordinate(en,es){return this.currentTransform.screenPointToMercatorCoordinate(en,es)}screenPointToLocation(en,es){return this.currentTransform.screenPointToLocation(en,es)}isPointOnMapSurface(en,es){return this.currentTransform.isPointOnMapSurface(en,es)}getRayDirectionFromPixel(en){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(en)}getMatrixForModel(en,es){return this.currentTransform.getMatrixForModel(en,es)}getProjectionDataForCustomLayer(en=!0){let es=this._mercatorTransform.getProjectionDataForCustomLayer(en);if(!this.isGlobeRendering)return es;let ec=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(en);return ec.fallbackMatrix=es.mainMatrix,ec}getFastPathSimpleProjectionMatrix(en){return this.currentTransform.getFastPathSimpleProjectionMatrix(en)}};let vi=class vi{get useGlobeControls(){return!0}handlePanInertia(en,ec){let ed=ni(en,ec);return Math.abs(ed.lng-ec.center.lng)>180&&(ed.lng=ec.center.lng+179.5*Math.sign(ed.lng-ec.center.lng)),{easingCenter:ed,easingOffset:new es.P(0,0)}}handleMapControlsRollPitchBearingZoom(en,ec){let ed=en.around,ep=ec.screenPointToLocation(ed);en.bearingDelta&&ec.setBearing(ec.bearing+en.bearingDelta),en.pitchDelta&&ec.setPitch(ec.pitch+en.pitchDelta),en.rollDelta&&ec.setRoll(ec.roll+en.rollDelta);let ef=ec.zoom;en.zoomDelta&&ec.setZoom(ec.zoom+en.zoomDelta);let em=ec.zoom-ef;if(0===em)return;let e_=es.bA(ec.center.lng,ep.lng),eg=es.bA(ec.center.lat,ep.lat),ey=ec.getRayDirectionFromPixel(ed),ex=ec.cameraPosition,ev=-1*es.aX(ex,ey),eb=es.bp();es.aS(eb,ex,[ey[0]*ev,ey[1]*ev,ey[2]*ev]);let ew=es.aZ(eb)-1,eT=oi(ec.worldSize,ec.center.lat)/Math.min(ec.width,ec.height),eP=es.bn(eT,.9,.5,1,.25),eS=(1-es.af(-em))*Math.min(Math.exp(-(.5*Math.max(ew-.3,0))),eP),eM=ec.center.lat,eC=ec.zoom,eI=new es.S(ec.center.lng+e_/(Math.abs(e_/180)+1)*eS,es.ah(ec.center.lat+eg*eS,-es.ai,es.ai));ec.setLocationAtPoint(ep,ed);let eE=ec.center,eA=es.bn(Math.abs(e_),45,85,0,1),ez=es.bn(eT,.75,.35,0,1),ek=Math.pow(Math.max(eA,ez),.25),eD=es.bA(eE.lng,eI.lng),eR=es.bA(eE.lat,eI.lat);ec.setCenter(new es.S(eE.lng+eD*ek,eE.lat+eR*ek).wrap()),ec.setZoom(eC+si(eM,ec.center.lat))}handleMapControlsPan(en,es,ec){if(!en.panDelta)return;let ed=es.center.lat,ep=es.zoom;es.setCenter(ni(en.panDelta,es).wrap()),es.setZoom(ep+si(ed,es.center.lat))}cameraForBoxAndBearing(en,ec,ed,ep,ef){let em=Bt(en,ec,ed,ep,ef),e_=ec.left/ef.width*2-1,eg=(ef.width-ec.right)/ef.width*2-1,ey=-(ec.top/ef.height*2)+1,ex=-((ef.height-ec.bottom)/ef.height*2)+1,ev=0>es.bA(ed.getWest(),ed.getEast()),eb=ev?ed.getEast():ed.getWest(),ew=ev?ed.getWest():ed.getEast(),eT=Math.max(ed.getNorth(),ed.getSouth()),eP=Math.min(ed.getNorth(),ed.getSouth()),eS=eb+.5*es.bA(eb,ew),eM=eT+.5*es.bA(eT,eP),eC=ef.clone();eC.setCenter(em.center),eC.setBearing(em.bearing),eC.setPitch(0),eC.setRoll(0),eC.setZoom(em.zoom);let eI=eC.modelViewProjectionMatrix,eE=[ii(ed.getNorthWest()),ii(ed.getNorthEast()),ii(ed.getSouthWest()),ii(ed.getSouthEast()),ii(new es.S(ew,eM)),ii(new es.S(eb,eM)),ii(new es.S(eS,eT)),ii(new es.S(eS,eP))],eA=ii(em.center),ez=Number.POSITIVE_INFINITY;for(let en of eE)e_<0&&(ez=vi.getLesserNonNegativeNonNull(ez,vi.solveVectorScale(en,eA,eI,"x",e_))),eg>0&&(ez=vi.getLesserNonNegativeNonNull(ez,vi.solveVectorScale(en,eA,eI,"x",eg))),ey>0&&(ez=vi.getLesserNonNegativeNonNull(ez,vi.solveVectorScale(en,eA,eI,"y",ey))),ex<0&&(ez=vi.getLesserNonNegativeNonNull(ez,vi.solveVectorScale(en,eA,eI,"y",ex)));if(Number.isFinite(ez)&&0!==ez)return em.zoom=eC.zoom+es.ak(ez),em;kt()}handleJumpToCenterZoom(en,ec){let ed=en.center.lat,ep=en.getConstrained(ec.center?es.S.convert(ec.center):en.center,en.zoom).center;en.setCenter(ep.wrap());let ef=void 0!==ec.zoom?+ec.zoom:en.zoom+si(ed,ep.lat);en.zoom!==ef&&en.setZoom(ef)}handleEaseTo(en,ec){let ed=en.zoom,ep=en.center,ef=en.padding,em={roll:en.roll,pitch:en.pitch,bearing:en.bearing},e_={roll:void 0===ec.roll?en.roll:ec.roll,pitch:void 0===ec.pitch?en.pitch:ec.pitch,bearing:void 0===ec.bearing?en.bearing:ec.bearing},eg=void 0!==ec.zoom,ey=!en.isPaddingEqual(ec.padding),ex=!1,ev=ec.center?es.S.convert(ec.center):ep,eb=en.getConstrained(ev,ed).center;St(en,eb);let ew=en.clone();ew.setCenter(eb),ew.setZoom(eg?+ec.zoom:ed+si(ep.lat,ev.lat)),ew.setBearing(ec.bearing);let eT=new es.P(es.ah(en.centerPoint.x+ec.offsetAsPoint.x,0,en.width),es.ah(en.centerPoint.y+ec.offsetAsPoint.y,0,en.height));ew.setLocationAtPoint(eb,eT);let eP=(ec.offset&&ec.offsetAsPoint.mag())>0?ew.center:eb,eS=eg?+ec.zoom:ed+si(ep.lat,eP.lat),eM=ed+si(ep.lat,0),eC=eS+si(eP.lat,0),eI=es.bA(ep.lng,eP.lng),eE=es.bA(ep.lat,eP.lat),eA=es.af(eC-eM);return{easeFunc:ed=>{if(es.be(em,e_)||Ft({startEulerAngles:em,endEulerAngles:e_,tr:en,k:ed,useSlerp:em.roll!=e_.roll}),ey&&en.interpolatePadding(ef,ec.padding,ed),ec.around)es.w("Easing around a point is not supported under globe projection."),en.setLocationAtPoint(ec.around,ec.aroundPoint);else{let es=eC>eM?Math.min(2,eA):Math.max(.5,eA),ec=Math.pow(es,1-ed),ef=ci(ep,eI,eE,ed*ec);en.setCenter(ef.wrap())}if(ex){let ec=es.C.number(eM,eC,ed)+si(0,en.center.lat);en.setZoom(ec)}},isZooming:ex=eS!==ed,elevationCenter:eP}}handleFlyTo(en,ec){let ed;let ep=void 0!==ec.zoom,ef=en.center,em=en.zoom,e_=en.padding,eg=!en.isPaddingEqual(ec.padding),ey=en.getConstrained(es.S.convert(ec.center||ec.locationAtOffset),em).center,ex=ep?+ec.zoom:en.zoom+si(en.center.lat,ey.lat),ev=en.clone();ev.setCenter(ey),ev.setZoom(ex),ev.setBearing(ec.bearing);let eb=new es.P(es.ah(en.centerPoint.x+ec.offsetAsPoint.x,0,en.width),es.ah(en.centerPoint.y+ec.offsetAsPoint.y,0,en.height));ev.setLocationAtPoint(ey,eb);let ew=ev.center;St(en,ew);let eT=function(en,ec,ed){let ep=ii(ec),ef=ii(ed),em=es.aX(ep,ef),e_=ei(en);return Math.acos(em)/(2*Math.PI)*e_}(en,ef,ew),eP=em+si(ef.lat,0),eS=ex+si(ew.lat,0),eM=es.af(eS-eP);if("number"==typeof ec.minZoom){let ep=+ec.minZoom+si(ew.lat,0),ef=Math.min(ep,eP,eS)+si(0,ew.lat),em=en.getConstrained(ew,ef).zoom+si(ew.lat,0);ed=es.af(em-eP)}let eC=es.bA(ef.lng,ew.lng),eI=es.bA(ef.lat,ew.lat);return{easeFunc:(ed,ep,em,ey)=>{let ev=ci(ef,eC,eI,em);eg&&en.interpolatePadding(e_,ec.padding,ed);let eb=1===ed?ew:ev;en.setCenter(eb.wrap());let eT=eP+es.ak(ep);en.setZoom(1===ed?ex:eT+si(0,eb.lat))},scaleOfZoom:eM,targetCenter:ew,scaleOfMinZoom:ed,pixelPathLength:eT}}static solveVectorScale(en,es,ec,ed,ep){let ef="x"===ed?[ec[0],ec[4],ec[8],ec[12]]:[ec[1],ec[5],ec[9],ec[13]],em=[ec[3],ec[7],ec[11],ec[15]],e_=en[0]*ef[0]+en[1]*ef[1]+en[2]*ef[2],eg=en[0]*em[0]+en[1]*em[1]+en[2]*em[2],ey=es[0]*ef[0]+es[1]*ef[1]+es[2]*ef[2],ex=es[0]*em[0]+es[1]*em[1]+es[2]*em[2];return ey+ep*eg===e_+ep*ex||em[3]*(e_-ey)+ef[3]*(ex-eg)+e_*ex==ey*eg?null:(ey+ef[3]-ep*ex-ep*em[3])/(ey-e_-ep*ex+ep*eg)}static getLesserNonNegativeNonNull(en,es){return null!==es&&es>=0&&es<en?es:en}};let bi=class bi{constructor(en){this._globe=en,this._mercatorCameraHelper=new Ot,this._verticalPerspectiveCameraHelper=new vi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(en,es){return this.currentHelper.handlePanInertia(en,es)}handleMapControlsRollPitchBearingZoom(en,es){return this.currentHelper.handleMapControlsRollPitchBearingZoom(en,es)}handleMapControlsPan(en,es,ec){this.currentHelper.handleMapControlsPan(en,es,ec)}cameraForBoxAndBearing(en,es,ec,ed,ep){return this.currentHelper.cameraForBoxAndBearing(en,es,ec,ed,ep)}handleJumpToCenterZoom(en,es){this.currentHelper.handleJumpToCenterZoom(en,es)}handleEaseTo(en,es){return this.currentHelper.handleEaseTo(en,es)}handleFlyTo(en,es){return this.currentHelper.handleFlyTo(en,es)}};let xi=(en,ec)=>es.y(en,ec&&ec.filter(en=>"source.canvas"!==en.identifier)),eq=es.bE();let wi=class wi extends es.E{constructor(en,ec={}){var ed,ep;super(),this._rtlPluginLoaded=()=>{for(let en in this.sourceCaches){let es=this.sourceCaches[en].getSource().type;"vector"!==es&&"geojson"!==es||this.sourceCaches[en].reload()}},this.map=en,this.dispatcher=new F(k(),en._getMapId()),this.dispatcher.registerMessageHandler("GG",(en,es)=>this.getGlyphs(en,es)),this.dispatcher.registerMessageHandler("GI",(en,es)=>this.getImages(en,es)),this.dispatcher.registerMessageHandler("GDA",(en,es)=>this.getDashes(en,es)),this.imageManager=new b,this.imageManager.setEventedParent(this);let ef=(null===(ed=en._container)||void 0===ed?void 0:ed.lang)||"undefined"!=typeof document&&(null===(ep=document.documentElement)||void 0===ep?void 0:ep.lang)||void 0;this.glyphManager=new T(en._requestManager,ec.localIdeographFontFamily,ef),this.lineAtlas=new E(256,512),this.crossTileSymbolIndex=new vt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new es.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",es.bG()),oe().on(eA,this._rtlPluginLoaded),this.on("data",en=>{if("source"!==en.dataType||"metadata"!==en.sourceDataType)return;let es=this.sourceCaches[en.sourceId];if(!es)return;let ec=es.getSource();if(ec&&ec.vectorLayerIds)for(let en in this._layers){let es=this._layers[en];es.source===ec.id&&this._validateLayer(es)}})}setGlobalStateProperty(en,ec){var ed,ep,ef;this._checkLoaded();let em=null===ec?null!==(ef=null===(ep=null===(ed=this.stylesheet.state)||void 0===ed?void 0:ed[en])||void 0===ep?void 0:ep.default)&&void 0!==ef?ef:null:ec;if(es.bH(em,this._globalState[en]))return this;this._globalState[en]=em,this._applyGlobalStateChanges([en])}getGlobalState(){return this._globalState}setGlobalState(en){this._checkLoaded();let ec=[];for(let ed in en)es.bH(this._globalState[ed],en[ed].default)||(ec.push(ed),this._globalState[ed]=en[ed].default);this._applyGlobalStateChanges(ec)}_applyGlobalStateChanges(en){if(0===en.length)return;let es=new Set,ec={};for(let ed of en)for(let en in ec[ed]=this._globalState[ed],this._layers){let ec=this._layers[en],ep=ec.getLayoutAffectingGlobalStateRefs(),ef=ec.getPaintAffectingGlobalStateRefs();if(ep.has(ed)&&es.add(ec.source),ef.has(ed))for(let{name:en,value:es}of ef.get(ed))this._updatePaintProperty(ec,en,es)}for(let en in this.dispatcher.broadcast("UGS",ec),this.sourceCaches)es.has(en)&&(this._reloadSource(en),this._changed=!0)}loadURL(en,ec={},ed){this.fire(new es.l("dataloading",{dataType:"style"})),ec.validate="boolean"!=typeof ec.validate||ec.validate;let ep=this.map._requestManager.transformRequest(en,"Style");this._loadStyleRequest=new AbortController;let ef=this._loadStyleRequest;es.j(ep,this._loadStyleRequest).then(en=>{this._loadStyleRequest=null,this._load(en.data,ec,ed)}).catch(en=>{this._loadStyleRequest=null,en&&!ef.signal.aborted&&this.fire(new es.k(en))})}loadJSON(en,ec={},ed){this.fire(new es.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ev.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,ec.validate=!1!==ec.validate,this._load(en,ec,ed)}).catch(()=>{})}loadEmpty(){this.fire(new es.l("dataloading",{dataType:"style"})),this._load(eq,{validate:!1})}_load(en,ec,ed){var ep,ef;let em=ec.transformStyle?ec.transformStyle(ed,en):en;if(!ec.validate||!xi(this,es.z(em))){for(let en in em=Object.assign({},em),this._loaded=!0,this.stylesheet=em,em.sources)this.addSource(en,em.sources[en],{validate:!1});em.sprite?this._loadSprite(em.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(em.glyphs),this._createLayers(),this.light=new I(this.stylesheet.light),this._setProjectionInternal((null===(ep=this.stylesheet.projection)||void 0===ep?void 0:ep.type)||"mercator"),this.sky=new S(this.stylesheet.sky),this.map.setTerrain(null!==(ef=this.stylesheet.terrain)&&void 0!==ef?ef:null),this.fire(new es.l("data",{dataType:"style"})),this.fire(new es.l("style.load"))}}_createLayers(){var en;let ec=es.bI(this.stylesheet.layers);for(let ed of(this.setGlobalState(null!==(en=this.stylesheet.state)&&void 0!==en?en:null),this.dispatcher.broadcast("SL",ec),this._order=ec.map(en=>en.id),this._layers={},this._serializedLayers=null,ec)){let en=es.bJ(ed,this._globalState);en.setEventedParent(this,{layer:{id:ed.id}}),this._layers[ed.id]=en}}_loadSprite(en,ec=!1,ed){let ep;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(en,ec,ed,ep){return es._(this,void 0,void 0,function*(){let ef=f(en),em=ed>1?"@2x":"",e_={},eg={};for(let{id:en,url:ed}of ef){let ef=ec.transformRequest(g(ed,em,".json"),"SpriteJSON");e_[en]=es.j(ef,ep);let ex=ec.transformRequest(g(ed,em,".png"),"SpriteImage");eg[en]=ey.getImage(ex,ep)}return yield Promise.all([...Object.values(e_),...Object.values(eg)]),function(en,ec){return es._(this,void 0,void 0,function*(){let es={};for(let ed in en){es[ed]={};let ep=ev.getImageCanvasContext((yield ec[ed]).data),ef=(yield en[ed]).data;for(let en in ef){let{width:ec,height:em,x:e_,y:eg,sdf:ey,pixelRatio:ex,stretchX:ev,stretchY:eb,content:ew,textFitWidth:eT,textFitHeight:eP}=ef[en];es[ed][en]={data:null,pixelRatio:ex,sdf:ey,stretchX:ev,stretchY:eb,content:ew,textFitWidth:eT,textFitHeight:eP,spriteData:{width:ec,height:em,x:e_,y:eg,context:ep}}}}return es})}(e_,eg)})})(en,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(en=>{if(this._spriteRequest=null,en)for(let es in en){this._spritesImagesIds[es]=[];let ed=this._spritesImagesIds[es]?this._spritesImagesIds[es].filter(es=>!(es in en)):[];for(let en of ed)this.imageManager.removeImage(en),this._changedImages[en]=!0;for(let ed in en[es]){let ep="default"===es?ed:`${es}:${ed}`;this._spritesImagesIds[es].push(ep),ep in this.imageManager.images?this.imageManager.updateImage(ep,en[es][ed],!1):this.imageManager.addImage(ep,en[es][ed]),ec&&(this._changedImages[ep]=!0)}}}).catch(en=>{this._spriteRequest=null,ep=en,this.fire(new es.k(ep))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),ec&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new es.l("data",{dataType:"style"})),ed&&ed(ep)})}_unloadSprite(){for(let en of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(en),this._changedImages[en]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new es.l("data",{dataType:"style"}))}_validateLayer(en){let ec=this.sourceCaches[en.source];if(!ec)return;let ed=en.sourceLayer;if(!ed)return;let ep=ec.getSource();("geojson"===ep.type||ep.vectorLayerIds&&-1===ep.vectorLayerIds.indexOf(ed))&&this.fire(new es.k(Error(`Source layer "${ed}" does not exist on source "${ep.id}" as specified by style layer "${en.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let en in this.sourceCaches)if(!this.sourceCaches[en].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(en,ec=!1){let ed=this._serializedAllLayers();if(!en||0===en.length)return Object.values(ec?es.bK(ed):ed);let ep=[];for(let ef of en)if(ed[ef]){let en=ec?es.bK(ed[ef]):ed[ef];ep.push(en)}return ep}_serializedAllLayers(){let en=this._serializedLayers;if(en)return en;en=this._serializedLayers={};let es=Object.keys(this._layers);for(let ec of es){let es=this._layers[ec];"custom"!==es.type&&(en[ec]=es.serialize())}return en}hasTransitions(){var en,es,ec;if((null===(en=this.light)||void 0===en?void 0:en.hasTransition())||(null===(es=this.sky)||void 0===es?void 0:es.hasTransition())||(null===(ec=this.projection)||void 0===ec?void 0:ec.hasTransition()))return!0;for(let en in this.sourceCaches)if(this.sourceCaches[en].hasTransition())return!0;for(let en in this._layers)if(this._layers[en].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading.")}update(en){if(!this._loaded)return;let ec=this._changed;if(ec){let es=Object.keys(this._updatedLayers),ec=Object.keys(this._removedLayers);for(let en in(es.length||ec.length)&&this._updateWorkerLayers(es,ec),this._updatedSources){let es=this._updatedSources[en];if("reload"===es)this._reloadSource(en);else{if("clear"!==es)throw Error(`Invalid action ${es}`);this._clearSource(en)}}for(let es in this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs(),this._updatedPaintProps)this._layers[es].updateTransitions(en);this.light.updateTransitions(en),this.sky.updateTransitions(en),this._resetUpdates()}let ed={};for(let en in this.sourceCaches){let es=this.sourceCaches[en];ed[en]=es.used,es.used=!1}for(let es of this._order){let ec=this._layers[es];ec.recalculate(en,this._availableImages),!ec.isHidden(en.zoom)&&ec.source&&(this.sourceCaches[ec.source].used=!0)}for(let en in ed){let ec=this.sourceCaches[en];!!ed[en]!=!!ec.used&&ec.fire(new es.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:en}))}this.light.recalculate(en),this.sky.recalculate(en),this.projection.recalculate(en),this.z=en.zoom,ec&&this.fire(new es.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let en=Object.keys(this._changedImages);if(en.length){for(let es in this.sourceCaches)this.sourceCaches[es].reloadTilesForDependencies(["icons","patterns"],en);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let en in this.sourceCaches)this.sourceCaches[en].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(en,es){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(en,!1),removedIds:es})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(en,ec={}){var ed;this._checkLoaded();let ep=this.serialize();if(en=ec.transformStyle?ec.transformStyle(ep,en):en,(null===(ed=ec.validate)||void 0===ed||ed)&&xi(this,es.z(en)))return!1;(en=es.bK(en)).layers=es.bI(en.layers);let ef=es.bL(ep,en),em=this._getOperationsToPerform(ef);if(em.unimplemented.length>0)throw Error(`Unimplemented: ${em.unimplemented.join(", ")}.`);if(0===em.operations.length)return!1;for(let en of em.operations)en();return this.stylesheet=en,this._serializedLayers=null,!0}_getOperationsToPerform(en){let es=[],ec=[];for(let ed of en)switch(ed.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":es.push(()=>this.addLayer.apply(this,ed.args));break;case"removeLayer":es.push(()=>this.removeLayer.apply(this,ed.args));break;case"setPaintProperty":es.push(()=>this.setPaintProperty.apply(this,ed.args));break;case"setLayoutProperty":es.push(()=>this.setLayoutProperty.apply(this,ed.args));break;case"setFilter":es.push(()=>this.setFilter.apply(this,ed.args));break;case"addSource":es.push(()=>this.addSource.apply(this,ed.args));break;case"removeSource":es.push(()=>this.removeSource.apply(this,ed.args));break;case"setLayerZoomRange":es.push(()=>this.setLayerZoomRange.apply(this,ed.args));break;case"setLight":es.push(()=>this.setLight.apply(this,ed.args));break;case"setGeoJSONSourceData":es.push(()=>this.setGeoJSONSourceData.apply(this,ed.args));break;case"setGlyphs":es.push(()=>this.setGlyphs.apply(this,ed.args));break;case"setSprite":es.push(()=>this.setSprite.apply(this,ed.args));break;case"setTerrain":es.push(()=>this.map.setTerrain.apply(this,ed.args));break;case"setSky":es.push(()=>this.setSky.apply(this,ed.args));break;case"setProjection":this.setProjection.apply(this,ed.args);break;case"setGlobalState":es.push(()=>this.setGlobalState.apply(this,ed.args));break;case"setTransition":es.push(()=>{});break;default:ec.push(ed.command)}return{operations:es,unimplemented:ec}}addImage(en,ec){if(this.getImage(en))return this.fire(new es.k(Error(`An image named "${en}" already exists.`)));this.imageManager.addImage(en,ec),this._afterImageUpdated(en)}updateImage(en,es){this.imageManager.updateImage(en,es)}getImage(en){return this.imageManager.getImage(en)}removeImage(en){if(!this.getImage(en))return this.fire(new es.k(Error(`An image named "${en}" does not exist.`)));this.imageManager.removeImage(en),this._afterImageUpdated(en)}_afterImageUpdated(en){this._availableImages=this.imageManager.listImages(),this._changedImages[en]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new es.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(en,ec,ed={}){if(this._checkLoaded(),void 0!==this.sourceCaches[en])throw Error(`Source "${en}" already exists.`);if(!ec.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(ec).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(ec.type)>=0&&this._validate(es.z.source,`sources.${en}`,ec,null,ed))return;this.map&&this.map._collectResourceTiming&&(ec.collectResourceTiming=!0);let ep=this.sourceCaches[en]=new xe(en,ec,this.dispatcher);ep.style=this,ep.setEventedParent(this,()=>({isSourceLoaded:ep.loaded(),source:ep.serialize(),sourceId:en})),ep.onAdd(this.map),this._changed=!0}removeSource(en){if(this._checkLoaded(),void 0===this.sourceCaches[en])throw Error("There is no source with this ID");for(let ec in this._layers)if(this._layers[ec].source===en)return this.fire(new es.k(Error(`Source "${en}" cannot be removed while layer "${ec}" is using it.`)));let ec=this.sourceCaches[en];delete this.sourceCaches[en],delete this._updatedSources[en],ec.fire(new es.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:en})),ec.setEventedParent(null),ec.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(en,es){if(this._checkLoaded(),void 0===this.sourceCaches[en])throw Error(`There is no source with this ID=${en}`);let ec=this.sourceCaches[en].getSource();if("geojson"!==ec.type)throw Error(`geojsonSource.type is ${ec.type}, which is !== 'geojson`);ec.setData(es),this._changed=!0}getSource(en){return this.sourceCaches[en]&&this.sourceCaches[en].getSource()}addLayer(en,ec,ed={}){let ep;this._checkLoaded();let ef=en.id;if(this.getLayer(ef))return void this.fire(new es.k(Error(`Layer "${ef}" already exists on this map.`)));if("custom"===en.type){if(xi(this,es.bM(en)))return;ep=es.bJ(en,this._globalState)}else{if("source"in en&&"object"==typeof en.source&&(this.addSource(ef,en.source),en=es.bK(en),en=es.e(en,{source:ef})),this._validate(es.z.layer,`layers.${ef}`,en,{arrayIndex:-1},ed))return;ep=es.bJ(en,this._globalState),this._validateLayer(ep),ep.setEventedParent(this,{layer:{id:ef}})}let em=ec?this._order.indexOf(ec):this._order.length;if(ec&&-1===em)this.fire(new es.k(Error(`Cannot add layer "${ef}" before non-existing layer "${ec}".`)));else{if(this._order.splice(em,0,ef),this._layerOrderChanged=!0,this._layers[ef]=ep,this._removedLayers[ef]&&ep.source&&"custom"!==ep.type){let en=this._removedLayers[ef];delete this._removedLayers[ef],en.type!==ep.type?this._updatedSources[ep.source]="clear":(this._updatedSources[ep.source]="reload",this.sourceCaches[ep.source].pause())}this._updateLayer(ep),ep.onAdd&&ep.onAdd(this.map)}}moveLayer(en,ec){if(this._checkLoaded(),this._changed=!0,!this._layers[en])return void this.fire(new es.k(Error(`The layer '${en}' does not exist in the map's style and cannot be moved.`)));if(en===ec)return;let ed=this._order.indexOf(en);this._order.splice(ed,1);let ep=ec?this._order.indexOf(ec):this._order.length;ec&&-1===ep?this.fire(new es.k(Error(`Cannot move layer "${en}" before non-existing layer "${ec}".`))):(this._order.splice(ep,0,en),this._layerOrderChanged=!0)}removeLayer(en){this._checkLoaded();let ec=this._layers[en];if(!ec)return void this.fire(new es.k(Error(`Cannot remove non-existing layer "${en}".`)));ec.setEventedParent(null);let ed=this._order.indexOf(en);this._order.splice(ed,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[en]=ec,delete this._layers[en],this._serializedLayers&&delete this._serializedLayers[en],delete this._updatedLayers[en],delete this._updatedPaintProps[en],ec.onRemove&&ec.onRemove(this.map)}getLayer(en){return this._layers[en]}getLayersOrder(){return[...this._order]}hasLayer(en){return en in this._layers}setLayerZoomRange(en,ec,ed){this._checkLoaded();let ep=this.getLayer(en);ep?ep.minzoom===ec&&ep.maxzoom===ed||(null!=ec&&(ep.minzoom=ec),null!=ed&&(ep.maxzoom=ed),this._updateLayer(ep)):this.fire(new es.k(Error(`Cannot set the zoom range of non-existing layer "${en}".`)))}setFilter(en,ec,ed={}){this._checkLoaded();let ep=this.getLayer(en);if(ep){if(!es.bH(ep.filter,ec))return null==ec?(ep.setFilter(void 0),void this._updateLayer(ep)):void(this._validate(es.z.filter,`layers.${ep.id}.filter`,ec,null,ed)||(ep.setFilter(es.bK(ec)),this._updateLayer(ep)))}else this.fire(new es.k(Error(`Cannot filter non-existing layer "${en}".`)))}getFilter(en){return es.bK(this.getLayer(en).filter)}setLayoutProperty(en,ec,ed,ep={}){this._checkLoaded();let ef=this.getLayer(en);ef?es.bH(ef.getLayoutProperty(ec),ed)||(ef.setLayoutProperty(ec,ed,ep),this._updateLayer(ef)):this.fire(new es.k(Error(`Cannot style non-existing layer "${en}".`)))}getLayoutProperty(en,ec){let ed=this.getLayer(en);if(ed)return ed.getLayoutProperty(ec);this.fire(new es.k(Error(`Cannot get style of non-existing layer "${en}".`)))}setPaintProperty(en,ec,ed,ep={}){this._checkLoaded();let ef=this.getLayer(en);ef?es.bH(ef.getPaintProperty(ec),ed)||this._updatePaintProperty(ef,ec,ed,ep):this.fire(new es.k(Error(`Cannot style non-existing layer "${en}".`)))}_updatePaintProperty(en,es,ec,ed={}){en.setPaintProperty(es,ec,ed)&&this._updateLayer(en),this._changed=!0,this._updatedPaintProps[en.id]=!0,this._serializedLayers=null}getPaintProperty(en,es){return this.getLayer(en).getPaintProperty(es)}setFeatureState(en,ec){this._checkLoaded();let ed=en.source,ep=en.sourceLayer,ef=this.sourceCaches[ed];if(void 0===ef)return void this.fire(new es.k(Error(`The source '${ed}' does not exist in the map's style.`)));let em=ef.getSource().type;"geojson"===em&&ep?this.fire(new es.k(Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==em||ep?(void 0===en.id&&this.fire(new es.k(Error("The feature id parameter must be provided."))),ef.setFeatureState(ep,en.id,ec)):this.fire(new es.k(Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(en,ec){this._checkLoaded();let ed=en.source,ep=this.sourceCaches[ed];if(void 0===ep)return void this.fire(new es.k(Error(`The source '${ed}' does not exist in the map's style.`)));let ef=ep.getSource().type,em="vector"===ef?en.sourceLayer:void 0;"vector"!==ef||em?ec&&"string"!=typeof en.id&&"number"!=typeof en.id?this.fire(new es.k(Error("A feature id is required to remove its specific state property."))):ep.removeFeatureState(em,en.id,ec):this.fire(new es.k(Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(en){this._checkLoaded();let ec=en.source,ed=en.sourceLayer,ep=this.sourceCaches[ec];if(void 0!==ep)return"vector"!==ep.getSource().type||ed?(void 0===en.id&&this.fire(new es.k(Error("The feature id parameter must be provided."))),ep.getFeatureState(ed,en.id)):void this.fire(new es.k(Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new es.k(Error(`The source '${ec}' does not exist in the map's style.`)))}getTransition(){return es.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let en=es.bN(this.sourceCaches,en=>en.serialize()),ec=this._serializeByIds(this._order,!0),ed=this.map.getTerrain()||void 0,ep=this.stylesheet;return es.bO({version:ep.version,name:ep.name,metadata:ep.metadata,light:ep.light,sky:ep.sky,center:ep.center,zoom:ep.zoom,bearing:ep.bearing,pitch:ep.pitch,sprite:ep.sprite,glyphs:ep.glyphs,transition:ep.transition,projection:ep.projection,sources:en,layers:ec,terrain:ed},en=>void 0!==en)}_updateLayer(en){this._updatedLayers[en.id]=!0,en.source&&!this._updatedSources[en.source]&&"raster"!==this.sourceCaches[en.source].getSource().type&&(this._updatedSources[en.source]="reload",this.sourceCaches[en.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(en){let t=en=>"fill-extrusion"===this._layers[en].type,es={},ec=[];for(let ed=this._order.length-1;ed>=0;ed--){let ep=this._order[ed];if(t(ep))for(let ef of(es[ep]=ed,en)){let en=ef[ep];if(en)for(let es of en)ec.push(es)}}ec.sort((en,es)=>es.intersectionZ-en.intersectionZ);let ed=[];for(let ep=this._order.length-1;ep>=0;ep--){let ef=this._order[ep];if(t(ef))for(let en=ec.length-1;en>=0;en--){let ef=ec[en].feature;if(es[ef.layer.id]<ep)break;ed.push(ef),ec.pop()}else for(let es of en){let en=es[ef];if(en)for(let es of en)ed.push(es.feature)}}return ed}queryRenderedFeatures(en,ec,ed){ec&&ec.filter&&this._validate(es.z.filter,"queryRenderedFeatures.filter",ec.filter,null,ec);let ep={};if(ec&&ec.layers){if(!(Array.isArray(ec.layers)||ec.layers instanceof Set))return this.fire(new es.k(Error("parameters.layers must be an Array or a Set of strings"))),[];for(let en of ec.layers){let ec=this._layers[en];if(!ec)return this.fire(new es.k(Error(`The layer '${en}' does not exist in the map's style and cannot be queried for features.`))),[];ep[ec.source]=!0}}let ef=[];ec.availableImages=this._availableImages;let em=this._serializedAllLayers(),e_=ec.layers instanceof Set?ec.layers:Array.isArray(ec.layers)?new Set(ec.layers):null,eg=Object.assign(Object.assign({},ec),{layers:e_,globalState:this._globalState});for(let e_ in this.sourceCaches)ec.layers&&!ep[e_]||ef.push(function(en,ec,ed,ep,ef,em,e_){var eg;let ey=function(en,es,ec){if(en)for(let ed of en){let en=es[ed];if(en&&en.source===ec&&"fill-extrusion"===en.type)return!0}else for(let en in es){let ed=es[en];if(ed.source===ec&&"fill-extrusion"===ed.type)return!0}return!1}(null!==(eg=null==ef?void 0:ef.layers)&&void 0!==eg?eg:null,ec,en.id),ex=em.maxPitchScaleFactor(),ev=en.tilesIn(ep,ex,ey);ev.sort(N);let eb=[];for(let ep of ev)eb.push({wrappedTileID:ep.tileID.wrapped().key,queryResults:ep.tile.queryRenderedFeatures(ec,ed,en._state,ep.queryGeometry,ep.cameraQueryGeometry,ep.scale,ef,em,ex,function(en,ec){let ed=es.L();return es.M(ed,ed,[1,1,0]),es.N(ed,ed,[.5*en.width,.5*en.height,1]),en.calculatePosMatrix?es.O(ed,ed,en.calculatePosMatrix(ec.toUnwrapped())):ed}(en.transform,ep.tileID),e_?(en,es)=>e_(ep.tileID,en,es):void 0)});return function(en,es){for(let ec in en)for(let ed of en[ec])U(ed,es);return en}(function(en){let es={},ec={};for(let ed of en){let en=ed.queryResults,ep=ed.wrappedTileID,ef=ec[ep]=ec[ep]||{};for(let ec in en){let ed=en[ec],ep=ef[ec]=ef[ec]||{},em=es[ec]=es[ec]||[];for(let en of ed)ep[en.featureIndex]||(ep[en.featureIndex]=!0,em.push(en))}}return es}(eb),en)}(this.sourceCaches[e_],this._layers,em,en,eg,ed,this.map.terrain?(en,es,ec)=>this.map.terrain.getElevation(en,es,ec):void 0));return this.placement&&ef.push(function(en,es,ec,ed,ep,ef,em){let e_={},eg=ef.queryRenderedSymbols(ed),ey=[];for(let en of Object.keys(eg).map(Number))ey.push(em[en]);for(let ec of(ey.sort(N),ey)){let ed=ec.featureIndex.lookupSymbolFeatures(eg[ec.bucketInstanceId],es,ec.bucketIndex,ec.sourceLayerIndex,{filterSpec:ep.filter,globalState:ep.globalState},ep.layers,ep.availableImages,en);for(let en in ed){let es=e_[en]=e_[en]||[],ep=ed[en];for(let en of(ep.sort((en,es)=>{let ed=ec.featureSortOrder;if(ed){let ec=ed.indexOf(en.featureIndex);return ed.indexOf(es.featureIndex)-ec}return es.featureIndex-en.featureIndex}),ep))es.push(en)}}return function(en,es,ec){for(let ed in en)for(let ep of en[ed])U(ep,ec[es[ed].source]);return en}(e_,en,ec)}(this._layers,em,this.sourceCaches,en,eg,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ef)}querySourceFeatures(en,ec){(null==ec?void 0:ec.filter)&&this._validate(es.z.filter,"querySourceFeatures.filter",ec.filter,null,ec);let ed=this.sourceCaches[en];return ed?function(en,es){let ec=en.getRenderableIds().map(es=>en.getTileByID(es)),ed=[],ep={};for(let en=0;en<ec.length;en++){let ef=ec[en],em=ef.tileID.canonical.key;ep[em]||(ep[em]=!0,ef.querySourceFeatures(ed,es))}return ed}(ed,ec?Object.assign(Object.assign({},ec),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(en,ec={}){this._checkLoaded();let ed=this.light.getLight(),ep=!1;for(let ec in en)if(!es.bH(en[ec],ed[ec])){ep=!0;break}if(!ep)return;let ef={now:ev.now(),transition:es.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(en,ec),this.light.updateTransitions(ef)}getProjection(){var en;return null===(en=this.stylesheet)||void 0===en?void 0:en.projection}setProjection(en){if(this._checkLoaded(),this.projection){if(this.projection.name===en.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=en,this._setProjectionInternal(en.type)}getSky(){var en;return null===(en=this.stylesheet)||void 0===en?void 0:en.sky}setSky(en,ec={}){this._checkLoaded();let ed=this.getSky(),ep=!1;if(!en&&!ed)return;if(en&&!ed)ep=!0;else if(!en&&ed)ep=!0;else for(let ec in en)if(!es.bH(en[ec],ed[ec])){ep=!0;break}if(!ep)return;let ef={now:ev.now(),transition:es.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=en,this.sky.setSky(en,ec),this.sky.updateTransitions(ef)}_setProjectionInternal(en){let ec=function(en){if(Array.isArray(en)){let es=new Jt({type:en});return{projection:es,transform:new gi,cameraHelper:new bi(es)}}switch(en){case"mercator":return{projection:new It,transform:new Lt,cameraHelper:new Ot};case"globe":{let en=new Jt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:en,transform:new gi,cameraHelper:new bi(en)}}case"vertical-perspective":return{projection:new Yt,transform:new fi,cameraHelper:new vi};default:return es.w(`Unknown projection name: ${en}. Falling back to mercator projection.`),{projection:new It,transform:new Lt,cameraHelper:new Ot}}}(en);for(let en in this.projection=ec.projection,this.map.migrateProjection(ec.transform,ec.cameraHelper),this.sourceCaches)this.sourceCaches[en].reload()}_validate(en,ec,ed,ep,ef={}){return(!ef||!1!==ef.validate)&&xi(this,en.call(es.z,es.e({key:ec,style:this.serialize(),value:ed,styleSpec:es.v},ep)))}_remove(en=!0){for(let en in this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),oe().off(eA,this._rtlPluginLoaded),this._layers)this._layers[en].setEventedParent(null);for(let en in this.sourceCaches){let es=this.sourceCaches[en];es.setEventedParent(null),es.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),en&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(en)}_clearSource(en){this.sourceCaches[en].clearTiles()}_reloadSource(en){this.sourceCaches[en].resume(),this.sourceCaches[en].reload()}_updateSources(en){for(let es in this.sourceCaches)this.sourceCaches[es].update(en,this.map.terrain)}_generateCollisionBoxes(){for(let en in this.sourceCaches)this._reloadSource(en)}_updatePlacement(en,es,ec,ed,ep=!1){let ef=!1,em=!1,e_={};for(let es of this._order){let ec=this._layers[es];if("symbol"!==ec.type)continue;if(!e_[ec.source]){let en=this.sourceCaches[ec.source];e_[ec.source]=en.getRenderableIds(!0).map(es=>en.getTileByID(es)).sort((en,es)=>es.tileID.overscaledZ-en.tileID.overscaledZ||(en.tileID.isLessThan(es.tileID)?-1:1))}let ed=this.crossTileSymbolIndex.addLayer(ec,e_[ec.source],en.center.lng);ef=ef||ed}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((ep=ep||this._layerOrderChanged||0===ec)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ev.now(),en.zoom))&&(this.pauseablePlacement=new _t(en,this.map.terrain,this._order,ep,es,ec,ed,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,e_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ev.now()),em=!0),ef&&this.pauseablePlacement.placement.setStale()),em||ef)for(let en of this._order){let es=this._layers[en];"symbol"===es.type&&this.placement.updateLayerOpacities(es,e_[es.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ev.now())}_releaseSymbolFadeTiles(){for(let en in this.sourceCaches)this.sourceCaches[en].releaseSymbolFadeTiles()}getImages(en,ec){return es._(this,void 0,void 0,function*(){let en=yield this.imageManager.getImages(ec.icons);this._updateTilesForChangedImages();let es=this.sourceCaches[ec.source];return es&&es.setDependencies(ec.tileID.key,ec.type,ec.icons),en})}getGlyphs(en,ec){return es._(this,void 0,void 0,function*(){let en=yield this.glyphManager.getGlyphs(ec.stacks),es=this.sourceCaches[ec.source];return es&&es.setDependencies(ec.tileID.key,ec.type,[""]),en})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(en,ec={}){this._checkLoaded(),en&&this._validate(es.z.glyphs,"glyphs",en,null,ec)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=en,this.glyphManager.entries={},this.glyphManager.setURL(en))}getDashes(en,ec){return es._(this,void 0,void 0,function*(){let en={};for(let[es,ed]of Object.entries(ec.dashes))en[es]=this.lineAtlas.getDash(ed.dasharray,ed.round);return en})}addSprite(en,ec,ed={},ep){this._checkLoaded();let ef=[{id:en,url:ec}],em=[...f(this.stylesheet.sprite),...ef];this._validate(es.z.sprite,"sprite",em,null,ed)||(this.stylesheet.sprite=em,this._loadSprite(ef,!0,ep))}removeSprite(en){this._checkLoaded();let ec=f(this.stylesheet.sprite);if(ec.find(es=>es.id===en)){if(this._spritesImagesIds[en])for(let es of this._spritesImagesIds[en])this.imageManager.removeImage(es),this._changedImages[es]=!0;ec.splice(ec.findIndex(es=>es.id===en),1),this.stylesheet.sprite=ec.length>0?ec:void 0,delete this._spritesImagesIds[en],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new es.l("data",{dataType:"style"}))}else this.fire(new es.k(Error(`Sprite "${en}" doesn't exists on this map.`)))}getSprite(){return f(this.stylesheet.sprite)}setSprite(en,ec={},ed){this._checkLoaded(),en&&this._validate(es.z.sprite,"sprite",en,null,ec)||(this.stylesheet.sprite=en,en?this._loadSprite(en,!0,ed):(this._unloadSprite(),ed&&ed(null)))}};var eW=es.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let Pi=class Pi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(en,es,ec,ed,ep,ef,em,e_,eg){this.context=en;let ey=this.boundPaintVertexBuffers.length!==ed.length;for(let en=0;!ey&&en<ed.length;en++)this.boundPaintVertexBuffers[en]!==ed[en]&&(ey=!0);!this.vao||this.boundProgram!==es||this.boundLayoutVertexBuffer!==ec||ey||this.boundIndexBuffer!==ep||this.boundVertexOffset!==ef||this.boundDynamicVertexBuffer!==em||this.boundDynamicVertexBuffer2!==e_||this.boundDynamicVertexBuffer3!==eg?this.freshBind(es,ec,ed,ep,ef,em,e_,eg):(en.bindVertexArray.set(this.vao),em&&em.bind(),ep&&ep.dynamicDraw&&ep.bind(),e_&&e_.bind(),eg&&eg.bind())}freshBind(en,es,ec,ed,ep,ef,em,e_){let eg=en.numAttributes,ey=this.context,ex=ey.gl;for(let eg of(this.vao&&this.destroy(),this.vao=ey.createVertexArray(),ey.bindVertexArray.set(this.vao),this.boundProgram=en,this.boundLayoutVertexBuffer=es,this.boundPaintVertexBuffers=ec,this.boundIndexBuffer=ed,this.boundVertexOffset=ep,this.boundDynamicVertexBuffer=ef,this.boundDynamicVertexBuffer2=em,this.boundDynamicVertexBuffer3=e_,es.enableAttributes(ex,en),ec))eg.enableAttributes(ex,en);for(let ed of(ef&&ef.enableAttributes(ex,en),em&&em.enableAttributes(ex,en),e_&&e_.enableAttributes(ex,en),es.bind(),es.setVertexAttribPointers(ex,en,ep),ec))ed.bind(),ed.setVertexAttribPointers(ex,en,ep);ef&&(ef.bind(),ef.setVertexAttribPointers(ex,en,ep)),ed&&ed.bind(),em&&(em.bind(),em.setVertexAttribPointers(ex,en,ep)),e_&&(e_.bind(),e_.setVertexAttribPointers(ex,en,ep)),ey.currentNumAttributes=eg}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}};let Ci=(en,ec,ed,ep,ef)=>({u_texture:0,u_ele_delta:en,u_fog_matrix:ec,u_fog_color:ed?ed.properties.get("fog-color"):es.bf.white,u_fog_ground_blend:ed?ed.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:ef?0:ed?ed.calculateFogBlendOpacity(ep):0,u_horizon_color:ed?ed.properties.get("horizon-color"):es.bf.white,u_horizon_fog_blend:ed?ed.properties.get("horizon-fog-blend"):1,u_is_globe_mode:ef?1:0}),eH={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Mi(en){let es=[];for(let ec=0;ec<en.length;ec++){if(null===en[ec])continue;let ed=en[ec].split(" ");es.push(ed.pop())}return es}let Si=class Si{constructor(en,ec,ed,ep,ef,em,e_,eg,ey=[]){let ex=en.gl;this.program=ex.createProgram();let ev=Mi(ec.staticAttributes),eb=ed?ed.getBinderAttributes():[],ew=ev.concat(eb),eT=eO.prelude.staticUniforms?Mi(eO.prelude.staticUniforms):[],eP=e_.staticUniforms?Mi(e_.staticUniforms):[],eS=ec.staticUniforms?Mi(ec.staticUniforms):[],eM=ed?ed.getBinderUniforms():[],eC=eT.concat(eP).concat(eS).concat(eM),eI=[];for(let en of eC)0>eI.indexOf(en)&&eI.push(en);let eE=ed?ed.defines():[];qt(ex)&&eE.unshift("#version 300 es"),ef&&eE.push("#define OVERDRAW_INSPECTOR;"),em&&eE.push("#define TERRAIN3D;"),eg&&eE.push(eg),ey&&eE.push(...ey);let eA=eE.concat(eO.prelude.fragmentSource,e_.fragmentSource,ec.fragmentSource).join("\n"),ez=eE.concat(eO.prelude.vertexSource,e_.vertexSource,ec.vertexSource).join("\n");qt(ex)||(eA=eA.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D("),ez=ez.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D("));let ek=ex.createShader(ex.FRAGMENT_SHADER);if(ex.isContextLost())return void(this.failedToCreate=!0);if(ex.shaderSource(ek,eA),ex.compileShader(ek),!ex.getShaderParameter(ek,ex.COMPILE_STATUS))throw Error(`Could not compile fragment shader: ${ex.getShaderInfoLog(ek)}`);ex.attachShader(this.program,ek);let eD=ex.createShader(ex.VERTEX_SHADER);if(ex.isContextLost())return void(this.failedToCreate=!0);if(ex.shaderSource(eD,ez),ex.compileShader(eD),!ex.getShaderParameter(eD,ex.COMPILE_STATUS))throw Error(`Could not compile vertex shader: ${ex.getShaderInfoLog(eD)}`);ex.attachShader(this.program,eD),this.attributes={};let eR={};this.numAttributes=ew.length;for(let en=0;en<this.numAttributes;en++)ew[en]&&(ex.bindAttribLocation(this.program,en,ew[en]),this.attributes[ew[en]]=en);if(ex.linkProgram(this.program),!ex.getProgramParameter(this.program,ex.LINK_STATUS))throw Error(`Program failed to link: ${ex.getProgramInfoLog(this.program)}`);ex.deleteShader(eD),ex.deleteShader(ek);for(let en=0;en<eI.length;en++){let es=eI[en];if(es&&!eR[es]){let en=ex.getUniformLocation(this.program,es);en&&(eR[es]=en)}}this.fixedUniforms=ep(en,eR),this.terrainUniforms={u_depth:new es.bP(en,eR.u_depth),u_terrain:new es.bP(en,eR.u_terrain),u_terrain_dim:new es.bg(en,eR.u_terrain_dim),u_terrain_matrix:new es.bR(en,eR.u_terrain_matrix),u_terrain_unpack:new es.bS(en,eR.u_terrain_unpack),u_terrain_exaggeration:new es.bg(en,eR.u_terrain_exaggeration)},this.projectionUniforms={u_projection_matrix:new es.bR(en,eR.u_projection_matrix),u_projection_tile_mercator_coords:new es.bS(en,eR.u_projection_tile_mercator_coords),u_projection_clipping_plane:new es.bS(en,eR.u_projection_clipping_plane),u_projection_transition:new es.bg(en,eR.u_projection_transition),u_projection_fallback_matrix:new es.bR(en,eR.u_projection_fallback_matrix)},this.binderUniforms=ed?ed.getUniforms(en,eR):[]}draw(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT,eP,eS,eM,eC){let eI=en.gl;if(this.failedToCreate)return;if(en.program.set(this.program),en.setDepthMode(ec),en.setStencilMode(ed),en.setColorMode(ep),en.setCullFace(ef),e_)for(let es in en.activeTexture.set(eI.TEXTURE2),eI.bindTexture(eI.TEXTURE_2D,e_.depthTexture),en.activeTexture.set(eI.TEXTURE3),eI.bindTexture(eI.TEXTURE_2D,e_.texture),this.terrainUniforms)this.terrainUniforms[es].set(e_[es]);if(eg)for(let en in eg)this.projectionUniforms[eH[en]].set(eg[en]);if(em)for(let en in this.fixedUniforms)this.fixedUniforms[en].set(em[en]);eP&&eP.setUniforms(en,this.binderUniforms,ew,{zoom:eT});let eE=0;switch(es){case eI.LINES:eE=2;break;case eI.TRIANGLES:eE=3;break;case eI.LINE_STRIP:eE=1}for(let ec of eb.get()){let ed=ec.vaos||(ec.vaos={});(ed[ey]||(ed[ey]=new Pi)).bind(en,this,ex,eP?eP.getPaintVertexBuffers():[],ev,ec.vertexOffset,eS,eM,eC),eI.drawElements(es,ec.primitiveLength*eE,eI.UNSIGNED_SHORT,ec.primitiveOffset*eE*2)}}};function Ei(en,ec,ed){let ep=1/es.aC(ed,1,ec.transform.tileZoom),ef=Math.pow(2,ed.tileID.overscaledZ),em=ed.tileSize*Math.pow(2,ec.transform.tileZoom)/ef,e_=em*(ed.tileID.canonical.x+ed.tileID.wrap*ef),eg=em*ed.tileID.canonical.y;return{u_image:0,u_texsize:ed.imageAtlasTexture.size,u_scale:[ep,en.fromScale,en.toScale],u_fade:en.t,u_pixel_coord_upper:[e_>>16,eg>>16],u_pixel_coord_lower:[65535&e_,65535&eg]}}let Ri=(en,ec,ed,ep)=>{let ef=en.style.light,em=ef.properties.get("position"),e_=[em.x,em.y,em.z],eg=es.bV();"viewport"===ef.properties.get("anchor")&&es.bW(eg,en.transform.bearingInRadians),es.bX(e_,e_,eg);let ey=en.transform.transformLightDirection(e_),ex=ef.properties.get("color");return{u_lightpos:e_,u_lightpos_globe:ey,u_lightintensity:ef.properties.get("intensity"),u_lightcolor:[ex.r,ex.g,ex.b],u_vertical_gradient:+ec,u_opacity:ed,u_fill_translate:ep}},zi=(en,ec,ed,ep,ef,em,e_)=>es.e(Ri(en,ec,ed,ep),Ei(em,en,e_),{u_height_factor:-Math.pow(2,ef.overscaledZ)/e_.tileSize/8}),Di=(en,ec,ed,ep)=>es.e(Ei(ec,en,ed),{u_fill_translate:ep}),Ai=(en,es)=>({u_world:en,u_fill_translate:es}),Li=(en,ec,ed,ep,ef)=>es.e(Di(en,ec,ed,ef),{u_world:ep}),ki=(en,ec,ed,ep,ef)=>{let em=en.transform,e_,eg,ey=0;if("map"===ed.paint.get("circle-pitch-alignment")){let en=es.aC(ec,1,em.zoom);e_=!0,eg=[en,en],ey=en/(es.$*Math.pow(2,ec.tileID.overscaledZ))*2*Math.PI*ef}else e_=!1,eg=em.pixelsToGLUnits;return{u_camera_to_center_distance:em.cameraToCenterDistance,u_scale_with_map:+("map"===ed.paint.get("circle-pitch-scale")),u_pitch_with_map:+e_,u_device_pixel_ratio:en.pixelRatio,u_extrude_scale:eg,u_globe_extrude_scale:ey,u_translate:ep}},Fi=en=>({u_pixel_extrude_scale:[1/en.width,1/en.height]}),Bi=en=>({u_viewport_size:[en.width,en.height]}),Oi=(en,es=1)=>({u_color:en,u_overlay:0,u_overlay_scale:es}),ji=(en,ec,ed,ep)=>{let ef=es.aC(en,1,ec)/(es.$*Math.pow(2,en.tileID.overscaledZ))*2*Math.PI*ep;return{u_extrude_scale:es.aC(en,1,ec),u_intensity:ed,u_globe_extrude_scale:ef}},Ni=(en,ec,ed,ep)=>{let ef=es.L();es.bY(ef,0,en.width,en.height,0,0,1);let em=en.context.gl;return{u_matrix:ef,u_world:[em.drawingBufferWidth,em.drawingBufferHeight],u_image:ed,u_color_ramp:ep,u_opacity:ec.paint.get("heatmap-opacity")}},Ui=(en,ec,ed)=>{let ep;let ef=ed.paint.get("hillshade-accent-color");switch(ed.paint.get("hillshade-method")){case"basic":ep=4;break;case"combined":ep=1;break;case"igor":ep=2;break;case"multidirectional":ep=3;break;default:ep=0}let em=ed.getIlluminationProperties();for(let es=0;es<em.directionRadians.length;es++)"viewport"===ed.paint.get("hillshade-illumination-anchor")&&(em.directionRadians[es]+=en.transform.bearingInRadians);return{u_image:0,u_latrange:function(en,ec){let ed=Math.pow(2,ec.canonical.z),ep=ec.canonical.y;return[new es.a1(0,ep/ed).toLngLat().lat,new es.a1(0,(ep+1)/ed).toLngLat().lat]}(0,ec.tileID),u_exaggeration:ed.paint.get("hillshade-exaggeration"),u_altitudes:em.altitudeRadians,u_azimuths:em.directionRadians,u_accent:ef,u_method:ep,u_highlights:em.highlightColor,u_shadows:em.shadowColor}},Zi=(en,ec)=>{let ed=ec.stride,ep=es.L();return es.bY(ep,0,es.$,-es.$,0,0,1),es.M(ep,ep,[0,-es.$,0]),{u_matrix:ep,u_image:1,u_dimension:[ed,ed],u_zoom:en.overscaledZ,u_unpack:ec.getUnpackVector()}},Vi=(en,es,ec=0)=>({u_image:0,u_unpack:es.getUnpackVector(),u_dimension:[es.stride,es.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:ec,u_opacity:en.paint.get("color-relief-opacity")}),$i=(en,ec,ed,ep)=>{let ef=en.transform;return{u_translation:Ki(en,ec,ed),u_ratio:ep/es.aC(ec,1,ef.zoom),u_device_pixel_ratio:en.pixelRatio,u_units_to_pixels:[1/ef.pixelsToGLUnits[0],1/ef.pixelsToGLUnits[1]]}},qi=(en,ec,ed,ep,ef)=>es.e($i(en,ec,ed,ep),{u_image:0,u_image_height:ef}),Wi=(en,ec,ed,ep,ef)=>{let em=en.transform,e_=Xi(ec,em);return{u_translation:Ki(en,ec,ed),u_texsize:ec.imageAtlasTexture.size,u_ratio:ep/es.aC(ec,1,em.zoom),u_device_pixel_ratio:en.pixelRatio,u_image:0,u_scale:[e_,ef.fromScale,ef.toScale],u_fade:ef.t,u_units_to_pixels:[1/em.pixelsToGLUnits[0],1/em.pixelsToGLUnits[1]]}},Hi=(en,ec,ed,ep,ef)=>{let em=Xi(ec,en.transform);return es.e($i(en,ec,ed,ep),{u_tileratio:em,u_crossfade_from:ef.fromScale,u_crossfade_to:ef.toScale,u_image:0,u_mix:ef.t,u_lineatlas_width:en.lineAtlas.width,u_lineatlas_height:en.lineAtlas.height})};function Xi(en,ec){return 1/es.aC(en,1,ec.tileZoom)}function Ki(en,ec,ed){return es.aD(en.transform,ec,ed.paint.get("line-translate"),ed.paint.get("line-translate-anchor"))}let Yi=(en,es,ec,ed,ep)=>{var ef,em;return{u_tl_parent:en,u_scale_parent:es,u_buffer_scale:1,u_fade_t:ec.mix,u_opacity:ec.opacity*ed.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ed.paint.get("raster-brightness-min"),u_brightness_high:ed.paint.get("raster-brightness-max"),u_saturation_factor:(em=ed.paint.get("raster-saturation"))>0?1-1/(1.001-em):-em,u_contrast_factor:(ef=ed.paint.get("raster-contrast"))>0?1/(1-ef):1+ef,u_spin_weights:function(en){en*=Math.PI/180;let es=Math.sin(en),ec=Math.cos(en);return[(2*ec+1)/3,(-Math.sqrt(3)*es-ec+1)/3,(Math.sqrt(3)*es-ec+1)/3]}(ed.paint.get("raster-hue-rotate")),u_coords_top:[ep[0].x,ep[0].y,ep[1].x,ep[1].y],u_coords_bottom:[ep[3].x,ep[3].y,ep[2].x,ep[2].y]}},Ji=(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb)=>{let ew=em.transform;return{u_is_size_zoom_constant:+("constant"===en||"source"===en),u_is_size_feature_constant:+("constant"===en||"camera"===en),u_size_t:es?es.uSizeT:0,u_size:es?es.uSize:0,u_camera_to_center_distance:ew.cameraToCenterDistance,u_pitch:ew.pitch/360*2*Math.PI,u_rotate_symbol:+ec,u_aspect_ratio:ew.width/ew.height,u_fade_change:em.options.fadeDuration?em.symbolFadeChange:1,u_label_plane_matrix:e_,u_coord_matrix:eg,u_is_text:+ex,u_pitch_with_map:+ed,u_is_along_line:ep,u_is_variable_anchor:ef,u_texsize:ev,u_texture:0,u_translation:ey,u_pitched_scale:eb}},eo=(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew,eT)=>{let eP=e_.transform;return es.e(Ji(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,eT),{u_gamma_scale:ep?Math.cos(eP.pitch*Math.PI/180)*eP.cameraToCenterDistance:1,u_device_pixel_ratio:e_.pixelRatio,u_is_halo:1})},to=(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew)=>es.e(eo(en,ec,ed,ep,ef,em,e_,eg,ey,ex,!0,ev,0,ew),{u_texsize_icon:eb,u_texture_icon:1}),io=(en,es)=>({u_opacity:en,u_color:es}),oo=(en,ec,ed,ep,ef)=>es.e(function(en,ec,ed,ep){let ef=ed.imageManager.getPattern(en.from.toString()),em=ed.imageManager.getPattern(en.to.toString()),{width:e_,height:eg}=ed.imageManager.getPixelSize(),ey=Math.pow(2,ep.tileID.overscaledZ),ex=ep.tileSize*Math.pow(2,ed.transform.tileZoom)/ey,ev=ex*(ep.tileID.canonical.x+ep.tileID.wrap*ey),eb=ex*ep.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ef.tl,u_pattern_br_a:ef.br,u_pattern_tl_b:em.tl,u_pattern_br_b:em.br,u_texsize:[e_,eg],u_mix:ec.t,u_pattern_size_a:ef.displaySize,u_pattern_size_b:em.displaySize,u_scale_a:ec.fromScale,u_scale_b:ec.toScale,u_tile_units_to_pixels:1/es.aC(ep,1,ed.transform.tileZoom),u_pixel_coord_upper:[ev>>16,eb>>16],u_pixel_coord_lower:[65535&ev,65535&eb]}}(ed,ef,ec,ep),{u_opacity:en}),ro=(en,es)=>{},eX={fillExtrusion:(en,ec)=>({u_lightpos:new es.bT(en,ec.u_lightpos),u_lightpos_globe:new es.bT(en,ec.u_lightpos_globe),u_lightintensity:new es.bg(en,ec.u_lightintensity),u_lightcolor:new es.bT(en,ec.u_lightcolor),u_vertical_gradient:new es.bg(en,ec.u_vertical_gradient),u_opacity:new es.bg(en,ec.u_opacity),u_fill_translate:new es.bU(en,ec.u_fill_translate)}),fillExtrusionPattern:(en,ec)=>({u_lightpos:new es.bT(en,ec.u_lightpos),u_lightpos_globe:new es.bT(en,ec.u_lightpos_globe),u_lightintensity:new es.bg(en,ec.u_lightintensity),u_lightcolor:new es.bT(en,ec.u_lightcolor),u_vertical_gradient:new es.bg(en,ec.u_vertical_gradient),u_height_factor:new es.bg(en,ec.u_height_factor),u_opacity:new es.bg(en,ec.u_opacity),u_fill_translate:new es.bU(en,ec.u_fill_translate),u_image:new es.bP(en,ec.u_image),u_texsize:new es.bU(en,ec.u_texsize),u_pixel_coord_upper:new es.bU(en,ec.u_pixel_coord_upper),u_pixel_coord_lower:new es.bU(en,ec.u_pixel_coord_lower),u_scale:new es.bT(en,ec.u_scale),u_fade:new es.bg(en,ec.u_fade)}),fill:(en,ec)=>({u_fill_translate:new es.bU(en,ec.u_fill_translate)}),fillPattern:(en,ec)=>({u_image:new es.bP(en,ec.u_image),u_texsize:new es.bU(en,ec.u_texsize),u_pixel_coord_upper:new es.bU(en,ec.u_pixel_coord_upper),u_pixel_coord_lower:new es.bU(en,ec.u_pixel_coord_lower),u_scale:new es.bT(en,ec.u_scale),u_fade:new es.bg(en,ec.u_fade),u_fill_translate:new es.bU(en,ec.u_fill_translate)}),fillOutline:(en,ec)=>({u_world:new es.bU(en,ec.u_world),u_fill_translate:new es.bU(en,ec.u_fill_translate)}),fillOutlinePattern:(en,ec)=>({u_world:new es.bU(en,ec.u_world),u_image:new es.bP(en,ec.u_image),u_texsize:new es.bU(en,ec.u_texsize),u_pixel_coord_upper:new es.bU(en,ec.u_pixel_coord_upper),u_pixel_coord_lower:new es.bU(en,ec.u_pixel_coord_lower),u_scale:new es.bT(en,ec.u_scale),u_fade:new es.bg(en,ec.u_fade),u_fill_translate:new es.bU(en,ec.u_fill_translate)}),circle:(en,ec)=>({u_camera_to_center_distance:new es.bg(en,ec.u_camera_to_center_distance),u_scale_with_map:new es.bP(en,ec.u_scale_with_map),u_pitch_with_map:new es.bP(en,ec.u_pitch_with_map),u_extrude_scale:new es.bU(en,ec.u_extrude_scale),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_globe_extrude_scale:new es.bg(en,ec.u_globe_extrude_scale),u_translate:new es.bU(en,ec.u_translate)}),collisionBox:(en,ec)=>({u_pixel_extrude_scale:new es.bU(en,ec.u_pixel_extrude_scale)}),collisionCircle:(en,ec)=>({u_viewport_size:new es.bU(en,ec.u_viewport_size)}),debug:(en,ec)=>({u_color:new es.bQ(en,ec.u_color),u_overlay:new es.bP(en,ec.u_overlay),u_overlay_scale:new es.bg(en,ec.u_overlay_scale)}),depth:ro,clippingMask:ro,heatmap:(en,ec)=>({u_extrude_scale:new es.bg(en,ec.u_extrude_scale),u_intensity:new es.bg(en,ec.u_intensity),u_globe_extrude_scale:new es.bg(en,ec.u_globe_extrude_scale)}),heatmapTexture:(en,ec)=>({u_matrix:new es.bR(en,ec.u_matrix),u_world:new es.bU(en,ec.u_world),u_image:new es.bP(en,ec.u_image),u_color_ramp:new es.bP(en,ec.u_color_ramp),u_opacity:new es.bg(en,ec.u_opacity)}),hillshade:(en,ec)=>({u_image:new es.bP(en,ec.u_image),u_latrange:new es.bU(en,ec.u_latrange),u_exaggeration:new es.bg(en,ec.u_exaggeration),u_altitudes:new es.b_(en,ec.u_altitudes),u_azimuths:new es.b_(en,ec.u_azimuths),u_accent:new es.bQ(en,ec.u_accent),u_method:new es.bP(en,ec.u_method),u_shadows:new es.bZ(en,ec.u_shadows),u_highlights:new es.bZ(en,ec.u_highlights)}),hillshadePrepare:(en,ec)=>({u_matrix:new es.bR(en,ec.u_matrix),u_image:new es.bP(en,ec.u_image),u_dimension:new es.bU(en,ec.u_dimension),u_zoom:new es.bg(en,ec.u_zoom),u_unpack:new es.bS(en,ec.u_unpack)}),colorRelief:(en,ec)=>({u_image:new es.bP(en,ec.u_image),u_unpack:new es.bS(en,ec.u_unpack),u_dimension:new es.bU(en,ec.u_dimension),u_elevation_stops:new es.bP(en,ec.u_elevation_stops),u_color_stops:new es.bP(en,ec.u_color_stops),u_color_ramp_size:new es.bP(en,ec.u_color_ramp_size),u_opacity:new es.bg(en,ec.u_opacity)}),line:(en,ec)=>({u_translation:new es.bU(en,ec.u_translation),u_ratio:new es.bg(en,ec.u_ratio),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_units_to_pixels:new es.bU(en,ec.u_units_to_pixels)}),lineGradient:(en,ec)=>({u_translation:new es.bU(en,ec.u_translation),u_ratio:new es.bg(en,ec.u_ratio),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_units_to_pixels:new es.bU(en,ec.u_units_to_pixels),u_image:new es.bP(en,ec.u_image),u_image_height:new es.bg(en,ec.u_image_height)}),linePattern:(en,ec)=>({u_translation:new es.bU(en,ec.u_translation),u_texsize:new es.bU(en,ec.u_texsize),u_ratio:new es.bg(en,ec.u_ratio),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_image:new es.bP(en,ec.u_image),u_units_to_pixels:new es.bU(en,ec.u_units_to_pixels),u_scale:new es.bT(en,ec.u_scale),u_fade:new es.bg(en,ec.u_fade)}),lineSDF:(en,ec)=>({u_translation:new es.bU(en,ec.u_translation),u_ratio:new es.bg(en,ec.u_ratio),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_units_to_pixels:new es.bU(en,ec.u_units_to_pixels),u_image:new es.bP(en,ec.u_image),u_mix:new es.bg(en,ec.u_mix),u_tileratio:new es.bg(en,ec.u_tileratio),u_crossfade_from:new es.bg(en,ec.u_crossfade_from),u_crossfade_to:new es.bg(en,ec.u_crossfade_to),u_lineatlas_width:new es.bg(en,ec.u_lineatlas_width),u_lineatlas_height:new es.bg(en,ec.u_lineatlas_height)}),raster:(en,ec)=>({u_tl_parent:new es.bU(en,ec.u_tl_parent),u_scale_parent:new es.bg(en,ec.u_scale_parent),u_buffer_scale:new es.bg(en,ec.u_buffer_scale),u_fade_t:new es.bg(en,ec.u_fade_t),u_opacity:new es.bg(en,ec.u_opacity),u_image0:new es.bP(en,ec.u_image0),u_image1:new es.bP(en,ec.u_image1),u_brightness_low:new es.bg(en,ec.u_brightness_low),u_brightness_high:new es.bg(en,ec.u_brightness_high),u_saturation_factor:new es.bg(en,ec.u_saturation_factor),u_contrast_factor:new es.bg(en,ec.u_contrast_factor),u_spin_weights:new es.bT(en,ec.u_spin_weights),u_coords_top:new es.bS(en,ec.u_coords_top),u_coords_bottom:new es.bS(en,ec.u_coords_bottom)}),symbolIcon:(en,ec)=>({u_is_size_zoom_constant:new es.bP(en,ec.u_is_size_zoom_constant),u_is_size_feature_constant:new es.bP(en,ec.u_is_size_feature_constant),u_size_t:new es.bg(en,ec.u_size_t),u_size:new es.bg(en,ec.u_size),u_camera_to_center_distance:new es.bg(en,ec.u_camera_to_center_distance),u_pitch:new es.bg(en,ec.u_pitch),u_rotate_symbol:new es.bP(en,ec.u_rotate_symbol),u_aspect_ratio:new es.bg(en,ec.u_aspect_ratio),u_fade_change:new es.bg(en,ec.u_fade_change),u_label_plane_matrix:new es.bR(en,ec.u_label_plane_matrix),u_coord_matrix:new es.bR(en,ec.u_coord_matrix),u_is_text:new es.bP(en,ec.u_is_text),u_pitch_with_map:new es.bP(en,ec.u_pitch_with_map),u_is_along_line:new es.bP(en,ec.u_is_along_line),u_is_variable_anchor:new es.bP(en,ec.u_is_variable_anchor),u_texsize:new es.bU(en,ec.u_texsize),u_texture:new es.bP(en,ec.u_texture),u_translation:new es.bU(en,ec.u_translation),u_pitched_scale:new es.bg(en,ec.u_pitched_scale)}),symbolSDF:(en,ec)=>({u_is_size_zoom_constant:new es.bP(en,ec.u_is_size_zoom_constant),u_is_size_feature_constant:new es.bP(en,ec.u_is_size_feature_constant),u_size_t:new es.bg(en,ec.u_size_t),u_size:new es.bg(en,ec.u_size),u_camera_to_center_distance:new es.bg(en,ec.u_camera_to_center_distance),u_pitch:new es.bg(en,ec.u_pitch),u_rotate_symbol:new es.bP(en,ec.u_rotate_symbol),u_aspect_ratio:new es.bg(en,ec.u_aspect_ratio),u_fade_change:new es.bg(en,ec.u_fade_change),u_label_plane_matrix:new es.bR(en,ec.u_label_plane_matrix),u_coord_matrix:new es.bR(en,ec.u_coord_matrix),u_is_text:new es.bP(en,ec.u_is_text),u_pitch_with_map:new es.bP(en,ec.u_pitch_with_map),u_is_along_line:new es.bP(en,ec.u_is_along_line),u_is_variable_anchor:new es.bP(en,ec.u_is_variable_anchor),u_texsize:new es.bU(en,ec.u_texsize),u_texture:new es.bP(en,ec.u_texture),u_gamma_scale:new es.bg(en,ec.u_gamma_scale),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_is_halo:new es.bP(en,ec.u_is_halo),u_translation:new es.bU(en,ec.u_translation),u_pitched_scale:new es.bg(en,ec.u_pitched_scale)}),symbolTextAndIcon:(en,ec)=>({u_is_size_zoom_constant:new es.bP(en,ec.u_is_size_zoom_constant),u_is_size_feature_constant:new es.bP(en,ec.u_is_size_feature_constant),u_size_t:new es.bg(en,ec.u_size_t),u_size:new es.bg(en,ec.u_size),u_camera_to_center_distance:new es.bg(en,ec.u_camera_to_center_distance),u_pitch:new es.bg(en,ec.u_pitch),u_rotate_symbol:new es.bP(en,ec.u_rotate_symbol),u_aspect_ratio:new es.bg(en,ec.u_aspect_ratio),u_fade_change:new es.bg(en,ec.u_fade_change),u_label_plane_matrix:new es.bR(en,ec.u_label_plane_matrix),u_coord_matrix:new es.bR(en,ec.u_coord_matrix),u_is_text:new es.bP(en,ec.u_is_text),u_pitch_with_map:new es.bP(en,ec.u_pitch_with_map),u_is_along_line:new es.bP(en,ec.u_is_along_line),u_is_variable_anchor:new es.bP(en,ec.u_is_variable_anchor),u_texsize:new es.bU(en,ec.u_texsize),u_texsize_icon:new es.bU(en,ec.u_texsize_icon),u_texture:new es.bP(en,ec.u_texture),u_texture_icon:new es.bP(en,ec.u_texture_icon),u_gamma_scale:new es.bg(en,ec.u_gamma_scale),u_device_pixel_ratio:new es.bg(en,ec.u_device_pixel_ratio),u_is_halo:new es.bP(en,ec.u_is_halo),u_translation:new es.bU(en,ec.u_translation),u_pitched_scale:new es.bg(en,ec.u_pitched_scale)}),background:(en,ec)=>({u_opacity:new es.bg(en,ec.u_opacity),u_color:new es.bQ(en,ec.u_color)}),backgroundPattern:(en,ec)=>({u_opacity:new es.bg(en,ec.u_opacity),u_image:new es.bP(en,ec.u_image),u_pattern_tl_a:new es.bU(en,ec.u_pattern_tl_a),u_pattern_br_a:new es.bU(en,ec.u_pattern_br_a),u_pattern_tl_b:new es.bU(en,ec.u_pattern_tl_b),u_pattern_br_b:new es.bU(en,ec.u_pattern_br_b),u_texsize:new es.bU(en,ec.u_texsize),u_mix:new es.bg(en,ec.u_mix),u_pattern_size_a:new es.bU(en,ec.u_pattern_size_a),u_pattern_size_b:new es.bU(en,ec.u_pattern_size_b),u_scale_a:new es.bg(en,ec.u_scale_a),u_scale_b:new es.bg(en,ec.u_scale_b),u_pixel_coord_upper:new es.bU(en,ec.u_pixel_coord_upper),u_pixel_coord_lower:new es.bU(en,ec.u_pixel_coord_lower),u_tile_units_to_pixels:new es.bg(en,ec.u_tile_units_to_pixels)}),terrain:(en,ec)=>({u_texture:new es.bP(en,ec.u_texture),u_ele_delta:new es.bg(en,ec.u_ele_delta),u_fog_matrix:new es.bR(en,ec.u_fog_matrix),u_fog_color:new es.bQ(en,ec.u_fog_color),u_fog_ground_blend:new es.bg(en,ec.u_fog_ground_blend),u_fog_ground_blend_opacity:new es.bg(en,ec.u_fog_ground_blend_opacity),u_horizon_color:new es.bQ(en,ec.u_horizon_color),u_horizon_fog_blend:new es.bg(en,ec.u_horizon_fog_blend),u_is_globe_mode:new es.bg(en,ec.u_is_globe_mode)}),terrainDepth:(en,ec)=>({u_ele_delta:new es.bg(en,ec.u_ele_delta)}),terrainCoords:(en,ec)=>({u_texture:new es.bP(en,ec.u_texture),u_terrain_coords_id:new es.bg(en,ec.u_terrain_coords_id),u_ele_delta:new es.bg(en,ec.u_ele_delta)}),projectionErrorMeasurement:(en,ec)=>({u_input:new es.bg(en,ec.u_input),u_output_expected:new es.bg(en,ec.u_output_expected)}),atmosphere:(en,ec)=>({u_sun_pos:new es.bT(en,ec.u_sun_pos),u_atmosphere_blend:new es.bg(en,ec.u_atmosphere_blend),u_globe_position:new es.bT(en,ec.u_globe_position),u_globe_radius:new es.bg(en,ec.u_globe_radius),u_inv_proj_matrix:new es.bR(en,ec.u_inv_proj_matrix)}),sky:(en,ec)=>({u_sky_color:new es.bQ(en,ec.u_sky_color),u_horizon_color:new es.bQ(en,ec.u_horizon_color),u_horizon:new es.bU(en,ec.u_horizon),u_horizon_normal:new es.bU(en,ec.u_horizon_normal),u_sky_horizon_blend:new es.bg(en,ec.u_sky_horizon_blend),u_sky_blend:new es.bg(en,ec.u_sky_blend)})};let so=class so{constructor(en,es,ec){this.context=en;let ed=en.gl;this.buffer=ed.createBuffer(),this.dynamicDraw=!!ec,this.context.unbindVAO(),en.bindElementBuffer.set(this.buffer),ed.bufferData(ed.ELEMENT_ARRAY_BUFFER,es.arrayBuffer,this.dynamicDraw?ed.DYNAMIC_DRAW:ed.STATIC_DRAW),this.dynamicDraw||delete es.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(en){let es=this.context.gl;if(!this.dynamicDraw)throw Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),es.bufferSubData(es.ELEMENT_ARRAY_BUFFER,0,en.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}};let eK={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};let lo=class lo{constructor(en,es,ec,ed){this.length=es.length,this.attributes=ec,this.itemSize=es.bytesPerElement,this.dynamicDraw=ed,this.context=en;let ep=en.gl;this.buffer=ep.createBuffer(),en.bindVertexBuffer.set(this.buffer),ep.bufferData(ep.ARRAY_BUFFER,es.arrayBuffer,this.dynamicDraw?ep.DYNAMIC_DRAW:ep.STATIC_DRAW),this.dynamicDraw||delete es.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(en){if(en.length!==this.length)throw Error(`Length of new data is ${en.length}, which doesn't match current length of ${this.length}`);let es=this.context.gl;this.bind(),es.bufferSubData(es.ARRAY_BUFFER,0,en.arrayBuffer)}enableAttributes(en,es){for(let ec=0;ec<this.attributes.length;ec++){let ed=es.attributes[this.attributes[ec].name];void 0!==ed&&en.enableVertexAttribArray(ed)}}setVertexAttribPointers(en,es,ec){for(let ed=0;ed<this.attributes.length;ed++){let ep=this.attributes[ed],ef=es.attributes[ep.name];void 0!==ef&&en.vertexAttribPointer(ef,ep.components,en[eK[ep.type]],!1,this.itemSize,ep.offset+this.itemSize*(ec||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}};let co=class co{constructor(en){this.gl=en.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(en){}getDefault(){return this.default}setDefault(){this.set(this.default)}};let ho=class ho extends co{getDefault(){return es.bf.transparent}set(en){let es=this.current;(en.r!==es.r||en.g!==es.g||en.b!==es.b||en.a!==es.a||this.dirty)&&(this.gl.clearColor(en.r,en.g,en.b,en.a),this.current=en,this.dirty=!1)}};let uo=class uo extends co{getDefault(){return 1}set(en){(en!==this.current||this.dirty)&&(this.gl.clearDepth(en),this.current=en,this.dirty=!1)}};let _o=class _o extends co{getDefault(){return 0}set(en){(en!==this.current||this.dirty)&&(this.gl.clearStencil(en),this.current=en,this.dirty=!1)}};let po=class po extends co{getDefault(){return[!0,!0,!0,!0]}set(en){let es=this.current;(en[0]!==es[0]||en[1]!==es[1]||en[2]!==es[2]||en[3]!==es[3]||this.dirty)&&(this.gl.colorMask(en[0],en[1],en[2],en[3]),this.current=en,this.dirty=!1)}};let mo=class mo extends co{getDefault(){return!0}set(en){(en!==this.current||this.dirty)&&(this.gl.depthMask(en),this.current=en,this.dirty=!1)}};let fo=class fo extends co{getDefault(){return 255}set(en){(en!==this.current||this.dirty)&&(this.gl.stencilMask(en),this.current=en,this.dirty=!1)}};let go=class go extends co{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(en){let es=this.current;(en.func!==es.func||en.ref!==es.ref||en.mask!==es.mask||this.dirty)&&(this.gl.stencilFunc(en.func,en.ref,en.mask),this.current=en,this.dirty=!1)}};let vo=class vo extends co{getDefault(){let en=this.gl;return[en.KEEP,en.KEEP,en.KEEP]}set(en){let es=this.current;(en[0]!==es[0]||en[1]!==es[1]||en[2]!==es[2]||this.dirty)&&(this.gl.stencilOp(en[0],en[1],en[2]),this.current=en,this.dirty=!1)}};let bo=class bo extends co{getDefault(){return!1}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;en?es.enable(es.STENCIL_TEST):es.disable(es.STENCIL_TEST),this.current=en,this.dirty=!1}};let xo=class xo extends co{getDefault(){return[0,1]}set(en){let es=this.current;(en[0]!==es[0]||en[1]!==es[1]||this.dirty)&&(this.gl.depthRange(en[0],en[1]),this.current=en,this.dirty=!1)}};let yo=class yo extends co{getDefault(){return!1}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;en?es.enable(es.DEPTH_TEST):es.disable(es.DEPTH_TEST),this.current=en,this.dirty=!1}};let wo=class wo extends co{getDefault(){return this.gl.LESS}set(en){(en!==this.current||this.dirty)&&(this.gl.depthFunc(en),this.current=en,this.dirty=!1)}};let To=class To extends co{getDefault(){return!1}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;en?es.enable(es.BLEND):es.disable(es.BLEND),this.current=en,this.dirty=!1}};let Po=class Po extends co{getDefault(){let en=this.gl;return[en.ONE,en.ZERO]}set(en){let es=this.current;(en[0]!==es[0]||en[1]!==es[1]||this.dirty)&&(this.gl.blendFunc(en[0],en[1]),this.current=en,this.dirty=!1)}};let Co=class Co extends co{getDefault(){return es.bf.transparent}set(en){let es=this.current;(en.r!==es.r||en.g!==es.g||en.b!==es.b||en.a!==es.a||this.dirty)&&(this.gl.blendColor(en.r,en.g,en.b,en.a),this.current=en,this.dirty=!1)}};let Io=class Io extends co{getDefault(){return this.gl.FUNC_ADD}set(en){(en!==this.current||this.dirty)&&(this.gl.blendEquation(en),this.current=en,this.dirty=!1)}};let Mo=class Mo extends co{getDefault(){return!1}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;en?es.enable(es.CULL_FACE):es.disable(es.CULL_FACE),this.current=en,this.dirty=!1}};let So=class So extends co{getDefault(){return this.gl.BACK}set(en){(en!==this.current||this.dirty)&&(this.gl.cullFace(en),this.current=en,this.dirty=!1)}};let Eo=class Eo extends co{getDefault(){return this.gl.CCW}set(en){(en!==this.current||this.dirty)&&(this.gl.frontFace(en),this.current=en,this.dirty=!1)}};let Ro=class Ro extends co{getDefault(){return null}set(en){(en!==this.current||this.dirty)&&(this.gl.useProgram(en),this.current=en,this.dirty=!1)}};let zo=class zo extends co{getDefault(){return this.gl.TEXTURE0}set(en){(en!==this.current||this.dirty)&&(this.gl.activeTexture(en),this.current=en,this.dirty=!1)}};let Do=class Do extends co{getDefault(){let en=this.gl;return[0,0,en.drawingBufferWidth,en.drawingBufferHeight]}set(en){let es=this.current;(en[0]!==es[0]||en[1]!==es[1]||en[2]!==es[2]||en[3]!==es[3]||this.dirty)&&(this.gl.viewport(en[0],en[1],en[2],en[3]),this.current=en,this.dirty=!1)}};let Ao=class Ao extends co{getDefault(){return null}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.bindFramebuffer(es.FRAMEBUFFER,en),this.current=en,this.dirty=!1}};let Lo=class Lo extends co{getDefault(){return null}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.bindRenderbuffer(es.RENDERBUFFER,en),this.current=en,this.dirty=!1}};let ko=class ko extends co{getDefault(){return null}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.bindTexture(es.TEXTURE_2D,en),this.current=en,this.dirty=!1}};let Fo=class Fo extends co{getDefault(){return null}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.bindBuffer(es.ARRAY_BUFFER,en),this.current=en,this.dirty=!1}};let Bo=class Bo extends co{getDefault(){return null}set(en){let es=this.gl;es.bindBuffer(es.ELEMENT_ARRAY_BUFFER,en),this.current=en,this.dirty=!1}};let Oo=class Oo extends co{getDefault(){return null}set(en){var es;if(en===this.current&&!this.dirty)return;let ec=this.gl;qt(ec)?ec.bindVertexArray(en):null===(es=ec.getExtension("OES_vertex_array_object"))||void 0===es||es.bindVertexArrayOES(en),this.current=en,this.dirty=!1}};let jo=class jo extends co{getDefault(){return 4}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.pixelStorei(es.UNPACK_ALIGNMENT,en),this.current=en,this.dirty=!1}};let No=class No extends co{getDefault(){return!1}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.pixelStorei(es.UNPACK_PREMULTIPLY_ALPHA_WEBGL,en),this.current=en,this.dirty=!1}};let Uo=class Uo extends co{getDefault(){return!1}set(en){if(en===this.current&&!this.dirty)return;let es=this.gl;es.pixelStorei(es.UNPACK_FLIP_Y_WEBGL,en),this.current=en,this.dirty=!1}};let Zo=class Zo extends co{constructor(en,es){super(en),this.context=en,this.parent=es}getDefault(){return null}};let Go=class Go extends Zo{setDirty(){this.dirty=!0}set(en){if(en===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let es=this.gl;es.framebufferTexture2D(es.FRAMEBUFFER,es.COLOR_ATTACHMENT0,es.TEXTURE_2D,en,0),this.current=en,this.dirty=!1}};let Vo=class Vo extends Zo{set(en){if(en===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let es=this.gl;es.framebufferRenderbuffer(es.FRAMEBUFFER,es.DEPTH_ATTACHMENT,es.RENDERBUFFER,en),this.current=en,this.dirty=!1}};let $o=class $o extends Zo{set(en){if(en===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let es=this.gl;es.framebufferRenderbuffer(es.FRAMEBUFFER,es.DEPTH_STENCIL_ATTACHMENT,es.RENDERBUFFER,en),this.current=en,this.dirty=!1}};let eY="Framebuffer is not complete";let Wo=class Wo{constructor(en,es,ec,ed,ep){this.context=en,this.width=es,this.height=ec;let ef=en.gl,em=this.framebuffer=ef.createFramebuffer();if(this.colorAttachment=new Go(en,em),ed)this.depthAttachment=ep?new $o(en,em):new Vo(en,em);else if(ep)throw Error("Stencil cannot be set without depth");if(ef.checkFramebufferStatus(ef.FRAMEBUFFER)!==ef.FRAMEBUFFER_COMPLETE)throw Error(eY)}destroy(){let en=this.context.gl,es=this.colorAttachment.get();if(es&&en.deleteTexture(es),this.depthAttachment){let es=this.depthAttachment.get();es&&en.deleteRenderbuffer(es)}en.deleteFramebuffer(this.framebuffer)}};let Ho=class Ho{constructor(en){var es,ec;if(this.gl=en,this.clearColor=new ho(this),this.clearDepth=new uo(this),this.clearStencil=new _o(this),this.colorMask=new po(this),this.depthMask=new mo(this),this.stencilMask=new fo(this),this.stencilFunc=new go(this),this.stencilOp=new vo(this),this.stencilTest=new bo(this),this.depthRange=new xo(this),this.depthTest=new yo(this),this.depthFunc=new wo(this),this.blend=new To(this),this.blendFunc=new Po(this),this.blendColor=new Co(this),this.blendEquation=new Io(this),this.cullFace=new Mo(this),this.cullFaceSide=new So(this),this.frontFace=new Eo(this),this.program=new Ro(this),this.activeTexture=new zo(this),this.viewport=new Do(this),this.bindFramebuffer=new Ao(this),this.bindRenderbuffer=new Lo(this),this.bindTexture=new ko(this),this.bindVertexBuffer=new Fo(this),this.bindElementBuffer=new Bo(this),this.bindVertexArray=new Oo(this),this.pixelStoreUnpack=new jo(this),this.pixelStoreUnpackPremultiplyAlpha=new No(this),this.pixelStoreUnpackFlipY=new Uo(this),this.extTextureFilterAnisotropic=en.getExtension("EXT_texture_filter_anisotropic")||en.getExtension("MOZ_EXT_texture_filter_anisotropic")||en.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=en.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=en.getParameter(en.MAX_TEXTURE_SIZE),qt(en)){this.HALF_FLOAT=en.HALF_FLOAT;let ed=en.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(es=en.RGBA16F)&&void 0!==es?es:null==ed?void 0:ed.RGBA16F_EXT,this.RGB16F=null!==(ec=en.RGB16F)&&void 0!==ec?ec:null==ed?void 0:ed.RGB16F_EXT,en.getExtension("EXT_color_buffer_float")}else{en.getExtension("EXT_color_buffer_half_float"),en.getExtension("OES_texture_half_float_linear");let es=en.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==es?void 0:es.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(en,es){return new so(this,en,es)}createVertexBuffer(en,es,ec){return new lo(this,en,es,ec)}createRenderbuffer(en,es,ec){let ed=this.gl,ep=ed.createRenderbuffer();return this.bindRenderbuffer.set(ep),ed.renderbufferStorage(ed.RENDERBUFFER,en,es,ec),this.bindRenderbuffer.set(null),ep}createFramebuffer(en,es,ec,ed){return new Wo(this,en,es,ec,ed)}clear({color:en,depth:es,stencil:ec}){let ed=this.gl,ep=0;en&&(ep|=ed.COLOR_BUFFER_BIT,this.clearColor.set(en),this.colorMask.set([!0,!0,!0,!0])),void 0!==es&&(ep|=ed.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(es),this.depthMask.set(!0)),void 0!==ec&&(ep|=ed.STENCIL_BUFFER_BIT,this.clearStencil.set(ec),this.stencilMask.set(255)),ed.clear(ep)}setCullFace(en){!1===en.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(en.mode),this.frontFace.set(en.frontFace))}setDepthMode(en){en.func!==this.gl.ALWAYS||en.mask?(this.depthTest.set(!0),this.depthFunc.set(en.func),this.depthMask.set(en.mask),this.depthRange.set(en.range)):this.depthTest.set(!1)}setStencilMode(en){en.test.func!==this.gl.ALWAYS||en.mask?(this.stencilTest.set(!0),this.stencilMask.set(en.mask),this.stencilOp.set([en.fail,en.depthFail,en.pass]),this.stencilFunc.set({func:en.test.func,ref:en.ref,mask:en.test.mask})):this.stencilTest.set(!1)}setColorMode(en){es.bH(en.blendFunction,jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(en.blendFunction),this.blendColor.set(en.blendColor)),this.colorMask.set(en.mask)}createVertexArray(){var en;return qt(this.gl)?this.gl.createVertexArray():null===(en=this.gl.getExtension("OES_vertex_array_object"))||void 0===en?void 0:en.createVertexArrayOES()}deleteVertexArray(en){var es;return qt(this.gl)?this.gl.deleteVertexArray(en):null===(es=this.gl.getExtension("OES_vertex_array_object"))||void 0===es?void 0:es.deleteVertexArrayOES(en)}unbindVAO(){this.bindVertexArray.set(null)}};function Ko(en,ec,ed,ep,ef){let em=en.context,eg=en.transform,ey=em.gl,ex=en.useProgram("collisionBox"),ev=[],eb=0,ew=0;for(let es=0;es<ep.length;es++){let e_=ep[es],eT=ec.getTile(e_).getBucket(ed);if(!eT)continue;let eP=ef?eT.textCollisionBox:eT.iconCollisionBox,eS=eT.collisionCircleArray;eS.length>0&&(ev.push({circleArray:eS,circleOffset:ew,coord:e_}),eb+=eS.length/4,ew=eb),eP&&ex.draw(em,ey.LINES,Zt.disabled,Vt.disabled,en.colorModeForRenderPass(),Ut.disabled,Fi(en.transform),en.style.map.terrain&&en.style.map.terrain.getTerrainData(e_),eg.getProjectionData({overscaledTileID:e_,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ed.id,eP.layoutVertexBuffer,eP.indexBuffer,eP.segments,null,en.transform.zoom,null,null,eP.collisionVertexBuffer)}if(!ef||!ev.length)return;let eT=en.useProgram("collisionCircle"),eP=new es.b$;eP.resize(4*eb),eP._trim();let eS=0;for(let en of ev)for(let es=0;es<en.circleArray.length/4;es++){let ec=4*es,ed=en.circleArray[ec+0],ep=en.circleArray[ec+1],ef=en.circleArray[ec+2],em=en.circleArray[ec+3];eP.emplace(eS++,ed,ep,ef,em,0),eP.emplace(eS++,ed,ep,ef,em,1),eP.emplace(eS++,ed,ep,ef,em,2),eP.emplace(eS++,ed,ep,ef,em,3)}(!e_||e_.length<2*eb)&&(e_=function(en){let ec=2*en,ed=new es.c1;ed.resize(ec),ed._trim();for(let en=0;en<ec;en++){let es=6*en;ed.uint16[es+0]=4*en+0,ed.uint16[es+1]=4*en+1,ed.uint16[es+2]=4*en+2,ed.uint16[es+3]=4*en+2,ed.uint16[es+4]=4*en+3,ed.uint16[es+5]=4*en+0}return ed}(eb));let eM=em.createIndexBuffer(e_,!0),eC=em.createVertexBuffer(eP,es.c0.members,!0);for(let ec of ev){let ep=Bi(en.transform);eT.draw(em,ey.TRIANGLES,Zt.disabled,Vt.disabled,en.colorModeForRenderPass(),Ut.disabled,ep,en.style.map.terrain&&en.style.map.terrain.getTerrainData(ec.coord),null,ed.id,eC,eM,es.aM.simpleSegment(0,2*ec.circleOffset,ec.circleArray.length,ec.circleArray.length/2),null,en.transform.zoom,null,null,null)}eC.destroy(),eM.destroy()}let eJ=es.ag(new Float32Array(16));function ir(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew){let eT=en.context,eP=eT.gl,eS=en.transform,eM="map"===eg,eC="map"===ey,eI="viewport"!==eg&&"point"!==ed.layout.get("symbol-placement"),eE=eM&&!eC&&!eI,eA=!ed.layout.get("symbol-sort-key").isConstant(),ez=!1,ek=en.getDepthModeForSublayer(0,Zt.ReadOnly),eD=ed._unevaluatedLayout.hasValue("text-variable-anchor")||ed._unevaluatedLayout.hasValue("text-variable-anchor-offset"),eR=[],eL=eS.getCircleRadiusCorrection();for(let eg of ep){let ep;let ey=ec.getTile(eg),ev=ey.getBucket(ed);if(!ev)continue;let eb=ef?ev.text:ev.icon;if(!eb||!eb.segments.get().length||!eb.hasVisibleVertices)continue;let eT=eb.programConfigurations.get(ed.id),ek=ef||ev.sdfIcons,eB=ef?ev.textSizeData:ev.iconSizeData,eF=eC||0!==eS.pitch,eO=en.useProgram(ev.iconsInText&&ef?"symbolTextAndIcon":ek?"symbolSDF":"symbolIcon",eT),ej=es.an(eB,eS.zoom),eV=en.style.map.terrain&&en.style.map.terrain.getTerrainData(eg),eU,eN,eZ,eG,e$=[0,0],eq=null;if(ef)eN=ey.glyphAtlasTexture,eZ=eP.LINEAR,eU=ey.glyphAtlasTexture.size,ev.iconsInText&&(e$=ey.imageAtlasTexture.size,eq=ey.imageAtlasTexture,eG=eF||en.options.rotating||en.options.zooming||"composite"===eB.kind||"camera"===eB.kind?eP.LINEAR:eP.NEAREST);else{let es=1!==ed.layout.get("icon-size").constantOr(0)||ev.iconsNeedLinear;eN=ey.imageAtlasTexture,eZ=ek||en.options.rotating||en.options.zooming||es||eF?eP.LINEAR:eP.NEAREST,eU=ey.imageAtlasTexture.size}let eW=es.aC(ey,1,en.transform.zoom),eH=Ie(eM,en.transform,eW),eX=es.L();es.aq(eX,eH);let eK=function(en,ec,ed,ep){if(en){let en=es.L();if(!ec){let{vecSouth:es,vecEast:ec}=Se(ed);en[0]=ec[0],en[1]=ec[1],en[4]=es[0],en[5]=es[1]}return es.N(en,en,[ep,ep,1]),en}return ed.pixelsToClipSpaceMatrix}(eC,eM,en.transform,eW),eY=es.aD(eS,ey,em,e_),eQ=eS.getProjectionData({overscaledTileID:eg,applyGlobeMatrix:!ew,applyTerrainMatrix:!0}),e0=eD&&ev.hasTextData(),e1="none"!==ed.layout.get("icon-text-fit")&&e0&&ev.hasIconData();if(eI){let ec=en.style.map.terrain?(es,ec)=>en.style.map.terrain.getElevation(eg,es,ec):null,ep="map"===ed.layout.get("text-rotation-alignment");!function(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb,ew){let eT=ed?en.textSizeData:en.iconSizeData,eP=es.an(eT,ec.transform.zoom),eS=[256/ec.width*2+1,256/ec.height*2+1],eM=ed?en.text.dynamicLayoutVertexArray:en.icon.dynamicLayoutVertexArray;eM.clear();let eC=en.lineVertexArray,eI=ed?en.text.placedSymbolArray:en.icon.placedSymbolArray,eE=ec.transform.width/ec.transform.height,eA=!1;for(let ed=0;ed<eI.length;ed++){var ez;let ek=eI.get(ed);if(ek.hidden||ek.writingMode===es.ao.vertical&&!eA){$e(ek.numGlyphs,eM);continue}eA=!1;let eD=new es.P(ek.anchorX,ek.anchorY),eR={getElevation:ew,pitchedLabelPlaneMatrix:ep,lineVertexArray:eC,pitchWithMap:em,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:ec.transform,tileAnchorPoint:eD,unwrappedTileID:ey,width:ex,height:ev,translation:eb},eL=Ne(ek.anchorX,ek.anchorY,eR);if(!((ez=eL.point).x>=-eS[0]&&ez.x<=eS[0]&&ez.y>=-eS[1])||!(ez.y<=eS[1])){$e(ek.numGlyphs,eM);continue}let eB=.5+ec.transform.cameraToCenterDistance/eL.signedDistanceFromCamera*.5,eF=es.ap(eT,eP,ek),eO=em?eF*ec.transform.getPitchedTextCorrection(ek.anchorX,ek.anchorY,ey)/eB:eF*eB,ej=ke({projectionContext:eR,pitchedLabelPlaneMatrixInverse:ef,symbol:ek,fontSize:eO,flip:!1,keepUpright:e_,glyphOffsetArray:en.glyphOffsetArray,dynamicLayoutVertexArray:eM,aspectRatio:eE,rotateToLine:eg});eA=ej.useVertical,(ej.notEnoughRoom||eA||ej.needsFlipping&&ke({projectionContext:eR,pitchedLabelPlaneMatrixInverse:ef,symbol:ek,fontSize:eO,flip:!0,keepUpright:e_,glyphOffsetArray:en.glyphOffsetArray,dynamicLayoutVertexArray:eM,aspectRatio:eE,rotateToLine:eg}).notEnoughRoom)&&$e(ek.numGlyphs,eM)}ed?en.text.dynamicLayoutVertexBuffer.updateData(eM):en.icon.dynamicLayoutVertexBuffer.updateData(eM)}(ev,en,ef,eH,eX,eC,ex,ep,eg.toUnwrapped(),eS.width,eS.height,eY,ec)}let e2=ef&&eD||e1,e3=eI||e2?eJ:eC?eH:en.transform.clipSpaceToPixelsMatrix,e5=ek&&0!==ed.paint.get(ef?"text-halo-width":"icon-halo-width").constantOr(1);ep=ek?ev.iconsInText?to(eB.kind,ej,eE,eC,eI,e2,en,e3,eK,eY,eU,e$,eL):eo(eB.kind,ej,eE,eC,eI,e2,en,e3,eK,eY,ef,eU,0,eL):Ji(eB.kind,ej,eE,eC,eI,e2,en,e3,eK,eY,ef,eU,eL);let e4={program:eO,buffers:eb,uniformValues:ep,projectionData:eQ,atlasTexture:eN,atlasTextureIcon:eq,atlasInterpolation:eZ,atlasInterpolationIcon:eG,isSDF:ek,hasHalo:e5};if(eA&&ev.canOverlap){ez=!0;let en=eb.segments.get();for(let ec of en)eR.push({segments:new es.aM([ec]),sortKey:ec.sortKey,state:e4,terrainData:eV})}else eR.push({segments:eb.segments,sortKey:0,state:e4,terrainData:eV})}for(let es of(ez&&eR.sort((en,es)=>en.sortKey-es.sortKey),eR)){let ec=es.state;if(eT.activeTexture.set(eP.TEXTURE0),ec.atlasTexture.bind(ec.atlasInterpolation,eP.CLAMP_TO_EDGE),ec.atlasTextureIcon&&(eT.activeTexture.set(eP.TEXTURE1),ec.atlasTextureIcon&&ec.atlasTextureIcon.bind(ec.atlasInterpolationIcon,eP.CLAMP_TO_EDGE)),ec.isSDF){let ep=ec.uniformValues;ec.hasHalo&&(ep.u_is_halo=1,or(ec.buffers,es.segments,ed,en,ec.program,ek,ev,eb,ep,ec.projectionData,es.terrainData)),ep.u_is_halo=0}or(ec.buffers,es.segments,ed,en,ec.program,ek,ev,eb,ec.uniformValues,ec.projectionData,es.terrainData)}}function or(en,es,ec,ed,ep,ef,em,e_,eg,ey,ex){let ev=ed.context;ep.draw(ev,ev.gl.TRIANGLES,ef,em,e_,Ut.backCCW,eg,ex,ey,ec.id,en.layoutVertexBuffer,en.indexBuffer,es,ec.paint,ed.transform.zoom,en.programConfigurations.get(ec.id),en.dynamicLayoutVertexBuffer,en.opacityVertexBuffer)}function sr(en,es,ec){var ed,ep;let ef=en.gl,em=ef.createTexture();ef.bindTexture(ef.TEXTURE_2D,em),ef.texParameteri(ef.TEXTURE_2D,ef.TEXTURE_WRAP_S,ef.CLAMP_TO_EDGE),ef.texParameteri(ef.TEXTURE_2D,ef.TEXTURE_WRAP_T,ef.CLAMP_TO_EDGE),ef.texParameteri(ef.TEXTURE_2D,ef.TEXTURE_MIN_FILTER,ef.LINEAR),ef.texParameteri(ef.TEXTURE_2D,ef.TEXTURE_MAG_FILTER,ef.LINEAR);let e_=null!==(ed=en.HALF_FLOAT)&&void 0!==ed?ed:ef.UNSIGNED_BYTE,eg=null!==(ep=en.RGBA16F)&&void 0!==ep?ep:ef.RGBA;ef.texImage2D(ef.TEXTURE_2D,0,eg,es,ec,0,ef.RGBA,e_,null);let ey=en.createFramebuffer(es,ec,!1,!1);return ey.colorAttachment.set(em),ey}function nr(en,ec){return ec.colorRampTexture||(ec.colorRampTexture=new es.T(en,ec.colorRamp,en.gl.RGBA)),ec.colorRampTexture}function lr(en,es,ec,ed,ep){if(!ec||!ed||!ed.imageAtlas)return;let ef=ed.imageAtlas.patternPositions,em=ef[ec.to.toString()],e_=ef[ec.from.toString()];if(!em&&e_&&(em=e_),!e_&&em&&(e_=em),!em||!e_){let en=ep.getPaintProperty(es);em=ef[en],e_=ef[en]}em&&e_&&en.setConstantPatternPositions(em,e_)}function cr(en,ec,ed,ep,ef,em,e_,eg){let ey,ex,ev,eb,ew;let eT=en.context.gl,eP="fill-pattern",eS=ed.paint.get(eP),eM=eS&&eS.constantOr(1),eC=ed.getCrossfadeParameters(),eI=en.transform,eE=ed.paint.get("fill-translate"),eA=ed.paint.get("fill-translate-anchor");e_?(ex=eM&&!ed.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ey=eT.LINES):(ex=eM?"fillPattern":"fill",ey=eT.TRIANGLES);let ez=eS.constantOr(null);for(let eS of ep){let ep=ec.getTile(eS);if(eM&&!ep.patternsLoaded())continue;let ek=ep.getBucket(ed);if(!ek)continue;let eD=ek.programConfigurations.get(ed.id),eR=en.useProgram(ex,eD),eL=en.style.map.terrain&&en.style.map.terrain.getTerrainData(eS);eM&&(en.context.activeTexture.set(eT.TEXTURE0),ep.imageAtlasTexture.bind(eT.LINEAR,eT.CLAMP_TO_EDGE),eD.updatePaintBuffers(eC)),lr(eD,eP,ez,ep,ed);let eB=eI.getProjectionData({overscaledTileID:eS,applyGlobeMatrix:!eg,applyTerrainMatrix:!0}),eF=es.aD(eI,ep,eE,eA);if(e_){eb=ek.indexBuffer2,ew=ek.segments2;let es=[eT.drawingBufferWidth,eT.drawingBufferHeight];ev="fillOutlinePattern"===ex&&eM?Li(en,eC,ep,es,eF):Ai(es,eF)}else eb=ek.indexBuffer,ew=ek.segments,ev=eM?Di(en,eC,ep,eF):{u_fill_translate:eF};let eO=en.stencilModeForClipping(eS);eR.draw(en.context,ey,ef,eO,em,Ut.backCCW,ev,eL,eB,ed.id,ek.layoutVertexBuffer,eb,ew,ed.paint,en.transform.zoom,eD)}}function hr(en,ec,ed,ep,ef,em,e_,eg){let ey=en.context,ex=ey.gl,ev="fill-extrusion-pattern",eb=ed.paint.get(ev),ew=eb.constantOr(1),eT=ed.getCrossfadeParameters(),eP=ed.paint.get("fill-extrusion-opacity"),eS=eb.constantOr(null),eM=en.transform;for(let eb of ep){let ep=ec.getTile(eb),eC=ep.getBucket(ed);if(!eC)continue;let eI=en.style.map.terrain&&en.style.map.terrain.getTerrainData(eb),eE=eC.programConfigurations.get(ed.id),eA=en.useProgram(ew?"fillExtrusionPattern":"fillExtrusion",eE);ew&&(en.context.activeTexture.set(ex.TEXTURE0),ep.imageAtlasTexture.bind(ex.LINEAR,ex.CLAMP_TO_EDGE),eE.updatePaintBuffers(eT));let ez=eM.getProjectionData({overscaledTileID:eb,applyGlobeMatrix:!eg,applyTerrainMatrix:!0});lr(eE,ev,eS,ep,ed);let ek=es.aD(eM,ep,ed.paint.get("fill-extrusion-translate"),ed.paint.get("fill-extrusion-translate-anchor")),eD=ed.paint.get("fill-extrusion-vertical-gradient"),eR=ew?zi(en,eD,eP,ek,eb,eT,ep):Ri(en,eD,eP,ek);eA.draw(ey,ey.gl.TRIANGLES,ef,em,e_,Ut.backCCW,eR,eI,ez,ed.id,eC.layoutVertexBuffer,eC.indexBuffer,eC.segments,ed.paint,en.transform.zoom,eE,en.style.map.terrain&&eC.centroidVertexBuffer)}}function ur(en,es,ec,ed,ep,ef,em,e_,eg){var ey;let ex=en.style.projection,ev=en.context,eb=en.transform,ew=ev.gl,eT=[`#define NUM_ILLUMINATION_SOURCES ${ec.paint.get("hillshade-highlight-color").values.length}`],eP=en.useProgram("hillshade",null,!1,eT),eS=!en.options.moving;for(let eT of ed){let ed=es.getTile(eT),eM=ed.fbo;if(!eM)continue;let eC=ex.getMeshFromTileID(ev,eT.canonical,e_,!0,"raster"),eI=null===(ey=en.style.map.terrain)||void 0===ey?void 0:ey.getTerrainData(eT);ev.activeTexture.set(ew.TEXTURE0),ew.bindTexture(ew.TEXTURE_2D,eM.colorAttachment.get());let eE=eb.getProjectionData({overscaledTileID:eT,aligned:eS,applyGlobeMatrix:!eg,applyTerrainMatrix:!0});eP.draw(ev,ew.TRIANGLES,ef,ep[eT.overscaledZ],em,Ut.backCCW,Ui(en,ed,ec),eI,eE,ec.id,eC.vertexBuffer,eC.indexBuffer,eC.segments)}}function dr(en,ec,ed,ep,ef,em,e_,eg,ey){var ex;let ev=en.style.projection,eb=en.context,ew=en.transform,eT=eb.gl,eP=en.useProgram("colorRelief"),eS=!en.options.moving,eM=!0,eC=0;for(let eI of ep){let ep=ec.getTile(eI),eE=ep.dem;if(eM){let en=eT.getParameter(eT.MAX_TEXTURE_SIZE),{elevationTexture:es,colorTexture:ec}=ed.getColorRampTextures(eb,en,eE.getUnpackVector());eb.activeTexture.set(eT.TEXTURE1),es.bind(eT.NEAREST,eT.CLAMP_TO_EDGE),eb.activeTexture.set(eT.TEXTURE4),ec.bind(eT.LINEAR,eT.CLAMP_TO_EDGE),eM=!1,eC=es.size[0]}if(!eE||!eE.data)continue;let eA=eE.stride,ez=eE.getPixels();if(eb.activeTexture.set(eT.TEXTURE0),eb.pixelStoreUnpackPremultiplyAlpha.set(!1),ep.demTexture=ep.demTexture||en.getTileTexture(eA),ep.demTexture){let en=ep.demTexture;en.update(ez,{premultiply:!1}),en.bind(eT.LINEAR,eT.CLAMP_TO_EDGE)}else ep.demTexture=new es.T(eb,ez,eT.RGBA,{premultiply:!1}),ep.demTexture.bind(eT.LINEAR,eT.CLAMP_TO_EDGE);let ek=ev.getMeshFromTileID(eb,eI.canonical,eg,!0,"raster"),eD=null===(ex=en.style.map.terrain)||void 0===ex?void 0:ex.getTerrainData(eI),eR=ew.getProjectionData({overscaledTileID:eI,aligned:eS,applyGlobeMatrix:!ey,applyTerrainMatrix:!0});eP.draw(eb,eT.TRIANGLES,em,ef[eI.overscaledZ],e_,Ut.backCCW,Vi(ed,ep.dem,eC),eD,eR,ed.id,ek.vertexBuffer,ek.indexBuffer,ek.segments)}}let eQ=[new es.P(0,0),new es.P(es.$,0),new es.P(es.$,es.$),new es.P(0,es.$)];function pr(en,ec,ed,ep,ef,em,e_,eg,ey=!1,ex=!1){let eb=ep[ep.length-1].overscaledZ,ew=en.context,eT=ew.gl,eP=en.useProgram("raster"),eS=en.transform,eM=en.style.projection,eC=en.colorModeForRenderPass(),eI=!en.options.moving;for(let eE of ep){let ep,eA;let ez=en.getDepthModeForSublayer(eE.overscaledZ-eb,1===ed.paint.get("raster-opacity")?Zt.ReadWrite:Zt.ReadOnly,eT.LESS),ek=ec.getTile(eE);ek.registerFadeDuration(ed.paint.get("raster-fade-duration"));let eD=ec.findLoadedParent(eE,0),eR=ec.findLoadedSibling(eE),eL=function(en,ec,ed,ep,ef,em){let e_=ep.paint.get("raster-fade-duration");if(!em&&e_>0){let ep=ev.now(),em=(ep-en.timeAdded)/e_,eg=ec?(ep-ec.timeAdded)/e_:-1,ey=ed.getSource(),ex=ge(ef,{tileSize:ey.tileSize,roundZoom:ey.roundZoom}),eb=!ec||Math.abs(ec.tileID.overscaledZ-ex)>Math.abs(en.tileID.overscaledZ-ex),ew=eb&&en.refreshedUponExpiration?1:es.ah(eb?em:1-eg,0,1);return en.refreshedUponExpiration&&em>=1&&(en.refreshedUponExpiration=!1),ec?{opacity:1,mix:1-ew}:{opacity:ew,mix:0}}return{opacity:1,mix:0}}(ek,eD||eR||null,ec,ed,en.transform,en.style.map.terrain),eB="nearest"===ed.paint.get("raster-resampling")?eT.NEAREST:eT.LINEAR;ew.activeTexture.set(eT.TEXTURE0),ek.texture.bind(eB,eT.CLAMP_TO_EDGE,eT.LINEAR_MIPMAP_NEAREST),ew.activeTexture.set(eT.TEXTURE1),eD?(eD.texture.bind(eB,eT.CLAMP_TO_EDGE,eT.LINEAR_MIPMAP_NEAREST),ep=Math.pow(2,eD.tileID.overscaledZ-ek.tileID.overscaledZ),eA=[ek.tileID.canonical.x*ep%1,ek.tileID.canonical.y*ep%1]):ek.texture.bind(eB,eT.CLAMP_TO_EDGE,eT.LINEAR_MIPMAP_NEAREST),ek.texture.useMipmap&&ew.extTextureFilterAnisotropic&&en.transform.pitch>20&&eT.texParameterf(eT.TEXTURE_2D,ew.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ew.extTextureFilterAnisotropicMax);let eF=en.style.map.terrain&&en.style.map.terrain.getTerrainData(eE),eO=eS.getProjectionData({overscaledTileID:eE,aligned:eI,applyGlobeMatrix:!ex,applyTerrainMatrix:!0}),ej=Yi(eA||[0,0],ep||1,eL,ed,eg),eV=eM.getMeshFromTileID(ew,eE.canonical,em,e_,"raster");eP.draw(ew,eT.TRIANGLES,ez,ef?ef[eE.overscaledZ]:Vt.disabled,eC,ey?Ut.frontCCW:Ut.backCCW,ej,eF,eO,ed.id,eV.vertexBuffer,eV.indexBuffer,eV.segments)}}let e0=new es.bf(1,0,0,1),e1=new es.bf(0,1,0,1),e2=new es.bf(0,0,1,1),e3=new es.bf(1,0,1,1),e5=new es.bf(0,1,1,1);function yr(en,es,ec,ed){Tr(en,0,es+ec/2,en.transform.width,ec,ed)}function wr(en,es,ec,ed){Tr(en,es-ec/2,0,ec,en.transform.height,ed)}function Tr(en,es,ec,ed,ep,ef){let em=en.context,e_=em.gl;e_.enable(e_.SCISSOR_TEST),e_.scissor(es*en.pixelRatio,ec*en.pixelRatio,ed*en.pixelRatio,ep*en.pixelRatio),em.clear({color:ef}),e_.disable(e_.SCISSOR_TEST)}function Cr(en,es,ec,ed){let{isRenderingGlobe:ep}=ed,ef=en.context,em=ef.gl,e_=en.transform,eg=en.colorModeForRenderPass(),ey=en.getDepthModeFor3D(),ex=en.useProgram("terrain");for(let ed of(ef.bindFramebuffer.set(null),ef.viewport.set([0,0,en.width,en.height]),ec)){let ec=es.getTerrainMesh(ed.tileID),ev=en.renderToTexture.getTexture(ed),eb=es.getTerrainData(ed.tileID);ef.activeTexture.set(em.TEXTURE0),em.bindTexture(em.TEXTURE_2D,ev.texture);let ew=es.getMeshFrameDelta(e_.zoom),eT=e_.calculateFogMatrix(ed.tileID.toUnwrapped()),eP=Ci(ew,eT,en.style.sky,e_.pitch,ep),eS=e_.getProjectionData({overscaledTileID:ed.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ex.draw(ef,em.TRIANGLES,ey,Vt.disabled,eg,Ut.backCCW,eP,eb,eS,"terrain",ec.vertexBuffer,ec.indexBuffer,ec.segments)}}function Ir(en,ec){if(!ec.mesh){let ed=new es.aL;ed.emplaceBack(-1,-1),ed.emplaceBack(1,-1),ed.emplaceBack(1,1),ed.emplaceBack(-1,1);let ep=new es.aN;ep.emplaceBack(0,1,2),ep.emplaceBack(0,2,3),ec.mesh=new wt(en.createVertexBuffer(ed,ej.members),en.createIndexBuffer(ep),es.aM.simpleSegment(0,0,ed.length,ep.length))}return ec.mesh}let Mr=class Mr{constructor(en,ec){this.context=new Ho(en),this.transform=ec,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:es.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xe.maxUnderzooming+xe.maxOverzooming+1,this.depthEpsilon=1/65536,this.crossTileSymbolIndex=new vt}resize(en,es,ec){if(this.width=Math.floor(en*ec),this.height=Math.floor(es*ec),this.pixelRatio=ec,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let en of this.style._order)this.style._layers[en].resize()}setup(){let en=this.context,ec=new es.aL;ec.emplaceBack(0,0),ec.emplaceBack(es.$,0),ec.emplaceBack(0,es.$),ec.emplaceBack(es.$,es.$),this.tileExtentBuffer=en.createVertexBuffer(ec,ej.members),this.tileExtentSegments=es.aM.simpleSegment(0,0,4,2);let ed=new es.aL;ed.emplaceBack(0,0),ed.emplaceBack(es.$,0),ed.emplaceBack(0,es.$),ed.emplaceBack(es.$,es.$),this.debugBuffer=en.createVertexBuffer(ed,ej.members),this.debugSegments=es.aM.simpleSegment(0,0,4,5);let ep=new es.c6;ep.emplaceBack(0,0,0,0),ep.emplaceBack(es.$,0,es.$,0),ep.emplaceBack(0,es.$,0,es.$),ep.emplaceBack(es.$,es.$,es.$,es.$),this.rasterBoundsBuffer=en.createVertexBuffer(ep,eW.members),this.rasterBoundsSegments=es.aM.simpleSegment(0,0,4,2);let ef=new es.aL;ef.emplaceBack(0,0),ef.emplaceBack(es.$,0),ef.emplaceBack(0,es.$),ef.emplaceBack(es.$,es.$),this.rasterBoundsBufferPosOnly=en.createVertexBuffer(ef,ej.members),this.rasterBoundsSegmentsPosOnly=es.aM.simpleSegment(0,0,4,5);let em=new es.aL;em.emplaceBack(0,0),em.emplaceBack(1,0),em.emplaceBack(0,1),em.emplaceBack(1,1),this.viewportBuffer=en.createVertexBuffer(em,ej.members),this.viewportSegments=es.aM.simpleSegment(0,0,4,2);let e_=new es.c7;e_.emplaceBack(0),e_.emplaceBack(1),e_.emplaceBack(3),e_.emplaceBack(2),e_.emplaceBack(0),this.tileBorderIndexBuffer=en.createIndexBuffer(e_);let eg=new es.aN;eg.emplaceBack(1,0,2),eg.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=en.createIndexBuffer(eg);let ey=this.context.gl;this.stencilClearMode=new Vt({func:ey.ALWAYS,mask:0},0,255,ey.ZERO,ey.ZERO,ey.ZERO),this.tileExtentMesh=new wt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let en=this.context,ec=en.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let ed=es.L();es.bY(ed,0,this.width,this.height,0,0,1),es.N(ed,ed,[ec.drawingBufferWidth,ec.drawingBufferHeight,0]),this.useProgram("clippingMask",null,!0).draw(en,ec.TRIANGLES,Zt.disabled,this.stencilClearMode,jt.disabled,Ut.disabled,null,null,{mainMatrix:ed,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:ed},"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(en,es,ec){if(this.currentStencilSource===en.source||!en.isTileClipped()||!es||!es.length)return;this.currentStencilSource=en.source,this.nextStencilID+es.length>256&&this.clearStencil();let ed=this.context;ed.setColorMode(jt.disabled),ed.setDepthMode(Zt.disabled);let ep={};for(let en of es)ep[en.key]=this.nextStencilID++;this._renderTileMasks(ep,es,ec,!0),this._renderTileMasks(ep,es,ec,!1),this._tileClippingMaskIDs=ep}_renderTileMasks(en,es,ec,ed){let ep=this.context,ef=ep.gl,em=this.style.projection,e_=this.transform,eg=this.useProgram("clippingMask");for(let ey of es){let es=en[ey.key],ex=this.style.map.terrain&&this.style.map.terrain.getTerrainData(ey),ev=em.getMeshFromTileID(this.context,ey.canonical,ed,!0,"stencil"),eb=e_.getProjectionData({overscaledTileID:ey,applyGlobeMatrix:!ec,applyTerrainMatrix:!0});eg.draw(ep,ef.TRIANGLES,Zt.disabled,new Vt({func:ef.ALWAYS,mask:0},es,255,ef.KEEP,ef.KEEP,ef.REPLACE),jt.disabled,ec?Ut.disabled:Ut.backCCW,null,ex,eb,"$clipping",ev.vertexBuffer,ev.indexBuffer,ev.segments)}}_renderTilesDepthBuffer(){let en=this.context,es=en.gl,ec=this.style.projection,ed=this.transform,ep=this.useProgram("depth"),ef=this.getDepthModeFor3D(),em=ve(ed,{tileSize:ed.tileSize});for(let e_ of em){let em=this.style.map.terrain&&this.style.map.terrain.getTerrainData(e_),eg=ec.getMeshFromTileID(this.context,e_.canonical,!0,!0,"raster"),ey=ed.getProjectionData({overscaledTileID:e_,applyGlobeMatrix:!0,applyTerrainMatrix:!0});ep.draw(en,es.TRIANGLES,ef,Vt.disabled,jt.disabled,Ut.backCCW,null,em,ey,"$clipping",eg.vertexBuffer,eg.indexBuffer,eg.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let en=this.nextStencilID++,es=this.context.gl;return new Vt({func:es.NOTEQUAL,mask:255},en,255,es.KEEP,es.KEEP,es.REPLACE)}stencilModeForClipping(en){let es=this.context.gl;return new Vt({func:es.EQUAL,mask:255},this._tileClippingMaskIDs[en.key],0,es.KEEP,es.KEEP,es.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(en){let es=this.context.gl,ec=en.sort((en,es)=>es.overscaledZ-en.overscaledZ),ed=ec[ec.length-1].overscaledZ,ep=ec[0].overscaledZ-ed+1;if(ep>1){this.currentStencilSource=void 0,this.nextStencilID+ep>256&&this.clearStencil();let en={};for(let ec=0;ec<ep;ec++)en[ec+ed]=new Vt({func:es.GEQUAL,mask:255},ec+this.nextStencilID,255,es.KEEP,es.KEEP,es.REPLACE);return this.nextStencilID+=ep,[en,ec]}return[{[ed]:Vt.disabled},ec]}stencilConfigForOverlapTwoPass(en){let es=this.context.gl,ec=en.sort((en,es)=>es.overscaledZ-en.overscaledZ),ed=ec[ec.length-1].overscaledZ,ep=ec[0].overscaledZ-ed+1;if(this.clearStencil(),ep>1){let en={},ef={};for(let ec=0;ec<ep;ec++)en[ec+ed]=new Vt({func:es.GREATER,mask:255},ep+1+ec,255,es.KEEP,es.KEEP,es.REPLACE),ef[ec+ed]=new Vt({func:es.GREATER,mask:255},1+ec,255,es.KEEP,es.KEEP,es.REPLACE);return this.nextStencilID=2*ep+1,[en,ef,ec]}return this.nextStencilID=3,[{[ed]:new Vt({func:es.GREATER,mask:255},2,255,es.KEEP,es.KEEP,es.REPLACE)},{[ed]:new Vt({func:es.GREATER,mask:255},1,255,es.KEEP,es.KEEP,es.REPLACE)},ec]}colorModeForRenderPass(){let en=this.context.gl;if(this._showOverdrawInspector){let ec=1/8;return new jt([en.CONSTANT_COLOR,en.ONE],new es.bf(ec,ec,ec,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?jt.unblended:jt.alphaBlended}getDepthModeForSublayer(en,es,ec){if(!this.opaquePassEnabledForLayer())return Zt.disabled;let ed=1-((1+this.currentLayer)*this.numSublayers+en)*this.depthEpsilon;return new Zt(ec||this.context.gl.LEQUAL,es,[ed,ed])}getDepthModeFor3D(){return new Zt(this.context.gl.LEQUAL,Zt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(en,ec){var ed,ep;this.style=en,this.options=ec,this.lineAtlas=en.lineAtlas,this.imageManager=en.imageManager,this.glyphManager=en.glyphManager,this.symbolFadeChange=en.placement.symbolFadeChange(ev.now()),this.imageManager.beginFrame();let ef=this.style._order,em=this.style.sourceCaches,e_={},eg={},ey={},ex={isRenderingToTexture:!1,isRenderingGlobe:(null===(ed=en.projection)||void 0===ed?void 0:ed.transitionState)>0};for(let en in em){let es=em[en];es.used&&es.prepare(this.context),e_[en]=es.getVisibleCoordinates(!1),eg[en]=e_[en].slice().reverse(),ey[en]=es.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let en=0;en<ef.length;en++)if(this.style._layers[ef[en]].is3D()){this.opaquePassCutoff=en;break}for(let en of(this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen",ef)){let es=this.style._layers[en];if(!es.hasOffscreenPass()||es.isHidden(this.transform.zoom))continue;let ec=eg[es.source];("custom"===es.type||ec.length)&&this.renderLayer(this,em[es.source],es,ec,ex)}if(null===(ep=this.style.projection)||void 0===ep||ep.updateGPUdependent({context:this.context,useProgram:en=>this.useProgram(en)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:ec.showOverdrawInspector?es.bf.black:es.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(en,es){let ec=en.context,ed=ec.gl,ep=((en,es,ec)=>{let ed=Math.cos(es.rollInRadians),ep=Math.sin(es.rollInRadians),ef=he(es),em=es.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:en.properties.get("sky-color"),u_horizon_color:en.properties.get("horizon-color"),u_horizon:[(es.width/2-ef*ep)*ec,(es.height/2+ef*ed)*ec],u_horizon_normal:[-ep,ed],u_sky_horizon_blend:en.properties.get("sky-horizon-blend")*es.height/2*ec,u_sky_blend:em}})(es,en.style.map.transform,en.pixelRatio),ef=new Zt(ed.LEQUAL,Zt.ReadWrite,[0,1]),em=Vt.disabled,e_=en.colorModeForRenderPass(),eg=en.useProgram("sky"),ey=Ir(ec,es);eg.draw(ec,ed.TRIANGLES,ef,em,e_,Ut.disabled,ep,null,void 0,"sky",ey.vertexBuffer,ey.indexBuffer,ey.segments)}(this,this.style.sky),this._showOverdrawInspector=ec.showOverdrawInspector,this.depthRangeFor3D=[0,1-(en._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=ef.length-1;this.currentLayer>=0;this.currentLayer--){let en=this.style._layers[ef[this.currentLayer]],es=em[en.source],ec=e_[en.source];this._renderTileClippingMasks(en,ec,!1),this.renderLayer(this,es,en,ec,ex)}this.renderPass="translucent";let eb=!1;for(this.currentLayer=0;this.currentLayer<ef.length;this.currentLayer++){let en=this.style._layers[ef[this.currentLayer]],es=em[en.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(en,ex))continue;this.opaquePassEnabledForLayer()||eb||(eb=!0,ex.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let ec=("symbol"===en.type?ey:eg)[en.source];this._renderTileClippingMasks(en,e_[en.source],!!this.renderToTexture),this.renderLayer(this,es,en,ec,ex)}if(ex.isRenderingGlobe&&function(en,ec,ed){let ep=en.context,ef=ep.gl,em=en.useProgram("atmosphere"),e_=new Zt(ef.LEQUAL,Zt.ReadOnly,[0,1]),eg=en.transform,ey=function(en,ec){let ed=en.properties.get("position"),ep=[-ed.x,-ed.y,-ed.z],ef=es.ag(new Float64Array(16));return"map"===en.properties.get("anchor")&&(es.b6(ef,ef,ec.rollInRadians),es.b7(ef,ef,-ec.pitchInRadians),es.b6(ef,ef,ec.bearingInRadians),es.b7(ef,ef,ec.center.lat*Math.PI/180),es.bz(ef,ef,-ec.center.lng*Math.PI/180)),es.c5(ep,ep,ef),ep}(ed,en.transform),ex=eg.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ev=ec.properties.get("atmosphere-blend")*ex.projectionTransition;if(0===ev)return;let eb=oi(eg.worldSize,eg.center.lat),ew=eg.inverseProjectionMatrix,eT=new Float64Array(4);eT[3]=1,es.aw(eT,eT,eg.modelViewProjectionMatrix),eT[0]/=eT[3],eT[1]/=eT[3],eT[2]/=eT[3],eT[3]=1,es.aw(eT,eT,ew),eT[0]/=eT[3],eT[1]/=eT[3],eT[2]/=eT[3],eT[3]=1;let eP={u_sun_pos:ey,u_atmosphere_blend:ev,u_globe_position:[eT[0],eT[1],eT[2]],u_globe_radius:eb,u_inv_proj_matrix:ew},eS=Ir(ep,ec);em.draw(ep,ef.TRIANGLES,e_,Vt.disabled,jt.alphaBlended,Ut.disabled,eP,null,null,"atmosphere",eS.vertexBuffer,eS.indexBuffer,eS.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let en=function(en,es){let ec=null,ed=Object.values(en._layers).flatMap(ec=>ec.source&&!ec.isHidden(es)?[en.sourceCaches[ec.source]]:[]),ep=ed.filter(en=>"vector"===en.getSource().type),ef=ed.filter(en=>"vector"!==en.getSource().type),s=en=>{(!ec||ec.getSource().maxzoom<en.getSource().maxzoom)&&(ec=en)};return ep.forEach(en=>s(en)),ec||ef.forEach(en=>s(en)),ec}(this.style,this.transform.zoom);en&&function(en,ec,ed){for(let ep=0;ep<ed.length;ep++)!function(en,ec,ed){let ep=en.context,ef=ep.gl,em=en.useProgram("debug"),e_=Zt.disabled,eg=Vt.disabled,ey=en.colorModeForRenderPass(),ex="$debug",ev=en.style.map.terrain&&en.style.map.terrain.getTerrainData(ed);ep.activeTexture.set(ef.TEXTURE0);let eb=ec.getTileByID(ed.key).latestRawTileData,ew=Math.floor((eb&&eb.byteLength||0)/1024),eT=ec.getTile(ed).tileSize,eP=512/Math.min(eT,512)*(ed.overscaledZ/en.transform.zoom)*.5,eS=ed.canonical.toString();ed.overscaledZ!==ed.canonical.z&&(eS+=` => ${ed.overscaledZ}`),function(en,es){en.initDebugOverlayCanvas();let ec=en.debugOverlayCanvas,ed=en.context.gl,ep=en.debugOverlayCanvas.getContext("2d");ep.clearRect(0,0,ec.width,ec.height),ep.shadowColor="white",ep.shadowBlur=2,ep.lineWidth=1.5,ep.strokeStyle="white",ep.textBaseline="top",ep.font="bold 36px Open Sans, sans-serif",ep.fillText(es,5,5),ep.strokeText(es,5,5),en.debugOverlayTexture.update(ec),en.debugOverlayTexture.bind(ed.LINEAR,ed.CLAMP_TO_EDGE)}(en,`${eS} ${ew}kB`);let eM=en.transform.getProjectionData({overscaledTileID:ed,applyGlobeMatrix:!0,applyTerrainMatrix:!0});em.draw(ep,ef.TRIANGLES,e_,eg,jt.alphaBlended,Ut.disabled,Oi(es.bf.transparent,eP),null,eM,ex,en.debugBuffer,en.quadTriangleIndexBuffer,en.debugSegments),em.draw(ep,ef.LINE_STRIP,e_,eg,ey,Ut.disabled,Oi(es.bf.red),ev,eM,ex,en.debugBuffer,en.tileBorderIndexBuffer,en.debugSegments)}(en,ec,ed[ep])}(this,en,en.getVisibleCoordinates())}this.options.showPadding&&function(en){var es,ec;let ed=en.transform.padding;yr(en,en.transform.height-(ed.top||0),3,e0),yr(en,ed.bottom||0,3,e1),wr(en,ed.left||0,3,e2),wr(en,en.transform.width-(ed.right||0),3,e3);let ep=en.transform.centerPoint;es=ep.x,ec=en.transform.height-ep.y,Tr(en,es-1,ec-10,2,20,e5),Tr(en,es-10,ec-1,20,2,e5)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(en){if(!this.style||!this.style.map||!this.style.map.terrain)return;let ec=this.terrainFacilitator.matrix,ed=this.transform.modelViewProjectionMatrix,ep=this.terrainFacilitator.dirty;ep||(ep=en?!es.c8(ec,ed):!es.c9(ec,ed)),ep||(ep=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),ep&&(es.ca(ec,ed),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(en,ec){let ed=en.context,ep=ed.gl,ef=en.transform,em=jt.unblended,e_=new Zt(ep.LEQUAL,Zt.ReadWrite,[0,1]),eg=ec.sourceCache.getRenderableTiles(),ey=en.useProgram("terrainDepth");for(let ex of(ed.bindFramebuffer.set(ec.getFramebuffer("depth").framebuffer),ed.viewport.set([0,0,en.width/devicePixelRatio,en.height/devicePixelRatio]),ed.clear({color:es.bf.transparent,depth:1}),eg)){let en=ec.getTerrainMesh(ex.tileID),es=ec.getTerrainData(ex.tileID),eg=ef.getProjectionData({overscaledTileID:ex.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ev={u_ele_delta:ec.getMeshFrameDelta(ef.zoom)};ey.draw(ed,ep.TRIANGLES,e_,Vt.disabled,em,Ut.backCCW,ev,es,eg,"terrain",en.vertexBuffer,en.indexBuffer,en.segments)}ed.bindFramebuffer.set(null),ed.viewport.set([0,0,en.width,en.height])}(this,this.style.map.terrain),function(en,ec){let ed=en.context,ep=ed.gl,ef=en.transform,em=jt.unblended,e_=new Zt(ep.LEQUAL,Zt.ReadWrite,[0,1]),eg=ec.getCoordsTexture(),ey=ec.sourceCache.getRenderableTiles(),ex=en.useProgram("terrainCoords");for(let ev of(ed.bindFramebuffer.set(ec.getFramebuffer("coords").framebuffer),ed.viewport.set([0,0,en.width/devicePixelRatio,en.height/devicePixelRatio]),ed.clear({color:es.bf.transparent,depth:1}),ec.coordsIndex=[],ey)){let en=ec.getTerrainMesh(ev.tileID),es=ec.getTerrainData(ev.tileID);ed.activeTexture.set(ep.TEXTURE0),ep.bindTexture(ep.TEXTURE_2D,eg.texture);let ey={u_terrain_coords_id:(255-ec.coordsIndex.length)/255,u_texture:0,u_ele_delta:ec.getMeshFrameDelta(ef.zoom)},eb=ef.getProjectionData({overscaledTileID:ev.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ex.draw(ed,ep.TRIANGLES,e_,Vt.disabled,em,Ut.backCCW,ey,es,eb,"terrain",en.vertexBuffer,en.indexBuffer,en.segments),ec.coordsIndex.push(ev.tileID.key)}ed.bindFramebuffer.set(null),ed.viewport.set([0,0,en.width,en.height])}(this,this.style.map.terrain))}renderLayer(en,ec,ed,ep,ef){ed.isHidden(this.transform.zoom)||("background"===ed.type||"custom"===ed.type||(ep||[]).length)&&(this.id=ed.id,es.cb(ed)?function(en,ec,ed,ep,ef,em){if("translucent"!==en.renderPass)return;let{isRenderingToTexture:e_}=em,eg=Vt.disabled,ey=en.colorModeForRenderPass();(ed._unevaluatedLayout.hasValue("text-variable-anchor")||ed._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(en,ec,ed,ep,ef,em,e_,eg,ey){let ex=ec.transform,ev=ec.style.map.terrain,eb="map"===ef,ew="map"===em;for(let ef of en){let en=ep.getTile(ef),em=en.getBucket(ed);if(!em||!em.text||!em.text.segments.get().length)continue;let eT=es.an(em.textSizeData,ex.zoom),eP=es.aC(en,1,ec.transform.zoom),eS=Ie(eb,ec.transform,eP),eM="none"!==ed.layout.get("icon-text-fit")&&em.hasIconData();if(eT){let ec=Math.pow(2,ex.zoom-en.tileID.overscaledZ),ed=ev?(en,es)=>ev.getElevation(ef,en,es):null;(function(en,ec,ed,ep,ef,em,e_,eg,ey,ex,ev,eb){let ew=en.text.placedSymbolArray,eT=en.text.dynamicLayoutVertexArray,eP=en.icon.dynamicLayoutVertexArray,eS={};eT.clear();for(let eP=0;eP<ew.length;eP++){let eM=ew.get(eP),eC=eM.hidden||!eM.crossTileID||en.allowVerticalPlacement&&!eM.placedOrientation?null:ep[eM.crossTileID];if(eC){let ep=new es.P(eM.anchorX,eM.anchorY),ew={getElevation:eb,width:ef.width,height:ef.height,pitchedLabelPlaneMatrix:em,pitchWithMap:ed,transform:ef,tileAnchorPoint:ep,translation:ex,unwrappedTileID:ev},eP=ed?Ne(ep.x,ep.y,ew):Oe(ep.x,ep.y,ew),eI=.5+ef.cameraToCenterDistance/eP.signedDistanceFromCamera*.5,eE=es.ap(en.textSizeData,eg,eM)*eI/es.aB;ed&&(eE*=en.tilePixelRatio/e_);let{width:eA,height:ez,anchor:ek,textOffset:eD,textBoxScale:eR}=eC,eL=function(en,ec,ed,ep,ef,em){let{horizontalAlign:e_,verticalAlign:eg}=es.aH(en);return new es.P((-(e_-.5)*ec/ef+ep[0])*em,(-(eg-.5)*ed/ef+ep[1])*em)}(ek,eA,ez,eD,eR,eE),eB=ef.getPitchedTextCorrection(ep.x+ex[0],ep.y+ex[1],ev),eF=function(en,ec,ed,ep,ef,em){let e_=ec.tileAnchorPoint.add(new es.P(ec.translation[0],ec.translation[1]));if(ec.pitchWithMap){let en=ep.mult(em);ed||(en=en.rotate(-ef));let es=e_.add(en);return Ee(es.x,es.y,ec.pitchedLabelPlaneMatrix,ec.getElevation).point}if(ed){let es=Oe(ec.tileAnchorPoint.x+1,ec.tileAnchorPoint.y,ec).point.sub(en),ed=Math.atan(es.y/es.x)+(es.x<0?Math.PI:0);return en.add(ep.rotate(ed))}return en.add(ep)}(eP.point,ew,ec,eL,-ef.bearingInRadians,eB),eO=en.allowVerticalPlacement&&eM.placedOrientation===es.ao.vertical?Math.PI/2:0;for(let en=0;en<eM.numGlyphs;en++)es.av(eT,eF,eO);ey&&eM.associatedIconIndex>=0&&(eS[eM.associatedIconIndex]={shiftedAnchor:eF,angle:eO})}else $e(eM.numGlyphs,eT)}if(ey){eP.clear();let ec=en.icon.placedSymbolArray;for(let en=0;en<ec.length;en++){let ed=ec.get(en);if(ed.hidden)$e(ed.numGlyphs,eP);else{let ec=eS[en];if(ec)for(let en=0;en<ed.numGlyphs;en++)es.av(eP,ec.shiftedAnchor,ec.angle);else $e(ed.numGlyphs,eP)}}en.icon.dynamicLayoutVertexBuffer.updateData(eP)}en.text.dynamicLayoutVertexBuffer.updateData(eT)})(em,eb,ew,ey,ex,eS,ec,eT,eM,es.aD(ex,en,e_,eg),ef.toUnwrapped(),ed)}}}(ep,en,ed,ec,ed.layout.get("text-rotation-alignment"),ed.layout.get("text-pitch-alignment"),ed.paint.get("text-translate"),ed.paint.get("text-translate-anchor"),ef),0!==ed.paint.get("icon-opacity").constantOr(1)&&ir(en,ec,ed,ep,!1,ed.paint.get("icon-translate"),ed.paint.get("icon-translate-anchor"),ed.layout.get("icon-rotation-alignment"),ed.layout.get("icon-pitch-alignment"),ed.layout.get("icon-keep-upright"),eg,ey,e_),0!==ed.paint.get("text-opacity").constantOr(1)&&ir(en,ec,ed,ep,!0,ed.paint.get("text-translate"),ed.paint.get("text-translate-anchor"),ed.layout.get("text-rotation-alignment"),ed.layout.get("text-pitch-alignment"),ed.layout.get("text-keep-upright"),eg,ey,e_),ec.map.showCollisionBoxes&&(Ko(en,ec,ed,ep,!0),Ko(en,ec,ed,ep,!1))}(en,ec,ed,ep,this.style.placement.variableOffsets,ef):es.cc(ed)?function(en,ec,ed,ep,ef){if("translucent"!==en.renderPass)return;let{isRenderingToTexture:em}=ef,e_=ed.paint.get("circle-opacity"),eg=ed.paint.get("circle-stroke-width"),ey=ed.paint.get("circle-stroke-opacity"),ex=!ed.layout.get("circle-sort-key").isConstant();if(0===e_.constantOr(1)&&(0===eg.constantOr(1)||0===ey.constantOr(1)))return;let ev=en.context,eb=ev.gl,ew=en.transform,eT=en.getDepthModeForSublayer(0,Zt.ReadOnly),eP=Vt.disabled,eS=en.colorModeForRenderPass(),eM=[],eC=ew.getCircleRadiusCorrection();for(let ef=0;ef<ep.length;ef++){let e_=ep[ef],eg=ec.getTile(e_),ey=eg.getBucket(ed);if(!ey)continue;let ev=ed.paint.get("circle-translate"),eb=ed.paint.get("circle-translate-anchor"),eT=es.aD(ew,eg,ev,eb),eP=ey.programConfigurations.get(ed.id),eS=en.useProgram("circle",eP),eI=ey.layoutVertexBuffer,eE=ey.indexBuffer,eA=en.style.map.terrain&&en.style.map.terrain.getTerrainData(e_),ez={programConfiguration:eP,program:eS,layoutVertexBuffer:eI,indexBuffer:eE,uniformValues:ki(en,eg,ed,eT,eC),terrainData:eA,projectionData:ew.getProjectionData({overscaledTileID:e_,applyGlobeMatrix:!em,applyTerrainMatrix:!0})};if(ex){let en=ey.segments.get();for(let ec of en)eM.push({segments:new es.aM([ec]),sortKey:ec.sortKey,state:ez})}else eM.push({segments:ey.segments,sortKey:0,state:ez})}for(let es of(ex&&eM.sort((en,es)=>en.sortKey-es.sortKey),eM)){let{programConfiguration:ec,program:ep,layoutVertexBuffer:ef,indexBuffer:em,uniformValues:e_,terrainData:eg,projectionData:ey}=es.state;ep.draw(ev,eb.TRIANGLES,eT,eP,eS,Ut.backCCW,e_,eg,ey,ed.id,ef,em,es.segments,ed.paint,en.transform.zoom,ec)}}(en,ec,ed,ep,ef):es.cd(ed)?function(en,ec,ed,ep,ef){if(0===ed.paint.get("heatmap-opacity"))return;let em=en.context,{isRenderingToTexture:e_,isRenderingGlobe:eg}=ef;if(en.style.map.terrain){for(let ef of ep){let ep=ec.getTile(ef);ec.hasRenderableParent(ef)||("offscreen"===en.renderPass?function(en,ec,ed,ep,ef){let em=en.context,e_=em.gl,eg=Vt.disabled,ey=new jt([e_.ONE,e_.ONE],es.bf.transparent,[!0,!0,!0,!0]),ex=ec.getBucket(ed);if(!ex)return;let ev=ep.key,eb=ed.heatmapFbos.get(ev);eb||(eb=sr(em,ec.tileSize,ec.tileSize),ed.heatmapFbos.set(ev,eb)),em.bindFramebuffer.set(eb.framebuffer),em.viewport.set([0,0,ec.tileSize,ec.tileSize]),em.clear({color:es.bf.transparent});let ew=ex.programConfigurations.get(ed.id),eT=en.useProgram("heatmap",ew,!ef),eP=en.transform.getProjectionData({overscaledTileID:ec.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),eS=en.style.map.terrain.getTerrainData(ep);eT.draw(em,e_.TRIANGLES,Zt.disabled,eg,ey,Ut.disabled,ji(ec,en.transform.zoom,ed.paint.get("heatmap-intensity"),1),eS,eP,ed.id,ex.layoutVertexBuffer,ex.indexBuffer,ex.segments,ed.paint,en.transform.zoom,ew)}(en,ep,ed,ef,eg):"translucent"===en.renderPass&&function(en,es,ec,ed,ep){let ef=en.context,em=ef.gl,e_=en.transform;ef.setColorMode(en.colorModeForRenderPass());let eg=nr(ef,es),ey=ec.key,ex=es.heatmapFbos.get(ey);if(!ex)return;ef.activeTexture.set(em.TEXTURE0),em.bindTexture(em.TEXTURE_2D,ex.colorAttachment.get()),ef.activeTexture.set(em.TEXTURE1),eg.bind(em.LINEAR,em.CLAMP_TO_EDGE);let ev=e_.getProjectionData({overscaledTileID:ec,applyTerrainMatrix:ep,applyGlobeMatrix:!ed});en.useProgram("heatmapTexture").draw(ef,em.TRIANGLES,Zt.disabled,Vt.disabled,en.colorModeForRenderPass(),Ut.disabled,Ni(en,es,0,1),null,ev,es.id,en.rasterBoundsBuffer,en.quadTriangleIndexBuffer,en.rasterBoundsSegments,es.paint,e_.zoom),ex.destroy(),es.heatmapFbos.delete(ey)}(en,ed,ef,e_,eg))}em.viewport.set([0,0,en.width,en.height])}else"offscreen"===en.renderPass?function(en,ec,ed,ep){let ef=en.context,em=ef.gl,e_=en.transform,eg=Vt.disabled,ey=new jt([em.ONE,em.ONE],es.bf.transparent,[!0,!0,!0,!0]);(function(en,ec,ed){let ep=en.gl;en.activeTexture.set(ep.TEXTURE1),en.viewport.set([0,0,ec.width/4,ec.height/4]);let ef=ed.heatmapFbos.get(es.c2);ef?(ep.bindTexture(ep.TEXTURE_2D,ef.colorAttachment.get()),en.bindFramebuffer.set(ef.framebuffer)):(ef=sr(en,ec.width/4,ec.height/4),ed.heatmapFbos.set(es.c2,ef))})(ef,en,ed),ef.clear({color:es.bf.transparent});for(let es=0;es<ep.length;es++){let ex=ep[es];if(ec.hasRenderableParent(ex))continue;let ev=ec.getTile(ex),eb=ev.getBucket(ed);if(!eb)continue;let ew=eb.programConfigurations.get(ed.id),eT=en.useProgram("heatmap",ew),eP=e_.getProjectionData({overscaledTileID:ex,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),eS=e_.getCircleRadiusCorrection();eT.draw(ef,em.TRIANGLES,Zt.disabled,eg,ey,Ut.backCCW,ji(ev,e_.zoom,ed.paint.get("heatmap-intensity"),eS),null,eP,ed.id,eb.layoutVertexBuffer,eb.indexBuffer,eb.segments,ed.paint,e_.zoom,ew)}ef.viewport.set([0,0,en.width,en.height])}(en,ec,ed,ep):"translucent"===en.renderPass&&function(en,ec){let ed=en.context,ep=ed.gl;ed.setColorMode(en.colorModeForRenderPass());let ef=ec.heatmapFbos.get(es.c2);ef&&(ed.activeTexture.set(ep.TEXTURE0),ep.bindTexture(ep.TEXTURE_2D,ef.colorAttachment.get()),ed.activeTexture.set(ep.TEXTURE1),nr(ed,ec).bind(ep.LINEAR,ep.CLAMP_TO_EDGE),en.useProgram("heatmapTexture").draw(ed,ep.TRIANGLES,Zt.disabled,Vt.disabled,en.colorModeForRenderPass(),Ut.disabled,Ni(en,ec,0,1),null,null,ec.id,en.viewportBuffer,en.quadTriangleIndexBuffer,en.viewportSegments,ec.paint,en.transform.zoom))}(en,ed)}(en,ec,ed,ep,ef):es.ce(ed)?function(en,ec,ed,ep,ef){if("translucent"!==en.renderPass)return;let{isRenderingToTexture:em}=ef,e_=ed.paint.get("line-opacity"),eg=ed.paint.get("line-width");if(0===e_.constantOr(1)||0===eg.constantOr(1))return;let ey=en.getDepthModeForSublayer(0,Zt.ReadOnly),ex=en.colorModeForRenderPass(),ev=ed.paint.get("line-dasharray"),eb=ev.constantOr(1),ew=ed.paint.get("line-pattern"),eT=ew.constantOr(1),eP=ed.paint.get("line-gradient"),eS=ed.getCrossfadeParameters(),eM=eT?"linePattern":eb?"lineSDF":eP?"lineGradient":"line",eC=en.context,eI=eC.gl,eE=en.transform,eA=!0;for(let ef of ep){let ep=ec.getTile(ef);if(eT&&!ep.patternsLoaded())continue;let e_=ep.getBucket(ed);if(!e_)continue;let eg=e_.programConfigurations.get(ed.id),ez=en.context.program.get(),ek=en.useProgram(eM,eg),eD=eA||ek.program!==ez,eR=en.style.map.terrain&&en.style.map.terrain.getTerrainData(ef),eL=ew.constantOr(null),eB=ev&&ev.constantOr(null);if(eL&&ep.imageAtlas){let en=ep.imageAtlas,es=en.patternPositions[eL.to.toString()],ec=en.patternPositions[eL.from.toString()];es&&ec&&eg.setConstantPatternPositions(es,ec)}else if(eB){let es="round"===ed.layout.get("line-cap"),ec=en.lineAtlas.getDash(eB.to,es),ep=en.lineAtlas.getDash(eB.from,es);eg.setConstantDashPositions(ec,ep)}let eF=eE.getProjectionData({overscaledTileID:ef,applyGlobeMatrix:!em,applyTerrainMatrix:!0}),eO=eE.getPixelScale(),ej=eT?Wi(en,ep,ed,eO,eS):eb?Hi(en,ep,ed,eO,eS):eP?qi(en,ep,ed,eO,e_.lineClipsArray.length):$i(en,ep,ed,eO);if(eT)eC.activeTexture.set(eI.TEXTURE0),ep.imageAtlasTexture.bind(eI.LINEAR,eI.CLAMP_TO_EDGE),eg.updatePaintBuffers(eS);else if(eb)(eD||en.lineAtlas.dirty)&&(eC.activeTexture.set(eI.TEXTURE0),en.lineAtlas.bind(eC)),eg.updatePaintBuffers(eS);else if(eP){let ep=e_.gradients[ed.id],em=ep.texture;if(ed.gradientVersion!==ep.version){let eg=256;if(ed.stepInterpolant){let ed=ec.getSource().maxzoom,ep=ef.canonical.z===ed?Math.ceil(1<<en.transform.maxZoom-ef.canonical.z):1;eg=es.ah(es.c3(e_.maxLineLength/es.$*1024*ep),256,eC.maxTextureSize)}ep.gradient=es.c4({expression:ed.gradientExpression(),evaluationKey:"lineProgress",resolution:eg,image:ep.gradient||void 0,clips:e_.lineClipsArray}),ep.texture?ep.texture.update(ep.gradient):ep.texture=new es.T(eC,ep.gradient,eI.RGBA),ep.version=ed.gradientVersion,em=ep.texture}eC.activeTexture.set(eI.TEXTURE0),em.bind(ed.stepInterpolant?eI.NEAREST:eI.LINEAR,eI.CLAMP_TO_EDGE)}let eV=en.stencilModeForClipping(ef);ek.draw(eC,eI.TRIANGLES,ey,eV,ex,Ut.disabled,ej,eR,eF,ed.id,e_.layoutVertexBuffer,e_.indexBuffer,e_.segments,ed.paint,en.transform.zoom,eg,e_.layoutVertexBuffer2),eA=!1}}(en,ec,ed,ep,ef):es.cf(ed)?function(en,ec,ed,ep,ef){let em=ed.paint.get("fill-color"),e_=ed.paint.get("fill-opacity");if(0===e_.constantOr(1))return;let{isRenderingToTexture:eg}=ef,ey=en.colorModeForRenderPass(),ex=ed.paint.get("fill-pattern"),ev=en.opaquePassEnabledForLayer()&&!ex.constantOr(1)&&1===em.constantOr(es.bf.transparent).a&&1===e_.constantOr(0)?"opaque":"translucent";if(en.renderPass===ev){let es=en.getDepthModeForSublayer(1,"opaque"===en.renderPass?Zt.ReadWrite:Zt.ReadOnly);cr(en,ec,ed,ep,es,ey,!1,eg)}if("translucent"===en.renderPass&&ed.paint.get("fill-antialias")){let es=en.getDepthModeForSublayer(ed.getPaintProperty("fill-outline-color")?2:0,Zt.ReadOnly);cr(en,ec,ed,ep,es,ey,!0,eg)}}(en,ec,ed,ep,ef):es.cg(ed)?function(en,es,ec,ed,ep){let ef=ec.paint.get("fill-extrusion-opacity");if(0===ef)return;let{isRenderingToTexture:em}=ep;if("translucent"===en.renderPass){let ep=new Zt(en.context.gl.LEQUAL,Zt.ReadWrite,en.depthRangeFor3D);if(1!==ef||ec.paint.get("fill-extrusion-pattern").constantOr(1))hr(en,es,ec,ed,ep,Vt.disabled,jt.disabled,em),hr(en,es,ec,ed,ep,en.stencilModeFor3D(),en.colorModeForRenderPass(),em);else{let ef=en.colorModeForRenderPass();hr(en,es,ec,ed,ep,Vt.disabled,ef,em)}}}(en,ec,ed,ep,ef):es.ch(ed)?function(en,ec,ed,ep,ef){if("offscreen"!==en.renderPass&&"translucent"!==en.renderPass)return;let{isRenderingToTexture:em}=ef,e_=en.context,eg=en.style.projection.useSubdivision,ey=en.getDepthModeForSublayer(0,Zt.ReadOnly),ex=en.colorModeForRenderPass();if("offscreen"===en.renderPass)(function(en,ec,ed,ep,ef,em,e_){let eg=en.context,ey=eg.gl;for(let ex of ed){let ed=ec.getTile(ex),ev=ed.dem;if(!ev||!ev.data||!ed.needsHillshadePrepare)continue;let eb=ev.dim,ew=ev.stride,eT=ev.getPixels();if(eg.activeTexture.set(ey.TEXTURE1),eg.pixelStoreUnpackPremultiplyAlpha.set(!1),ed.demTexture=ed.demTexture||en.getTileTexture(ew),ed.demTexture){let en=ed.demTexture;en.update(eT,{premultiply:!1}),en.bind(ey.NEAREST,ey.CLAMP_TO_EDGE)}else ed.demTexture=new es.T(eg,eT,ey.RGBA,{premultiply:!1}),ed.demTexture.bind(ey.NEAREST,ey.CLAMP_TO_EDGE);eg.activeTexture.set(ey.TEXTURE0);let eP=ed.fbo;if(!eP){let en=new es.T(eg,{width:eb,height:eb,data:null},ey.RGBA);en.bind(ey.LINEAR,ey.CLAMP_TO_EDGE),(eP=ed.fbo=eg.createFramebuffer(eb,eb,!0,!1)).colorAttachment.set(en.texture)}eg.bindFramebuffer.set(eP.framebuffer),eg.viewport.set([0,0,eb,eb]),en.useProgram("hillshadePrepare").draw(eg,ey.TRIANGLES,ef,em,e_,Ut.disabled,Zi(ed.tileID,ev),null,null,ep.id,en.rasterBoundsBuffer,en.quadTriangleIndexBuffer,en.rasterBoundsSegments),ed.needsHillshadePrepare=!1}})(en,ec,ep,ed,ey,Vt.disabled,ex),e_.viewport.set([0,0,en.width,en.height]);else if("translucent"===en.renderPass){if(eg){let[es,ef,e_]=en.stencilConfigForOverlapTwoPass(ep);ur(en,ec,ed,e_,es,ey,ex,!1,em),ur(en,ec,ed,e_,ef,ey,ex,!0,em)}else{let[es,ef]=en.getStencilConfigForOverlapAndUpdateStencilID(ep);ur(en,ec,ed,ef,es,ey,ex,!1,em)}}}(en,ec,ed,ep,ef):es.ci(ed)?function(en,es,ec,ed,ep){if("translucent"!==en.renderPass||!ed.length)return;let{isRenderingToTexture:ef}=ep,em=en.style.projection.useSubdivision,e_=en.getDepthModeForSublayer(0,Zt.ReadOnly),eg=en.colorModeForRenderPass();if(em){let[ep,em,ey]=en.stencilConfigForOverlapTwoPass(ed);dr(en,es,ec,ey,ep,e_,eg,!1,ef),dr(en,es,ec,ey,em,e_,eg,!0,ef)}else{let[ep,em]=en.getStencilConfigForOverlapAndUpdateStencilID(ed);dr(en,es,ec,em,ep,e_,eg,!1,ef)}}(en,ec,ed,ep,ef):es.cj(ed)?function(en,es,ec,ed,ep){if("translucent"!==en.renderPass||0===ec.paint.get("raster-opacity")||!ed.length)return;let{isRenderingToTexture:ef}=ep,em=es.getSource(),e_=en.style.projection.useSubdivision;if(em instanceof X)pr(en,es,ec,ed,null,!1,!1,em.tileCoords,em.flippedWindingOrder,ef);else if(e_){let[ep,em,e_]=en.stencilConfigForOverlapTwoPass(ed);pr(en,es,ec,e_,ep,!1,!0,eQ,!1,ef),pr(en,es,ec,e_,em,!0,!0,eQ,!1,ef)}else{let[ep,em]=en.getStencilConfigForOverlapAndUpdateStencilID(ed);pr(en,es,ec,em,ep,!1,!0,eQ,!1,ef)}}(en,ec,ed,ep,ef):es.ck(ed)?function(en,es,ec,ed,ep){let ef=ec.paint.get("background-color"),em=ec.paint.get("background-opacity");if(0===em)return;let{isRenderingToTexture:e_}=ep,eg=en.context,ey=eg.gl,ex=en.style.projection,ev=en.transform,eb=ev.tileSize,ew=ec.paint.get("background-pattern");if(en.isPatternMissing(ew))return;let eT=!ew&&1===ef.a&&1===em&&en.opaquePassEnabledForLayer()?"opaque":"translucent";if(en.renderPass!==eT)return;let eP=Vt.disabled,eS=en.getDepthModeForSublayer(0,"opaque"===eT?Zt.ReadWrite:Zt.ReadOnly),eM=en.colorModeForRenderPass(),eC=en.useProgram(ew?"backgroundPattern":"background"),eI=ed||ve(ev,{tileSize:eb,terrain:en.style.map.terrain});ew&&(eg.activeTexture.set(ey.TEXTURE0),en.imageManager.bind(en.context));let eE=ec.getCrossfadeParameters();for(let es of eI){let ed=ev.getProjectionData({overscaledTileID:es,applyGlobeMatrix:!e_,applyTerrainMatrix:!0}),ep=ew?oo(em,en,ew,{tileID:es,tileSize:eb},eE):io(em,ef),eT=en.style.map.terrain&&en.style.map.terrain.getTerrainData(es),eI=ex.getMeshFromTileID(eg,es.canonical,!1,!0,"raster");eC.draw(eg,ey.TRIANGLES,eS,eP,eM,Ut.backCCW,ep,eT,ed,ec.id,eI.vertexBuffer,eI.indexBuffer,eI.segments)}}(en,0,ed,ep,ef):es.cl(ed)&&function(en,es,ec,ed){let{isRenderingGlobe:ep}=ed,ef=en.context,em=ec.implementation,e_=en.style.projection,eg=en.transform,ey=eg.getProjectionDataForCustomLayer(ep),ex={farZ:eg.farZ,nearZ:eg.nearZ,fov:eg.fov*Math.PI/180,modelViewProjectionMatrix:eg.modelViewProjectionMatrix,projectionMatrix:eg.projectionMatrix,shaderData:{variantName:e_.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${e_.shaderPreludeCode.vertexSource}`,define:e_.shaderDefine},defaultProjectionData:ey},ev=em.renderingMode?em.renderingMode:"2d";if("offscreen"===en.renderPass){let es=em.prerender;es&&(en.setCustomLayerDefaults(),ef.setColorMode(en.colorModeForRenderPass()),es.call(em,ef.gl,ex),ef.setDirty(),en.setBaseState())}else if("translucent"===en.renderPass){en.setCustomLayerDefaults(),ef.setColorMode(en.colorModeForRenderPass()),ef.setStencilMode(Vt.disabled);let es="3d"===ev?en.getDepthModeFor3D():en.getDepthModeForSublayer(0,Zt.ReadOnly);ef.setDepthMode(es),em.render(ef.gl,ex),ef.setDirty(),en.setBaseState(),ef.bindFramebuffer.set(null)}}(en,0,ed,ef))}saveTileTexture(en){let es=this._tileTextures[en.size[0]];es?es.push(en):this._tileTextures[en.size[0]]=[en]}getTileTexture(en){let es=this._tileTextures[en];return es&&es.length>0?es.pop():null}isPatternMissing(en){if(!en)return!1;if(!en.from||!en.to)return!0;let es=this.imageManager.getPattern(en.from.toString()),ec=this.imageManager.getPattern(en.to.toString());return!es||!ec}useProgram(en,es,ec=!1,ed=[]){this.cache=this.cache||{};let ep=!!this.style.map.terrain,ef=this.style.projection,em=ec?eO.projectionMercator:ef.shaderPreludeCode,e_=ec?eV:ef.shaderDefine,eg=en+(es?es.cacheKey:"")+`/${ec?eU:ef.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(ep?"/terrain":"")+(ed?`/${ed.join("/")}`:"");return this.cache[eg]||(this.cache[eg]=new Si(this.context,eO[en],es,eX[en],this._showOverdrawInspector,ep,em,e_,ed)),this.cache[eg]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let en=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(en.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new es.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:en,drawingBufferHeight:es}=this.context.gl;return this.width!==en||this.height!==es}};function Sr(en,es){let ec,ed=!1,ep=null,ef=null,s=()=>{ep=null,ed&&(en.apply(ef,ec),ep=setTimeout(s,es),ed=!1)};return(...en)=>(ed=!0,ef=this,ec=en,ep||s(),ep)}let Er=class Er{constructor(en){this._getCurrentHash=()=>{let en=window.location.hash.replace("#","");if(this._hashName){let es;return en.split("&").map(en=>en.split("=")).forEach(en=>{en[0]===this._hashName&&(es=en)}),(es&&es[1]||"").split("/")}return en.split("/")},this._onHashChange=()=>{let en=this._getCurrentHash();if(!this._isValidHash(en))return!1;let es=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(en[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+en[2],+en[1]],zoom:+en[0],bearing:es,pitch:+(en[4]||0)}),!0},this._updateHashUnthrottled=()=>{let en=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,en)},this._removeHash=()=>{let en=this._getCurrentHash();if(0===en.length)return;let es=en.join("/"),ec=es;ec.split("&").length>0&&(ec=ec.split("&")[0]),this._hashName&&(ec=`${this._hashName}=${es}`);let ed=window.location.hash.replace(ec,"");ed.startsWith("#&")?ed=ed.slice(0,1)+ed.slice(2):"#"===ed&&(ed="");let ep=window.location.href.replace(/(#.+)?$/,ed);ep=ep.replace("&&","&"),window.history.replaceState(window.history.state,null,ep)},this._updateHash=Sr(this._updateHashUnthrottled,300),this._hashName=en&&encodeURIComponent(en)}addTo(en){return this._map=en,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(en){let es=this._map.getCenter(),ec=Math.round(100*this._map.getZoom())/100,ed=Math.pow(10,Math.ceil((ec*Math.LN2+Math.log(512/360/.5))/Math.LN10)),ep=Math.round(es.lng*ed)/ed,ef=Math.round(es.lat*ed)/ed,em=this._map.getBearing(),e_=this._map.getPitch(),eg="";if(eg+=en?`/${ep}/${ef}/${ec}`:`${ec}/${ef}/${ep}`,(em||e_)&&(eg+="/"+Math.round(10*em)/10),e_&&(eg+=`/${Math.round(e_)}`),this._hashName){let en=this._hashName,es=!1,ec=window.location.hash.slice(1).split("&").map(ec=>{let ed=ec.split("=")[0];return ed===en?(es=!0,`${ed}=${eg}`):ec}).filter(en=>en);return es||ec.push(`${en}=${eg}`),`#${ec.join("&")}`}return`#${eg}`}_isValidHash(en){if(en.length<3||en.some(isNaN))return!1;try{new es.S(+en[2],+en[1])}catch(en){return!1}let ec=+en[0],ed=+(en[3]||0),ep=+(en[4]||0);return ec>=this._map.getMinZoom()&&ec<=this._map.getMaxZoom()&&ed>=-180&&ed<=180&&ep>=this._map.getMinPitch()&&ep<=this._map.getMaxPitch()}};let e4={linearity:.3,easing:es.cm(0,0,.3,1)},e6=es.e({deceleration:2500,maxSpeed:1400},e4),e8=es.e({deceleration:20,maxSpeed:1400},e4),e9=es.e({deceleration:1e3,maxSpeed:360},e4),e7=es.e({deceleration:1e3,maxSpeed:90},e4),th=es.e({deceleration:1e3,maxSpeed:360},e4);let Fr=class Fr{constructor(en){this._map=en,this.clear()}clear(){this._inertiaBuffer=[]}record(en){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ev.now(),settings:en})}_drainInertiaBuffer(){let en=this._inertiaBuffer,es=ev.now();for(;en.length>0&&es-en[0].time>160;)en.shift()}_onMoveEnd(en){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let ec={zoom:0,bearing:0,pitch:0,roll:0,pan:new es.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:en}of this._inertiaBuffer)ec.zoom+=en.zoomDelta||0,ec.bearing+=en.bearingDelta||0,ec.pitch+=en.pitchDelta||0,ec.roll+=en.rollDelta||0,en.panDelta&&ec.pan._add(en.panDelta),en.around&&(ec.around=en.around),en.pinchAround&&(ec.pinchAround=en.pinchAround);let ed=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ep={};if(ec.pan.mag()){let ef=Or(ec.pan.mag(),ed,es.e({},e6,en||{})),em=ec.pan.mult(ef.amount/ec.pan.mag()),e_=this._map.cameraHelper.handlePanInertia(em,this._map.transform);ep.center=e_.easingCenter,ep.offset=e_.easingOffset,Br(ep,ef)}if(ec.zoom){let en=Or(ec.zoom,ed,e8);ep.zoom=this._map.transform.zoom+en.amount,Br(ep,en)}if(ec.bearing){let en=Or(ec.bearing,ed,e9);ep.bearing=this._map.transform.bearing+es.ah(en.amount,-179,179),Br(ep,en)}if(ec.pitch){let en=Or(ec.pitch,ed,e7);ep.pitch=this._map.transform.pitch+en.amount,Br(ep,en)}if(ec.roll){let en=Or(ec.roll,ed,th);ep.roll=this._map.transform.roll+es.ah(en.amount,-179,179),Br(ep,en)}if(ep.zoom||ep.bearing){let en=void 0===ec.pinchAround?ec.around:ec.pinchAround;ep.around=en?this._map.unproject(en):this._map.getCenter()}return this.clear(),es.e(ep,{noMoveStart:!0})}};function Br(en,es){(!en.duration||en.duration<es.duration)&&(en.duration=es.duration,en.easing=es.easing)}function Or(en,ec,ed){let{maxSpeed:ep,linearity:ef,deceleration:em}=ed,e_=es.ah(en*ef/(ec/1e3),-ep,ep),eg=Math.abs(e_)/(em*ef);return{easing:ed.easing,duration:1e3*eg,amount:e_*(eg/2)}}let jr=class jr extends es.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(en,ec,ed,ep={}){ed=ed instanceof MouseEvent?ed:new MouseEvent(en,ed);let ef=n.mousePos(ec.getCanvas(),ed),em=ec.unproject(ef);super(en,es.e({point:ef,lngLat:em,originalEvent:ed},ep)),this._defaultPrevented=!1,this.target=ec}};let Nr=class Nr extends es.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(en,ec,ed){let ep="touchend"===en?ed.changedTouches:ed.touches,ef=n.touchPos(ec.getCanvasContainer(),ep),em=ef.map(en=>ec.unproject(en)),e_=ef.reduce((en,es,ec,ed)=>en.add(es.div(ed.length)),new es.P(0,0));super(en,{points:ef,point:e_,lngLats:em,lngLat:ec.unproject(e_),originalEvent:ed}),this._defaultPrevented=!1}};let Ur=class Ur extends es.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(en,es,ec){super(en,{originalEvent:ec}),this._defaultPrevented=!1}};let Zr=class Zr{constructor(en,es){this._map=en,this._clickTolerance=es.clickTolerance}reset(){delete this._mousedownPos}wheel(en){return this._firePreventable(new Ur(en.type,this._map,en))}mousedown(en,es){return this._mousedownPos=es,this._firePreventable(new jr(en.type,this._map,en))}mouseup(en){this._map.fire(new jr(en.type,this._map,en))}click(en,es){this._mousedownPos&&this._mousedownPos.dist(es)>=this._clickTolerance||this._map.fire(new jr(en.type,this._map,en))}dblclick(en){return this._firePreventable(new jr(en.type,this._map,en))}mouseover(en){this._map.fire(new jr(en.type,this._map,en))}mouseout(en){this._map.fire(new jr(en.type,this._map,en))}touchstart(en){return this._firePreventable(new Nr(en.type,this._map,en))}touchmove(en){this._map.fire(new Nr(en.type,this._map,en))}touchend(en){this._map.fire(new Nr(en.type,this._map,en))}touchcancel(en){this._map.fire(new Nr(en.type,this._map,en))}_firePreventable(en){if(this._map.fire(en),en.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}};let Gr=class Gr{constructor(en){this._map=en}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(en){this._map.fire(new jr(en.type,this._map,en))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(en){this._delayContextMenu?this._contextMenuEvent=en:this._ignoreContextMenu||this._map.fire(new jr(en.type,this._map,en)),this._map.listens("contextmenu")&&en.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}};let Vr=class Vr{constructor(en){this._map=en}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(en){return this.transform.screenPointToLocation(es.P.convert(en),this._map.terrain)}};let $r=class $r{constructor(en,es){this._map=en,this._tr=new Vr(en),this._el=en.getCanvasContainer(),this._container=en.getContainer(),this._clickTolerance=es.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(en,es){this.isEnabled()&&en.shiftKey&&0===en.button&&(n.disableDrag(),this._startPos=this._lastPos=es,this._active=!0)}mousemoveWindow(en,es){if(!this._active||this._lastPos.equals(es)||!this._box&&es.dist(this._startPos)<this._clickTolerance)return;let ec=this._startPos;this._lastPos=es,this._box||(this._box=n.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",en));let ed=Math.min(ec.x,es.x),ep=Math.max(ec.x,es.x),ef=Math.min(ec.y,es.y),em=Math.max(ec.y,es.y);n.setTransform(this._box,`translate(${ed}px,${ef}px)`),this._box.style.width=ep-ed+"px",this._box.style.height=em-ef+"px"}mouseupWindow(en,ec){if(!this._active||0!==en.button)return;let ed=this._startPos;if(this.reset(),n.suppressClick(),ed.x!==ec.x||ed.y!==ec.y)return this._map.fire(new es.l("boxzoomend",{originalEvent:en})),{cameraAnimation:en=>en.fitScreenCoordinates(ed,ec,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",en)}keydown(en){this._active&&27===en.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",en))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(en,ec){return this._map.fire(new es.l(en,{originalEvent:ec}))}};function qr(en,es){if(en.length!==es.length)throw Error(`The number of touches and points are not equal - touches ${en.length}, points ${es.length}`);let ec={};for(let ed=0;ed<en.length;ed++)ec[en[ed].identifier]=es[ed];return ec}let Wr=class Wr{constructor(en){this.reset(),this.numTouches=en.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(en,ec,ed){(this.centroid||ed.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=en.timeStamp),ed.length===this.numTouches&&(this.centroid=function(en){let ec=new es.P(0,0);for(let es of en)ec._add(es);return ec.div(en.length)}(ec),this.touches=qr(ed,ec)))}touchmove(en,es,ec){if(this.aborted||!this.centroid)return;let ed=qr(ec,es);for(let en in this.touches){let es=ed[en];(!es||es.dist(this.touches[en])>30)&&(this.aborted=!0)}}touchend(en,es,ec){if((!this.centroid||en.timeStamp-this.startTime>500)&&(this.aborted=!0),0===ec.length){let en=!this.aborted&&this.centroid;if(this.reset(),en)return en}}};let Hr=class Hr{constructor(en){this.singleTap=new Wr(en),this.numTaps=en.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(en,es,ec){this.singleTap.touchstart(en,es,ec)}touchmove(en,es,ec){this.singleTap.touchmove(en,es,ec)}touchend(en,es,ec){let ed=this.singleTap.touchend(en,es,ec);if(ed){let es=en.timeStamp-this.lastTime<500,ec=!this.lastTap||30>this.lastTap.dist(ed);if(es&&ec||this.reset(),this.count++,this.lastTime=en.timeStamp,this.lastTap=ed,this.count===this.numTaps)return this.reset(),ed}}};let Xr=class Xr{constructor(en){this._tr=new Vr(en),this._zoomIn=new Hr({numTouches:1,numTaps:2}),this._zoomOut=new Hr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(en,es,ec){this._zoomIn.touchstart(en,es,ec),this._zoomOut.touchstart(en,es,ec)}touchmove(en,es,ec){this._zoomIn.touchmove(en,es,ec),this._zoomOut.touchmove(en,es,ec)}touchend(en,es,ec){let ed=this._zoomIn.touchend(en,es,ec),ep=this._zoomOut.touchend(en,es,ec),ef=this._tr;return ed?(this._active=!0,en.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:es=>es.easeTo({duration:300,zoom:ef.zoom+1,around:ef.unproject(ed)},{originalEvent:en})}):ep?(this._active=!0,en.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:es=>es.easeTo({duration:300,zoom:ef.zoom-1,around:ef.unproject(ep)},{originalEvent:en})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let Kr=class Kr{constructor(en){this._enabled=!!en.enable,this._moveStateManager=en.moveStateManager,this._clickTolerance=en.clickTolerance||1,this._moveFunction=en.move,this._activateOnStart=!!en.activateOnStart,en.assignEvents(this),this.reset()}reset(en){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(en)}_move(...en){let es=this._moveFunction(...en);if(es.bearingDelta||es.pitchDelta||es.rollDelta||es.around||es.panDelta)return this._active=!0,es}dragStart(en,es){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(en)&&(this._moveStateManager.startMove(en),this._lastPoint=Array.isArray(es)?es[0]:es,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(en,es){if(!this.isEnabled())return;let ec=this._lastPoint;if(!ec)return;if(en.preventDefault(),!this._moveStateManager.isValidMoveEvent(en))return void this.reset(en);let ed=Array.isArray(es)?es[0]:es;return!this._moved&&ed.dist(ec)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=ed,this._move(ec,ed))}dragEnd(en){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(en)&&(this._moved&&n.suppressClick(),this.reset(en))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}};let tc={0:1,2:2};let ea=class ea{constructor(en){this._correctEvent=en.checkCorrectEvent}startMove(en){let es=n.mouseButton(en);this._eventButton=es}endMove(en){delete this._eventButton}isValidStartEvent(en){return this._correctEvent(en)}isValidMoveEvent(en){return!function(en,es){let ec=tc[es];return void 0===en.buttons||(en.buttons&ec)!==ec}(en,this._eventButton)}isValidEndEvent(en){return n.mouseButton(en)===this._eventButton}};let ta=class ta{constructor(){this._firstTouch=void 0}_isOneFingerTouch(en){return 1===en.targetTouches.length}_isSameTouchEvent(en){return en.targetTouches[0].identifier===this._firstTouch}startMove(en){this._firstTouch=en.targetTouches[0].identifier}endMove(en){delete this._firstTouch}isValidStartEvent(en){return this._isOneFingerTouch(en)}isValidMoveEvent(en){return this._isOneFingerTouch(en)&&this._isSameTouchEvent(en)}isValidEndEvent(en){return this._isOneFingerTouch(en)&&this._isSameTouchEvent(en)}};let ia=class ia{constructor(en=new ea({checkCorrectEvent:()=>!0}),es=new ta){this.mouseMoveStateManager=en,this.oneFingerTouchMoveStateManager=es}_executeRelevantHandler(en,es,ec){return en instanceof MouseEvent?es(en):"undefined"!=typeof TouchEvent&&en instanceof TouchEvent?ec(en):void 0}startMove(en){this._executeRelevantHandler(en,en=>this.mouseMoveStateManager.startMove(en),en=>this.oneFingerTouchMoveStateManager.startMove(en))}endMove(en){this._executeRelevantHandler(en,en=>this.mouseMoveStateManager.endMove(en),en=>this.oneFingerTouchMoveStateManager.endMove(en))}isValidStartEvent(en){return this._executeRelevantHandler(en,en=>this.mouseMoveStateManager.isValidStartEvent(en),en=>this.oneFingerTouchMoveStateManager.isValidStartEvent(en))}isValidMoveEvent(en){return this._executeRelevantHandler(en,en=>this.mouseMoveStateManager.isValidMoveEvent(en),en=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(en))}isValidEndEvent(en){return this._executeRelevantHandler(en,en=>this.mouseMoveStateManager.isValidEndEvent(en),en=>this.oneFingerTouchMoveStateManager.isValidEndEvent(en))}};let oa=en=>{en.mousedown=en.dragStart,en.mousemoveWindow=en.dragMove,en.mouseup=en.dragEnd,en.contextmenu=en=>{en.preventDefault()}};let ra=class ra{constructor(en,es){this._clickTolerance=en.clickTolerance||1,this._map=es,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new es.P(0,0)}_shouldBePrevented(en){return en<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(en,es,ec){return this._calculateTransform(en,es,ec)}touchmove(en,es,ec){if(this._active){if(!this._shouldBePrevented(ec.length))return en.preventDefault(),this._calculateTransform(en,es,ec);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",en)}}touchend(en,es,ec){this._calculateTransform(en,es,ec),this._active&&this._shouldBePrevented(ec.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(en,ec,ed){ed.length>0&&(this._active=!0);let ep=qr(ed,ec),ef=new es.P(0,0),em=new es.P(0,0),e_=0;for(let en in ep){let es=ep[en],ec=this._touches[en];ec&&(ef._add(es),em._add(es.sub(ec)),e_++,ep[en]=es)}if(this._touches=ep,this._shouldBePrevented(e_)||!em.mag())return;let eg=em.div(e_);return this._sum._add(eg),this._sum.mag()<this._clickTolerance?void 0:{around:ef.div(e_),panDelta:eg}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let aa=class aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(en,es,ec){this._firstTwoTouches||ec.length<2||(this._firstTwoTouches=[ec[0].identifier,ec[1].identifier],this._start([es[0],es[1]]))}touchmove(en,es,ec){if(!this._firstTwoTouches)return;en.preventDefault();let[ed,ep]=this._firstTwoTouches,ef=sa(ec,es,ed),em=sa(ec,es,ep);if(!ef||!em)return;let e_=this._aroundCenter?null:ef.add(em).div(2);return this._move([ef,em],e_,en)}touchend(en,es,ec){if(!this._firstTwoTouches)return;let[ed,ep]=this._firstTwoTouches,ef=sa(ec,es,ed),em=sa(ec,es,ep);ef&&em||(this._active&&n.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(en){this._enabled=!0,this._aroundCenter=!!en&&"center"===en.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}};function sa(en,es,ec){for(let ed=0;ed<en.length;ed++)if(en[ed].identifier===ec)return es[ed]}function na(en,es){return Math.log(en/es)/Math.LN2}let la=class la extends aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(en){this._startDistance=this._distance=en[0].dist(en[1])}_move(en,es){let ec=this._distance;if(this._distance=en[0].dist(en[1]),this._active||!(.1>Math.abs(na(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:na(this._distance,ec),pinchAround:es}}};function ca(en,es){return 180*en.angleWith(es)/Math.PI}let ha=class ha extends aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(en){this._startVector=this._vector=en[0].sub(en[1]),this._minDiameter=en[0].dist(en[1])}_move(en,es,ec){let ed=this._vector;if(this._vector=en[0].sub(en[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ca(this._vector,ed),pinchAround:es}}_isBelowThreshold(en){this._minDiameter=Math.min(this._minDiameter,en.mag());let es=25/(Math.PI*this._minDiameter)*360,ec=ca(en,this._startVector);return Math.abs(ec)<es}};function ua(en){return Math.abs(en.y)>Math.abs(en.x)}let da=class da extends aa{constructor(en){super(),this._currentTouchCount=0,this._map=en}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(en,es,ec){super.touchstart(en,es,ec),this._currentTouchCount=ec.length}_start(en){this._lastPoints=en,ua(en[0].sub(en[1]))&&(this._valid=!1)}_move(en,es,ec){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let ed=en[0].sub(this._lastPoints[0]),ep=en[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(ed,ep,ec.timeStamp),this._valid?(this._lastPoints=en,this._active=!0,{pitchDelta:-((ed.y+ep.y)/2*.5)}):void 0}gestureBeginsVertically(en,es,ec){if(void 0!==this._valid)return this._valid;let ed=en.mag()>=2,ep=es.mag()>=2;if(!ed&&!ep)return;if(!ed||!ep)return void 0===this._firstMove&&(this._firstMove=ec),ec-this._firstMove<100&&void 0;let ef=en.y>0==es.y>0;return ua(en)&&ua(es)&&ef}};let pa=class pa{constructor(en){this._tr=new Vr(en),this._panStep=100,this._bearingStep=15,this._pitchStep=10,this._rotationDisabled=!1}reset(){this._active=!1}keydown(en){if(en.altKey||en.ctrlKey||en.metaKey)return;let es=0,ec=0,ed=0,ep=0,ef=0;switch(en.keyCode){case 61:case 107:case 171:case 187:es=1;break;case 189:case 109:case 173:es=-1;break;case 37:en.shiftKey?ec=-1:(en.preventDefault(),ep=-1);break;case 39:en.shiftKey?ec=1:(en.preventDefault(),ep=1);break;case 38:en.shiftKey?ed=1:(en.preventDefault(),ef=-1);break;case 40:en.shiftKey?ed=-1:(en.preventDefault(),ef=1);break;default:return}return this._rotationDisabled&&(ec=0,ed=0),{cameraAnimation:em=>{let e_=this._tr;em.easeTo({duration:300,easeId:"keyboardHandler",easing:ma,zoom:es?Math.round(e_.zoom)+es*(en.shiftKey?2:1):e_.zoom,bearing:e_.bearing+ec*this._bearingStep,pitch:e_.pitch+ed*this._pitchStep,offset:[-ep*this._panStep,-ef*this._panStep],center:e_.center},{originalEvent:en})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}};function ma(en){return en*(2-en)}let td=1/450;let va=class va{constructor(en,es){this._onTimeout=en=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(en)},this._map=en,this._tr=new Vr(en),this._triggerRenderFrame=es,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=td}setZoomRate(en){this._defaultZoomRate=en}setWheelZoomRate(en){this._wheelZoomRate=en}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(en){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!en&&"center"===en.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(en){return!!this._map.cooperativeGestures.isEnabled()&&!(en.ctrlKey||this._map.cooperativeGestures.isBypassed(en))}wheel(en){if(!this.isEnabled())return;if(this._shouldBePrevented(en))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",en);let es=en.deltaMode===WheelEvent.DOM_DELTA_LINE?40*en.deltaY:en.deltaY,ec=ev.now(),ed=ec-(this._lastWheelEventTime||0);this._lastWheelEventTime=ec,0!==es&&es%4.000244140625==0?this._type="wheel":0!==es&&4>Math.abs(es)?this._type="trackpad":ed>400?(this._type=null,this._lastValue=es,this._timeout=setTimeout(this._onTimeout,40,en)):this._type||(this._type=200>Math.abs(ed*es)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,es+=this._lastValue)),en.shiftKey&&es&&(es/=4),this._type&&(this._lastWheelEvent=en,this._delta-=es,this._active||this._start(en)),en.preventDefault()}_start(en){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let ec=n.mousePos(this._map.getCanvas(),en),ed=this._tr;this._aroundPoint=this._aroundCenter?ed.transform.locationToScreenPoint(es.S.convert(ed.center)):ec,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let en=this._tr.transform;if("number"==typeof this._lastExpectedZoom){let es=en.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=es),"number"==typeof this._targetZoom&&(this._targetZoom+=es)}if(0!==this._delta){let ec="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,ed=2/(1+Math.exp(-Math.abs(this._delta*ec)));this._delta<0&&0!==ed&&(ed=1/ed);let ep="number"!=typeof this._targetZoom?en.scale:es.af(this._targetZoom);this._targetZoom=en.getConstrained(en.getCameraLngLat(),es.ak(ep*ed)).zoom,"wheel"===this._type&&(this._startZoom=en.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let ec="number"!=typeof this._targetZoom?en.zoom:this._targetZoom,ed=this._startZoom,ep=this._easing,ef,em=!1;if("wheel"===this._type&&ed&&ep){let en=ev.now()-this._lastWheelEventTime,e_=Math.min((en+5)/200,1),eg=ep(e_);ef=es.C.number(ed,ec,eg),e_<1?this._frameId||(this._frameId=!0):em=!0}else ef=ec,em=!0;return this._active=!0,em&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=ef,{noInertia:!0,needsRenderFrame:!em,zoomDelta:ef-en.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(en){let ec=es.co;if(this._prevEase){let en=this._prevEase,ed=(ev.now()-en.start)/en.duration,ep=en.easing(ed+.01)-en.easing(ed),ef=.27/Math.sqrt(ep*ep+1e-4)*.01,em=Math.sqrt(.0729-ef*ef);ec=es.cm(ef,em,.25,1)}return this._prevEase={start:ev.now(),duration:en,easing:ec},ec}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}};let ba=class ba{constructor(en,es){this._clickZoom=en,this._tapZoom=es}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}};let xa=class xa{constructor(en){this._tr=new Vr(en),this.reset()}reset(){this._active=!1}dblclick(en,es){return en.preventDefault(),{cameraAnimation:ec=>{ec.easeTo({duration:300,zoom:this._tr.zoom+(en.shiftKey?-1:1),around:this._tr.unproject(es)},{originalEvent:en})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let ya=class ya{constructor(){this._tap=new Hr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(en,es,ec){if(!this._swipePoint){if(this._tapTime){let ed=es[0],ep=en.timeStamp-this._tapTime<500,ef=30>this._tapPoint.dist(ed);ep&&ef?ec.length>0&&(this._swipePoint=ed,this._swipeTouch=ec[0].identifier):this.reset()}else this._tap.touchstart(en,es,ec)}}touchmove(en,es,ec){if(this._tapTime){if(this._swipePoint){if(ec[0].identifier!==this._swipeTouch)return;let ed=es[0],ep=ed.y-this._swipePoint.y;return this._swipePoint=ed,en.preventDefault(),this._active=!0,{zoomDelta:ep/128}}}else this._tap.touchmove(en,es,ec)}touchend(en,es,ec){if(this._tapTime)this._swipePoint&&0===ec.length&&this.reset();else{let ed=this._tap.touchend(en,es,ec);ed&&(this._tapTime=en.timeStamp,this._tapPoint=ed)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let wa=class wa{constructor(en,es,ec){this._el=en,this._mousePan=es,this._touchPan=ec}enable(en){this._inertiaOptions=en||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}};let Ta=class Ta{constructor(en,es,ec,ed){this._pitchWithRotate=en.pitchWithRotate,this._rollEnabled=en.rollEnabled,this._mouseRotate=es,this._mousePitch=ec,this._mouseRoll=ed}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}};let Pa=class Pa{constructor(en,es,ec,ed){this._el=en,this._touchZoom=es,this._touchRotate=ec,this._tapDragZoom=ed,this._rotationDisabled=!1,this._enabled=!0}enable(en){this._touchZoom.enable(en),this._rotationDisabled||this._touchRotate.enable(en),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}};let Ca=class Ca{constructor(en,es){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=en,this._options=es,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let en=this._map.getCanvasContainer();en.classList.add("maplibregl-cooperative-gestures"),this._container=n.create("div","maplibregl-cooperative-gesture-screen",en);let es=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(es=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let ec=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),ed=document.createElement("div");ed.className="maplibregl-desktop-message",ed.textContent=es,this._container.appendChild(ed);let ep=document.createElement("div");ep.className="maplibregl-mobile-message",ep.textContent=ec,this._container.appendChild(ep),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(n.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(en){return en[this._bypassKey]}notifyGestureBlocked(en,ec){this._enabled&&(this._map.fire(new es.l("cooperativegestureprevented",{gestureType:en,originalEvent:ec})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}};let Ia=en=>en.zoom||en.drag||en.roll||en.pitch||en.rotate;let Ma=class Ma extends es.l{};function Sa(en){return en.panDelta&&en.panDelta.mag()||en.zoomDelta||en.bearingDelta||en.pitchDelta||en.rollDelta}let Ea=class Ea{constructor(en,ec){this.handleWindowEvent=en=>{this.handleEvent(en,`${en.type}Window`)},this.handleEvent=(en,ec)=>{if("blur"===en.type)return void this.stop(!0);this._updatingCamera=!0;let ed="renderFrame"===en.type?void 0:en,ep={needsRenderFrame:!1},ef={},em={};for(let{handlerName:e_,handler:eg,allowed:ey}of this._handlers){let ex;if(eg.isEnabled()){if(this._blockedByActive(em,ey,e_))eg.reset();else if(eg[ec||en.type]){if(es.cp(en,ec||en.type)){let es=n.mousePos(this._map.getCanvas(),en);ex=eg[ec||en.type](en,es)}else if(es.cq(en,ec||en.type)){let es=this._getMapTouches(en.touches),ed=n.touchPos(this._map.getCanvas(),es);ex=eg[ec||en.type](en,ed,es)}else es.cr(ec||en.type)||(ex=eg[ec||en.type](en));this.mergeHandlerResult(ep,ef,ex,e_,ed),ex&&ex.needsRenderFrame&&this._triggerRenderFrame()}(ex||eg.isActive())&&(em[e_]=eg)}}let e_={};for(let en in this._previousActiveHandlers)em[en]||(e_[en]=ed);this._previousActiveHandlers=em,(Object.keys(e_).length||Sa(ep))&&(this._changes.push([ep,ef,e_]),this._triggerRenderFrame()),(Object.keys(em).length||Sa(ep))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:eg}=ep;eg&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],eg(this._map))},this._map=en,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fr(en),this._bearingSnap=ec.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(ec);let ed=this._el;for(let[en,es,ec]of(this._listeners=[[ed,"touchstart",{passive:!0}],[ed,"touchmove",{passive:!1}],[ed,"touchend",void 0],[ed,"touchcancel",void 0],[ed,"mousedown",void 0],[ed,"mousemove",void 0],[ed,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[ed,"mouseover",void 0],[ed,"mouseout",void 0],[ed,"dblclick",void 0],[ed,"click",void 0],[ed,"keydown",{capture:!1}],[ed,"keyup",void 0],[ed,"wheel",{passive:!1}],[ed,"contextmenu",void 0],[window,"blur",void 0]],this._listeners))n.addEventListener(en,es,en===document?this.handleWindowEvent:this.handleEvent,ec)}destroy(){for(let[en,es,ec]of this._listeners)n.removeEventListener(en,es,en===document?this.handleWindowEvent:this.handleEvent,ec)}_addDefaultHandlers(en){let ec=this._map,ed=ec.getCanvasContainer();this._add("mapEvent",new Zr(ec,en));let ep=ec.boxZoom=new $r(ec,en);this._add("boxZoom",ep),en.interactive&&en.boxZoom&&ep.enable();let ef=ec.cooperativeGestures=new Ca(ec,en.cooperativeGestures);this._add("cooperativeGestures",ef),en.cooperativeGestures&&ef.enable();let em=new Xr(ec),e_=new xa(ec);ec.doubleClickZoom=new ba(e_,em),this._add("tapZoom",em),this._add("clickZoom",e_),en.interactive&&en.doubleClickZoom&&ec.doubleClickZoom.enable();let eg=new ya;this._add("tapDragZoom",eg);let ey=ec.touchPitch=new da(ec);this._add("touchPitch",ey),en.interactive&&en.touchPitch&&ec.touchPitch.enable(en.touchPitch);let u=()=>ec.project(ec.getCenter()),ex=function({enable:en,clickTolerance:ec,aroundCenter:ed=!0,minPixelCenterThreshold:ep=100,rotateDegreesPerPixelMoved:ef=.8},em){let e_=new ea({checkCorrectEvent:en=>0===n.mouseButton(en)&&en.ctrlKey||2===n.mouseButton(en)&&!en.ctrlKey});return new Kr({clickTolerance:ec,move:(en,ec)=>{let e_=em();if(ed&&Math.abs(e_.y-en.y)>ep)return{bearingDelta:es.cn(new es.P(en.x,ec.y),ec,e_)};let eg=(ec.x-en.x)*ef;return ed&&ec.y<e_.y&&(eg=-eg),{bearingDelta:eg}},moveStateManager:e_,enable:en,assignEvents:oa})}(en,u),ev=function({enable:en,clickTolerance:es,pitchDegreesPerPixelMoved:ec=-.5}){let ed=new ea({checkCorrectEvent:en=>0===n.mouseButton(en)&&en.ctrlKey||2===n.mouseButton(en)});return new Kr({clickTolerance:es,move:(en,es)=>({pitchDelta:(es.y-en.y)*ec}),moveStateManager:ed,enable:en,assignEvents:oa})}(en),eb=function({enable:en,clickTolerance:es,rollDegreesPerPixelMoved:ec=.3},ed){let ep=new ea({checkCorrectEvent:en=>2===n.mouseButton(en)&&en.ctrlKey});return new Kr({clickTolerance:es,move:(en,es)=>{let ep=ed(),ef=(es.x-en.x)*ec;return es.y<ep.y&&(ef=-ef),{rollDelta:ef}},moveStateManager:ep,enable:en,assignEvents:oa})}(en,u);ec.dragRotate=new Ta(en,ex,ev,eb),this._add("mouseRotate",ex,["mousePitch"]),this._add("mousePitch",ev,["mouseRotate","mouseRoll"]),this._add("mouseRoll",eb,["mousePitch"]),en.interactive&&en.dragRotate&&ec.dragRotate.enable();let ew=function({enable:en,clickTolerance:es}){let ec=new ea({checkCorrectEvent:en=>0===n.mouseButton(en)&&!en.ctrlKey});return new Kr({clickTolerance:es,move:(en,es)=>({around:es,panDelta:es.sub(en)}),activateOnStart:!0,moveStateManager:ec,enable:en,assignEvents:oa})}(en),eT=new ra(en,ec);ec.dragPan=new wa(ed,ew,eT),this._add("mousePan",ew),this._add("touchPan",eT,["touchZoom","touchRotate"]),en.interactive&&en.dragPan&&ec.dragPan.enable(en.dragPan);let eP=new ha,eS=new la;ec.touchZoomRotate=new Pa(ed,eS,eP,eg),this._add("touchRotate",eP,["touchPan","touchZoom"]),this._add("touchZoom",eS,["touchPan","touchRotate"]),en.interactive&&en.touchZoomRotate&&ec.touchZoomRotate.enable(en.touchZoomRotate);let eM=ec.scrollZoom=new va(ec,()=>this._triggerRenderFrame());this._add("scrollZoom",eM,["mousePan"]),en.interactive&&en.scrollZoom&&ec.scrollZoom.enable(en.scrollZoom);let eC=ec.keyboard=new pa(ec);this._add("keyboard",eC),en.interactive&&en.keyboard&&ec.keyboard.enable(),this._add("blockableMapEvent",new Gr(ec))}_add(en,es,ec){this._handlers.push({handlerName:en,handler:es,allowed:ec}),this._handlersById[en]=es}stop(en){if(!this._updatingCamera){for(let{handler:en}of this._handlers)en.reset();this._inertia.clear(),this._fireEvents({},{},en),this._changes=[]}}isActive(){for(let{handler:en}of this._handlers)if(en.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ia(this._eventsInProgress)||this.isZooming()}_blockedByActive(en,es,ec){for(let ed in en)if(ed!==ec&&(!es||0>es.indexOf(ed)))return!0;return!1}_getMapTouches(en){let es=[];for(let ec of en)this._el.contains(ec.target)&&es.push(ec);return es}mergeHandlerResult(en,ec,ed,ep,ef){if(!ed)return;es.e(en,ed);let em={handlerName:ep,originalEvent:ed.originalEvent||ef};void 0!==ed.zoomDelta&&(ec.zoom=em),void 0!==ed.panDelta&&(ec.drag=em),void 0!==ed.rollDelta&&(ec.roll=em),void 0!==ed.pitchDelta&&(ec.pitch=em),void 0!==ed.bearingDelta&&(ec.rotate=em)}_applyChanges(){let en={},ec={},ed={};for(let[ep,ef,em]of this._changes)ep.panDelta&&(en.panDelta=(en.panDelta||new es.P(0,0))._add(ep.panDelta)),ep.zoomDelta&&(en.zoomDelta=(en.zoomDelta||0)+ep.zoomDelta),ep.bearingDelta&&(en.bearingDelta=(en.bearingDelta||0)+ep.bearingDelta),ep.pitchDelta&&(en.pitchDelta=(en.pitchDelta||0)+ep.pitchDelta),ep.rollDelta&&(en.rollDelta=(en.rollDelta||0)+ep.rollDelta),void 0!==ep.around&&(en.around=ep.around),void 0!==ep.pinchAround&&(en.pinchAround=ep.pinchAround),ep.noInertia&&(en.noInertia=ep.noInertia),es.e(ec,ef),es.e(ed,em);this._updateMapTransform(en,ec,ed),this._changes=[]}_updateMapTransform(en,es,ec){let ed=this._map,ep=ed._getTransformForUpdate(),ef=ed.terrain;if(!(Sa(en)||ef&&this._terrainMovement))return this._fireEvents(es,ec,!0);ed._stop(!0);let{panDelta:em,zoomDelta:e_,bearingDelta:eg,pitchDelta:ey,rollDelta:ex,around:ev,pinchAround:eb}=en;void 0!==eb&&(ev=eb),ev=ev||ed.transform.centerPoint,ef&&!ep.isPointOnMapSurface(ev)&&(ev=ep.centerPoint);let ew={panDelta:em,zoomDelta:e_,rollDelta:ex,pitchDelta:ey,bearingDelta:eg,around:ev};this._map.cameraHelper.useGlobeControls&&!ep.isPointOnMapSurface(ev)&&(ev=ep.centerPoint);let eT=.01>ev.distSqr(ep.centerPoint)?ep.center:ep.screenPointToLocation(em?ev.sub(em):ev);this._handleMapControls({terrain:ef,tr:ep,deltasForHelper:ew,preZoomAroundLoc:eT,combinedEventsInProgress:es,panDelta:em}),ed._applyUpdatedTransform(ep),this._map._update(),en.noInertia||this._inertia.record(en),this._fireEvents(es,ec,!0)}_handleMapControls({terrain:en,tr:es,deltasForHelper:ec,preZoomAroundLoc:ed,combinedEventsInProgress:ep,panDelta:ef}){let em=this._map.cameraHelper;if(em.handleMapControlsRollPitchBearingZoom(ec,es),en)return em.useGlobeControls?(!this._terrainMovement&&(ep.drag||ep.zoom)&&(this._terrainMovement=!0,this._map._elevationFreeze=!0),void em.handleMapControlsPan(ec,es,ed)):!this._terrainMovement&&(ep.drag||ep.zoom)?(this._terrainMovement=!0,this._map._elevationFreeze=!0,void em.handleMapControlsPan(ec,es,ed)):void(ep.drag&&this._terrainMovement&&ef?es.setCenter(es.screenPointToLocation(es.centerPoint.sub(ef))):em.handleMapControlsPan(ec,es,ed));em.handleMapControlsPan(ec,es,ed)}_fireEvents(en,ec,ed){let ep;let ef=Ia(this._eventsInProgress),em=Ia(en),e_={};for(let es in en){let{originalEvent:ec}=en[es];this._eventsInProgress[es]||(e_[`${es}start`]=ec),this._eventsInProgress[es]=en[es]}for(let en in!ef&&em&&this._fireEvent("movestart",em.originalEvent),e_)this._fireEvent(en,e_[en]);for(let es in em&&this._fireEvent("move",em.originalEvent),en){let{originalEvent:ec}=en[es];this._fireEvent(es,ec)}let eg={};for(let en in this._eventsInProgress){let{handlerName:es,originalEvent:ed}=this._eventsInProgress[en];this._handlersById[es].isActive()||(delete this._eventsInProgress[en],ep=ec[es]||ed,eg[`${en}end`]=ep)}for(let en in eg)this._fireEvent(en,eg[en]);let ey=Ia(this._eventsInProgress),ex=(ef||em)&&!ey;if(ex&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let en=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&en.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(en)}if(ed&&ex){var eb,ew;this._updatingCamera=!0;let en=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions);en&&(en.essential||!ev.prefersReducedMotion)?(0!==(eb=en.bearing||this._map.getBearing())&&-this._bearingSnap<eb&&eb<this._bearingSnap&&(en.bearing=0),en.freezeElevation=!0,this._map.easeTo(en,{originalEvent:ep})):(this._map.fire(new es.l("moveend",{originalEvent:ep})),0!==(ew=this._map.getBearing())&&-this._bearingSnap<ew&&ew<this._bearingSnap&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(en,ec){this._map.fire(new es.l(en,ec?{originalEvent:ec}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(en=>{delete this._frameId,this.handleEvent(new Ma("renderFrame",{timeStamp:en})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}};let Ra=class Ra extends es.E{constructor(en,es,ec){super(),this._renderFrameCallback=()=>{let en=Math.min((ev.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(en)),en<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=en,this._bearingSnap=ec.bearingSnap,this.cameraHelper=es,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(en,es){en.apply(this.transform),this.transform=en,this.cameraHelper=es}getCenter(){return new es.S(this.transform.center.lng,this.transform.center.lat)}setCenter(en,es){return this.jumpTo({center:en},es)}getCenterElevation(){return this.transform.elevation}setCenterElevation(en,es){return this.jumpTo({elevation:en},es),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(en){this._centerClampedToGround=en}panBy(en,ec,ed){return en=es.P.convert(en).mult(-1),this.panTo(this.transform.center,es.e({offset:en},ec),ed)}panTo(en,ec,ed){return this.easeTo(es.e({center:en},ec),ed)}getZoom(){return this.transform.zoom}setZoom(en,es){return this.jumpTo({zoom:en},es),this}zoomTo(en,ec,ed){return this.easeTo(es.e({zoom:en},ec),ed)}zoomIn(en,es){return this.zoomTo(this.getZoom()+1,en,es),this}zoomOut(en,es){return this.zoomTo(this.getZoom()-1,en,es),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(en,ec){return en!=this.transform.fov&&(this.transform.setFov(en),this.fire(new es.l("movestart",ec)).fire(new es.l("move",ec)).fire(new es.l("moveend",ec))),this}getBearing(){return this.transform.bearing}setBearing(en,es){return this.jumpTo({bearing:en},es),this}getPadding(){return this.transform.padding}setPadding(en,es){return this.jumpTo({padding:en},es),this}rotateTo(en,ec,ed){return this.easeTo(es.e({bearing:en},ec),ed)}resetNorth(en,ec){return this.rotateTo(0,es.e({duration:1e3},en),ec),this}resetNorthPitch(en,ec){return this.easeTo(es.e({bearing:0,pitch:0,roll:0,duration:1e3},en),ec),this}snapToNorth(en,es){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(en,es):this}getPitch(){return this.transform.pitch}setPitch(en,es){return this.jumpTo({pitch:en},es),this}getRoll(){return this.transform.roll}setRoll(en,es){return this.jumpTo({roll:en},es),this}cameraForBounds(en,es){en=G.convert(en).adjustAntiMeridian();let ec=es&&es.bearing||0;return this._cameraForBoxAndBearing(en.getNorthWest(),en.getSouthEast(),ec,es)}_cameraForBoxAndBearing(en,ec,ed,ep){let ef={top:0,bottom:0,right:0,left:0};if("number"==typeof(ep=es.e({padding:ef,offset:[0,0],maxZoom:this.transform.maxZoom},ep)).padding){let en=ep.padding;ep.padding={top:en,bottom:en,right:en,left:en}}let em=es.e(ef,ep.padding);ep.padding=em;let e_=this.transform,eg=new G(en,ec);return this.cameraHelper.cameraForBoxAndBearing(ep,em,eg,ed,e_)}fitBounds(en,es,ec){return this._fitInternal(this.cameraForBounds(en,es),es,ec)}fitScreenCoordinates(en,ec,ed,ep,ef){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(es.P.convert(en)),this.transform.screenPointToLocation(es.P.convert(ec)),ed,ep),ep,ef)}_fitInternal(en,ec,ed){return en?(delete(ec=es.e(en,ec)).padding,ec.linear?this.easeTo(ec,ed):this.flyTo(ec,ed)):this}jumpTo(en,ec){this.stop();let ed=this._getTransformForUpdate(),ep=!1,ef=!1,em=!1,e_=ed.zoom;this.cameraHelper.handleJumpToCenterZoom(ed,en);let eg=ed.zoom!==e_;return"elevation"in en&&ed.elevation!==+en.elevation&&ed.setElevation(+en.elevation),"bearing"in en&&ed.bearing!==+en.bearing&&(ep=!0,ed.setBearing(+en.bearing)),"pitch"in en&&ed.pitch!==+en.pitch&&(ef=!0,ed.setPitch(+en.pitch)),"roll"in en&&ed.roll!==+en.roll&&(em=!0,ed.setRoll(+en.roll)),null==en.padding||ed.isPaddingEqual(en.padding)||ed.setPadding(en.padding),this._applyUpdatedTransform(ed),this.fire(new es.l("movestart",ec)).fire(new es.l("move",ec)),eg&&this.fire(new es.l("zoomstart",ec)).fire(new es.l("zoom",ec)).fire(new es.l("zoomend",ec)),ep&&this.fire(new es.l("rotatestart",ec)).fire(new es.l("rotate",ec)).fire(new es.l("rotateend",ec)),ef&&this.fire(new es.l("pitchstart",ec)).fire(new es.l("pitch",ec)).fire(new es.l("pitchend",ec)),em&&this.fire(new es.l("rollstart",ec)).fire(new es.l("roll",ec)).fire(new es.l("rollend",ec)),this.fire(new es.l("moveend",ec))}calculateCameraOptionsFromTo(en,ec,ed,ep=0){let ef=es.a1.fromLngLat(en,ec),em=es.a1.fromLngLat(ed,ep),e_=em.x-ef.x,eg=em.y-ef.y,ey=em.z-ef.z,ex=Math.hypot(e_,eg,ey);if(0===ex)throw Error("Can't calculate camera options with same From and To");let ev=Math.hypot(e_,eg),eb=es.ak(this.transform.cameraToCenterDistance/ex/this.transform.tileSize),ew=180*Math.atan2(e_,-eg)/Math.PI,eT=180*Math.acos(ev/ex)/Math.PI;return eT=ey<0?90-eT:90+eT,{center:em.toLngLat(),elevation:ep,zoom:eb,pitch:eT,bearing:ew}}calculateCameraOptionsFromCameraLngLatAltRotation(en,es,ec,ed,ep){let ef=this.transform.calculateCenterFromCameraLngLatAlt(en,es,ec,ed);return{center:ef.center,elevation:ef.elevation,zoom:ef.zoom,bearing:ec,pitch:ed,roll:ep}}easeTo(en,ec){let ed,ep;this._stop(!1,en.easeId),(!1===(en=es.e({offset:[0,0],duration:500,easing:es.co},en)).animate||!en.essential&&ev.prefersReducedMotion)&&(en.duration=0);let ef=this._getTransformForUpdate(),em=this.getBearing(),e_=ef.pitch,eg=ef.roll,ey="bearing"in en?this._normalizeBearing(en.bearing,em):em,ex="pitch"in en?+en.pitch:e_,eb="roll"in en?this._normalizeBearing(en.roll,eg):eg,ew="padding"in en?en.padding:ef.padding,eT=es.P.convert(en.offset);en.around&&(ed=es.S.convert(en.around),ep=ef.locationToScreenPoint(ed));let eP={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},eS=this.cameraHelper.handleEaseTo(ef,{bearing:ey,pitch:ex,roll:eb,padding:ew,around:ed,aroundPoint:ep,offsetAsPoint:eT,offset:en.offset,zoom:en.zoom,center:en.center});return this._rotating=this._rotating||em!==ey,this._pitching=this._pitching||ex!==e_,this._rolling=this._rolling||eb!==eg,this._padding=!ef.isPaddingEqual(ew),this._zooming=this._zooming||eS.isZooming,this._easeId=en.easeId,this._prepareEase(ec,en.noMoveStart,eP),this.terrain&&this._prepareElevation(eS.elevationCenter),this._ease(es=>{eS.easeFunc(es),this.terrain&&!en.freezeElevation&&this._updateElevation(es),this._applyUpdatedTransform(ef),this._fireMoveEvents(ec)},es=>{this.terrain&&en.freezeElevation&&this._finalizeElevation(),this._afterEase(ec,es)},en),this}_prepareEase(en,ec,ed={}){this._moving=!0,ec||ed.moving||this.fire(new es.l("movestart",en)),this._zooming&&!ed.zooming&&this.fire(new es.l("zoomstart",en)),this._rotating&&!ed.rotating&&this.fire(new es.l("rotatestart",en)),this._pitching&&!ed.pitching&&this.fire(new es.l("pitchstart",en)),this._rolling&&!ed.rolling&&this.fire(new es.l("rollstart",en))}_prepareElevation(en){this._elevationCenter=en,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(en,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(en){void 0!==this._elevationStart&&void 0!==this._elevationCenter||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let ec=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(en<1&&ec!==this._elevationTarget){let es=this._elevationTarget-this._elevationStart;this._elevationStart+=en*(es-(ec-(es*en+this._elevationStart))/(1-en)),this._elevationTarget=ec}this.transform.setElevation(es.C.number(this._elevationStart,this._elevationTarget,en))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(en){if(!this.terrain&&en.elevation>=0&&en.pitch<=90)return{};let es=en.getCameraLngLat(),ec=en.getCameraAltitude(),ed=this.terrain?this.terrain.getElevationForLngLatZoom(es,en.zoom):0;if(ec<ed){let ec=this.calculateCameraOptionsFromTo(es,ed,en.center,en.elevation);return{pitch:ec.pitch,zoom:ec.zoom}}return{}}_applyUpdatedTransform(en){let es=[];if(es.push(en=>this._elevateCameraIfInsideTerrain(en)),this.transformCameraUpdate&&es.push(en=>this.transformCameraUpdate(en)),!es.length)return;let ec=en.clone();for(let en of es){let es=ec.clone(),{center:ed,zoom:ep,roll:ef,pitch:em,bearing:e_,elevation:eg}=en(es);ed&&es.setCenter(ed),void 0!==eg&&es.setElevation(eg),void 0!==ep&&es.setZoom(ep),void 0!==ef&&es.setRoll(ef),void 0!==em&&es.setPitch(em),void 0!==e_&&es.setBearing(e_),ec.apply(es)}this.transform.apply(ec)}_fireMoveEvents(en){this.fire(new es.l("move",en)),this._zooming&&this.fire(new es.l("zoom",en)),this._rotating&&this.fire(new es.l("rotate",en)),this._pitching&&this.fire(new es.l("pitch",en)),this._rolling&&this.fire(new es.l("roll",en))}_afterEase(en,ec){if(this._easeId&&ec&&this._easeId===ec)return;delete this._easeId;let ed=this._zooming,ep=this._rotating,ef=this._pitching,em=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,ed&&this.fire(new es.l("zoomend",en)),ep&&this.fire(new es.l("rotateend",en)),ef&&this.fire(new es.l("pitchend",en)),em&&this.fire(new es.l("rollend",en)),this.fire(new es.l("moveend",en))}flyTo(en,ec){if(!en.essential&&ev.prefersReducedMotion){let ed=es.Q(en,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ed,ec)}this.stop(),en=es.e({offset:[0,0],speed:1.2,curve:1.42,easing:es.co},en);let ed=this._getTransformForUpdate(),ep=ed.bearing,ef=ed.pitch,em=ed.roll,e_=ed.padding,eg="bearing"in en?this._normalizeBearing(en.bearing,ep):ep,ey="pitch"in en?+en.pitch:ef,ex="roll"in en?this._normalizeBearing(en.roll,em):em,eb="padding"in en?en.padding:ed.padding,ew=es.P.convert(en.offset),eT=ed.centerPoint.add(ew),eP=ed.screenPointToLocation(eT),eS=this.cameraHelper.handleFlyTo(ed,{bearing:eg,pitch:ey,roll:ex,padding:eb,locationAtOffset:eP,offsetAsPoint:ew,center:en.center,minZoom:en.minZoom,zoom:en.zoom}),eM=en.curve,eC=Math.max(ed.width,ed.height),eI=eC/eS.scaleOfZoom,eE=eS.pixelPathLength;"number"==typeof eS.scaleOfMinZoom&&(eM=Math.sqrt(eC/eS.scaleOfMinZoom/eE*2));let eA=eM*eM;function w(en){let es=(eI*eI-eC*eC+(en?-1:1)*eA*eA*eE*eE)/(2*(en?eI:eC)*eA*eE);return Math.log(Math.sqrt(es*es+1)-es)}function T(en){return(Math.exp(en)-Math.exp(-en))/2}function P(en){return(Math.exp(en)+Math.exp(-en))/2}let ez=w(!1),I=function(en){return P(ez)/P(ez+eM*en)},M=function(en){var es;return eC*((P(ez)*(T(es=ez+eM*en)/P(es))-T(ez))/eA)/eE},ek=(w(!0)-ez)/eM;if(2e-6>Math.abs(eE)||!isFinite(ek)){if(1e-6>Math.abs(eC-eI))return this.easeTo(en,ec);let es=eI<eC?-1:1;ek=Math.abs(Math.log(eI/eC))/eM,M=()=>0,I=en=>Math.exp(es*eM*en)}return en.duration="duration"in en?+en.duration:1e3*ek/("screenSpeed"in en?+en.screenSpeed/eM:+en.speed),en.maxDuration&&en.duration>en.maxDuration&&(en.duration=0),this._zooming=!0,this._rotating=ep!==eg,this._pitching=ey!==ef,this._rolling=ex!==em,this._padding=!ed.isPaddingEqual(eb),this._prepareEase(ec,!1),this.terrain&&this._prepareElevation(eS.targetCenter),this._ease(ev=>{let eP=ev*ek,eM=1/I(eP),eC=M(eP);this._rotating&&ed.setBearing(es.C.number(ep,eg,ev)),this._pitching&&ed.setPitch(es.C.number(ef,ey,ev)),this._rolling&&ed.setRoll(es.C.number(em,ex,ev)),this._padding&&(ed.interpolatePadding(e_,eb,ev),eT=ed.centerPoint.add(ew)),eS.easeFunc(ev,eM,eC,eT),this.terrain&&!en.freezeElevation&&this._updateElevation(ev),this._applyUpdatedTransform(ed),this._fireMoveEvents(ec)},()=>{this.terrain&&en.freezeElevation&&this._finalizeElevation(),this._afterEase(ec)},en),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(en,es){var ec;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let en=this._onEaseEnd;delete this._onEaseEnd,en.call(this,es)}return en||null===(ec=this.handlers)||void 0===ec||ec.stop(!1),this}_ease(en,es,ec){!1===ec.animate||0===ec.duration?(en(1),es()):(this._easeStart=ev.now(),this._easeOptions=ec,this._onEaseFrame=en,this._onEaseEnd=es,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(en,ec){en=es.aO(en,-180,180);let ed=Math.abs(en-ec);return Math.abs(en-360-ec)<ed&&(en-=360),Math.abs(en+360-ec)<ed&&(en+=360),en}queryTerrainElevation(en){return this.terrain?this.terrain.getElevationForLngLatZoom(es.S.convert(en),this.transform.tileZoom):null}};let tf={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};let Da=class Da{constructor(en=tf){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=en=>{en&&("metadata"===en.sourceDataType||"visibility"===en.sourceDataType||"style"===en.dataType||"terrain"===en.type)&&this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=en}getDefaultPosition(){return"bottom-right"}onAdd(en){return this._map=en,this._compact=this.options.compact,this._container=n.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=n.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(en,es){let ec=this._map._getUIString(`AttributionControl.${es}`);en.title=ec,en.setAttribute("aria-label",ec)}_updateAttributions(){if(!this._map.style)return;let en=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?en=en.concat(this.options.customAttribution.map(en=>"string"!=typeof en?"":en)):"string"==typeof this.options.customAttribution&&en.push(this.options.customAttribution)),this._map.style.stylesheet){let en=this._map.style.stylesheet;this.styleOwner=en.owner,this.styleId=en.id}let es=this._map.style.sourceCaches;for(let ec in es){let ed=es[ec];if(ed.used||ed.usedForTerrain){let es=ed.getSource();es.attribution&&0>en.indexOf(es.attribution)&&en.push(es.attribution)}}(en=en.filter(en=>String(en).trim())).sort((en,es)=>en.length-es.length),en=en.filter((es,ec)=>{for(let ed=ec+1;ed<en.length;ed++)if(en[ed].indexOf(es)>=0)return!1;return!0});let ec=en.join(" | ");ec!==this._attribHTML&&(this._attribHTML=ec,en.length?(this._innerContainer.innerHTML=n.sanitize(ec),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}};let Aa=class Aa{constructor(en={}){this._updateCompact=()=>{let en=this._container.children;if(en.length){let es=en[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&es.classList.add("maplibregl-compact"):es.classList.remove("maplibregl-compact")}},this.options=en}getDefaultPosition(){return"bottom-left"}onAdd(en){this._map=en,this._compact=this.options&&this.options.compact,this._container=n.create("div","maplibregl-ctrl");let es=n.create("a","maplibregl-ctrl-logo");return es.target="_blank",es.rel="noopener nofollow",es.href="https://maplibre.org/",es.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),es.setAttribute("rel","noopener nofollow"),this._container.appendChild(es),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){n.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}};let La=class La{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(en){let es=++this._id;return this._queue.push({callback:en,id:es,cancelled:!1}),es}remove(en){let es=this._currentlyRunning,ec=es?this._queue.concat(es):this._queue;for(let es of ec)if(es.id===en)return void(es.cancelled=!0)}run(en=0){if(this._currentlyRunning)throw Error("Attempting to run(), but is already running.");let es=this._currentlyRunning=this._queue;for(let ec of(this._queue=[],es))if(!ec.cancelled&&(ec.callback(en),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}};var tm=es.aJ([{name:"a_pos3d",type:"Int16",components:3}]);let Fa=class Fa extends es.E{constructor(en){super(),this._lastTilesetChange=ev.now(),this.sourceCache=en,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=en._source.tileSize*2**this.deltaZoom,en.usedForTerrain=!0,en.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(en,ec){this.sourceCache.update(en,ec),this._renderableTilesKeys=[];let ed={};for(let ep of ve(en,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:ec,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))ed[ep.key]=!0,this._renderableTilesKeys.push(ep.key),this._tiles[ep.key]||(ep.terrainRttPosMatrix32f=new Float64Array(16),es.bY(ep.terrainRttPosMatrix32f,0,es.$,es.$,0,0,1),this._tiles[ep.key]=new re(ep,this.tileSize),this._lastTilesetChange=ev.now());for(let en in this._tiles)ed[en]||delete this._tiles[en]}freeRtt(en){for(let es in this._tiles){let ec=this._tiles[es];(!en||ec.tileID.equals(en)||ec.tileID.isChildOf(en)||en.isChildOf(ec.tileID))&&(ec.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(en=>this.getTileByID(en))}getTileByID(en){return this._tiles[en]}getTerrainCoords(en,es){return es?this._getTerrainCoordsForTileRanges(en,es):this._getTerrainCoordsForRegularTile(en)}_getTerrainCoordsForRegularTile(en){let ec={};for(let ed of this._renderableTilesKeys){let ep=this._tiles[ed].tileID,ef=en.clone(),em=es.ba();if(ep.canonical.equals(en.canonical))es.bY(em,0,es.$,es.$,0,0,1);else if(ep.canonical.isChildOf(en.canonical)){let ec=ep.canonical.z-en.canonical.z,ed=ep.canonical.x-(ep.canonical.x>>ec<<ec),ef=ep.canonical.y-(ep.canonical.y>>ec<<ec),e_=es.$>>ec;es.bY(em,0,e_,e_,0,0,1),es.M(em,em,[-ed*e_,-ef*e_,0])}else{if(!en.canonical.isChildOf(ep.canonical))continue;{let ec=en.canonical.z-ep.canonical.z,ed=en.canonical.x-(en.canonical.x>>ec<<ec),ef=en.canonical.y-(en.canonical.y>>ec<<ec),e_=es.$>>ec;es.bY(em,0,es.$,es.$,0,0,1),es.M(em,em,[ed*e_,ef*e_,0]),es.N(em,em,[1/2**ec,1/2**ec,0])}}ef.terrainRttPosMatrix32f=new Float32Array(em),ec[ed]=ef}return ec}_getTerrainCoordsForTileRanges(en,ec){let ed={};for(let ep of this._renderableTilesKeys){let ef=this._tiles[ep].tileID;if(!this._isWithinTileRanges(ef,ec))continue;let em=en.clone(),e_=es.ba();if(ef.canonical.z===en.canonical.z){let ec=en.canonical.x-ef.canonical.x,ed=en.canonical.y-ef.canonical.y;es.bY(e_,0,es.$,es.$,0,0,1),es.M(e_,e_,[ec*es.$,ed*es.$,0])}else if(ef.canonical.z>en.canonical.z){let ec=ef.canonical.z-en.canonical.z,ed=ef.canonical.x-(ef.canonical.x>>ec<<ec),ep=ef.canonical.y-(ef.canonical.y>>ec<<ec),em=en.canonical.x-(ef.canonical.x>>ec),eg=en.canonical.y-(ef.canonical.y>>ec),ey=es.$>>ec;es.bY(e_,0,ey,ey,0,0,1),es.M(e_,e_,[-ed*ey+em*es.$,-ep*ey+eg*es.$,0])}else{let ec=en.canonical.z-ef.canonical.z,ed=en.canonical.x-(en.canonical.x>>ec<<ec),ep=en.canonical.y-(en.canonical.y>>ec<<ec),em=(en.canonical.x>>ec)-ef.canonical.x,eg=(en.canonical.y>>ec)-ef.canonical.y,ey=es.$<<ec;es.bY(e_,0,ey,ey,0,0,1),es.M(e_,e_,[ed*es.$+em*ey,ep*es.$+eg*ey,0])}em.terrainRttPosMatrix32f=new Float32Array(e_),ed[ep]=em}return ed}getSourceTile(en,es){let ec=this.sourceCache._source,ed=en.overscaledZ-this.deltaZoom;if(ed>ec.maxzoom&&(ed=ec.maxzoom),ed<ec.minzoom)return null;this._sourceTileCache[en.key]||(this._sourceTileCache[en.key]=en.scaledTo(ed).key);let ep=this.sourceCache.getTileByID(this._sourceTileCache[en.key]);if((!ep||!ep.dem)&&es)for(;ed>=ec.minzoom&&(!ep||!ep.dem);)ep=this.sourceCache.getTileByID(en.scaledTo(ed--).key);return ep}anyTilesAfterTime(en=Date.now()){return this._lastTilesetChange>=en}_isWithinTileRanges(en,es){return es[en.canonical.z]&&en.canonical.x>=es[en.canonical.z].minTileX&&en.canonical.x<=es[en.canonical.z].maxTileX&&en.canonical.y>=es[en.canonical.z].minTileY&&en.canonical.y<=es[en.canonical.z].maxTileY}};let Ba=class Ba{constructor(en,es,ec){this._meshCache={},this.painter=en,this.sourceCache=new Fa(es),this.options=ec,this.exaggeration="number"==typeof ec.exaggeration?ec.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(en,ec,ed,ep=es.$){var ef;if(!(ec>=0&&ec<ep&&ed>=0&&ed<ep))return 0;let em=this.getTerrainData(en),e_=null===(ef=em.tile)||void 0===ef?void 0:ef.dem;if(!e_)return 0;let eg=es.cs([],[ec/ep*es.$,ed/ep*es.$],em.u_terrain_matrix),ey=[eg[0]*e_.dim,eg[1]*e_.dim],ex=Math.floor(ey[0]),ev=Math.floor(ey[1]),eb=ey[0]-ex,ew=ey[1]-ev;return e_.get(ex,ev)*(1-eb)*(1-ew)+e_.get(ex+1,ev)*eb*(1-ew)+e_.get(ex,ev+1)*(1-eb)*ew+e_.get(ex+1,ev+1)*eb*ew}getElevationForLngLatZoom(en,ec){if(!es.ct(ec,en.wrap()))return 0;let{tileID:ed,mercatorX:ep,mercatorY:ef}=this._getOverscaledTileIDFromLngLatZoom(en,ec);return this.getElevation(ed,ep%es.$,ef%es.$,es.$)}getElevation(en,ec,ed,ep=es.$){return this.getDEMElevation(en,ec,ed,ep)*this.exaggeration}getTerrainData(en){if(!this._emptyDemTexture){let en=this.painter.context,ec=new es.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new es.T(en,ec,en.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new es.T(en,new es.R({width:1,height:1}),en.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(en.gl.NEAREST,en.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=es.ag([])}let ec=this.sourceCache.getSourceTile(en,!0);if(ec&&ec.dem&&(!ec.demTexture||ec.needsTerrainPrepare)){let en=this.painter.context;ec.demTexture=this.painter.getTileTexture(ec.dem.stride),ec.demTexture?ec.demTexture.update(ec.dem.getPixels(),{premultiply:!1}):ec.demTexture=new es.T(en,ec.dem.getPixels(),en.gl.RGBA,{premultiply:!1}),ec.demTexture.bind(en.gl.NEAREST,en.gl.CLAMP_TO_EDGE),ec.needsTerrainPrepare=!1}let ed=ec&&ec+ec.tileID.key+en.key;if(ed&&!this._demMatrixCache[ed]){let ed=this.sourceCache.sourceCache._source.maxzoom,ep=en.canonical.z-ec.tileID.canonical.z;en.overscaledZ>en.canonical.z&&(en.canonical.z>=ed?ep=en.canonical.z-ed:es.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let ef=en.canonical.x-(en.canonical.x>>ep<<ep),em=en.canonical.y-(en.canonical.y>>ep<<ep),e_=es.cu(new Float64Array(16),[1/(es.$<<ep),1/(es.$<<ep),0]);es.M(e_,e_,[ef*es.$,em*es.$,0]),this._demMatrixCache[en.key]={matrix:e_,coord:en}}return{u_depth:2,u_terrain:3,u_terrain_dim:ec&&ec.dem&&ec.dem.dim||1,u_terrain_matrix:ed?this._demMatrixCache[en.key].matrix:this._emptyDemMatrix,u_terrain_unpack:ec&&ec.dem&&ec.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(ec&&ec.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:ec}}getFramebuffer(en){let ec=this.painter,ed=ec.width/devicePixelRatio,ep=ec.height/devicePixelRatio;return this._fbo&&(this._fbo.width!==ed||this._fbo.height!==ep)&&(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new es.T(ec.context,{width:ed,height:ep,data:null},ec.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(ec.context.gl.NEAREST,ec.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new es.T(ec.context,{width:ed,height:ep,data:null},ec.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(ec.context.gl.NEAREST,ec.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=ec.context.createFramebuffer(ed,ep,!0,!1),this._fbo.depthAttachment.set(ec.context.createRenderbuffer(ec.context.gl.DEPTH_COMPONENT16,ed,ep))),this._fbo.colorAttachment.set("coords"===en?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let en=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let ec=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let en=0,es=0;en<this._coordsTextureSize;en++)for(let ed=0;ed<this._coordsTextureSize;ed++,es+=4)ec[es+0]=255&ed,ec[es+1]=255&en,ec[es+2]=ed>>8<<4|en>>8,ec[es+3]=0;let ed=new es.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(ec.buffer)),ep=new es.T(en,ed,en.gl.RGBA,{premultiply:!1});return ep.bind(en.gl.NEAREST,en.gl.CLAMP_TO_EDGE),this._coordsTexture=ep,ep}pointCoordinate(en){this.painter.maybeDrawDepthAndCoords(!0);let ec=new Uint8Array(4),ed=this.painter.context,ep=ed.gl,ef=Math.round(en.x*this.painter.pixelRatio/devicePixelRatio),em=Math.round(en.y*this.painter.pixelRatio/devicePixelRatio),e_=Math.round(this.painter.height/devicePixelRatio);ed.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),ep.readPixels(ef,e_-em-1,1,1,ep.RGBA,ep.UNSIGNED_BYTE,ec),ed.bindFramebuffer.set(null);let eg=ec[0]+(ec[2]>>4<<8),ey=ec[1]+((15&ec[2])<<8),ex=this.coordsIndex[255-ec[3]],ev=ex&&this.sourceCache.getTileByID(ex);if(!ev)return null;let eb=this._coordsTextureSize,ew=(1<<ev.tileID.canonical.z)*eb;return new es.a1((ev.tileID.canonical.x*eb+eg)/ew+ev.tileID.wrap,(ev.tileID.canonical.y*eb+ey)/ew,this.getElevation(ev.tileID,eg,ey,eb))}depthAtPoint(en){let es=new Uint8Array(4),ec=this.painter.context,ed=ec.gl;return ec.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),ed.readPixels(en.x,this.painter.height/devicePixelRatio-en.y-1,1,1,ed.RGBA,ed.UNSIGNED_BYTE,es),ec.bindFramebuffer.set(null),(es[0]/16777216+es[1]/65536+es[2]/256+es[3])/256}getTerrainMesh(en){var ec;let ed=(null===(ec=this.painter.style.projection)||void 0===ec?void 0:ec.transitionState)>0,ep=ed&&0===en.canonical.y,ef=ed&&en.canonical.y===(1<<en.canonical.z)-1,em=`m_${ep?"n":""}_${ef?"s":""}`;if(this._meshCache[em])return this._meshCache[em];let e_=this.painter.context,eg=new es.cv,ey=new es.aN,ex=this.meshSize,ev=es.$/ex,eb=ex*ex;for(let en=0;en<=ex;en++)for(let es=0;es<=ex;es++)eg.emplaceBack(es*ev,en*ev,0);for(let en=0;en<eb;en+=ex+1)for(let es=0;es<ex;es++)ey.emplaceBack(es+en,ex+es+en+1,ex+es+en+2),ey.emplaceBack(es+en,ex+es+en+2,es+en+1);let ew=eg.length,eT=ew+(ex+1),eP=(ex+1)*ex,eS=ep?es.bh:0,eM=ep?0:1,eC=ef?es.bi:es.$,eI=ef?0:1;for(let en=0;en<=ex;en++)eg.emplaceBack(en*ev,eS,eM);for(let en=0;en<=ex;en++)eg.emplaceBack(en*ev,eC,eI);for(let en=0;en<ex;en++)ey.emplaceBack(eP+en,eT+en,eT+en+1),ey.emplaceBack(eP+en,eT+en+1,eP+en+1),ey.emplaceBack(0+en,ew+en+1,ew+en),ey.emplaceBack(0+en,0+en+1,ew+en+1);let eE=eg.length,eA=eE+2*(ex+1);for(let en of[0,1])for(let ec=0;ec<=ex;ec++)for(let ed of[0,1])eg.emplaceBack(en*es.$,ec*ev,ed);for(let en=0;en<2*ex;en+=2)ey.emplaceBack(eE+en,eE+en+1,eE+en+3),ey.emplaceBack(eE+en,eE+en+3,eE+en+2),ey.emplaceBack(eA+en,eA+en+3,eA+en+1),ey.emplaceBack(eA+en,eA+en+2,eA+en+3);let ez=new wt(e_.createVertexBuffer(eg,tm.members),e_.createIndexBuffer(ey),es.aM.simpleSegment(0,0,eg.length,ey.length));return this._meshCache[em]=ez,ez}getMeshFrameDelta(en){return 2*Math.PI*es.bu/Math.pow(2,Math.max(en,0))/5}getMinTileElevationForLngLatZoom(en,es){var ec;let{tileID:ed}=this._getOverscaledTileIDFromLngLatZoom(en,es);return null!==(ec=this.getMinMaxElevation(ed).minElevation)&&void 0!==ec?ec:0}getMinMaxElevation(en){let es=this.getTerrainData(en).tile,ec={minElevation:null,maxElevation:null};return es&&es.dem&&(ec.minElevation=es.dem.min*this.exaggeration,ec.maxElevation=es.dem.max*this.exaggeration),ec}_getOverscaledTileIDFromLngLatZoom(en,ec){let ed=es.a1.fromLngLat(en.wrap()),ep=(1<<ec)*es.$,ef=ed.x*ep,em=ed.y*ep,e_=Math.floor(ef/es.$),eg=Math.floor(em/es.$);return{tileID:new es.Z(ec,0,ec,e_,eg),mercatorX:ef,mercatorY:em}}};let Oa=class Oa{constructor(en,es,ec){this._context=en,this._size=es,this._tileSize=ec,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let en of this._objects)en.texture.destroy(),en.fbo.destroy()}_createObject(en){let ec=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),ed=new es.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return ed.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),ec.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),ec.colorAttachment.set(ed.texture),{id:en,fbo:ec,texture:ed,stamp:-1,inUse:!1}}getObjectForId(en){return this._objects[en]}useObject(en){en.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(es=>en.id!==es),this._recentlyUsed.push(en.id)}stampObject(en){en.stamp=++this._stamp}getOrCreateFreeObject(){for(let en of this._recentlyUsed)if(!this._objects[en].inUse)return this._objects[en];if(this._objects.length>=this._size)throw Error("No free RenderPool available, call freeAllObjects() required!");let en=this._createObject(this._objects.length);return this._objects.push(en),en}freeObject(en){en.inUse=!1}freeAllObjects(){for(let en of this._objects)this.freeObject(en)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(en=>!en.inUse)}};let t_={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};let Na=class Na{constructor(en,es){this.painter=en,this.terrain=es,this.pool=new Oa(en.context,30,es.sourceCache.tileSize*es.qualityFactor)}destruct(){this.pool.destruct()}getTexture(en){return this.pool.getObjectForId(en.rtt[this._stacks.length-1].id).texture}prepareForRender(en,es){for(let ec in this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=en._order.filter(ec=>!en._layers[ec].isHidden(es)),this._coordsAscending={},en.sourceCaches){this._coordsAscending[ec]={};let es=en.sourceCaches[ec].getVisibleCoordinates(),ed=en.sourceCaches[ec].getSource(),ep=ed instanceof X?ed.terrainTileRanges:null;for(let en of es){let es=this.terrain.sourceCache.getTerrainCoords(en,ep);for(let en in es)this._coordsAscending[ec][en]||(this._coordsAscending[ec][en]=[]),this._coordsAscending[ec][en].push(es[en])}}for(let es of(this._coordsAscendingStr={},en._order)){let ec=en._layers[es],ed=ec.source;if(t_[ec.type]&&!this._coordsAscendingStr[ed])for(let en in this._coordsAscendingStr[ed]={},this._coordsAscending[ed])this._coordsAscendingStr[ed][en]=this._coordsAscending[ed][en].map(en=>en.key).sort().join()}for(let en of this._renderableTiles)for(let es in this._coordsAscendingStr){let ec=this._coordsAscendingStr[es][en.tileID.key];ec&&ec!==en.rttCoords[es]&&(en.rtt=[])}}renderLayer(en,ec){if(en.isHidden(this.painter.transform.zoom))return!1;let ed=Object.assign(Object.assign({},ec),{isRenderingToTexture:!0}),ep=en.type,ef=this.painter,em=this._renderableLayerIds[this._renderableLayerIds.length-1]===en.id;if(t_[ep]&&(this._prevType&&t_[this._prevType]||this._stacks.push([]),this._prevType=ep,this._stacks[this._stacks.length-1].push(en.id),!em))return!0;if(t_[this._prevType]||t_[ep]&&em){this._prevType=ep;let en=this._stacks.length-1,ec=this._stacks[en]||[];for(let ep of this._renderableTiles){if(this.pool.isFull()&&(Cr(this.painter,this.terrain,this._rttTiles,ed),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ep),ep.rtt[en]){let es=this.pool.getObjectForId(ep.rtt[en].id);if(es.stamp===ep.rtt[en].stamp){this.pool.useObject(es);continue}}let em=this.pool.getOrCreateFreeObject();this.pool.useObject(em),this.pool.stampObject(em),ep.rtt[en]={id:em.id,stamp:em.stamp},ef.context.bindFramebuffer.set(em.fbo.framebuffer),ef.context.clear({color:es.bf.transparent,stencil:0}),ef.currentStencilSource=void 0;for(let en=0;en<ec.length;en++){let es=ef.style._layers[ec[en]],e_=es.source?this._coordsAscending[es.source][ep.tileID.key]:[ep.tileID];ef.context.viewport.set([0,0,em.fbo.width,em.fbo.height]),ef._renderTileClippingMasks(es,e_,!0),ef.renderLayer(ef,ef.style.sourceCaches[es.source],es,e_,ed),es.source&&(ep.rttCoords[es.source]=this._coordsAscendingStr[es.source][ep.tileID.key])}}return Cr(this.painter,this.terrain,this._rttTiles,ed),this._rttTiles=[],this.pool.freeAllObjects(),t_[ep]}return!1}};let tg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ty={hash:!1,interactive:!0,bearingSnap:7,attributionControl:tf,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:es.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},tx={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};let $a=class $a{constructor(en,ec,ed=!1){this.mousedown=en=>{this.startMove(en,n.mousePos(this.element,en)),n.addEventListener(window,"mousemove",this.mousemove),n.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=en=>{this.move(en,n.mousePos(this.element,en))},this.mouseup=en=>{this._rotatePitchHandler.dragEnd(en),this.offTemp()},this.touchstart=en=>{1!==en.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,en.targetTouches)[0],this.startMove(en,this._startPos),n.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),n.addEventListener(window,"touchend",this.touchend))},this.touchmove=en=>{1!==en.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,en.targetTouches)[0],this.move(en,this._lastPos))},this.touchend=en=>{0===en.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=ec;let ep=new ia;this._rotatePitchHandler=new Kr({clickTolerance:3,move:(en,ep)=>{let ef=ec.getBoundingClientRect(),em=new es.P((ef.bottom-ef.top)/2,(ef.right-ef.left)/2);return{bearingDelta:es.cn(new es.P(en.x,ep.y),ep,em),pitchDelta:ed?-.5*(ep.y-en.y):void 0}},moveStateManager:ep,enable:!0,assignEvents:()=>{}}),this.map=en,n.addEventListener(ec,"mousedown",this.mousedown),n.addEventListener(ec,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(ec,"touchcancel",this.reset)}startMove(en,es){this._rotatePitchHandler.dragStart(en,es),n.disableDrag()}move(en,es){let ec=this.map,{bearingDelta:ed,pitchDelta:ep}=this._rotatePitchHandler.dragMove(en,es)||{};ed&&ec.setBearing(ec.getBearing()+ed),ep&&ec.setPitch(ec.getPitch()+ep)}off(){let en=this.element;n.removeEventListener(en,"mousedown",this.mousedown),n.removeEventListener(en,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),n.removeEventListener(window,"touchend",this.touchend),n.removeEventListener(en,"touchcancel",this.reset),this.offTemp()}offTemp(){n.enableDrag(),n.removeEventListener(window,"mousemove",this.mousemove),n.removeEventListener(window,"mouseup",this.mouseup),n.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),n.removeEventListener(window,"touchend",this.touchend)}};function Wa(en,ec,ed,ep=!1){if(ep||!ed.getCoveringTilesDetailsProvider().allowWorldCopies())return null==en?void 0:en.wrap();let ef=new es.S(en.lng,en.lat);if(en=new es.S(en.lng,en.lat),ec){let ep=new es.S(en.lng-360,en.lat),ef=new es.S(en.lng+360,en.lat),em=ed.locationToScreenPoint(en).distSqr(ec);ed.locationToScreenPoint(ep).distSqr(ec)<em?en=ep:ed.locationToScreenPoint(ef).distSqr(ec)<em&&(en=ef)}for(;Math.abs(en.lng-ed.center.lng)>180;){let es=ed.locationToScreenPoint(en);if(es.x>=0&&es.y>=0&&es.x<=ed.width&&es.y<=ed.height)break;en.lng>ed.center.lng?en.lng-=360:en.lng+=360}return en.lng!==ef.lng&&ed.isPointOnMapSurface(ed.locationToScreenPoint(en))?en:ef}let tv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xa(en,es,ec){let ed=en.classList;for(let en in tv)ed.remove(`maplibregl-${ec}-anchor-${en}`);ed.add(`maplibregl-${ec}-anchor-${es}`)}let Ka=class Ka extends es.E{constructor(en){if(super(),this._onKeyPress=en=>{let es=en.code,ec=en.charCode||en.keyCode;"Space"!==es&&"Enter"!==es&&32!==ec&&13!==ec||this.togglePopup()},this._onMapClick=en=>{let es=en.originalEvent.target,ec=this._element;this._popup&&(es===ec||ec.contains(es))&&this.togglePopup()},this._update=en=>{if(!this._map)return;let es=this._map.loaded()&&!this._map.isMoving();"terrain"!==(null==en?void 0:en.type)&&("render"!==(null==en?void 0:en.type)||es)||this._map.once("render",this._update),this._lngLat=Wa(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let ec="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?ec=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(ec=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let ed="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?ed="rotateX(0deg)":"map"===this._pitchAlignment&&(ed=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||en&&"moveend"!==en.type||(this._pos=this._pos.round()),n.setTransform(this._element,`${tv[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${ed} ${ec}`),ev.frameAsync(new AbortController).then(()=>{this._updateOpacity(en&&"moveend"===en.type)}).catch(()=>{})},this._onMove=en=>{if(!this._isDragging){let es=this._clickTolerance||this._map._clickTolerance;this._isDragging=en.point.dist(this._pointerdownPos)>=es}this._isDragging&&(this._pos=en.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new es.l("dragstart"))),this.fire(new es.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new es.l("dragend")),this._state="inactive"},this._addDragHandler=en=>{this._element.contains(en.originalEvent.target)&&(en.preventDefault(),this._positionDelta=en.point.sub(this._pos).add(this._offset),this._pointerdownPos=en.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=en&&en.anchor||"center",this._color=en&&en.color||"#3FB1CE",this._scale=en&&en.scale||1,this._draggable=en&&en.draggable||!1,this._clickTolerance=en&&en.clickTolerance||0,this._subpixelPositioning=en&&en.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=en&&en.rotation||0,this._rotationAlignment=en&&en.rotationAlignment||"auto",this._pitchAlignment=en&&en.pitchAlignment&&"auto"!==en.pitchAlignment?en.pitchAlignment:this._rotationAlignment,this.setOpacity(null==en?void 0:en.opacity,null==en?void 0:en.opacityWhenCovered),en&&en.element)this._element=en.element,this._offset=es.P.convert(en&&en.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div");let ec=n.createNS("http://www.w3.org/2000/svg","svg");ec.setAttributeNS(null,"display","block"),ec.setAttributeNS(null,"height","41px"),ec.setAttributeNS(null,"width","27px"),ec.setAttributeNS(null,"viewBox","0 0 27 41");let ed=n.createNS("http://www.w3.org/2000/svg","g");ed.setAttributeNS(null,"stroke","none"),ed.setAttributeNS(null,"stroke-width","1"),ed.setAttributeNS(null,"fill","none"),ed.setAttributeNS(null,"fill-rule","evenodd");let ep=n.createNS("http://www.w3.org/2000/svg","g");ep.setAttributeNS(null,"fill-rule","nonzero");let ef=n.createNS("http://www.w3.org/2000/svg","g");for(let en of(ef.setAttributeNS(null,"transform","translate(3.0, 29.0)"),ef.setAttributeNS(null,"fill","#000000"),[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}])){let es=n.createNS("http://www.w3.org/2000/svg","ellipse");es.setAttributeNS(null,"opacity","0.04"),es.setAttributeNS(null,"cx","10.5"),es.setAttributeNS(null,"cy","5.80029008"),es.setAttributeNS(null,"rx",en.rx),es.setAttributeNS(null,"ry",en.ry),ef.appendChild(es)}let em=n.createNS("http://www.w3.org/2000/svg","g");em.setAttributeNS(null,"fill",this._color);let e_=n.createNS("http://www.w3.org/2000/svg","path");e_.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),em.appendChild(e_);let eg=n.createNS("http://www.w3.org/2000/svg","g");eg.setAttributeNS(null,"opacity","0.25"),eg.setAttributeNS(null,"fill","#000000");let ey=n.createNS("http://www.w3.org/2000/svg","path");ey.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),eg.appendChild(ey);let ex=n.createNS("http://www.w3.org/2000/svg","g");ex.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ex.setAttributeNS(null,"fill","#FFFFFF");let ev=n.createNS("http://www.w3.org/2000/svg","g");ev.setAttributeNS(null,"transform","translate(8.0, 8.0)");let eb=n.createNS("http://www.w3.org/2000/svg","circle");eb.setAttributeNS(null,"fill","#000000"),eb.setAttributeNS(null,"opacity","0.25"),eb.setAttributeNS(null,"cx","5.5"),eb.setAttributeNS(null,"cy","5.5"),eb.setAttributeNS(null,"r","5.4999962");let ew=n.createNS("http://www.w3.org/2000/svg","circle");ew.setAttributeNS(null,"fill","#FFFFFF"),ew.setAttributeNS(null,"cx","5.5"),ew.setAttributeNS(null,"cy","5.5"),ew.setAttributeNS(null,"r","5.4999962"),ev.appendChild(eb),ev.appendChild(ew),ep.appendChild(ef),ep.appendChild(em),ep.appendChild(eg),ep.appendChild(ex),ep.appendChild(ev),ec.appendChild(ep),ec.setAttributeNS(null,"height",41*this._scale+"px"),ec.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(ec),this._offset=es.P.convert(en&&en.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",en=>{en.preventDefault()}),this._element.addEventListener("mousedown",en=>{en.preventDefault()}),Xa(this._element,this._anchor,"marker"),en&&en.className)for(let es of en.className.split(" "))this._element.classList.add(es);this._popup=null}addTo(en){return this.remove(),this._map=en,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",en._getUIString("Marker.Title")),en.getCanvasContainer().appendChild(this._element),en.on("move",this._update),en.on("moveend",this._update),en.on("terrain",this._update),en.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(en){return this._lngLat=es.S.convert(en),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(en){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),en){if(!("offset"in en.options)){let es=Math.abs(13.5)/Math.SQRT2;en.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[es,-1*(24.6+es)],"bottom-right":[-es,-1*(24.6+es)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=en,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(en){return this._subpixelPositioning=en,this}getPopup(){return this._popup}togglePopup(){let en=this._popup;return this._element.style.opacity===this._opacityWhenCovered||en&&(en.isOpen()?en.remove():(en.setLngLat(this._lngLat),en.addTo(this._map))),this}_updateOpacity(en=!1){var ec,ed;let ep=null===(ec=this._map)||void 0===ec?void 0:ec.terrain,ef=this._map.transform.isLocationOccluded(this._lngLat);if(!ep||ef){let en=ef?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==en&&(this._element.style.opacity=en))}if(en)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let em=this._map,e_=em.terrain.depthAtPoint(this._pos),eg=em.terrain.getElevationForLngLatZoom(this._lngLat,em.transform.tileZoom);if(em.transform.lngLatToCameraDepth(this._lngLat,eg)-e_<.006)return void(this._element.style.opacity=this._opacity);let ey=-this._offset.y/em.transform.pixelsPerMeter,ex=Math.sin(em.getPitch()*Math.PI/180)*ey,ev=em.terrain.depthAtPoint(new es.P(this._pos.x,this._pos.y-this._offset.y)),eb=em.transform.lngLatToCameraDepth(this._lngLat,eg+ex)-ev>.006;(null===(ed=this._popup)||void 0===ed?void 0:ed.isOpen())&&eb&&this._popup.remove(),this._element.style.opacity=eb?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(en){return this._offset=es.P.convert(en),this._update(),this}addClassName(en){this._element.classList.add(en)}removeClassName(en){this._element.classList.remove(en)}toggleClassName(en){return this._element.classList.toggle(en)}setDraggable(en){return this._draggable=!!en,this._map&&(en?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(en){return this._rotation=en||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(en){return this._rotationAlignment=en||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(en){return this._pitchAlignment=en&&"auto"!==en?en:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(en,es){return(void 0===this._opacity||void 0===en&&void 0===es)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==en&&(this._opacity=en),void 0!==es&&(this._opacityWhenCovered=es),this._map&&this._updateOpacity(!0),this}};let tb={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},tw=0,tT=!1,tP={maxWidth:100,unit:"metric"};function ts(en,es,ec){let ed=ec&&ec.maxWidth||100,ep=en._container.clientHeight/2,ef=en._container.clientWidth/2,em=en.unproject([ef-ed/2,ep]),e_=en.unproject([ef+ed/2,ep]),eg=Math.round(en.project(e_).x-en.project(em).x),ey=Math.min(ed,eg,en._container.clientWidth),ex=em.distanceTo(e_);if(ec&&"imperial"===ec.unit){let ec=3.2808*ex;ec>5280?is(es,ey,ec/5280,en._getUIString("ScaleControl.Miles")):is(es,ey,ec,en._getUIString("ScaleControl.Feet"))}else ec&&"nautical"===ec.unit?is(es,ey,ex/1852,en._getUIString("ScaleControl.NauticalMiles")):ex>=1e3?is(es,ey,ex/1e3,en._getUIString("ScaleControl.Kilometers")):is(es,ey,ex,en._getUIString("ScaleControl.Meters"))}function is(en,es,ec,ed){let ep=function(en){let es=Math.pow(10,`${Math.floor(en)}`.length-1),ec=en/es;return es*(ec=ec>=10?10:ec>=5?5:ec>=3?3:ec>=2?2:ec>=1?1:function(en){let es=Math.pow(10,Math.ceil(-Math.log(en)/Math.LN10));return Math.round(en*es)/es}(ec))}(ec);en.style.width=es*(ep/ec)+"px",en.innerHTML=`${ep}&nbsp;${ed}`}let tS={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0};en.AJAXError=es.cz,en.Event=es.l,en.Evented=es.E,en.LngLat=es.S,en.MercatorCoordinate=es.a1,en.Point=es.P,en.addProtocol=es.cA,en.config=es.a,en.removeProtocol=es.cB,en.AttributionControl=Da,en.BoxZoomHandler=$r,en.CanvasSource=Y,en.CooperativeGesturesHandler=Ca,en.DoubleClickZoomHandler=ba,en.DragPanHandler=wa,en.DragRotateHandler=Ta,en.EdgeInsets=Mt,en.FullscreenControl=class extends es.E{constructor(en={}){super(),this._onFullscreenChange=()=>{var en;let es=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(en=null==es?void 0:es.shadowRoot)||void 0===en?void 0:en.fullscreenElement;)es=es.shadowRoot.fullscreenElement;es===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,en&&en.container&&(en.container instanceof HTMLElement?this._container=en.container:es.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(en){return this._map=en,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){n.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let en=this._fullscreenButton=n.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);n.create("span","maplibregl-ctrl-icon",en).setAttribute("aria-hidden","true"),en.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let en=this._getTitle();this._fullscreenButton.setAttribute("aria-label",en),this._fullscreenButton.title=en}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new es.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new es.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},en.GeoJSONSource=H,en.GeolocateControl=class extends es.E{constructor(en){super(),this._onSuccess=en=>{if(this._map){if(this._isOutOfMapMaxBounds(en))return this._setErrorState(),this.fire(new es.l("outofmaxbounds",en)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=en,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(en),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(en),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new es.l("geolocate",en)),this._finish()}},this._updateCamera=en=>{let ec=new es.S(en.coords.longitude,en.coords.latitude),ed=en.coords.accuracy,ep=this._map.getBearing(),ef=es.e({bearing:ep},this.options.fitBoundsOptions),em=G.fromLngLat(ec,ed);this._map.fitBounds(em,ef,{geolocateSource:!0})},this._updateMarker=en=>{if(en){let ec=new es.S(en.coords.longitude,en.coords.latitude);this._accuracyCircleMarker.setLngLat(ec).addTo(this._map),this._userLocationDotMarker.setLngLat(ec).addTo(this._map),this._accuracy=en.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=en=>{if(this._map){if(1===en.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let en=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=en,this._geolocateButton.setAttribute("aria-label",en),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===en.code&&tT)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new es.l("error",en)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",en=>en.preventDefault()),this._geolocateButton=n.create("button","maplibregl-ctrl-geolocate",this._container),n.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=en=>{if(this._map){if(!1===en){es.w("Geolocation support is not available so the GeolocateControl will be disabled.");let en=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=en,this._geolocateButton.setAttribute("aria-label",en)}else{let en=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=en,this._geolocateButton.setAttribute("aria-label",en)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ka({element:this._dotElement}),this._circleElement=n.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ka({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",en=>{let ec=(null==en?void 0:en[0])instanceof ResizeObserverEntry;en.geolocateSource||"ACTIVE_LOCK"!==this._watchState||ec||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new es.l("trackuserlocationend")),this.fire(new es.l("userlocationlostfocus")))})}},this.options=es.e({},tb,en)}onAdd(en){return this._map=en,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return es._(this,arguments,void 0,function*(en=!1){if(void 0!==eg&&!en)return eg;if(void 0===window.navigator.permissions)return eg=!!window.navigator.geolocation;try{let en=yield window.navigator.permissions.query({name:"geolocation"});eg="denied"!==en.state}catch(en){eg=!!window.navigator.geolocation}return eg})})().then(en=>this._finishSetupUI(en)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,tw=0,tT=!1}_isOutOfMapMaxBounds(en){let es=this._map.getMaxBounds(),ec=en.coords;return es&&(ec.longitude<es.getWest()||ec.longitude>es.getEast()||ec.latitude<es.getSouth()||ec.latitude>es.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){let en=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&en))return;let es=this._map.project(en),ec=this._map.unproject([es.x+100,es.y]),ed=en.distanceTo(ec)/100,ep=2*this._accuracy/ed;this._circleElement.style.width=`${ep.toFixed(2)}px`,this._circleElement.style.height=`${ep.toFixed(2)}px`}trigger(){if(!this._setup)return es.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new es.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tw--,tT=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new es.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new es.l("trackuserlocationstart")),this.fire(new es.l("userlocationfocus"));break;default:throw Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let en;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++tw>1?(en={maximumAge:6e5,timeout:0},tT=!0):(en=this.options.positionOptions,tT=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,en)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},en.GlobeControl=class{constructor(){this._toggleProjection=()=>{var en;let es=null===(en=this._map.getProjection())||void 0===en?void 0:en.type;this._map.setProjection("mercator"!==es&&es?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var en;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(en=this._map.getProjection())||void 0===en?void 0:en.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(en){return this._map=en,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=n.create("button","maplibregl-ctrl-globe",this._container),n.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){n.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},en.Hash=Er,en.ImageSource=X,en.KeyboardHandler=pa,en.LngLatBounds=G,en.LogoControl=Aa,en.Map=class extends Ra{constructor(en){var ec,ed;es.cw.mark(es.cx.create);let ep=Object.assign(Object.assign(Object.assign({},ty),en),{canvasContextAttributes:Object.assign(Object.assign({},ty.canvasContextAttributes),en.canvasContextAttributes)});if(null!=ep.minZoom&&null!=ep.maxZoom&&ep.minZoom>ep.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=ep.minPitch&&null!=ep.maxPitch&&ep.minPitch>ep.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=ep.minPitch&&ep.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=ep.maxPitch&&ep.maxPitch>180)throw Error("maxPitch must be less than or equal to 180");let ef=new Lt,em=new Ot;if(void 0!==ep.minZoom&&ef.setMinZoom(ep.minZoom),void 0!==ep.maxZoom&&ef.setMaxZoom(ep.maxZoom),void 0!==ep.minPitch&&ef.setMinPitch(ep.minPitch),void 0!==ep.maxPitch&&ef.setMaxPitch(ep.maxPitch),void 0!==ep.renderWorldCopies&&ef.setRenderWorldCopies(ep.renderWorldCopies),super(ef,em,{bearingSnap:ep.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new La,this._controls=[],this._mapId=es.a7(),this._contextLost=en=>{en.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new es.l("webglcontextlost",{originalEvent:en}))},this._contextRestored=en=>{this._setupPainter(),this.resize(),this._update(),this.fire(new es.l("webglcontextrestored",{originalEvent:en}))},this._onMapScroll=en=>{if(en.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=ep.interactive,this._maxTileCacheSize=ep.maxTileCacheSize,this._maxTileCacheZoomLevels=ep.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},ep.canvasContextAttributes),this._trackResize=!0===ep.trackResize,this._bearingSnap=ep.bearingSnap,this._centerClampedToGround=ep.centerClampedToGround,this._refreshExpiredTiles=!0===ep.refreshExpiredTiles,this._fadeDuration=ep.fadeDuration,this._crossSourceCollisions=!0===ep.crossSourceCollisions,this._collectResourceTiming=!0===ep.collectResourceTiming,this._locale=Object.assign(Object.assign({},tg),ep.locale),this._clickTolerance=ep.clickTolerance,this._overridePixelRatio=ep.pixelRatio,this._maxCanvasSize=ep.maxCanvasSize,this.transformCameraUpdate=ep.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===ep.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=ey.addThrottleControl(()=>this.isMoving()),this._requestManager=new m(ep.transformRequest),"string"==typeof ep.container){if(this._container=document.getElementById(ep.container),!this._container)throw Error(`Container '${ep.container}' not found.`)}else{if(!(ep.container instanceof HTMLElement))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=ep.container}if(ep.maxBounds&&this.setMaxBounds(ep.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let en=!1,es=Sr(en=>{this._trackResize&&!this._removed&&(this.resize(en),this.redraw())},50);this._resizeObserver=new ResizeObserver(ec=>{en?es(ec):en=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ea(this,ep),this._hash=ep.hash&&new Er("string"==typeof ep.hash&&ep.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:ep.center,elevation:ep.elevation,zoom:ep.zoom,bearing:ep.bearing,pitch:ep.pitch,roll:ep.roll}),ep.bounds&&(this.resize(),this.fitBounds(ep.bounds,es.e({},ep.fitBoundsOptions,{duration:0}))));let e_="string"==typeof ep.style||"globe"!==(null===(ed=null===(ec=ep.style)||void 0===ec?void 0:ec.projection)||void 0===ed?void 0:ed.type);this.resize(null,e_),this._localIdeographFontFamily=ep.localIdeographFontFamily,this._validateStyle=ep.validateStyle,ep.style&&this.setStyle(ep.style,{localIdeographFontFamily:ep.localIdeographFontFamily}),ep.attributionControl&&this.addControl(new Da("boolean"==typeof ep.attributionControl?void 0:ep.attributionControl)),ep.maplibreLogo&&this.addControl(new Aa,ep.logoPosition),this.on("style.load",()=>{if(e_||this._resizeTransform(),this.transform.unmodified){let en=es.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(en)}}),this.on("data",en=>{this._update("style"===en.dataType),this.fire(new es.l(`${en.dataType}data`,en))}),this.on("dataloading",en=>{this.fire(new es.l(`${en.dataType}dataloading`,en))}),this.on("dataabort",en=>{this.fire(new es.l("sourcedataabort",en))})}_getMapId(){return this._mapId}setGlobalStateProperty(en,es){return this.style.setGlobalStateProperty(en,es),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(en,ec){if(void 0===ec&&(ec=en.getDefaultPosition?en.getDefaultPosition():"top-right"),!en||!en.onAdd)return this.fire(new es.k(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let ed=en.onAdd(this);this._controls.push(en);let ep=this._controlPositions[ec];return -1!==ec.indexOf("bottom")?ep.insertBefore(ed,ep.firstChild):ep.appendChild(ed),this}removeControl(en){if(!en||!en.onRemove)return this.fire(new es.k(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let ec=this._controls.indexOf(en);return ec>-1&&this._controls.splice(ec,1),en.onRemove(this),this}hasControl(en){return this._controls.indexOf(en)>-1}coveringTiles(en){return ve(this.transform,en)}calculateCameraOptionsFromTo(en,es,ec,ed){return null==ed&&this.terrain&&(ed=this.terrain.getElevationForLngLatZoom(ec,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(en,es,ec,ed)}resize(en,ec=!0){let[ed,ep]=this._containerDimensions(),ef=this._getClampedPixelRatio(ed,ep);if(this._resizeCanvas(ed,ep,ef),this.painter.resize(ed,ep,ef),this.painter.overLimit()){let en=this.painter.context.gl;this._maxCanvasSize=[en.drawingBufferWidth,en.drawingBufferHeight];let es=this._getClampedPixelRatio(ed,ep);this._resizeCanvas(ed,ep,es),this.painter.resize(ed,ep,es)}this._resizeTransform(ec);let em=!this._moving;return em&&(this.stop(),this.fire(new es.l("movestart",en)).fire(new es.l("move",en))),this.fire(new es.l("resize",en)),em&&this.fire(new es.l("moveend",en)),this}_resizeTransform(en=!0){var es;let[ec,ed]=this._containerDimensions();this.transform.resize(ec,ed,en),null===(es=this._requestedCameraState)||void 0===es||es.resize(ec,ed,en)}_getClampedPixelRatio(en,es){let{0:ec,1:ed}=this._maxCanvasSize,ep=this.getPixelRatio(),ef=en*ep,em=es*ep;return Math.min(ef>ec?ec/ef:1,em>ed?ed/em:1)*ep}getPixelRatio(){var en;return null!==(en=this._overridePixelRatio)&&void 0!==en?en:devicePixelRatio}setPixelRatio(en){this._overridePixelRatio=en,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(en){return this.transform.setMaxBounds(G.convert(en)),this._update()}setMinZoom(en){if((en=null==en?-2:en)>=-2&&en<=this.transform.maxZoom)return this.transform.setMinZoom(en),this._update(),this.getZoom()<en&&this.setZoom(en),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(en){if((en=null==en?22:en)>=this.transform.minZoom)return this.transform.setMaxZoom(en),this._update(),this.getZoom()>en&&this.setZoom(en),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(en){if((en=null==en?0:en)<0)throw Error("minPitch must be greater than or equal to 0");if(en>=0&&en<=this.transform.maxPitch)return this.transform.setMinPitch(en),this._update(),this.getPitch()<en&&this.setPitch(en),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(en){if((en=null==en?60:en)>180)throw Error("maxPitch must be less than or equal to 180");if(en>=this.transform.minPitch)return this.transform.setMaxPitch(en),this._update(),this.getPitch()>en&&this.setPitch(en),this;throw Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(en){return this.transform.setRenderWorldCopies(en),this._update()}project(en){return this.transform.locationToScreenPoint(es.S.convert(en),this.style&&this.terrain)}unproject(en){return this.transform.screenPointToLocation(es.P.convert(en),this.terrain)}isMoving(){var en;return this._moving||(null===(en=this.handlers)||void 0===en?void 0:en.isMoving())}isZooming(){var en;return this._zooming||(null===(en=this.handlers)||void 0===en?void 0:en.isZooming())}isRotating(){var en;return this._rotating||(null===(en=this.handlers)||void 0===en?void 0:en.isRotating())}_createDelegatedListener(en,es,ec){if("mouseenter"===en||"mouseover"===en){let ed=!1;return{layers:es,listener:ec,delegates:{mousemove:ep=>{let ef=es.filter(en=>this.getLayer(en)),em=0!==ef.length?this.queryRenderedFeatures(ep.point,{layers:ef}):[];em.length?ed||(ed=!0,ec.call(this,new jr(en,this,ep.originalEvent,{features:em}))):ed=!1},mouseout:()=>{ed=!1}}}}if("mouseleave"===en||"mouseout"===en){let ed=!1;return{layers:es,listener:ec,delegates:{mousemove:ep=>{let ef=es.filter(en=>this.getLayer(en));(0!==ef.length?this.queryRenderedFeatures(ep.point,{layers:ef}):[]).length?ed=!0:ed&&(ed=!1,ec.call(this,new jr(en,this,ep.originalEvent)))},mouseout:es=>{ed&&(ed=!1,ec.call(this,new jr(en,this,es.originalEvent)))}}}}return{layers:es,listener:ec,delegates:{[en]:en=>{let ed=es.filter(en=>this.getLayer(en)),ep=0!==ed.length?this.queryRenderedFeatures(en.point,{layers:ed}):[];ep.length&&(en.features=ep,ec.call(this,en),delete en.features)}}}}_saveDelegatedListener(en,es){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[en]=this._delegatedListeners[en]||[],this._delegatedListeners[en].push(es)}_removeDelegatedListener(en,es,ec){if(!this._delegatedListeners||!this._delegatedListeners[en])return;let ed=this._delegatedListeners[en];for(let en=0;en<ed.length;en++){let ep=ed[en];if(ep.listener===ec&&ep.layers.length===es.length&&ep.layers.every(en=>es.includes(en))){for(let en in ep.delegates)this.off(en,ep.delegates[en]);return void ed.splice(en,1)}}}on(en,es,ec){if(void 0===ec)return super.on(en,es);let ed="string"==typeof es?[es]:es,ep=this._createDelegatedListener(en,ed,ec);for(let es in this._saveDelegatedListener(en,ep),ep.delegates)this.on(es,ep.delegates[es]);return{unsubscribe:()=>{this._removeDelegatedListener(en,ed,ec)}}}once(en,es,ec){if(void 0===ec)return super.once(en,es);let ed="string"==typeof es?[es]:es,ep=this._createDelegatedListener(en,ed,ec);for(let es in ep.delegates){let ef=ep.delegates[es];ep.delegates[es]=(...es)=>{this._removeDelegatedListener(en,ed,ec),ef(...es)}}for(let es in this._saveDelegatedListener(en,ep),ep.delegates)this.once(es,ep.delegates[es]);return this}off(en,es,ec){return void 0===ec?super.off(en,es):(this._removeDelegatedListener(en,"string"==typeof es?[es]:es,ec),this)}queryRenderedFeatures(en,ec){let ed;if(!this.style)return[];let ep=en instanceof es.P||Array.isArray(en),ef=ep?en:[[0,0],[this.transform.width,this.transform.height]];if(ec=ec||(ep?{}:en)||{},ef instanceof es.P||"number"==typeof ef[0])ed=[es.P.convert(ef)];else{let en=es.P.convert(ef[0]),ec=es.P.convert(ef[1]);ed=[en,new es.P(ec.x,en.y),ec,new es.P(en.x,ec.y),en]}return this.style.queryRenderedFeatures(ed,ec,this.transform)}querySourceFeatures(en,es){return this.style.querySourceFeatures(en,es)}setStyle(en,ec){return!1!==(ec=es.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},ec)).diff&&ec.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&en?(this._diffStyle(en,ec),this):(this._localIdeographFontFamily=ec.localIdeographFontFamily,this._updateStyle(en,ec))}setTransformRequest(en){return this._requestManager.setTransformRequest(en),this}_getUIString(en){let es=this._locale[en];if(null==es)throw Error(`Missing UI string '${en}'`);return es}_updateStyle(en,es){var ec,ed;if(es.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(en,es));let ep=this.style&&es.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!en)),en?(this.style=new wi(this,es||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof en?this.style.loadURL(en,es,ep):this.style.loadJSON(en,es,ep)):(null===(ed=null===(ec=this.style)||void 0===ec?void 0:ec.projection)||void 0===ed||ed.destroy(),delete this.style),this}_lazyInitEmptyStyle(){this.style||(this.style=new wi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(en,ec){if("string"==typeof en){let ed=this._requestManager.transformRequest(en,"Style");es.j(ed,new AbortController).then(en=>{this._updateDiff(en.data,ec)}).catch(en=>{en&&this.fire(new es.k(en))})}else"object"==typeof en&&this._updateDiff(en,ec)}_updateDiff(en,ec){try{this.style.setState(en,ec)&&this._update(!0)}catch(ed){es.w(`Unable to perform style diff: ${ed.message||ed.error||ed}.  Rebuilding the style from scratch.`),this._updateStyle(en,ec)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():es.w("There is no style added to the map.")}addSource(en,es){return this._lazyInitEmptyStyle(),this.style.addSource(en,es),this._update(!0)}isSourceLoaded(en){let ec=this.style&&this.style.sourceCaches[en];if(void 0!==ec)return ec.loaded();this.fire(new es.k(Error(`There is no source with ID '${en}'`)))}setTerrain(en){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),en){let ec=this.style.sourceCaches[en.source];if(!ec)throw Error(`cannot load terrain, because there exists no source with ID: ${en.source}`);for(let ed in null===this.terrain&&ec.reload(),this.style._layers){let ec=this.style._layers[ed];"hillshade"===ec.type&&ec.source===en.source&&es.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===ec.type&&ec.source===en.source&&es.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ba(this.painter,ec,en),this.painter.renderToTexture=new Na(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=es=>{var ec;"style"===es.dataType?this.terrain.sourceCache.freeRtt():"source"===es.dataType&&es.tile&&(es.sourceId!==en.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(ec=es.source)||void 0===ec?void 0:ec.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(es.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new es.l("terrain",{terrain:en})),this}getTerrain(){var en,es;return null!==(es=null===(en=this.terrain)||void 0===en?void 0:en.options)&&void 0!==es?es:null}areTilesLoaded(){let en=this.style&&this.style.sourceCaches;for(let es in en){let ec=en[es]._tiles;for(let en in ec){let es=ec[en];if("loaded"!==es.state&&"errored"!==es.state)return!1}}return!0}removeSource(en){return this.style.removeSource(en),this._update(!0)}getSource(en){return this.style.getSource(en)}setSourceTileLodParams(en,es,ec){if(ec){let ed=this.getSource(ec);if(!ed)throw Error(`There is no source with ID "${ec}", cannot set LOD parameters`);ed.calculateTileZoom=me(Math.max(1,en),Math.max(1,es))}else for(let ec in this.style.sourceCaches)this.style.sourceCaches[ec].getSource().calculateTileZoom=me(Math.max(1,en),Math.max(1,es));return this._update(!0),this}refreshTiles(en,ec){let ed=this.style.sourceCaches[en];if(!ed)throw Error(`There is no source cache with ID "${en}", cannot refresh tile`);void 0===ec?ed.reload(!0):ed.refreshTiles(ec.map(en=>new es.a4(en.z,en.x,en.y)))}addImage(en,ec,ed={}){let{pixelRatio:ep=1,sdf:ef=!1,stretchX:em,stretchY:e_,content:eg,textFitWidth:ey,textFitHeight:ex}=ed;if(this._lazyInitEmptyStyle(),!(ec instanceof HTMLImageElement||es.b(ec))){if(void 0===ec.width||void 0===ec.height)return this.fire(new es.k(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:ed,height:ev,data:eb}=ec;return this.style.addImage(en,{data:new es.R({width:ed,height:ev},new Uint8Array(eb)),pixelRatio:ep,stretchX:em,stretchY:e_,content:eg,textFitWidth:ey,textFitHeight:ex,sdf:ef,version:0,userImage:ec}),ec.onAdd&&ec.onAdd(this,en),this}}{let{width:ed,height:eb,data:ew}=ev.getImageData(ec);this.style.addImage(en,{data:new es.R({width:ed,height:eb},ew),pixelRatio:ep,stretchX:em,stretchY:e_,content:eg,textFitWidth:ey,textFitHeight:ex,sdf:ef,version:0})}}updateImage(en,ec){let ed=this.style.getImage(en);if(!ed)return this.fire(new es.k(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let ep=ec instanceof HTMLImageElement||es.b(ec)?ev.getImageData(ec):ec,{width:ef,height:em,data:e_}=ep;if(void 0===ef||void 0===em)return this.fire(new es.k(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ef!==ed.data.width||em!==ed.data.height)return this.fire(new es.k(Error("The width and height of the updated image must be that same as the previous version of the image")));let eg=!(ec instanceof HTMLImageElement||es.b(ec));return ed.data.replace(e_,eg),this.style.updateImage(en,ed),this}getImage(en){return this.style.getImage(en)}hasImage(en){return en?!!this.style.getImage(en):(this.fire(new es.k(Error("Missing required image id"))),!1)}removeImage(en){this.style.removeImage(en)}loadImage(en){return ey.getImage(this._requestManager.transformRequest(en,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(en,es){return this._lazyInitEmptyStyle(),this.style.addLayer(en,es),this._update(!0)}moveLayer(en,es){return this.style.moveLayer(en,es),this._update(!0)}removeLayer(en){return this.style.removeLayer(en),this._update(!0)}getLayer(en){return this.style.getLayer(en)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(en,es,ec){return this.style.setLayerZoomRange(en,es,ec),this._update(!0)}setFilter(en,es,ec={}){return this.style.setFilter(en,es,ec),this._update(!0)}getFilter(en){return this.style.getFilter(en)}setPaintProperty(en,es,ec,ed={}){return this.style.setPaintProperty(en,es,ec,ed),this._update(!0)}getPaintProperty(en,es){return this.style.getPaintProperty(en,es)}setLayoutProperty(en,es,ec,ed={}){return this.style.setLayoutProperty(en,es,ec,ed),this._update(!0)}getLayoutProperty(en,es){return this.style.getLayoutProperty(en,es)}setGlyphs(en,es={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(en,es),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(en,es,ec={}){return this._lazyInitEmptyStyle(),this.style.addSprite(en,es,ec,en=>{en||this._update(!0)}),this}removeSprite(en){return this._lazyInitEmptyStyle(),this.style.removeSprite(en),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(en,es={}){return this._lazyInitEmptyStyle(),this.style.setSprite(en,es,en=>{en||this._update(!0)}),this}setLight(en,es={}){return this._lazyInitEmptyStyle(),this.style.setLight(en,es),this._update(!0)}getLight(){return this.style.getLight()}setSky(en,es={}){return this._lazyInitEmptyStyle(),this.style.setSky(en,es),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(en,es){return this.style.setFeatureState(en,es),this._update()}removeFeatureState(en,es){return this.style.removeFeatureState(en,es),this._update()}getFeatureState(en){return this.style.getFeatureState(en)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let en=0,es=0;return this._container&&(en=this._container.clientWidth||400,es=this._container.clientHeight||300),[en,es]}_setupContainer(){let en=this._container;en.classList.add("maplibregl-map");let es=this._canvasContainer=n.create("div","maplibregl-canvas-container",en);this._interactive&&es.classList.add("maplibregl-interactive"),this._canvas=n.create("canvas","maplibregl-canvas",es),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let ec=this._containerDimensions(),ed=this._getClampedPixelRatio(ec[0],ec[1]);this._resizeCanvas(ec[0],ec[1],ed);let ep=this._controlContainer=n.create("div","maplibregl-control-container",en),ef=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(en=>{ef[en]=n.create("div",`maplibregl-ctrl-${en} `,ep)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(en,es,ec){this._canvas.width=Math.floor(ec*en),this._canvas.height=Math.floor(ec*es),this._canvas.style.width=`${en}px`,this._canvas.style.height=`${es}px`}_setupPainter(){let en=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),es=null;this._canvas.addEventListener("webglcontextcreationerror",ec=>{es={requestedAttributes:en},ec&&(es.statusMessage=ec.statusMessage,es.type=ec.type)},{once:!0});let ec=null;if(!(ec=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,en):this._canvas.getContext("webgl2",en)||this._canvas.getContext("webgl",en))){let en="Failed to initialize WebGL";throw es?(es.message=en,Error(JSON.stringify(es))):Error(en)}this.painter=new Mr(ec,this.transform),eb.testSupport(ec)}migrateProjection(en,ec){super.migrateProjection(en,ec),this.painter.transform=en,this.fire(new es.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(en){return this.style&&this.style._loaded&&(this._styleDirty=this._styleDirty||en,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(en){return this._update(),this._renderTaskQueue.add(en)}_cancelRenderFrame(en){this._renderTaskQueue.remove(en)}_render(en){var ec,ed,ep,ef,em;let e_=this._idleTriggered?this._fadeDuration:0,eg=(null===(ec=this.style.projection)||void 0===ec?void 0:ec.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(en),this._removed)return;let ey=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let en=this.transform.zoom,ec=ev.now();this.style.zoomHistory.update(en,ec);let ed=new es.F(en,{now:ec,fadeDuration:e_,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ep=ed.crossFadingFactor();1===ep&&ep===this._crossFadingFactor||(ey=!0,this._crossFadingFactor=ep),this.style.update(ed)}let ex=(null===(ed=this.style.projection)||void 0===ed?void 0:ed.transitionState)>0!==eg;null===(ep=this.style.projection)||void 0===ep||ep.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(ef=this.style.projection)||void 0===ef?void 0:ef.transitionState,null===(em=this.style.projection)||void 0===em?void 0:em.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||ex)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,e_,this._crossSourceCollisions,ex),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e_,showPadding:this.showPadding}),this.fire(new es.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,es.cw.mark(es.cx.load),this.fire(new es.l("load"))),this.style&&(this.style.hasTransitions()||ey)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let eb=this._sourcesDirty||this._styleDirty||this._placementDirty;return eb||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new es.l("idle")),!this._loaded||this._fullyLoaded||eb||(this._fullyLoaded=!0,es.cw.mark(es.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var en;for(let en of(this._hash&&this._hash.remove(),this._controls))en.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),ey.removeThrottleControl(this._imageQueueHandle),null===(en=this._resizeObserver)||void 0===en||en.disconnect();let ec=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==ec?void 0:ec.loseContext)&&ec.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),n.remove(this._canvasContainer),n.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),es.cw.clearMetrics(),this._removed=!0,this.fire(new es.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ev.frame(this._frameRequest,en=>{es.cw.frame(en),this._frameRequest=null;try{this._render(en)}catch(en){if(!es.cy(en)&&en.message!==eY)throw en}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(en){this._showTileBoundaries!==en&&(this._showTileBoundaries=en,this._update())}get showPadding(){return!!this._showPadding}set showPadding(en){this._showPadding!==en&&(this._showPadding=en,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(en){this._showCollisionBoxes!==en&&(this._showCollisionBoxes=en,en?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(en){this._showOverdrawInspector!==en&&(this._showOverdrawInspector=en,this._update())}get repaint(){return!!this._repaint}set repaint(en){this._repaint!==en&&(this._repaint=en,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(en){this._vertices=en,this._update()}get version(){return ex}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(en){return this._lazyInitEmptyStyle(),this.style.setProjection(en),this._update(!0)}},en.MapMouseEvent=jr,en.MapTouchEvent=Nr,en.MapWheelEvent=Ur,en.Marker=Ka,en.NavigationControl=class{constructor(en){this._updateZoomButtons=()=>{let en=this._map.getZoom(),es=en===this._map.getMaxZoom(),ec=en===this._map.getMinZoom();this._zoomInButton.disabled=es,this._zoomOutButton.disabled=ec,this._zoomInButton.setAttribute("aria-disabled",es.toString()),this._zoomOutButton.setAttribute("aria-disabled",ec.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(en,es)=>{let ec=this._map._getUIString(`NavigationControl.${es}`);en.title=ec,en.setAttribute("aria-label",ec)},this.options=es.e({},tx,en),this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",en=>en.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",en=>this._map.zoomIn({},{originalEvent:en})),n.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",en=>this._map.zoomOut({},{originalEvent:en})),n.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",en=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:en}):this._map.resetNorth({},{originalEvent:en})}),this._compassIcon=n.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(en){return this._map=en,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $a(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(en,es){let ec=n.create("button",en,this._container);return ec.type="button",ec.addEventListener("click",es),ec}},en.Popup=class extends es.E{constructor(en){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new es.l("close"))),this),this._onMouseUp=en=>{this._update(en.point)},this._onMouseMove=en=>{this._update(en.point)},this._onDrag=en=>{this._update(en.point)},this._update=en=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=n.create("div","maplibregl-popup",this._map.getContainer()),this._tip=n.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let en of this.options.className.split(" "))this._container.classList.add(en);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Wa(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!en)return;let ec=this._flatPos=this._pos=this._trackPointer&&en?en:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&en?en:this._map.transform.locationToScreenPoint(this._lngLat));let ed=this.options.anchor,ep=function as(en){if(en){if("number"==typeof en){let ec=Math.round(Math.abs(en)/Math.SQRT2);return{center:new es.P(0,0),top:new es.P(0,en),"top-left":new es.P(ec,ec),"top-right":new es.P(-ec,ec),bottom:new es.P(0,-en),"bottom-left":new es.P(ec,-ec),"bottom-right":new es.P(-ec,-ec),left:new es.P(en,0),right:new es.P(-en,0)}}if(en instanceof es.P||Array.isArray(en)){let ec=es.P.convert(en);return{center:ec,top:ec,"top-left":ec,"top-right":ec,bottom:ec,"bottom-left":ec,"bottom-right":ec,left:ec,right:ec}}return{center:es.P.convert(en.center||[0,0]),top:es.P.convert(en.top||[0,0]),"top-left":es.P.convert(en["top-left"]||[0,0]),"top-right":es.P.convert(en["top-right"]||[0,0]),bottom:es.P.convert(en.bottom||[0,0]),"bottom-left":es.P.convert(en["bottom-left"]||[0,0]),"bottom-right":es.P.convert(en["bottom-right"]||[0,0]),left:es.P.convert(en.left||[0,0]),right:es.P.convert(en.right||[0,0])}}return as(new es.P(0,0))}(this.options.offset);if(!ed){let en;let es=this._container.offsetWidth,ef=this._container.offsetHeight;en=ec.y+ep.bottom.y<ef?["top"]:ec.y>this._map.transform.height-ef?["bottom"]:[],ec.x<es/2?en.push("left"):ec.x>this._map.transform.width-es/2&&en.push("right"),ed=0===en.length?"bottom":en.join("-")}let ef=ec.add(ep[ed]);this.options.subpixelPositioning||(ef=ef.round()),n.setTransform(this._container,`${tv[ed]} translate(${ef.x}px,${ef.y}px)`),Xa(this._container,ed,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=es.e(Object.create(tS),en)}addTo(en){return this._map&&this.remove(),this._map=en,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new es.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(en){return this._lngLat=es.S.convert(en),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(en){return this.setDOMContent(document.createTextNode(en))}setHTML(en){let es;let ec=document.createDocumentFragment(),ed=document.createElement("body");for(ed.innerHTML=en;es=ed.firstChild;)ec.appendChild(es);return this.setDOMContent(ec)}getMaxWidth(){var en;return null===(en=this._container)||void 0===en?void 0:en.style.maxWidth}setMaxWidth(en){return this.options.maxWidth=en,this._update(),this}setDOMContent(en){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(en),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(en){return this._container&&this._container.classList.add(en),this}removeClassName(en){return this._container&&this._container.classList.remove(en),this}setOffset(en){return this.options.offset=en,this._update(),this}toggleClassName(en){if(this._container)return this._container.classList.toggle(en)}setSubpixelPositioning(en){this.options.subpixelPositioning=en}_createCloseButton(){this.options.closeButton&&(this._closeButton=n.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let en=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");en&&en.focus()}},en.RasterDEMTileSource=W,en.RasterTileSource=q,en.ScaleControl=class{constructor(en){this._onMove=()=>{ts(this._map,this._container,this.options)},this.setUnit=en=>{this.options.unit=en,ts(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},tP),en)}getDefaultPosition(){return"bottom-left"}onAdd(en){return this._map=en,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-scale",en.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},en.ScrollZoomHandler=va,en.Style=wi,en.TerrainControl=class{constructor(en){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=en}onAdd(en){return this._map=en,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=n.create("button","maplibregl-ctrl-terrain",this._container),n.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){n.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},en.TwoFingersTouchPitchHandler=da,en.TwoFingersTouchRotateHandler=ha,en.TwoFingersTouchZoomHandler=la,en.TwoFingersTouchZoomRotateHandler=Pa,en.VectorTileSource=$,en.VideoSource=K,en.addSourceType=(en,ec)=>es._(void 0,void 0,void 0,function*(){if(J(en))throw Error(`A source type called "${en}" already exists.`);eE[en]=ec}),en.clearPrewarmedResources=function(){let en=ef;en&&(en.isPreloaded()&&1===en.numActive()?(en.release(eC),ef=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},en.createTileMesh=Xt,en.getMaxParallelImageRequests=function(){return es.a.MAX_PARALLEL_IMAGE_REQUESTS},en.getRTLTextPluginStatus=function(){return oe().getRTLTextPluginStatus()},en.getVersion=function(){return ex},en.getWorkerCount=function(){return z.workerCount},en.getWorkerUrl=function(){return es.a.WORKER_URL},en.importScriptInWorkers=function(en){return B().broadcast("IS",en)},en.prewarm=function(){k().acquire(eC)},en.setMaxParallelImageRequests=function(en){es.a.MAX_PARALLEL_IMAGE_REQUESTS=en},en.setRTLTextPlugin=function(en,es){return oe().setRTLTextPlugin(en,es)},en.setWorkerCount=function(en){z.workerCount=en},en.setWorkerUrl=function(en){es.a.WORKER_URL=en}}),en}()}}]);